var Pa=e=>{throw TypeError(e)};var Da=(e,t,r)=>t.has(e)||Pa("Cannot "+r);var G=(e,t,r)=>(Da(e,t,"read from private field"),r?r.call(e):t.get(e)),Te=(e,t,r)=>t.has(e)?Pa("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),xe=(e,t,r,n)=>(Da(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var Ma=(e,t,r,n)=>({set _(s){xe(e,t,s,r)},get _(){return G(e,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var $a;(function(e){e[e.SysFatal=1]="SysFatal",e[e.SysTransient=2]="SysTransient",e[e.DestinationInvalid=3]="DestinationInvalid",e[e.CanisterReject=4]="CanisterReject",e[e.CanisterError=5]="CanisterError"})($a||($a={}));var Wr;(function(e){e.Replied="replied",e.Rejected="rejected"})(Wr||(Wr={}));function gd(e){return e!=null&&"reject_code"in e}function _d(e){return e!=null&&"certificate"in e}const Ts="abcdefghijklmnopqrstuvwxyz234567",Xr=Object.create(null);for(let e=0;e<Ts.length;e++)Xr[Ts[e]]=e;Xr[0]=Xr.o;Xr[1]=Xr.i;function bd(e){let t=0,r=0,n="";function s(i){return t<0?r|=i>>-t:r=i<<t&248,t>3?(t-=8,1):(t<4&&(n+=Ts[r>>3],t+=5),0)}for(let i=0;i<e.length;)i+=s(e[i]);return n+(t<0?Ts[r>>3]:"")}function wd(e){let t=0,r=0;const n=new Uint8Array(e.length*4/3|0);let s=0;function i(o){let a=Xr[o.toLowerCase()];if(a===void 0)throw new Error(`Invalid character: ${JSON.stringify(o)}`);a<<=3,r|=a>>>t,t+=5,t>=8&&(n[s++]=r,t-=8,t>0?r=a<<5-t&255:r=0)}for(const o of e)i(o);return n.slice(0,s)}const xd=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function Ed(e){let t=-1;for(let r=0;r<e.length;r++){const s=(e[r]^t)&255;t=xd[s]^t>>>8}return(t^-1)>>>0}const kr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Jn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function vd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function He(e,...t){if(!Jn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function La(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Nd(e,t){He(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function En(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ji(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function st(e,t){return e<<32-t|e>>>t}const au=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Td=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function re(e){if(He(e),au)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Td[e[r]];return t}const _t={_0:48,_9:57,A:65,F:70,a:97,f:102};function qa(e){if(e>=_t._0&&e<=_t._9)return e-_t._0;if(e>=_t.A&&e<=_t.F)return e-(_t.A-10);if(e>=_t.a&&e<=_t.f)return e-(_t.a-10)}function dt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(au)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=qa(e.charCodeAt(i)),a=qa(e.charCodeAt(i+1));if(o===void 0||a===void 0){const c=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Q(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function cu(e){return typeof e=="string"&&(e=Q(e)),He(e),e}function ee(...e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];He(s),t+=s.length}const r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){const i=e[n];r.set(i,s),s+=i.length}return r}class Id{}function Lo(e){const t=n=>e().update(cu(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function uu(e=32){if(kr&&typeof kr.getRandomValues=="function")return kr.getRandomValues(new Uint8Array(e));if(kr&&typeof kr.randomBytes=="function")return Uint8Array.from(kr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Rd(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}function Od(e,t,r){return e&t^~e&r}function Sd(e,t,r){return e&t^e&r^t&r}class lu extends Id{constructor(t,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(t),this.view=ji(this.buffer)}update(t){La(this),t=cu(t),He(t);const{view:r,buffer:n,blockLen:s}=this,i=t.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=ji(t);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){La(this),Nd(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,En(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let d=o;d<s;d++)r[d]=0;Rd(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=ji(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,f[d],i)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=i,t.length=s,t.pos=a,s%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const Vt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),Ie=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),is=BigInt(2**32-1),ja=BigInt(32);function Ad(e,t=!1){return t?{h:Number(e&is),l:Number(e>>ja&is)}:{h:Number(e>>ja&is)|0,l:Number(e&is)|0}}function Cd(e,t=!1){const r=e.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=Ad(e[i],t);[n[i],s[i]]=[o,a]}return[n,s]}const Ka=(e,t,r)=>e>>>r,Ga=(e,t,r)=>e<<32-r|t>>>r,Fr=(e,t,r)=>e>>>r|t<<32-r,Ur=(e,t,r)=>e<<32-r|t>>>r,os=(e,t,r)=>e<<64-r|t>>>r-32,as=(e,t,r)=>e>>>r-32|t<<64-r;function bt(e,t,r,n){const s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:s|0}}const Bd=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Vd=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,kd=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Fd=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0,Ud=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0),Pd=(e,t,r,n,s,i)=>t+r+n+s+i+(e/2**32|0)|0,Dd=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64);class du extends lu{constructor(t=32){super(64,t,8,!1),this.A=Vt[0]|0,this.B=Vt[1]|0,this.C=Vt[2]|0,this.D=Vt[3]|0,this.E=Vt[4]|0,this.F=Vt[5]|0,this.G=Vt[6]|0,this.H=Vt[7]|0}get(){const{A:t,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[t,r,n,s,i,o,a,c]}set(t,r,n,s,i,o,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,r){for(let d=0;d<16;d++,r+=4)Ft[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){const l=Ft[d-15],h=Ft[d-2],y=st(l,7)^st(l,18)^l>>>3,g=st(h,17)^st(h,19)^h>>>10;Ft[d]=g+Ft[d-7]+y+Ft[d-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:u,H:f}=this;for(let d=0;d<64;d++){const l=st(a,6)^st(a,11)^st(a,25),h=f+l+Od(a,c,u)+Dd[d]+Ft[d]|0,g=(st(n,2)^st(n,13)^st(n,22))+Sd(n,s,i)|0;f=u,u=c,c=a,a=o+h|0,o=i,i=s,s=n,n=h+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,s,i,o,a,c,u,f)}roundClean(){En(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),En(this.buffer)}}class Md extends du{constructor(){super(28),this.A=kt[0]|0,this.B=kt[1]|0,this.C=kt[2]|0,this.D=kt[3]|0,this.E=kt[4]|0,this.F=kt[5]|0,this.G=kt[6]|0,this.H=kt[7]|0}}const fu=Cd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),$d=fu[0],Ld=fu[1],Ut=new Uint32Array(80),Pt=new Uint32Array(80);class qd extends lu{constructor(t=64){super(128,t,16,!1),this.Ah=Ie[0]|0,this.Al=Ie[1]|0,this.Bh=Ie[2]|0,this.Bl=Ie[3]|0,this.Ch=Ie[4]|0,this.Cl=Ie[5]|0,this.Dh=Ie[6]|0,this.Dl=Ie[7]|0,this.Eh=Ie[8]|0,this.El=Ie[9]|0,this.Fh=Ie[10]|0,this.Fl=Ie[11]|0,this.Gh=Ie[12]|0,this.Gl=Ie[13]|0,this.Hh=Ie[14]|0,this.Hl=Ie[15]|0}get(){const{Ah:t,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:u,El:f,Fh:d,Fl:l,Gh:h,Gl:y,Hh:g,Hl:_}=this;return[t,r,n,s,i,o,a,c,u,f,d,l,h,y,g,_]}set(t,r,n,s,i,o,a,c,u,f,d,l,h,y,g,_){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=d|0,this.Fl=l|0,this.Gh=h|0,this.Gl=y|0,this.Hh=g|0,this.Hl=_|0}process(t,r){for(let p=0;p<16;p++,r+=4)Ut[p]=t.getUint32(r),Pt[p]=t.getUint32(r+=4);for(let p=16;p<80;p++){const E=Ut[p-15]|0,v=Pt[p-15]|0,N=Fr(E,v,1)^Fr(E,v,8)^Ka(E,v,7),I=Ur(E,v,1)^Ur(E,v,8)^Ga(E,v,7),R=Ut[p-2]|0,x=Pt[p-2]|0,O=Fr(R,x,19)^os(R,x,61)^Ka(R,x,6),B=Ur(R,x,19)^as(R,x,61)^Ga(R,x,6),A=kd(I,B,Pt[p-7],Pt[p-16]),w=Fd(A,N,O,Ut[p-7],Ut[p-16]);Ut[p]=w|0,Pt[p]=A|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:u,Dl:f,Eh:d,El:l,Fh:h,Fl:y,Gh:g,Gl:_,Hh:m,Hl:b}=this;for(let p=0;p<80;p++){const E=Fr(d,l,14)^Fr(d,l,18)^os(d,l,41),v=Ur(d,l,14)^Ur(d,l,18)^as(d,l,41),N=d&h^~d&g,I=l&y^~l&_,R=Ud(b,v,I,Ld[p],Pt[p]),x=Pd(R,m,E,N,$d[p],Ut[p]),O=R|0,B=Fr(n,s,28)^os(n,s,34)^os(n,s,39),A=Ur(n,s,28)^as(n,s,34)^as(n,s,39),w=n&i^n&a^i&a,T=s&o^s&c^o&c;m=g|0,b=_|0,g=h|0,_=y|0,h=d|0,y=l|0,{h:d,l}=bt(u|0,f|0,x|0,O|0),u=a|0,f=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const C=Bd(O,A,T);n=Vd(C,x,B,w),s=C|0}({h:n,l:s}=bt(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=bt(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=bt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=bt(this.Dh|0,this.Dl|0,u|0,f|0),{h:d,l}=bt(this.Eh|0,this.El|0,d|0,l|0),{h,l:y}=bt(this.Fh|0,this.Fl|0,h|0,y|0),{h:g,l:_}=bt(this.Gh|0,this.Gl|0,g|0,_|0),{h:m,l:b}=bt(this.Hh|0,this.Hl|0,m|0,b|0),this.set(n,s,i,o,a,c,u,f,d,l,h,y,g,_,m,b)}roundClean(){En(Ut,Pt)}destroy(){En(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Ge=Lo(()=>new du),jd=Lo(()=>new Md),Kd=Lo(()=>new qd),cs="__principal__",Gd=2,Ha=4,Hd="aaaaa-aa";let D=class Dr{static anonymous(){return new this(new Uint8Array([Ha]))}static managementCanister(){return this.fromText(Hd)}static selfAuthenticating(t){const r=jd(t);return new this(new Uint8Array([...r,Gd]))}static from(t){if(typeof t=="string")return Dr.fromText(t);if(Object.getPrototypeOf(t)===Uint8Array.prototype)return new Dr(t);if(Dr.isPrincipal(t))return new Dr(t._arr);throw new Error(`Impossible to convert ${JSON.stringify(t)} to Principal.`)}static fromHex(t){return new this(dt(t))}static fromText(t){let r=t;if(t.includes(cs)){const o=JSON.parse(t);cs in o&&(r=o[cs])}const n=r.toLowerCase().replace(/-/g,"");let s=wd(n);s=s.slice(4,s.length);const i=new this(s);if(i.toText()!==r)throw new Error(`Principal "${i.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return i}static fromUint8Array(t){return new this(t)}static isPrincipal(t){return t instanceof Dr||typeof t=="object"&&t!==null&&"_isPrincipal"in t&&t._isPrincipal===!0&&"_arr"in t&&t._arr instanceof Uint8Array}constructor(t){this._arr=t,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===Ha}toUint8Array(){return this._arr}toHex(){return re(this._arr).toUpperCase()}toText(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,Ed(this._arr));const n=new Uint8Array(t),s=new Uint8Array([...n,...this._arr]),o=bd(s).match(/.{1,5}/g);if(!o)throw new Error;return o.join("-")}toString(){return this.toText()}toJSON(){return{[cs]:this.toText()}}compareTo(t){for(let r=0;r<Math.min(this._arr.length,t._arr.length);r++){if(this._arr[r]<t._arr[r])return"lt";if(this._arr[r]>t._arr[r])return"gt"}return this._arr.length<t._arr.length?"lt":this._arr.length>t._arr.length?"gt":"eq"}ltEq(t){const r=this.compareTo(t);return r=="lt"||r=="eq"}gtEq(t){const r=this.compareTo(t);return r=="gt"||r=="eq"}};var St;(function(e){e.Trust="Trust",e.Protocol="Protocol",e.Reject="Reject",e.Transport="Transport",e.External="External",e.Limit="Limit",e.Input="Input",e.Unknown="Unknown"})(St||(St={}));class K{constructor(t=!1){this.isCertified=t}toString(){let t=this.toErrorMessage();return this.requestContext&&(t+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?re(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${re(this.requestContext.senderPubKey)}
  Sender signature (hex): ${re(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(t+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),t}}class at extends Error{get code(){return this.cause.code}set code(t){this.cause.code=t}get kind(){return this.cause.kind}set kind(t){this.cause.kind=t}get isCertified(){return this.code.isCertified}constructor(t,r){super(t.toString()),this.name="AgentError",this.cause={code:t,kind:r},Object.setPrototypeOf(this,at.prototype)}hasCode(t){return this.code instanceof t}toString(){return`${this.name} (${this.kind}): ${this.message}`}}class Sr extends at{static fromCode(t){return new this(t)}}class De extends Sr{constructor(t){super(t,St.Trust),this.name="TrustError",Object.setPrototypeOf(this,De.prototype)}}class ae extends Sr{constructor(t){super(t,St.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,ae.prototype)}}class qr extends Sr{constructor(t){super(t,St.Reject),this.name="RejectError",Object.setPrototypeOf(this,qr.prototype)}}class Is extends Sr{constructor(t){super(t,St.Transport),this.name="TransportError",Object.setPrototypeOf(this,Is.prototype)}}class Ce extends Sr{constructor(t){super(t,St.External),this.name="ExternalError",Object.setPrototypeOf(this,Ce.prototype)}}class ne extends Sr{constructor(t){super(t,St.Input),this.name="InputError",Object.setPrototypeOf(this,ne.prototype)}}class Re extends Sr{constructor(t){super(t,St.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,Re.prototype)}}class zt extends K{constructor(t,r){super(),this.reason=t,this.error=r,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,zt.prototype)}toErrorMessage(){let t=this.reason;return this.error&&(t+=`: ${ts(this.error)}`),`Certificate verification error: "${t}"`}}class Jr extends K{constructor(t,r,n,s,i){super(),this.maxAgeInMinutes=t,this.certificateTime=r,this.currentTime=n,this.timeDiffMsecs=s,this.ageType=i,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,Jr.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()} Clock drift: ${this.timeDiffMsecs}ms`}}class qo extends K{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,qo.prototype)}toErrorMessage(){return"Certificate has too many delegations"}}class Qn extends K{constructor(t,r){super(),this.canisterId=t,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,Qn.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: ${this.subnetId.toText()}`}}class jo extends K{constructor(t){super(),this.subnetId=t,this.name="CertificateNotAuthorizedForSubnetErrorCode",Object.setPrototypeOf(this,jo.prototype)}toErrorMessage(){return`The certificate is not authorized for subnet ${this.subnetId.toText()}`}}class vr extends K{constructor(t,r){super(),this.message=t,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,vr.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}}class Ko extends K{constructor(t){super(),this.message=t,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,Ko.prototype)}toErrorMessage(){return this.message}}class Go extends K{constructor(t){super(),this.message=t,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,Go.prototype)}toErrorMessage(){return this.message}}class Ys extends K{constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,Ys.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}}class Ho extends K{constructor(t,r){super(),this.expectedPrefix=t,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,Ho.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${re(this.expectedPrefix)}, but got ${re(this.actualPrefix)}`}}class zo extends K{constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,zo.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}}class At extends K{constructor(t){super(),this.error=t,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,At.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}}class Ws extends K{constructor(t){super(),this.error=t,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,Ws.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}}class Zo extends K{constructor(t,r){super(),this.error=t,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,Zo.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${ts(this.error)}, input: ${re(this.input)}`}}class Yo extends K{constructor(t,r){super(),this.error=t,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,Yo.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${ts(this.error)}, input: ${this.value}`}}class vn extends K{constructor(t,r,n){super(),this.message=t,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,vn.prototype)}toErrorMessage(){let t=`${this.message}
`;return this.requestId&&(t+=`  Request ID: ${re(this.requestId)}
`),this.status&&(t+=`  Request status: ${this.status}
`),t}}class Wo extends K{constructor(t,r,n){super(),this.maxIngressExpiryInMinutes=t,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,Wo.prototype)}toErrorMessage(){let t=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${re(this.requestId)}
`;return this.retryTimes!==void 0&&(t+=`  Retried ${this.retryTimes} times.`),t}}class Xs extends K{constructor(t,r,n,s){super(!0),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,Xs.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Xo extends K{constructor(t,r,n,s,i){super(),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.signatures=i,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,Xo.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Jo extends K{constructor(t,r,n,s){super(),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.name="UncertifiedRejectUpdateErrorCode",Object.setPrototypeOf(this,Jo.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Qo extends K{constructor(t){super(),this.requestId=t,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,Qo.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${re(this.requestId)}
`}}class Ar extends K{constructor(t){super(),this.shouldFetchRootKey=t,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,Ar.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}}class ea extends K{constructor(t){super(),this.value=t,this.name="HashValueErrorCode",Object.setPrototypeOf(this,ea.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}}class _n extends K{constructor(t){super(),this.error=t,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,_n.prototype)}toErrorMessage(){return this.error}}class pr extends K{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,pr.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}}class Et extends K{constructor(t,r){super(),this.message=t,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,Et.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}}class ta extends K{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,ta.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}}class ra extends K{constructor(t){super(),this.error=t,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,ra.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}}class na extends K{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,na.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}}class sa extends K{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,sa.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}}class ia extends K{constructor(t){super(),this.nodeId=t,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,ia.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}}class Me extends K{constructor(t){super(),this.error=t,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,Me.prototype)}toErrorMessage(){return`Unexpected error: ${ts(this.error)}`}}class es extends K{constructor(t){super(),this.error=t,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,es.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}}class Rs extends K{constructor(t,r,n,s){super(),this.status=t,this.statusText=r,this.headers=n,this.bodyText=s,this.name="HttpErrorCode",Object.setPrototypeOf(this,Rs.prototype)}toErrorMessage(){let t=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(t+=`  Body: ${this.bodyText}
`),t}}class Os extends K{constructor(){super(),this.name="HttpV4ApiNotSupportedErrorCode",Object.setPrototypeOf(this,Os.prototype)}toErrorMessage(){return"HTTP request failed: v4 API is not supported"}}class Ss extends K{constructor(t){super(),this.error=t,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,Ss.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${ts(this.error)}`}}class As extends K{constructor(t){super(),this.receivedCanisterId=t,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,As.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}}class oa extends K{constructor(t){super(),this.request=t,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,oa.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}}class Cs extends K{constructor(t){super(),this.error=t,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,Cs.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}}function ts(e){if(e instanceof Error)return e.stack??e.message;try{return JSON.stringify(e)}catch{return String(e)}}const Ot=new Error("unreachable");function X(...e){const t=new Uint8Array(e.reduce((n,s)=>n+s.byteLength,0));let r=0;for(const n of e)t.set(n,r),r+=n.byteLength;return t}class sn{save(){return this._view}restore(t){if(!(t instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=t}constructor(t,r=t?.byteLength||0){if(t&&!(t instanceof Uint8Array))try{t=Zt(t)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(t&&r>t.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=t||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(t){const r=this._view.subarray(0,t);return this._view=this._view.subarray(t),r.slice()}readUint8(){if(this._view.byteLength===0)return;const t=this._view[0];return this._view=this._view.subarray(1),t}write(t){if(!(t instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");const r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+t.byteLength>=this._buffer.byteLength?this.alloc(t.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+t.byteLength),this._view.set(t,r)}get end(){return this._view.byteLength===0}alloc(t){if(t<=0||!Number.isInteger(t))throw new Error("Amount must be a positive integer");const r=new Uint8Array((this._buffer.byteLength+t)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+t);n.set(this._view),this._buffer=r,this._view=n}}function Zt(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?Zt(e.buffer):new Uint8Array(e)}function Js(e,t){if(e.byteLength!==t.byteLength)return e.byteLength-t.byteLength;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]-t[r];return 0}function zd(e,t){return Js(e,t)===0}function Zd(e){if(!(e instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Yd(e){const r=new TextEncoder().encode(e);let n=0;for(const s of r)n=(n*223+s)%2**32;return n}function ke(e){if(/^_\d+_$/.test(e)||/^_0x[0-9a-fA-F]+_$/.test(e)){const t=+e.slice(1,-1);if(Number.isSafeInteger(t)&&t>=0&&t<2**32)return t}return Yd(e)}function hu(e){const t=BigInt(e);if(e<=0)throw new RangeError("Input must be positive");return t.toString(2).length-1}function wo(e){const t=BigInt(e);if(e<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<t}function pu(){throw new Error("unexpected end of buffer")}function Nr(e,t){return e.byteLength<t&&pu(),e.read(t)}function Tr(e){const t=e.readUint8();return t===void 0&&pu(),t}function ue(e){if(typeof e=="number"&&(e=BigInt(e)),e<BigInt(0))throw new Error("Cannot leb encode negative values.");const t=(e===BigInt(0)?0:hu(e))+1,r=new sn(new Uint8Array(t),0);for(;;){const n=Number(e&BigInt(127));if(e/=BigInt(128),e===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function be(e){let t=BigInt(1),r=BigInt(0),n;do n=Tr(e),r+=BigInt(n&127).valueOf()*t,t*=BigInt(128);while(n>=128);return r}function ye(e){typeof e=="number"&&(e=BigInt(e));const t=e<BigInt(0);t&&(e=-e-BigInt(1));const r=(e===BigInt(0)?0:hu(e))+1,n=new sn(new Uint8Array(r),0);for(;;){const i=s(e);if(e/=BigInt(128),t&&e===BigInt(0)&&(i&64)!==0||!t&&e===BigInt(0)&&(i&64)===0){n.write(new Uint8Array([i]));break}else n.write(new Uint8Array([i|128]))}function s(i){const o=i%BigInt(128);return Number(t?BigInt(128)-o-BigInt(1):o)}return n.buffer}function qt(e){const t=new Uint8Array(e.buffer);let r=0;for(;r<t.byteLength;r++)if(t[r]<128){if((t[r]&64)===0)return be(e);break}const n=new Uint8Array(Nr(e,r+1));let s=BigInt(0);for(let i=n.byteLength-1;i>=0;i--)s=s*BigInt(128)+BigInt(128-(n[i]&127)-1);return-s-BigInt(1)}function Wd(e,t){if(BigInt(e)<BigInt(0))throw new Error("Cannot write negative values.");return mu(e,t)}function mu(e,t){e=BigInt(e);const r=new sn(new Uint8Array(Math.min(1,t)),0);let n=0,s=BigInt(256),i=BigInt(0),o=Number(e%s);for(r.write(new Uint8Array([o]));++n<t;)e<0&&i===BigInt(0)&&o!==0&&(i=BigInt(1)),o=Number((e/s-i)%BigInt(256)),r.write(new Uint8Array([o])),s*=BigInt(256);return r.buffer}function yu(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=BigInt(Tr(e)),n=BigInt(1),s=0;for(;++s<t;){n*=BigInt(256);const i=BigInt(Tr(e));r=r+n*i}return r}function Xd(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=yu(e,t);const n=BigInt(2)**(BigInt(8)*BigInt(t-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var W;(function(e){e[e.Null=-1]="Null",e[e.Bool=-2]="Bool",e[e.Nat=-3]="Nat",e[e.Int=-4]="Int",e[e.Float32=-13]="Float32",e[e.Float64=-14]="Float64",e[e.Text=-15]="Text",e[e.Reserved=-16]="Reserved",e[e.Empty=-17]="Empty",e[e.Opt=-18]="Opt",e[e.Vector=-19]="Vector",e[e.Record=-20]="Record",e[e.Variant=-21]="Variant",e[e.Func=-22]="Func",e[e.Service=-23]="Service",e[e.Principal=-24]="Principal"})(W||(W={}));const gs="DIDL",Jd=new TextEncoder().encode(gs),za=400;function Nn(e,t,r){return e.map((n,s)=>r(n,t[s]))}class Qd{constructor(){this._typs=[],this._idx=new Map,this._idxRefCount=new Map}has(t){return this._idx.has(t.name)}add(t,r){const n=this._typs.length;this._idx.set(t.name,n),this._idxRefCount.set(n,1),this._typs.push(r)}merge(t,r){const n=this._idx.get(t.name),s=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+t);if(s===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[s];const i=this._getIdxRefCount(n),o=this._getIdxRefCount(s);this._idxRefCount.set(n,i+o),this._idx.set(r,n),this._idxRefCount.set(s,0),this._compactFromEnd()}_getIdxRefCount(t){return this._idxRefCount.get(t)||0}_compactFromEnd(){for(;this._typs.length>0;){const t=this._typs.length-1;if(this._getIdxRefCount(t)>0)break;this._typs.pop(),this._idxRefCount.delete(t)}}encode(){const t=ue(this._typs.length),r=X(...this._typs);return X(t,r)}indexOf(t){if(!this._idx.has(t))throw new Error("Missing type index for "+t);return ye(this._idx.get(t)||0)}}class ef{visitType(t,r){throw new Error("Not implemented")}visitPrimitive(t,r){return this.visitType(t,r)}visitEmpty(t,r){return this.visitPrimitive(t,r)}visitBool(t,r){return this.visitPrimitive(t,r)}visitNull(t,r){return this.visitPrimitive(t,r)}visitReserved(t,r){return this.visitPrimitive(t,r)}visitText(t,r){return this.visitPrimitive(t,r)}visitNumber(t,r){return this.visitPrimitive(t,r)}visitInt(t,r){return this.visitNumber(t,r)}visitNat(t,r){return this.visitNumber(t,r)}visitFloat(t,r){return this.visitPrimitive(t,r)}visitFixedInt(t,r){return this.visitNumber(t,r)}visitFixedNat(t,r){return this.visitNumber(t,r)}visitPrincipal(t,r){return this.visitPrimitive(t,r)}visitConstruct(t,r){return this.visitType(t,r)}visitVec(t,r,n){return this.visitConstruct(t,n)}visitOpt(t,r,n){return this.visitConstruct(t,n)}visitRecord(t,r,n){return this.visitConstruct(t,n)}visitTuple(t,r,n){const s=r.map((i,o)=>[`_${o}_`,i]);return this.visitRecord(t,s,n)}visitVariant(t,r,n){return this.visitConstruct(t,n)}visitRec(t,r,n){return this.visitConstruct(r,n)}visitFunc(t,r){return this.visitConstruct(t,r)}visitService(t,r){return this.visitConstruct(t,r)}}var L;(function(e){e.EmptyClass="__IDL_EmptyClass__",e.UnknownClass="__IDL_UnknownClass__",e.BoolClass="__IDL_BoolClass__",e.NullClass="__IDL_NullClass__",e.ReservedClass="__IDL_ReservedClass__",e.TextClass="__IDL_TextClass__",e.IntClass="__IDL_IntClass__",e.NatClass="__IDL_NatClass__",e.FloatClass="__IDL_FloatClass__",e.FixedIntClass="__IDL_FixedIntClass__",e.FixedNatClass="__IDL_FixedNatClass__",e.VecClass="__IDL_VecClass__",e.OptClass="__IDL_OptClass__",e.RecordClass="__IDL_RecordClass__",e.TupleClass="__IDL_TupleClass__",e.VariantClass="__IDL_VariantClass__",e.RecClass="__IDL_RecClass__",e.PrincipalClass="__IDL_PrincipalClass__",e.FuncClass="__IDL_FuncClass__",e.ServiceClass="__IDL_ServiceClass__"})(L||(L={}));class Qs{display(){return this.name}valueToString(t){return fe(t)}buildTypeTable(t){t.has(this)||this._buildTypeTableImpl(t)}}class Ye extends Qs{checkType(t){if(this.name!==t.name)throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`);return t}_buildTypeTableImpl(t){}}class Jt extends Qs{checkType(t){if(t instanceof ze){const r=t.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`)}encodeType(t){return t.indexOf(this.name)}}class aa extends Ye{get typeName(){return L.EmptyClass}static[Symbol.hasInstance](t){return t.typeName===L.EmptyClass}accept(t,r){return t.visitEmpty(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return ye(W.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}}class gu extends Qs{get typeName(){return L.UnknownClass}static[Symbol.hasInstance](t){return t.typeName===L.UnknownClass}checkType(t){throw new Error("Method not implemented for unknown.")}accept(t,r){throw t.visitType(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(t,r){let n=r.decodeValue(t,r);Object(n)!==n&&(n=Object(n));let s;return r instanceof ze?s=()=>r.getType():s=()=>r,Object.defineProperty(n,"type",{value:s,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}}class _u extends Ye{get typeName(){return L.BoolClass}static[Symbol.hasInstance](t){return t.typeName===L.BoolClass}accept(t,r){return t.visitBool(this,r)}covariant(t){if(typeof t=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return new Uint8Array([t?1:0])}encodeType(){return ye(W.Bool)}decodeValue(t,r){switch(this.checkType(r),Tr(t)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}}class Tn extends Ye{get typeName(){return L.NullClass}static[Symbol.hasInstance](t){return t.typeName===L.NullClass}accept(t,r){return t.visitNull(this,r)}covariant(t){if(t===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return ye(W.Null)}decodeValue(t,r){return this.checkType(r),null}get name(){return"null"}}class Xt extends Ye{get typeName(){return L.ReservedClass}static[Symbol.hasInstance](t){return t.typeName===L.ReservedClass}accept(t,r){return t.visitReserved(this,r)}covariant(t){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return ye(W.Reserved)}decodeValue(t,r){return r.name!==this.name&&r.decodeValue(t,r),null}get name(){return"reserved"}}class bu extends Ye{get typeName(){return L.TextClass}static[Symbol.hasInstance](t){return t.typeName===L.TextClass}accept(t,r){return t.visitText(this,r)}covariant(t){if(typeof t=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=new TextEncoder().encode(t),n=ue(r.byteLength);return X(n,r)}encodeType(){return ye(W.Text)}decodeValue(t,r){this.checkType(r);const n=be(t),s=Nr(t,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(s)}get name(){return"text"}valueToString(t){return'"'+t+'"'}}class ca extends Ye{get typeName(){return L.IntClass}static[Symbol.hasInstance](t){return t.typeName===L.IntClass}accept(t,r){return t.visitInt(this,r)}covariant(t){if(typeof t=="bigint"||Number.isInteger(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return ye(t)}encodeType(){return ye(W.Int)}decodeValue(t,r){return this.checkType(r),qt(t)}get name(){return"int"}valueToString(t){return t.toString()}}class ua extends Ye{get typeName(){return L.NatClass}static[Symbol.hasInstance](t){return t.typeName===L.NatClass}accept(t,r){return t.visitNat(this,r)}covariant(t){if(typeof t=="bigint"&&t>=BigInt(0)||Number.isInteger(t)&&t>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return ue(t)}encodeType(){return ye(W.Nat)}decodeValue(t,r){return this.checkType(r),be(t)}get name(){return"nat"}valueToString(t){return t.toString()}}class la extends Ye{get typeName(){return L.FloatClass}static[Symbol.hasInstance](t){return t.typeName===L.FloatClass}constructor(t){if(super(),this._bits=t,t!==32&&t!==64)throw new Error("not a valid float type")}accept(t,r){return t.visitFloat(this,r)}covariant(t){if(typeof t=="number"||t instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,t,!0):n.setFloat64(0,t,!0),new Uint8Array(r)}encodeType(){const t=this._bits===32?W.Float32:W.Float64;return ye(t)}decodeValue(t,r){this.checkType(r);const n=Nr(t,this._bits/8),s=Zd(n);return this._bits===32?s.getFloat32(0,!0):s.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(t){return t.toString()}}class Ir extends Ye{get typeName(){return L.FixedIntClass}static[Symbol.hasInstance](t){return t.typeName===L.FixedIntClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedInt(this,r)}covariant(t){const r=wo(this._bits-1)*BigInt(-1),n=wo(this._bits-1)-BigInt(1);let s=!1;if(typeof t=="bigint")s=t>=r&&t<=n;else if(Number.isInteger(t)){const i=BigInt(t);s=i>=r&&i<=n}else s=!1;if(s)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return mu(t,this._bits/8)}encodeType(){const t=Math.log2(this._bits)-3;return ye(-9-t)}decodeValue(t,r){this.checkType(r);const n=Xd(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(t){return t.toString()}}class Yt extends Ye{get typeName(){return L.FixedNatClass}static[Symbol.hasInstance](t){return t.typeName===L.FixedNatClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedNat(this,r)}covariant(t){const r=wo(this._bits);let n=!1;if(typeof t=="bigint"&&t>=BigInt(0)?n=t<r:Number.isInteger(t)&&t>=0?n=BigInt(t)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return Wd(t,this._bits/8)}encodeType(){const t=Math.log2(this._bits)-3;return ye(-5-t)}decodeValue(t,r){this.checkType(r);const n=yu(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(t){return t.toString()}}class Qr extends Jt{get typeName(){return L.VecClass}static[Symbol.hasInstance](t){return t.typeName===L.VecClass}constructor(t){super(),this._type=t,this._blobOptimization=!1,t instanceof Yt&&t._bits===8&&(this._blobOptimization=!0)}accept(t,r){return t.visitVec(this,this._type,r)}covariant(t){const r=this._type instanceof Yt?this._type._bits:this._type instanceof Ir?this._type._bits:0;if(ArrayBuffer.isView(t)&&r==t.BYTES_PER_ELEMENT*8||Array.isArray(t)&&t.every((n,s)=>{try{return this._type.covariant(n)}catch(i){throw new Error(`Invalid ${this.display()} argument: 

index ${s} -> ${i.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=ue(t.length);if(this._blobOptimization)return X(r,new Uint8Array(t));if(ArrayBuffer.isView(t))if(t instanceof Int16Array||t instanceof Uint16Array){const s=new DataView(new ArrayBuffer(t.length*2));for(let i=0;i<t.length;i++)t instanceof Int16Array?s.setInt16(i*2,t[i],!0):s.setUint16(i*2,t[i],!0);return X(r,new Uint8Array(s.buffer))}else if(t instanceof Int32Array||t instanceof Uint32Array){const s=new DataView(new ArrayBuffer(t.length*4));for(let i=0;i<t.length;i++)t instanceof Int32Array?s.setInt32(i*4,t[i],!0):s.setUint32(i*4,t[i],!0);return X(r,new Uint8Array(s.buffer))}else if(t instanceof BigInt64Array||t instanceof BigUint64Array){const s=new DataView(new ArrayBuffer(t.length*8));for(let i=0;i<t.length;i++)t instanceof BigInt64Array?s.setBigInt64(i*8,t[i],!0):s.setBigUint64(i*8,t[i],!0);return X(r,new Uint8Array(s.buffer))}else return X(r,new Uint8Array(t.buffer,t.byteOffset,t.byteLength));const n=new sn(new Uint8Array(r.byteLength+t.length),0);n.write(r);for(const s of t){const i=this._type.encodeValue(s);n.write(new Uint8Array(i))}return n.buffer}_buildTypeTableImpl(t){this._type.buildTypeTable(t);const r=ye(W.Vector),n=this._type.encodeType(t);t.add(this,X(r,n))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof Qr))throw new Error("Not a vector type");const s=Number(be(t));if(this._type instanceof Yt){if(this._type._bits==8)return new Uint8Array(t.read(s));if(this._type._bits==16){const o=t.read(s*2);return new Uint16Array(o.buffer,o.byteOffset,s)}if(this._type._bits==32){const o=t.read(s*4);return new Uint32Array(o.buffer,o.byteOffset,s)}if(this._type._bits==64)return new BigUint64Array(t.read(s*8).buffer)}if(this._type instanceof Ir){if(this._type._bits==8)return new Int8Array(t.read(s));if(this._type._bits==16){const o=t.read(s*2),a=new DataView(o.buffer,o.byteOffset,o.byteLength),c=new Int16Array(s);for(let u=0;u<s;u++)c[u]=a.getInt16(u*2,!0);return c}if(this._type._bits==32){const o=t.read(s*4),a=new DataView(o.buffer,o.byteOffset,o.byteLength),c=new Int32Array(s);for(let u=0;u<s;u++)c[u]=a.getInt32(u*4,!0);return c}if(this._type._bits==64){const o=t.read(s*8),a=new DataView(o.buffer,o.byteOffset,o.byteLength),c=new BigInt64Array(s);for(let u=0;u<s;u++)c[u]=a.getBigInt64(u*8,!0);return c}}const i=[];for(let o=0;o<s;o++)i.push(this._type.decodeValue(t,n._type));return i}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(t){return"vec {"+t.map(n=>this._type.valueToString(n)).join("; ")+"}"}}class Ct extends Jt{get typeName(){return L.OptClass}static[Symbol.hasInstance](t){return t.typeName===L.OptClass}constructor(t){super(),this._type=t}accept(t,r){return t.visitOpt(this,this._type,r)}covariant(t){try{if(Array.isArray(t)&&(t.length===0||t.length===1&&this._type.covariant(t[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${fe(t)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return t.length===0?new Uint8Array([0]):X(new Uint8Array([1]),this._type.encodeValue(t[0]))}_buildTypeTableImpl(t){this._type.buildTypeTable(t);const r=ye(W.Opt),n=this._type.encodeType(t);t.add(this,X(r,n))}decodeValue(t,r){if(r instanceof Tn)return[];if(r instanceof Xt)return[];let n=r;if(r instanceof ze){const s=r.getType();if(typeof s>"u")throw new Error("type mismatch with uninitialized type");n=s}if(n instanceof Ct)switch(Tr(t)){case 0:return[];case 1:{const s=t.save();try{return[this._type.decodeValue(t,n._type)]}catch{return t.restore(s),n._type.decodeValue(t,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof Tn||this._type instanceof Ct||this._type instanceof Xt)return n.decodeValue(t,n),[];{const s=t.save();try{return[this._type.decodeValue(t,r)]}catch{return t.restore(s),n.decodeValue(t,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(t){return t.length===0?"null":`opt ${this._type.valueToString(t[0])}`}}class Rr extends Jt{get typeName(){return L.RecordClass}static[Symbol.hasInstance](t){return t.typeName===L.RecordClass||t.typeName===L.TupleClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>ke(r[0])-ke(n[0]))}accept(t,r){return t.visitRecord(this,this._fields,r)}tryAsTuple(){const t=[];for(let r=0;r<this._fields.length;r++){const[n,s]=this._fields[r];if(n!==`_${r}_`)return null;t.push(s)}return t}covariant(t){if(typeof t=="object"&&this._fields.every(([r,n])=>{if(!t.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=this._fields.map(([s])=>t[s]),n=Nn(this._fields,r,([,s],i)=>s.encodeValue(i));return X(...n)}_buildTypeTableImpl(t){this._fields.forEach(([i,o])=>o.buildTypeTable(t));const r=ye(W.Record),n=ue(this._fields.length),s=this._fields.map(([i,o])=>X(ue(ke(i)),o.encodeType(t)));t.add(this,X(r,n,X(...s)))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof Rr))throw new Error("Not a record type");const s={};let i=0,o=0;for(;o<n._fields.length;){const[a,c]=n._fields[o];if(i>=this._fields.length){c.decodeValue(t,c),o++;continue}const[u,f]=this._fields[i],d=ke(this._fields[i][0]),l=ke(a);if(d===l)s[u]=f.decodeValue(t,c),i++,o++;else if(l>d)if(f instanceof Ct||f instanceof Xt)s[u]=[],i++;else throw new Error("Cannot find required field "+u);else c.decodeValue(t,c),o++}for(const[a,c]of this._fields.slice(i))if(c instanceof Ct||c instanceof Xt)s[a]=[];else throw new Error("Cannot find required field "+a);return s}get fieldsAsObject(){const t={};for(const[r,n]of this._fields)t[ke(r)]=n;return t}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(t){const r=this._fields.map(([s])=>t[s]);return`record {${Nn(this._fields,r,([s,i],o)=>s+"="+i.valueToString(o)).join("; ")}}`}}class ei extends Rr{get typeName(){return L.TupleClass}static[Symbol.hasInstance](t){return t.typeName===L.TupleClass}constructor(t){const r={};t.forEach((n,s)=>r["_"+s+"_"]=n),super(r),this._components=t}accept(t,r){return t.visitTuple(this,this._components,r)}covariant(t){if(Array.isArray(t)&&t.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(t[n])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=Nn(this._components,t,(n,s)=>n.encodeValue(s));return X(...r)}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof ei))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");const s=[];for(const[i,o]of n._components.entries())i>=this._components.length?o.decodeValue(t,o):s.push(this._components[i].decodeValue(t,o));return s}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(t){return`record {${Nn(this._components,t,(n,s)=>n.valueToString(s)).join("; ")}}`}}class en extends Jt{get typeName(){return L.VariantClass}static[Symbol.hasInstance](t){return t.typeName===L.VariantClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>ke(r[0])-ke(n[0]))}accept(t,r){return t.visitVariant(this,this._fields,r)}covariant(t){if(typeof t=="object"&&Object.entries(t).length===1&&this._fields.every(([r,n])=>{try{return!t.hasOwnProperty(r)||n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){for(let r=0;r<this._fields.length;r++){const[n,s]=this._fields[r];if(t.hasOwnProperty(n)){const i=ue(r),o=s.encodeValue(t[n]);return X(i,o)}}throw Error("Variant has no data: "+t)}_buildTypeTableImpl(t){this._fields.forEach(([,i])=>{i.buildTypeTable(t)});const r=ye(W.Variant),n=ue(this._fields.length),s=this._fields.map(([i,o])=>X(ue(ke(i)),o.encodeType(t)));t.add(this,X(r,n,...s))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof en))throw new Error("Not a variant type");const s=Number(be(t));if(s>=n._fields.length)throw Error("Invalid variant index: "+s);const[i,o]=n._fields[s];for(const[a,c]of this._fields)if(ke(i)===ke(a)){const u=c.decodeValue(t,o);return{[a]:u}}throw new Error("Cannot find field hash "+i)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(t){for(const[r,n]of this._fields)if(t.hasOwnProperty(r)){const s=n.valueToString(t[r]);return s==="null"?`variant {${r}}`:`variant {${r}=${s}}`}throw new Error("Variant has no data: "+t)}get alternativesAsObject(){const t={};for(const[r,n]of this._fields)t[ke(r)]=n;return t}}const zs=class zs extends Jt{constructor(){super(...arguments),this._id=zs._counter++}get typeName(){return L.RecClass}static[Symbol.hasInstance](t){return t.typeName===L.RecClass}accept(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return t.visitRec(this,this._type,r)}fill(t){this._type=t}getType(){return this._type}covariant(t){if(this._type&&this._type.covariant(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(t)}_buildTypeTableImpl(t){if(!this._type)throw Error("Recursive type uninitialized.");t.add(this,new Uint8Array([])),this._type.buildTypeTable(t),t.merge(this,this._type.name)}decodeValue(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(t,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`${this.name}.${this._type.name}`}valueToString(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(t)}};zs._counter=0;let ze=zs;function da(e){if(Tr(e)!==1)throw new Error("Cannot decode principal");const r=Number(be(e));return D.fromUint8Array(new Uint8Array(Nr(e,r)))}class wu extends Ye{get typeName(){return L.PrincipalClass}static[Symbol.hasInstance](t){return t.typeName===L.PrincipalClass}accept(t,r){return t.visitPrincipal(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=t.toUint8Array(),n=ue(r.byteLength);return X(new Uint8Array([1]),n,r)}encodeType(){return ye(W.Principal)}decodeValue(t,r){return this.checkType(r),da(t)}get name(){return"principal"}valueToString(t){return`${this.name} "${t.toText()}"`}}class In extends Jt{get typeName(){return L.FuncClass}static[Symbol.hasInstance](t){return t.typeName===L.FuncClass}static argsToString(t,r){if(t.length!==r.length)throw new Error("arity mismatch");return"("+t.map((n,s)=>n.valueToString(r[s])).join(", ")+")"}constructor(t,r,n=[]){super(),this.argTypes=t,this.retTypes=r,this.annotations=n}accept(t,r){return t.visitFunc(this,r)}covariant(t){if(Array.isArray(t)&&t.length===2&&t[0]&&t[0]._isPrincipal&&typeof t[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue([t,r]){const n=t.toUint8Array(),s=ue(n.byteLength),i=X(new Uint8Array([1]),s,n),o=new TextEncoder().encode(r),a=ue(o.byteLength);return X(new Uint8Array([1]),i,a,o)}_buildTypeTableImpl(t){this.argTypes.forEach(u=>u.buildTypeTable(t)),this.retTypes.forEach(u=>u.buildTypeTable(t));const r=ye(W.Func),n=ue(this.argTypes.length),s=X(...this.argTypes.map(u=>u.encodeType(t))),i=ue(this.retTypes.length),o=X(...this.retTypes.map(u=>u.encodeType(t))),a=ue(this.annotations.length),c=X(...this.annotations.map(u=>this.encodeAnnotation(u)));t.add(this,X(r,n,s,i,o,a,c))}decodeValue(t,r){const n=r instanceof ze?r.getType()??r:r;if(!fa(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(Tr(t)!==1)throw new Error("Cannot decode function reference");const i=da(t),o=Number(be(t)),a=Nr(t,o),u=new TextDecoder("utf8",{fatal:!0}).decode(a);return[i,u]}get name(){const t=this.argTypes.map(s=>s.name).join(", "),r=this.retTypes.map(s=>s.name).join(", "),n=" "+this.annotations.join(" ");return`(${t}) -> (${r})${n}`}valueToString([t,r]){return`func "${t.toText()}".${r}`}display(){const t=this.argTypes.map(s=>s.display()).join(", "),r=this.retTypes.map(s=>s.display()).join(", "),n=" "+this.annotations.join(" ");return`(${t})  (${r})${n}`}encodeAnnotation(t){if(t==="query")return new Uint8Array([1]);if(t==="oneway")return new Uint8Array([2]);if(t==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}}class Bs extends Jt{get typeName(){return L.ServiceClass}static[Symbol.hasInstance](t){return t.typeName===L.ServiceClass}constructor(t){super(),this._fields=Object.entries(t).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(t,r){return t.visitService(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=t.toUint8Array(),n=ue(r.length);return X(new Uint8Array([1]),n,r)}_buildTypeTableImpl(t){this._fields.forEach(([i,o])=>o.buildTypeTable(t));const r=ye(W.Service),n=ue(this._fields.length),s=this._fields.map(([i,o])=>{const a=new TextEncoder().encode(i),c=ue(a.length);return X(c,a,o.encodeType(t))});t.add(this,X(r,n,...s))}decodeValue(t,r){const n=r instanceof ze?r.getType()??r:r;if(!fa(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return da(t)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(t){return`service "${t.toText()}"`}fieldsAsObject(){const t={};for(const[r,n]of this._fields)t[r]=n;return t}}function fe(e){const t=JSON.stringify(e,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return t&&t.length>za?t.substring(0,za-3)+"...":t}function xo(e,t){if(t.length<e.length)throw Error("Wrong number of message arguments");const r=new Qd;e.forEach(a=>a.buildTypeTable(r));const n=r.encode(),s=ue(t.length),i=X(...e.map(a=>a.encodeType(r))),o=X(...Nn(e,t,(a,c)=>{try{a.covariant(c)}catch(u){throw new Error(u.message+`

`)}return a.encodeValue(c)}));return X(Jd,n,s,i,o)}function xu(e,t){const r=new sn(t);if(t.byteLength<gs.length)throw new Error("Message length smaller than magic number");const n=Nr(r,gs.length),s=new TextDecoder().decode(n);if(s!==gs)throw new Error("Wrong magic number: "+JSON.stringify(s));function i(l){const h=[],y=Number(be(l));for(let m=0;m<y;m++){const b=Number(qt(l));switch(b){case W.Opt:case W.Vector:{const p=Number(qt(l));h.push([b,p]);break}case W.Record:case W.Variant:{const p=[];let E=Number(be(l)),v;for(;E--;){const N=Number(be(l));if(N>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof v=="number"&&v>=N)throw new Error("field id collision or not sorted");v=N;const I=Number(qt(l));p.push([N,I])}h.push([b,p]);break}case W.Func:{const p=[];let E=Number(be(l));for(;E--;)p.push(Number(qt(l)));const v=[];let N=Number(be(l));for(;N--;)v.push(Number(qt(l)));const I=[];let R=Number(be(l));for(;R--;)switch(Number(be(l))){case 1:{I.push("query");break}case 2:{I.push("oneway");break}case 3:{I.push("composite_query");break}default:throw new Error("unknown annotation")}h.push([b,[p,v,I]]);break}case W.Service:{let p=Number(be(l));const E=[];for(;p--;){const v=Number(be(l)),N=new TextDecoder().decode(Nr(l,v)),I=qt(l);E.push([N,I])}h.push([b,E]);break}default:throw new Error("Illegal op_code: "+b)}}const g=[],_=Number(be(l));for(let m=0;m<_;m++)g.push(Number(qt(l)));return[h,g]}const[o,a]=i(r);if(a.length<e.length)throw new Error("Wrong number of return values");const c=o.map(l=>Gu());function u(l){if(l<-24)throw new Error("future value not supported");if(l<0)switch(l){case-1:return Tu;case-2:return Nu;case-3:return Ou;case-4:return Ru;case-5:return Fu;case-6:return Uu;case-7:return Pu;case-8:return Du;case-9:return Cu;case-10:return Bu;case-11:return Vu;case-12:return ku;case-13:return Su;case-14:return Au;case-15:return Iu;case-16:return vu;case-17:return Eu;case-24:return Mu;default:throw new Error("Illegal op_code: "+l)}if(l>=o.length)throw new Error("type index out of range");return c[l]}function f(l){switch(l[0]){case W.Vector:{const h=u(l[1]);return Lu(h)}case W.Opt:{const h=u(l[1]);return qu(h)}case W.Record:{const h={};for(const[_,m]of l[1]){const b=`_${_}_`;h[b]=u(m)}const y=ju(h),g=y.tryAsTuple();return Array.isArray(g)?$u(...g):y}case W.Variant:{const h={};for(const[y,g]of l[1]){const _=`_${y}_`;h[_]=u(g)}return Ku(h)}case W.Func:{const[h,y,g]=l[1];return Hu(h.map(_=>u(_)),y.map(_=>u(_)),g)}case W.Service:{const h={},y=l[1];for(const[g,_]of y){let m=u(_);if(m instanceof ze&&(m=m.getType()),!(m instanceof In))throw new Error("Illegal service definition: services can only contain functions");h[g]=m}return zu(h)}default:throw new Error("Illegal op_code: "+l[0])}}o.forEach((l,h)=>{if(l[0]===W.Func){const y=f(l);c[h].fill(y)}}),o.forEach((l,h)=>{if(l[0]!==W.Func){const y=f(l);c[h].fill(y)}}),Eo();const d=a.map(l=>u(l));try{const l=e.map((h,y)=>h.decodeValue(r,d[y]));for(let h=e.length;h<d.length;h++)d[h].decodeValue(r,d[h]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return l}finally{Eo()}}const Eu=new aa,vu=new Xt,tf=new gu,Nu=new _u,Tu=new Tn,Iu=new bu,Ru=new ca,Ou=new ua,Su=new la(32),Au=new la(64),Cu=new Ir(8),Bu=new Ir(16),Vu=new Ir(32),ku=new Ir(64),Fu=new Yt(8),Uu=new Yt(16),Pu=new Yt(32),Du=new Yt(64),Mu=new wu;function $u(...e){return new ei(e)}function Lu(e){return new Qr(e)}function qu(e){return new Ct(e)}function ju(e){return new Rr(e)}function Ku(e){return new en(e)}function Gu(){return new ze}function Hu(e,t,r=[]){return new In(e,t,r)}function zu(e){return new Bs(e)}class ti{constructor(t=new Map){this.rels=t}copy(){const t=new Map;for(const[r,n]of this.rels.entries()){const s=new Map(n);t.set(r,s)}return new ti(t)}known(t,r){return this.rels.get(t.name)?.get(r.name)}addNegative(t,r){this.addNames(t.name,r.name,!1)}add(t,r){this.addNames(t.name,r.name,!0)}display(){let t="";for(const[r,n]of this.rels)for(const[s,i]of n)t+=`${r} ${i?":<":"!<:"} ${s}
`;return t}addNames(t,r,n){const s=this.rels.get(t);if(s==null){const i=new Map;i.set(r,n),this.rels.set(t,i)}else s.set(r,n)}}let _s=new ti;function Eo(){_s=new ti}function rf(e,t){const r=new Set(e.annotations),n=new Set(t.annotations);if(r.size!==n.size)return!1;for(const s of r)if(!n.has(s))return!1;return!0}function Ki(e){return e instanceof Ct||e instanceof Tn||e instanceof Xt}function fa(e,t){const r=_s.copy(),n=wt(r,e,t);return n?_s.add(e,t):_s.addNegative(e,t),n}function wt(e,t,r){if(t.name===r.name)return!0;const n=e.known(t,r);if(n!==void 0)return n;if(e.add(t,r),r instanceof Xt||t instanceof aa||t instanceof ua&&r instanceof ca)return!0;if(t instanceof Qr&&r instanceof Qr)return wt(e,t._type,r._type);if(r instanceof Ct)return!0;if(t instanceof Rr&&r instanceof Rr){const s=t.fieldsAsObject;for(const[i,o]of r._fields){const a=s[ke(i)];if(a){if(!wt(e,a,o))return!1}else if(!Ki(o))return!1}return!0}if(t instanceof In&&r instanceof In){if(!rf(t,r))return!1;for(let s=0;s<t.argTypes.length;s++){const i=t.argTypes[s];if(s<r.argTypes.length){if(!wt(e,r.argTypes[s],i))return!1}else if(!Ki(i))return!1}for(let s=0;s<r.retTypes.length;s++){const i=r.retTypes[s];if(s<t.retTypes.length){if(!wt(e,t.retTypes[s],i))return!1}else if(!Ki(i))return!1}return!0}if(t instanceof en&&r instanceof en){const s=r.alternativesAsObject;for(const[i,o]of t._fields){const a=s[ke(i)];if(!a||!wt(e,o,a))return!1}return!0}if(t instanceof Bs&&r instanceof Bs){const s=t.fieldsAsObject();for(const[i,o]of r._fields){const a=s[i];if(!a||!wt(e,a,o))return!1}return!0}return t instanceof ze?wt(e,t.getType(),r):r instanceof ze?wt(e,t,r.getType()):!1}const nf=Object.freeze(Object.defineProperty({__proto__:null,Bool:Nu,BoolClass:_u,ConstructType:Jt,Empty:Eu,EmptyClass:aa,FixedIntClass:Ir,FixedNatClass:Yt,Float32:Su,Float64:Au,FloatClass:la,Func:Hu,FuncClass:In,Int:Ru,Int16:Bu,Int32:Vu,Int64:ku,Int8:Cu,IntClass:ca,Nat:Ou,Nat16:Uu,Nat32:Pu,Nat64:Du,Nat8:Fu,NatClass:ua,Null:Tu,NullClass:Tn,Opt:qu,OptClass:Ct,PrimitiveType:Ye,Principal:Mu,PrincipalClass:wu,Rec:Gu,RecClass:ze,Record:ju,RecordClass:Rr,Reserved:vu,ReservedClass:Xt,Service:zu,ServiceClass:Bs,Text:Iu,TextClass:bu,Tuple:$u,TupleClass:ei,Type:Qs,Unknown:tf,UnknownClass:gu,Variant:Ku,VariantClass:en,Vec:Lu,VecClass:Qr,Visitor:ef,decode:xu,encode:xo,resetSubtypeCache:Eo,subtype:fa},Symbol.toStringTag,{value:"Module"}));function Vs(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?Vs(e.buffer):new Uint8Array(e)}function ri(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function vo(e){if(typeof e=="string")return Zu(e);if(typeof e=="number")return Ge(ue(e));if(e instanceof Uint8Array||ArrayBuffer.isView(e))return Ge(Vs(e));if(Array.isArray(e)){const t=e.map(vo);return Ge(ee(...t))}else{if(e&&typeof e=="object"&&e._isPrincipal)return Ge(e.toUint8Array());if(typeof e=="object"&&e!==null&&typeof e.toHash=="function")return vo(e.toHash());if(typeof e=="object")return ks(e);if(typeof e=="bigint")return Ge(ue(e))}throw ne.fromCode(new ea(e))}const Zu=e=>{const t=new TextEncoder().encode(e);return Ge(t)};function jr(e){return ks(e)}function ks(e){const n=Object.entries(e).filter(([,o])=>o!==void 0).map(([o,a])=>{const c=Zu(o),u=vo(a);return[c,u]}).sort(([o],[a])=>Js(o,a)),s=ee(...n.map(o=>ee(...o)));return Ge(s)}const sf=new TextEncoder().encode("\ric-state-root"),Yu=new TextEncoder().encode(`
ic-request`),of=new TextEncoder().encode("\vic-response"),af=new TextEncoder().encode("ic-request-auth-delegation");class ha{getPrincipal(){return this._principal||(this._principal=D.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()))),this._principal}async transformRequest(t){const{body:r,...n}=t,s=jr(r);return{...n,body:{content:r,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(ee(Yu,s))}}}}class Kr{getPrincipal(){return D.anonymous()}async transformRequest(t){return{...t,body:{content:t.body}}}}let Cr=class extends Error{constructor(t){super(t),this.name="DecodingError"}};const Wu=55799,Xu=Symbol("CBOR_STOP_CODE");var tt=(e=>(e[e.False=20]="False",e[e.True=21]="True",e[e.Null=22]="Null",e[e.Undefined=23]="Undefined",e[e.Break=31]="Break",e))(tt||{}),me=(e=>(e[e.UnsignedInteger=0]="UnsignedInteger",e[e.NegativeInteger=1]="NegativeInteger",e[e.ByteString=2]="ByteString",e[e.TextString=3]="TextString",e[e.Array=4]="Array",e[e.Map=5]="Map",e[e.Tag=6]="Tag",e[e.Simple=7]="Simple",e))(me||{});const cf=23,uf=255,lf=65535,df=4294967295,ff=BigInt("0xffffffffffffffff");var et=(e=>(e[e.Value=23]="Value",e[e.OneByte=24]="OneByte",e[e.TwoBytes=25]="TwoBytes",e[e.FourBytes=26]="FourBytes",e[e.EightBytes=27]="EightBytes",e[e.Indefinite=31]="Indefinite",e))(et||{});const Gr=!1;function hf(e){return e==null}function Ju(e,t){const r=new Uint8Array(t);return r.set(e),r}const pf=new TextDecoder;function mf(e){return(e&224)>>5}function yf(e){return e&31}let Rn=new Uint8Array,fn,rt=0;function gf(e,t){Rn=e,rt=0;const r=xr();return t?.(r)??r}function xr(e){const[t,r]=bs();switch(t){case me.UnsignedInteger:return on(r);case me.NegativeInteger:return xf(r);case me.ByteString:return Qu(r);case me.TextString:return No(r);case me.Array:return _f(r);case me.Map:return wf(r);case me.Tag:return Ef(r);case me.Simple:return bf(r)}throw new Cr(`Unsupported major type: ${t}`)}function bs(){const e=Rn.at(rt);if(hf(e))throw new Cr("Provided CBOR data is empty");const t=mf(e),r=yf(e);return rt++,[t,r]}function _f(e,t){const r=on(e);if(r===1/0){const s=[];let i=xr();for(;i!==Xu;)s.push(i),i=xr();return s}const n=new Array(r);for(let s=0;s<r;s++){const i=xr();n[s]=i}return n}function bf(e){switch(e){case tt.False:return!1;case tt.True:return!0;case tt.Null:return null;case tt.Undefined:return;case tt.Break:return Xu}throw new Cr(`Unrecognized simple type: ${e.toString(2)}`)}function wf(e,t){const r=on(e),n={};if(r===1/0){let[s,i]=bs();for(;s!==me.Simple&&i!==tt.Break;){const o=No(i),a=xr();n[o]=a,[s,i]=bs()}return n}for(let s=0;s<r;s++){const[i,o]=bs();if(i!==me.TextString)throw new Cr("Map keys must be text strings");const a=No(o),c=xr();n[a]=c}return n}function on(e){if(e<=et.Value)return e;switch(fn=new DataView(Rn.buffer,Rn.byteOffset+rt),e){case et.OneByte:return rt++,fn.getUint8(0);case et.TwoBytes:return rt+=2,fn.getUint16(0,Gr);case et.FourBytes:return rt+=4,fn.getUint32(0,Gr);case et.EightBytes:return rt+=8,fn.getBigUint64(0,Gr);case et.Indefinite:return 1/0;default:throw new Cr(`Unsupported integer info: ${e.toString(2)}`)}}function xf(e){const t=on(e);return typeof t=="number"?-1-t:-1n-t}function Qu(e){const t=on(e);if(t>Number.MAX_SAFE_INTEGER)throw new Cr("Byte length is too large");const r=Number(t);return rt+=r,Rn.slice(rt-r,rt)}function No(e){const t=Qu(e);return pf.decode(t)}function Ef(e,t){const r=on(e);if(r===Wu)return xr();throw new Cr(`Unsupported tag: ${r}.`)}let pa=class extends Error{constructor(t){super(t),this.name="SerializationError"}};const vf=2*1024,Nf=100,Tf=new TextEncoder;function hn(e){return e<<5}let $e=new Uint8Array(vf),Xe=new DataView($e.buffer),pe=0,Gi=[];function If(e,t){pe=0;const r=t?.(e)??e;return kf(Wu,r,t),$e.slice(0,pe)}function ma(e,t){if(pe>$e.length-Nf&&($e=Ju($e,$e.length*2),Xe=new DataView($e.buffer)),e===!1||e===!0||e===null||e===void 0){Sf(e);return}if(typeof e=="number"||typeof e=="bigint"){Vf(e);return}if(typeof e=="string"){rl(e);return}if(e instanceof Uint8Array){Za(e);return}if(e instanceof ArrayBuffer){Za(new Uint8Array(e));return}if(Array.isArray(e)){Rf(e,t);return}if(typeof e=="object"){Of(e,t);return}throw new pa(`Unsupported type: ${typeof e}`)}function Rf(e,t){an(me.Array,e.length),e.forEach((r,n)=>{ma(t?.(r,n.toString())??r,t)})}function Of(e,t){Gi=Object.entries(e),an(me.Map,Gi.length),Gi.forEach(([r,n])=>{rl(r),ma(t?.(n,r)??n,t)})}function an(e,t){if(t<=cf){Xe.setUint8(pe++,hn(e)|Number(t));return}if(t<=uf){Xe.setUint8(pe++,hn(e)|et.OneByte),Xe.setUint8(pe,Number(t)),pe+=1;return}if(t<=lf){Xe.setUint8(pe++,hn(e)|et.TwoBytes),Xe.setUint16(pe,Number(t),Gr),pe+=2;return}if(t<=df){Xe.setUint8(pe++,hn(e)|et.FourBytes),Xe.setUint32(pe,Number(t),Gr),pe+=4;return}if(t<=ff){Xe.setUint8(pe++,hn(e)|et.EightBytes),Xe.setBigUint64(pe,BigInt(t),Gr),pe+=8;return}throw new pa(`Value too large to encode: ${t}`)}function Sf(e){an(me.Simple,Af(e))}function Af(e){if(e===!1)return tt.False;if(e===!0)return tt.True;if(e===null)return tt.Null;if(e===void 0)return tt.Undefined;throw new pa(`Unrecognized simple value: ${e.toString()}`)}function el(e,t){an(e,t.length),pe>$e.length-t.length&&($e=Ju($e,$e.length+t.length),Xe=new DataView($e.buffer)),$e.set(t,pe),pe+=t.length}function tl(e,t){an(e,t)}function Cf(e){tl(me.UnsignedInteger,e)}function Bf(e){tl(me.NegativeInteger,typeof e=="bigint"?-1n-e:-1-e)}function Vf(e){e>=0?Cf(e):Bf(e)}function rl(e){el(me.TextString,Tf.encode(e))}function Za(e){el(me.ByteString,e)}function kf(e,t,r){an(me.Tag,e),ma(t,r)}function Ff(e){return typeof e=="object"&&e!==null&&"toCborValue"in e}function Hi(e){try{return If(e,t=>D.isPrincipal(t)?t.toUint8Array():Hr.isExpiry(t)?t.toBigInt():Ff(t)?t.toCborValue():t)}catch(t){throw ne.fromCode(new Yo(t,e))}}function ct(e){try{return gf(e)}catch(t){throw ne.fromCode(new Zo(t,e))}}const us=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){const e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]}if(typeof crypto<"u"&&crypto.getRandomValues){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var yr;(function(e){e.Query="read",e.ReadState="read_state",e.Call="call"})(yr||(yr={}));var To;(function(e){e.Call="call"})(To||(To={}));var On;(function(e){e.Query="query",e.ReadState="read_state"})(On||(On={}));function Io(){const e=new ArrayBuffer(16),t=new DataView(e),r=us(),n=us(),s=us(),i=us();return t.setUint32(0,r),t.setUint32(4,n),t.setUint32(8,s),t.setUint32(12,i),Object.assign(new Uint8Array(e),{__nonce__:void 0})}const ls="__expiry__",Ro=BigInt(1e3),Uf=BigInt(1e6),Pf=BigInt(60),Oo=Pf*Ro,Df=BigInt(1)*Oo;function Mf(e){return e/Ro*Ro}function $f(e){return e/Oo*Oo}class Hr{constructor(t){this.__expiry__=t,this._isExpiry=!0}static fromDeltaInMilliseconds(t,r=0){const n=BigInt(Date.now())+BigInt(r),s=n+BigInt(t),i=$f(s);let o;return i>=n+Df?o=i:o=Mf(s),new Hr(o*Uf)}toBigInt(){return this.__expiry__}toHash(){return ue(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[ls]:this.toString()}}static fromJSON(t){const r=JSON.parse(t);if(r[ls])try{const n=BigInt(r[ls]);return new Hr(n)}catch(n){throw new ne(new Cs(`Not a valid BigInt: ${n}`))}throw new ne(new Cs(`The input does not contain the key ${ls}`))}static isExpiry(t){return t instanceof Hr||typeof t=="object"&&t!==null&&"_isExpiry"in t&&t._isExpiry===!0&&"__expiry__"in t&&typeof t.__expiry__=="bigint"}}function Ya(e=Io){return async t=>{const r=t.request.headers;t.request.headers=r,t.endpoint===yr.Call&&(t.body.nonce=e())}}function Wa(e){const t=[];return e.forEach((r,n)=>{t.push([n,r])}),t}const ya=BigInt(0),Fs=BigInt(1);function Sn(e,t=""){if(typeof e!="boolean"){const r=t&&`"${t}"`;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function zr(e,t,r=""){const n=Jn(e),s=e?.length,i=t!==void 0;if(!n||i&&s!==t){const o=r&&`"${r}" `,a=i?` of length ${t}`:"",c=n?`length=${s}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return e}function nl(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?ya:BigInt("0x"+e)}function ft(e){return nl(re(e))}function An(e){return He(e),nl(re(Uint8Array.from(e).reverse()))}function ve(e,t){return dt(e.toString(16).padStart(t*2,"0"))}function sl(e,t){return ve(e,t).reverse()}function Ve(e,t,r){let n;if(typeof t=="string")try{n=dt(t)}catch(i){throw new Error(e+" must be hex string or Uint8Array, cause: "+i)}else if(Jn(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(e+" of length "+r+" expected, got "+s);return n}function Xa(e){return Uint8Array.from(e)}const zi=e=>typeof e=="bigint"&&ya<=e;function il(e,t,r){return zi(e)&&zi(t)&&zi(r)&&t<=e&&e<r}function Ja(e,t,r,n){if(!il(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Cn(e){let t;for(t=0;e>ya;e>>=Fs,t+=1);return t}function Lf(e,t){return e>>BigInt(t)&Fs}const Br=e=>(Fs<<BigInt(e))-Fs;function qf(e){return typeof e=="function"&&Number.isSafeInteger(e.outputLen)}function rs(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,o){const a=e[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(t).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}const ol=()=>{throw new Error("not implemented")};function Bn(e){const t=new WeakMap;return(r,...n)=>{const s=t.get(r);if(s!==void 0)return s;const i=e(r,...n);return t.set(r,i),i}}const Ue=BigInt(0),Ne=BigInt(1),gr=BigInt(2),al=BigInt(3),cl=BigInt(4),ul=BigInt(5),jf=BigInt(7),ll=BigInt(8),Kf=BigInt(9),dl=BigInt(16);function de(e,t){const r=e%t;return r>=Ue?r:t+r}function it(e,t,r){let n=e;for(;t-- >Ue;)n*=n,n%=r;return n}function Qa(e,t){if(e===Ue)throw new Error("invert: expected non-zero number");if(t<=Ue)throw new Error("invert: expected positive modulus, got "+t);let r=de(e,t),n=t,s=Ue,i=Ne;for(;r!==Ue;){const a=n/r,c=n%r,u=s-i*a;n=r,r=c,s=i,i=u}if(n!==Ne)throw new Error("invert: does not exist");return de(s,t)}function ga(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function fl(e,t){const r=(e.ORDER+Ne)/cl,n=e.pow(t,r);return ga(e,n,t),n}function Gf(e,t){const r=(e.ORDER-ul)/ll,n=e.mul(t,gr),s=e.pow(n,r),i=e.mul(t,s),o=e.mul(e.mul(i,gr),s),a=e.mul(i,e.sub(o,e.ONE));return ga(e,a,t),a}function Hf(e){const t=Qt(e),r=hl(e),n=r(t,t.neg(t.ONE)),s=r(t,n),i=r(t,t.neg(n)),o=(e+jf)/dl;return(a,c)=>{let u=a.pow(c,o),f=a.mul(u,n);const d=a.mul(u,s),l=a.mul(u,i),h=a.eql(a.sqr(f),c),y=a.eql(a.sqr(d),c);u=a.cmov(u,f,h),f=a.cmov(l,d,y);const g=a.eql(a.sqr(f),c),_=a.cmov(u,f,g);return ga(a,_,c),_}}function hl(e){if(e<al)throw new Error("sqrt is not defined for small field");let t=e-Ne,r=0;for(;t%gr===Ue;)t/=gr,r++;let n=gr;const s=Qt(e);for(;Us(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return fl;let i=s.pow(n,t);const o=(t+Ne)/gr;return function(c,u){if(c.is0(u))return u;if(Us(c,u)!==1)throw new Error("Cannot find square root");let f=r,d=c.mul(c.ONE,i),l=c.pow(u,t),h=c.pow(u,o);for(;!c.eql(l,c.ONE);){if(c.is0(l))return c.ZERO;let y=1,g=c.sqr(l);for(;!c.eql(g,c.ONE);)if(y++,g=c.sqr(g),y===f)throw new Error("Cannot find square root");const _=Ne<<BigInt(f-y-1),m=c.pow(d,_);f=y,d=c.sqr(m),l=c.mul(l,d),h=c.mul(h,m)}return h}}function zf(e){return e%cl===al?fl:e%ll===ul?Gf:e%dl===Kf?Hf(e):hl(e)}const Zf=(e,t)=>(de(e,t)&Ne)===Ne,Yf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pl(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Yf.reduce((n,s)=>(n[s]="function",n),t);return rs(e,r),e}function ni(e,t,r){if(r<Ue)throw new Error("invalid exponent, negatives unsupported");if(r===Ue)return e.ONE;if(r===Ne)return t;let n=e.ONE,s=t;for(;r>Ue;)r&Ne&&(n=e.mul(n,s)),s=e.sqr(s),r>>=Ne;return n}function Vr(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),s=t.reduce((o,a,c)=>e.is0(a)?o:(n[c]=o,e.mul(o,a)),e.ONE),i=e.inv(s);return t.reduceRight((o,a,c)=>e.is0(a)?o:(n[c]=e.mul(o,n[c]),e.mul(o,a)),i),n}function Us(e,t){const r=(e.ORDER-Ne)/gr,n=e.pow(t,r),s=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function Wf(e,t){t!==void 0&&vd(t);const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Qt(e,t,r=!1,n={}){if(e<=Ue)throw new Error("invalid field: expected ORDER > 0, got "+e);let s,i,o=!1,a;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const l=t;l.BITS&&(s=l.BITS),l.sqrt&&(i=l.sqrt),typeof l.isLE=="boolean"&&(r=l.isLE),typeof l.modFromBytes=="boolean"&&(o=l.modFromBytes),a=l.allowedLengths}else typeof t=="number"&&(s=t),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:u}=Wf(e,s);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let f;const d=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:u,MASK:Br(c),ZERO:Ue,ONE:Ne,allowedLengths:a,create:l=>de(l,e),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return Ue<=l&&l<e},is0:l=>l===Ue,isValidNot0:l=>!d.is0(l)&&d.isValid(l),isOdd:l=>(l&Ne)===Ne,neg:l=>de(-l,e),eql:(l,h)=>l===h,sqr:l=>de(l*l,e),add:(l,h)=>de(l+h,e),sub:(l,h)=>de(l-h,e),mul:(l,h)=>de(l*h,e),pow:(l,h)=>ni(d,l,h),div:(l,h)=>de(l*Qa(h,e),e),sqrN:l=>l*l,addN:(l,h)=>l+h,subN:(l,h)=>l-h,mulN:(l,h)=>l*h,inv:l=>Qa(l,e),sqrt:i||(l=>(f||(f=zf(e)),f(d,l))),toBytes:l=>r?sl(l,u):ve(l,u),fromBytes:(l,h=!0)=>{if(a){if(!a.includes(l.length)||l.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);const g=new Uint8Array(u);g.set(l,r?0:g.length-l.length),l=g}if(l.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+l.length);let y=r?An(l):ft(l);if(o&&(y=de(y,e)),!h&&!d.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y},invertBatch:l=>Vr(d,l),cmov:(l,h,y)=>y?h:l});return Object.freeze(d)}function ml(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function yl(e){const t=ml(e);return t+Math.ceil(t/2)}function Xf(e,t,r=!1){const n=e.length,s=ml(t),i=yl(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?An(e):ft(e),a=de(o,t-Ne)+Ne;return r?sl(a,s):ve(a,s)}const tn=BigInt(0),_r=BigInt(1);function Ps(e,t){const r=t.negate();return e?r:t}function Tt(e,t){const r=Vr(e.Fp,t.map(n=>n.Z));return t.map((n,s)=>e.fromAffine(n.toAffine(r[s])))}function gl(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Zi(e,t){gl(e,t);const r=Math.ceil(t/e)+1,n=2**(e-1),s=2**e,i=Br(e),o=BigInt(e);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function ec(e,t,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(e&s),c=e>>o;a>n&&(a-=i,c+=_r);const u=t*n,f=u+Math.abs(a)-1,d=a===0,l=a<0,h=t%2!==0;return{nextN:c,offset:f,isZero:d,isNeg:l,isNegF:h,offsetF:u}}function Jf(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Qf(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Yi=new WeakMap,_l=new WeakMap;function Wi(e){return _l.get(e)||1}function tc(e){if(e!==tn)throw new Error("invalid wNAF")}class bl{constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let s=t;for(;r>tn;)r&_r&&(n=n.add(s)),s=s.double(),r>>=_r;return n}precomputeWindow(t,r){const{windows:n,windowSize:s}=Zi(r,this.bits),i=[];let o=t,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let u=1;u<s;u++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Zi(t,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:f,isNeg:d,isNegF:l,offsetF:h}=ec(n,a,o);n=c,f?i=i.add(Ps(l,r[h])):s=s.add(Ps(d,r[u]))}return tc(n),{p:s,f:i}}wNAFUnsafe(t,r,n,s=this.ZERO){const i=Zi(t,this.bits);for(let o=0;o<i.windows&&n!==tn;o++){const{nextN:a,offset:c,isZero:u,isNeg:f}=ec(n,o,i);if(n=a,!u){const d=r[c];s=s.add(f?d.negate():d)}}return tc(n),s}getPrecomputes(t,r,n){let s=Yi.get(r);return s||(s=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(s=n(s)),Yi.set(r,s))),s}cached(t,r,n){const s=Wi(t);return this.wNAF(s,this.getPrecomputes(s,t,n),r)}unsafe(t,r,n,s){const i=Wi(t);return i===1?this._unsafeLadder(t,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,t,n),r,s)}createCache(t,r){gl(r,this.bits),_l.set(t,r),Yi.delete(t)}hasCache(t){return Wi(t)!==1}}function eh(e,t,r,n){let s=t,i=e.ZERO,o=e.ZERO;for(;r>tn||n>tn;)r&_r&&(i=i.add(s)),n&_r&&(o=o.add(s)),s=s.double(),r>>=_r,n>>=_r;return{p1:i,p2:o}}function wl(e,t,r,n){Jf(r,e),Qf(n,t);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=Cn(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Br(c),f=new Array(Number(u)+1).fill(o),d=Math.floor((t.BITS-1)/c)*c;let l=o;for(let h=d;h>=0;h-=c){f.fill(o);for(let g=0;g<i;g++){const _=n[g],m=Number(_>>BigInt(h)&u);f[m]=f[m].add(r[g])}let y=o;for(let g=f.length-1,_=o;g>0;g--)_=_.add(f[g]),y=y.add(_);if(l=l.add(y),h!==0)for(let g=0;g<c;g++)l=l.double()}return l}function rc(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return pl(t),t}else return Qt(e,{isLE:r})}function xl(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const c of["p","n","h"]){const u=t[c];if(!(typeof u=="bigint"&&u>tn))throw new Error(`CURVE.${c} must be positive bigint`)}const s=rc(t.p,r.Fp,n),i=rc(t.n,r.Fn,n),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const c of a)if(!s.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:s,Fn:i}}const th=ft;function jt(e,t){if(Vn(e),Vn(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=e&255,e>>>=8;return new Uint8Array(r)}function rh(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function Vn(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function El(e){if(!Jn(e)&&typeof e!="string")throw new Error("DST must be Uint8Array or string");return typeof e=="string"?Q(e):e}function nh(e,t,r,n){He(e),Vn(r),t=El(t),t.length>255&&(t=n(ee(Q("H2C-OVERSIZE-DST-"),t)));const{outputLen:s,blockLen:i}=n,o=Math.ceil(r/s);if(r>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=ee(t,jt(t.length,1)),c=jt(0,i),u=jt(r,2),f=new Array(o),d=n(ee(c,e,u,jt(0,1),a));f[0]=n(ee(d,jt(1,1),a));for(let h=1;h<=o;h++){const y=[rh(d,f[h-1]),jt(h+1,1),a];f[h]=n(ee(...y))}return ee(...f).slice(0,r)}function sh(e,t,r,n,s){if(He(e),Vn(r),t=El(t),t.length>255){const i=Math.ceil(2*n/8);t=s.create({dkLen:i}).update(Q("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return s.create({dkLen:r}).update(e).update(jt(r,2)).update(t).update(jt(t.length,1)).digest()}function Xi(e,t,r){rs(r,{p:"bigint",m:"number",k:"number",hash:"function"});const{p:n,k:s,m:i,hash:o,expand:a,DST:c}=r;if(!qf(r.hash))throw new Error("expected valid hash");He(e),Vn(t);const u=n.toString(2).length,f=Math.ceil((u+s)/8),d=t*i*f;let l;if(a==="xmd")l=nh(e,c,d,o);else if(a==="xof")l=sh(e,c,d,s,o);else if(a==="_internal_pass")l=e;else throw new Error('expand must be "xmd" or "xof"');const h=new Array(t);for(let y=0;y<t;y++){const g=new Array(i);for(let _=0;_<i;_++){const m=f*(_+y*i),b=l.subarray(m,m+f);g[_]=de(th(b),n)}h[y]=g}return h}function vl(e,t){const r=t.map(n=>Array.from(n).reverse());return(n,s)=>{const[i,o,a,c]=r.map(d=>d.reduce((l,h)=>e.add(e.mul(l,n),h))),[u,f]=Vr(e,[o,c],!0);return n=e.mul(i,u),s=e.mul(s,e.mul(a,f)),{x:n,y:s}}}const ih=Q("HashToScalar-");function nc(e,t,r){if(typeof t!="function")throw new Error("mapToCurve() must be defined");function n(i){return e.fromAffine(t(i))}function s(i){const o=i.clearCofactor();return o.equals(e.ZERO)?e.ZERO:(o.assertValidity(),o)}return{defaults:r,hashToCurve(i,o){const a=Object.assign({},r,o),c=Xi(i,2,a),u=n(c[0]),f=n(c[1]);return s(u.add(f))},encodeToCurve(i,o){const a=r.encodeDST?{DST:r.encodeDST}:{},c=Object.assign({},r,a,o),u=Xi(i,1,c),f=n(u[0]);return s(f)},mapToCurve(i){if(!Array.isArray(i))throw new Error("expected array of bigints");for(const o of i)if(typeof o!="bigint")throw new Error("expected array of bigints");return s(n(i))},hashToScalar(i,o){const a=e.Fn.ORDER,c=Object.assign({},r,{p:a,m:1,DST:ih},o);return Xi(i,1,c)[0][0]}}}const sc=(e,t)=>(e+(e>=0?t:-t)/xt)/t;function oh(e,t,r){const[[n,s],[i,o]]=t,a=sc(o*e,r),c=sc(-s*e,r);let u=e-a*n-c*i,f=-a*s-c*o;const d=u<br,l=f<br;d&&(u=-u),l&&(f=-f);const h=Br(Math.ceil(Cn(r)/2))+Ae;if(u<br||u>=h||f<br||f>=h)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:u,k2neg:l,k2:f}}const br=BigInt(0),Ae=BigInt(1),xt=BigInt(2),$r=BigInt(3),So=BigInt(4);function Ds(e,t){const{BYTES:r}=e;let n;if(typeof t=="bigint")n=t;else{let s=Ve("private key",t);try{n=e.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function ah(e,t={}){const r=xl("weierstrass",e,t),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;rs(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=lh(n,s);function f(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(A,w,T){const{x:C,y:F}=w.toAffine(),$=n.toBytes(C);if(Sn(T,"isCompressed"),T){f();const S=!n.isOdd(F);return ee(ch(S),$)}else return ee(Uint8Array.of(4),$,n.toBytes(F))}function l(A){zr(A,void 0,"Point");const{publicKey:w,publicKeyUncompressed:T}=u,C=A.length,F=A[0],$=A.subarray(1);if(C===w&&(F===2||F===3)){const S=n.fromBytes($);if(!n.isValid(S))throw new Error("bad point: is not on curve, wrong x");const V=g(S);let k;try{k=n.sqrt(V)}catch(se){const te=se instanceof Error?": "+se.message:"";throw new Error("bad point: is not on curve, sqrt error"+te)}f();const U=n.isOdd(k);return(F&1)===1!==U&&(k=n.neg(k)),{x:S,y:k}}else if(C===T&&F===4){const S=n.BYTES,V=n.fromBytes($.subarray(0,S)),k=n.fromBytes($.subarray(S,S*2));if(!_(V,k))throw new Error("bad point: is not on curve");return{x:V,y:k}}else throw new Error(`bad point: got length ${C}, expected compressed=${w} or uncompressed=${T}`)}const h=t.toBytes||d,y=t.fromBytes||l;function g(A){const w=n.sqr(A),T=n.mul(w,A);return n.add(n.add(T,n.mul(A,i.a)),i.b)}function _(A,w){const T=n.sqr(w),C=g(A);return n.eql(T,C)}if(!_(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const m=n.mul(n.pow(i.a,$r),So),b=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(m,b)))throw new Error("bad curve params: a or b");function p(A,w,T=!1){if(!n.isValid(w)||T&&n.is0(w))throw new Error(`bad point coordinate ${A}`);return w}function E(A){if(!(A instanceof x))throw new Error("ProjectivePoint expected")}function v(A){if(!c||!c.basises)throw new Error("no endo");return oh(A,c.basises,s.ORDER)}const N=Bn((A,w)=>{const{X:T,Y:C,Z:F}=A;if(n.eql(F,n.ONE))return{x:T,y:C};const $=A.is0();w==null&&(w=$?n.ONE:n.inv(F));const S=n.mul(T,w),V=n.mul(C,w),k=n.mul(F,w);if($)return{x:n.ZERO,y:n.ZERO};if(!n.eql(k,n.ONE))throw new Error("invZ was invalid");return{x:S,y:V}}),I=Bn(A=>{if(A.is0()){if(t.allowInfinityPoint&&!n.is0(A.Y))return;throw new Error("bad point: ZERO")}const{x:w,y:T}=A.toAffine();if(!n.isValid(w)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!_(w,T))throw new Error("bad point: equation left != right");if(!A.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(A,w,T,C,F){return T=new x(n.mul(T.X,A),T.Y,T.Z),w=Ps(C,w),T=Ps(F,T),w.add(T)}class x{constructor(w,T,C){this.X=p("x",w),this.Y=p("y",T,!0),this.Z=p("z",C),Object.freeze(this)}static CURVE(){return i}static fromAffine(w){const{x:T,y:C}=w||{};if(!w||!n.isValid(T)||!n.isValid(C))throw new Error("invalid affine point");if(w instanceof x)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(C)?x.ZERO:new x(T,C,n.ONE)}static fromBytes(w){const T=x.fromAffine(y(zr(w,void 0,"point")));return T.assertValidity(),T}static fromHex(w){return x.fromBytes(Ve("pointHex",w))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(w=8,T=!0){return B.createCache(this,w),T||this.multiply($r),this}assertValidity(){I(this)}hasEvenY(){const{y:w}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(w)}equals(w){E(w);const{X:T,Y:C,Z:F}=this,{X:$,Y:S,Z:V}=w,k=n.eql(n.mul(T,V),n.mul($,F)),U=n.eql(n.mul(C,V),n.mul(S,F));return k&&U}negate(){return new x(this.X,n.neg(this.Y),this.Z)}double(){const{a:w,b:T}=i,C=n.mul(T,$r),{X:F,Y:$,Z:S}=this;let V=n.ZERO,k=n.ZERO,U=n.ZERO,P=n.mul(F,F),se=n.mul($,$),te=n.mul(S,S),Z=n.mul(F,$);return Z=n.add(Z,Z),U=n.mul(F,S),U=n.add(U,U),V=n.mul(w,U),k=n.mul(C,te),k=n.add(V,k),V=n.sub(se,k),k=n.add(se,k),k=n.mul(V,k),V=n.mul(Z,V),U=n.mul(C,U),te=n.mul(w,te),Z=n.sub(P,te),Z=n.mul(w,Z),Z=n.add(Z,U),U=n.add(P,P),P=n.add(U,P),P=n.add(P,te),P=n.mul(P,Z),k=n.add(k,P),te=n.mul($,S),te=n.add(te,te),P=n.mul(te,Z),V=n.sub(V,P),U=n.mul(te,se),U=n.add(U,U),U=n.add(U,U),new x(V,k,U)}add(w){E(w);const{X:T,Y:C,Z:F}=this,{X:$,Y:S,Z:V}=w;let k=n.ZERO,U=n.ZERO,P=n.ZERO;const se=i.a,te=n.mul(i.b,$r);let Z=n.mul(T,$),z=n.mul(C,S),ie=n.mul(F,V),ge=n.add(T,C),J=n.add($,S);ge=n.mul(ge,J),J=n.add(Z,z),ge=n.sub(ge,J),J=n.add(T,F);let he=n.add($,V);return J=n.mul(J,he),he=n.add(Z,ie),J=n.sub(J,he),he=n.add(C,F),k=n.add(S,V),he=n.mul(he,k),k=n.add(z,ie),he=n.sub(he,k),P=n.mul(se,J),k=n.mul(te,ie),P=n.add(k,P),k=n.sub(z,P),P=n.add(z,P),U=n.mul(k,P),z=n.add(Z,Z),z=n.add(z,Z),ie=n.mul(se,ie),J=n.mul(te,J),z=n.add(z,ie),ie=n.sub(Z,ie),ie=n.mul(se,ie),J=n.add(J,ie),Z=n.mul(z,J),U=n.add(U,Z),Z=n.mul(he,J),k=n.mul(ge,k),k=n.sub(k,Z),Z=n.mul(ge,z),P=n.mul(he,P),P=n.add(P,Z),new x(k,U,P)}subtract(w){return this.add(w.negate())}is0(){return this.equals(x.ZERO)}multiply(w){const{endo:T}=t;if(!s.isValidNot0(w))throw new Error("invalid scalar: out of range");let C,F;const $=S=>B.cached(this,S,V=>Tt(x,V));if(T){const{k1neg:S,k1:V,k2neg:k,k2:U}=v(w),{p:P,f:se}=$(V),{p:te,f:Z}=$(U);F=se.add(Z),C=R(T.beta,P,te,S,k)}else{const{p:S,f:V}=$(w);C=S,F=V}return Tt(x,[C,F])[0]}multiplyUnsafe(w){const{endo:T}=t,C=this;if(!s.isValid(w))throw new Error("invalid scalar: out of range");if(w===br||C.is0())return x.ZERO;if(w===Ae)return C;if(B.hasCache(this))return this.multiply(w);if(T){const{k1neg:F,k1:$,k2neg:S,k2:V}=v(w),{p1:k,p2:U}=eh(x,C,$,V);return R(T.beta,k,U,F,S)}else return B.unsafe(C,w)}multiplyAndAddUnsafe(w,T,C){const F=this.multiplyUnsafe(T).add(w.multiplyUnsafe(C));return F.is0()?void 0:F}toAffine(w){return N(this,w)}isTorsionFree(){const{isTorsionFree:w}=t;return o===Ae?!0:w?w(x,this):B.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:w}=t;return o===Ae?this:w?w(x,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(w=!0){return Sn(w,"isCompressed"),this.assertValidity(),h(x,this,w)}toHex(w=!0){return re(this.toBytes(w))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(w=!0){return this.toBytes(w)}_setWindowSize(w){this.precompute(w)}static normalizeZ(w){return Tt(x,w)}static msm(w,T){return wl(x,s,w,T)}static fromPrivateKey(w){return x.BASE.multiply(Ds(s,w))}}x.BASE=new x(i.Gx,i.Gy,n.ONE),x.ZERO=new x(n.ZERO,n.ONE,n.ZERO),x.Fp=n,x.Fn=s;const O=s.BITS,B=new bl(x,t.endo?Math.ceil(O/2):O);return x.BASE.precompute(8),x}function ch(e){return Uint8Array.of(e?2:3)}function uh(e,t){const r=e.ORDER;let n=br;for(let y=r-Ae;y%xt===br;y/=xt)n+=Ae;const s=n,i=xt<<s-Ae-Ae,o=i*xt,a=(r-Ae)/o,c=(a-Ae)/xt,u=o-Ae,f=i,d=e.pow(t,a),l=e.pow(t,(a+Ae)/xt);let h=(y,g)=>{let _=d,m=e.pow(g,u),b=e.sqr(m);b=e.mul(b,g);let p=e.mul(y,b);p=e.pow(p,c),p=e.mul(p,m),m=e.mul(p,g),b=e.mul(p,y);let E=e.mul(b,m);p=e.pow(E,f);let v=e.eql(p,e.ONE);m=e.mul(b,l),p=e.mul(E,_),b=e.cmov(m,b,v),E=e.cmov(p,E,v);for(let N=s;N>Ae;N--){let I=N-xt;I=xt<<I-Ae;let R=e.pow(E,I);const x=e.eql(R,e.ONE);m=e.mul(b,_),_=e.mul(_,_),R=e.mul(E,_),b=e.cmov(m,b,x),E=e.cmov(R,E,x)}return{isValid:v,value:b}};if(e.ORDER%So===$r){const y=(e.ORDER-$r)/So,g=e.sqrt(e.neg(t));h=(_,m)=>{let b=e.sqr(m);const p=e.mul(_,m);b=e.mul(b,p);let E=e.pow(b,y);E=e.mul(E,p);const v=e.mul(E,g),N=e.mul(e.sqr(E),m),I=e.eql(N,_);let R=e.cmov(v,E,I);return{isValid:I,value:R}}}return h}function Nl(e,t){pl(e);const{A:r,B:n,Z:s}=t;if(!e.isValid(r)||!e.isValid(n)||!e.isValid(s))throw new Error("mapToCurveSimpleSWU: invalid opts");const i=uh(e,s);if(!e.isOdd)throw new Error("Field does not have .isOdd()");return o=>{let a,c,u,f,d,l,h,y;a=e.sqr(o),a=e.mul(a,s),c=e.sqr(a),c=e.add(c,a),u=e.add(c,e.ONE),u=e.mul(u,n),f=e.cmov(s,e.neg(c),!e.eql(c,e.ZERO)),f=e.mul(f,r),c=e.sqr(u),l=e.sqr(f),d=e.mul(l,r),c=e.add(c,d),c=e.mul(c,u),l=e.mul(l,f),d=e.mul(l,n),c=e.add(c,d),h=e.mul(a,u);const{isValid:g,value:_}=i(c,l);y=e.mul(a,o),y=e.mul(y,_),h=e.cmov(h,u,g),y=e.cmov(y,_,g);const m=e.isOdd(o)===e.isOdd(y);y=e.cmov(e.neg(y),y,m);const b=Vr(e,[f],!0)[0];return h=e.mul(h,b),{x:h,y}}}function lh(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ic(e){const{CURVE:t,curveOpts:r}=dh(e),n=ah(t,r);return hh(e,n)}function dh(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp;let n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Qt(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:i}}function fh(e,t,r){function n(s){const i=e.sqr(s),o=e.mul(i,s);return e.add(e.add(o,e.mul(s,t)),r)}return n}function hh(e,t){const{Fp:r,Fn:n}=t;function s(o){return il(o,Ae,n.ORDER)}const i=fh(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:o=>Ds(n,o),weierstrassEquation:i,isWithinCurveOrder:s})}const ph=BigInt(0),ds=BigInt(1),oc=BigInt(2),Lr=BigInt(3);function mh(e){const t=[];for(;e>ds;e>>=ds)(e&ds)===ph?t.unshift(0):(e&Lr)===Lr?(t.unshift(-1),e+=ds):t.unshift(1);return t}function Ji(e){if(!Array.isArray(e)||e.length===0)throw new Error("expected non-empty array")}function yh(e,t,r,n){const{Fp2:s,Fp12:i}=e,{twistType:o,ateLoopSize:a,xNegative:c,postPrecompute:u}=n;let f;if(o==="multiplicative")f=(p,E,v,N,I,R)=>i.mul014(N,p,s.mul(E,I),s.mul(v,R));else if(o==="divisive")f=(p,E,v,N,I,R)=>i.mul034(N,s.mul(v,R),s.mul(E,I),p);else throw new Error("bls: unknown twist type");const d=s.div(s.ONE,s.mul(s.ONE,oc));function l(p,E,v,N){const I=s.sqr(v),R=s.sqr(N),x=s.mulByB(s.mul(R,Lr)),O=s.mul(x,Lr),B=s.sub(s.sub(s.sqr(s.add(v,N)),R),I),A=s.sub(x,I),w=s.mul(s.sqr(E),Lr),T=s.neg(B);return p.push([A,w,T]),E=s.mul(s.mul(s.mul(s.sub(I,O),E),v),d),v=s.sub(s.sqr(s.mul(s.add(I,O),d)),s.mul(s.sqr(x),Lr)),N=s.mul(I,B),{Rx:E,Ry:v,Rz:N}}function h(p,E,v,N,I,R){const x=s.sub(v,s.mul(R,N)),O=s.sub(E,s.mul(I,N)),B=s.sub(s.mul(x,I),s.mul(O,R)),A=s.neg(x),w=O;p.push([B,A,w]);const T=s.sqr(O),C=s.mul(T,O),F=s.mul(T,E),$=s.add(s.sub(C,s.mul(F,oc)),s.mul(s.sqr(x),N));return E=s.mul(O,$),v=s.sub(s.mul(s.sub(F,$),x),s.mul(C,v)),N=s.mul(N,C),{Rx:E,Ry:v,Rz:N}}const y=mh(a),g=Bn(p=>{const E=p,{x:v,y:N}=E.toAffine(),I=v,R=N,x=s.neg(N);let O=I,B=R,A=s.ONE;const w=[];for(const T of y){const C=[];({Rx:O,Ry:B,Rz:A}=l(C,O,B,A)),T&&({Rx:O,Ry:B,Rz:A}=h(C,O,B,A,I,T===-1?x:R)),w.push(C)}if(u){const T=w[w.length-1];u(O,B,A,I,R,h.bind(null,T))}return w});function _(p,E=!1){let v=i.ONE;if(p.length){const N=p[0][0].length;for(let I=0;I<N;I++){v=i.sqr(v);for(const[R,x,O]of p)for(const[B,A,w]of R[I])v=f(B,A,w,v,x,O)}}return c&&(v=i.conjugate(v)),E?i.finalExponentiate(v):v}function m(p,E=!0){const v=[];Tt(t,p.map(({g1:N})=>N)),Tt(r,p.map(({g2:N})=>N));for(const{g1:N,g2:I}of p){if(N.is0()||I.is0())throw new Error("pairing is not available for ZERO point");N.assertValidity(),I.assertValidity();const R=N.toAffine();v.push([g(I),R.x,R.y])}return _(v,E)}function b(p,E,v=!0){return m([{g1:p,g2:E}],v)}return{Fp12:i,millerLoopBatch:_,pairing:b,pairingBatch:m,calcPairingPrecomputes:g}}function ac(e,t,r,n,s){const{Fp12:i,pairingBatch:o}=e;function a(d){return d instanceof t.Point?d:t.Point.fromHex(d)}function c(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function u(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${s?"G1":"G2"} curve`);return d}const f=s?(d,l)=>({g1:l,g2:d}):(d,l)=>({g1:d,g2:l});return{getPublicKey(d){const l=Ds(t.Point.Fn,d);return t.Point.BASE.multiply(l)},sign(d,l,h){if(h!=null)throw new Error("sign() expects 2 arguments");const y=Ds(t.Point.Fn,l);return u(d).assertValidity(),d.multiply(y)},verify(d,l,h,y){if(y!=null)throw new Error("verify() expects 3 arguments");d=c(d),h=a(h);const g=h.negate(),_=t.Point.BASE,m=u(l),b=d,p=o([f(g,m),f(_,b)]);return i.eql(p,i.ONE)},verifyBatch(d,l,h){if(Ji(l),h.length!==l.length)throw new Error("amount of public keys and messages should be equal");const y=c(d),g=l,_=h.map(a),m=new Map;for(let E=0;E<_.length;E++){const v=_[E],N=g[E];let I=m.get(N);I===void 0&&(I=[],m.set(N,I)),I.push(v)}const b=[],p=t.Point.BASE;try{for(const[E,v]of m){const N=v.reduce((I,R)=>I.add(R));b.push(f(N,E))}return b.push(f(p.negate(),y)),i.eql(o(b),i.ONE)}catch{return!1}},aggregatePublicKeys(d){Ji(d),d=d.map(h=>a(h));const l=d.reduce((h,y)=>h.add(y),t.Point.ZERO);return l.assertValidity(),l},aggregateSignatures(d){Ji(d),d=d.map(h=>c(h));const l=d.reduce((h,y)=>h.add(y),r.Point.ZERO);return l.assertValidity(),l},hash(d,l){He(d);const h=l?{DST:l}:void 0;return r.hashToCurve(d,h)},Signature:n}}function gh(e){const{Fp:t,Fr:r,Fp2:n,Fp6:s,Fp12:i}=e.fields,o=ic(e.G1),a=Object.assign(o,nc(o.Point,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),c=ic(e.G2),u=Object.assign(c,nc(c.Point,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults})),f=yh(e.fields,a.Point,u.Point,{...e.params,postPrecompute:e.postPrecompute}),{millerLoopBatch:d,pairing:l,pairingBatch:h,calcPairingPrecomputes:y}=f,g=ac(f,a,u,e.G2.Signature,!1),_=ac(f,u,a,e.G1.ShortSignature,!0),m=e.randomBytes||uu,b=()=>{const S=yl(r.ORDER);return Xf(m(S),r.ORDER)},p={randomSecretKey:b,randomPrivateKey:b,calcPairingPrecomputes:y},{ShortSignature:E}=e.G1,{Signature:v}=e.G2;function N(S,V){return S instanceof a.Point?S:_.hash(Ve("point",S),V?.DST)}function I(S,V){return S instanceof u.Point?S:g.hash(Ve("point",S),V?.DST)}function R(S){return g.getPublicKey(S).toBytes(!0)}function x(S){return _.getPublicKey(S).toBytes(!0)}function O(S,V,k){const U=I(S,k),P=g.sign(U,V);return S instanceof u.Point?P:v.toBytes(P)}function B(S,V,k){const U=N(S,k),P=_.sign(U,V);return S instanceof a.Point?P:E.toBytes(P)}function A(S,V,k,U){const P=I(V,U);return g.verify(S,P,k)}function w(S,V,k,U){const P=N(V,U);return _.verify(S,P,k)}function T(S){const V=g.aggregatePublicKeys(S);return S[0]instanceof a.Point?V:V.toBytes(!0)}function C(S){const V=g.aggregateSignatures(S);return S[0]instanceof u.Point?V:v.toBytes(V)}function F(S){const V=_.aggregateSignatures(S);return S[0]instanceof a.Point?V:E.toBytes(V)}function $(S,V,k,U){const P=V.map(se=>I(se,U));return g.verifyBatch(S,P,k)}return a.Point.BASE.precompute(4),{longSignatures:g,shortSignatures:_,millerLoopBatch:d,pairing:l,pairingBatch:h,verifyBatch:$,fields:{Fr:r,Fp:t,Fp2:n,Fp6:s,Fp12:i},params:{ateLoopSize:e.params.ateLoopSize,twistType:e.params.twistType,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:p,getPublicKey:R,getPublicKeyForShortSignatures:x,sign:O,signShortSignature:B,verify:A,verifyShortSignature:w,aggregatePublicKeys:T,aggregateSignatures:C,aggregateShortSignatures:F,G1:a,G2:u,Signature:v,ShortSignature:E}}const cc=BigInt(0),It=BigInt(1),Be=BigInt(2),uc=BigInt(3);function _a(e,t,r,n,s=1,i){const o=BigInt(i===void 0?n:i),a=r**BigInt(n),c=[];for(let u=0;u<s;u++){const f=BigInt(u+1),d=[];for(let l=0,h=It;l<n;l++){const y=(f*h-f)/o%a;d.push(e.pow(t,y)),h*=r}c.push(d)}return c}function _h(e,t,r){const n=t.pow(r,(e.ORDER-It)/uc),s=t.pow(r,(e.ORDER-It)/Be);function i(l,h){const y=t.mul(t.frobeniusMap(l,1),n),g=t.mul(t.frobeniusMap(h,1),s);return[y,g]}const o=t.pow(r,(e.ORDER**Be-It)/uc),a=t.pow(r,(e.ORDER**Be-It)/Be);if(!t.eql(a,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(l,h){return[t.mul(l,o),t.neg(h)]}const u=l=>(h,y)=>{const g=y.toAffine(),_=l(g.x,g.y);return h.fromAffine({x:_[0],y:_[1]})},f=u(i),d=u(c);return{psi:i,psi2:c,G2psi:f,G2psi2:d,PSI_X:n,PSI_Y:s,PSI2_X:o,PSI2_Y:a}}const lc=(e,t)=>{if(t.length!==2)throw new Error("invalid tuple");const r=t.map(n=>e.create(n));return{c0:r[0],c1:r[1]}};class bh{constructor(t,r={}){this.MASK=It;const n=t.ORDER,s=n*n;this.Fp=t,this.ORDER=s,this.BITS=Cn(s),this.BYTES=Math.ceil(Cn(s)/8),this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.Fp_NONRESIDUE=t.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=t.div(t.ONE,Be),this.NONRESIDUE=lc(t,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=_a(t,this.Fp_NONRESIDUE,t.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(t){return lc(this.Fp,t)}create(t){return t}isValid({c0:t,c1:r}){function n(s,i){return typeof s=="bigint"&&cc<=s&&s<i}return n(t,this.ORDER)&&n(r,this.ORDER)}is0({c0:t,c1:r}){return this.Fp.is0(t)&&this.Fp.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}eql({c0:t,c1:r},{c0:n,c1:s}){return this.Fp.eql(t,n)&&this.Fp.eql(r,s)}neg({c0:t,c1:r}){return{c0:this.Fp.neg(t),c1:this.Fp.neg(r)}}pow(t,r){return ni(this,t,r)}invertBatch(t){return Vr(this,t)}add(t,r){const{c0:n,c1:s}=t,{c0:i,c1:o}=r;return{c0:this.Fp.add(n,i),c1:this.Fp.add(s,o)}}sub({c0:t,c1:r},{c0:n,c1:s}){return{c0:this.Fp.sub(t,n),c1:this.Fp.sub(r,s)}}mul({c0:t,c1:r},n){const{Fp:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};const{c0:i,c1:o}=n;let a=s.mul(t,i),c=s.mul(r,o);const u=s.sub(a,c),f=s.sub(s.mul(s.add(t,r),s.add(i,o)),s.add(a,c));return{c0:u,c1:f}}sqr({c0:t,c1:r}){const{Fp:n}=this,s=n.add(t,r),i=n.sub(t,r),o=n.add(t,t);return{c0:n.mul(s,i),c1:n.mul(o,r)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}div(t,r){const{Fp:n}=this;return this.mul(t,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:t,c1:r}){const{Fp:n}=this,s=n.inv(n.create(t*t+r*r));return{c0:n.mul(s,n.create(t)),c1:n.mul(s,n.create(-r))}}sqrt(t){const{Fp:r}=this,n=this,{c0:s,c1:i}=t;if(r.is0(i))return Us(r,s)===1?n.create({c0:r.sqrt(s),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(s,this.Fp_NONRESIDUE))});const o=r.sqrt(r.sub(r.sqr(s),r.mul(r.sqr(i),this.Fp_NONRESIDUE)));let a=r.mul(r.add(o,s),this.Fp_div2);Us(r,a)===-1&&(a=r.sub(a,o));const u=r.sqrt(a),f=n.create({c0:u,c1:r.div(r.mul(i,this.Fp_div2),u)});if(!n.eql(n.sqr(f),t))throw new Error("Cannot find square root");const d=f,l=n.neg(d),{re:h,im:y}=n.reim(d),{re:g,im:_}=n.reim(l);return y>_||y===_&&h>g?d:l}isOdd(t){const{re:r,im:n}=this.reim(t),s=r%Be,i=r===cc,o=n%Be;return BigInt(s||i&&o)==It}fromBytes(t){const{Fp:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){return ee(this.Fp.toBytes(t),this.Fp.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},i){return{c0:this.Fp.cmov(t,n,i),c1:this.Fp.cmov(r,s,i)}}reim({c0:t,c1:r}){return{re:t,im:r}}Fp4Square(t,r){const n=this,s=n.sqr(t),i=n.sqr(r);return{first:n.add(n.mulByNonresidue(i),s),second:n.sub(n.sub(n.sqr(n.add(t,r)),s),i)}}mulByNonresidue({c0:t,c1:r}){return this.mul({c0:t,c1:r},this.NONRESIDUE)}frobeniusMap({c0:t,c1:r},n){return{c0:t,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}}class wh{constructor(t){this.MASK=It,this.Fp2=t,this.ORDER=t.ORDER,this.BITS=3*t.BITS,this.BYTES=3*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO,c2:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO,c2:t.ZERO};const{Fp:r}=t,n=_a(t,t.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:o}){const{Fp2:a}=this;return{c0:a.add(t,s),c1:a.add(r,i),c2:a.add(n,o)}}sub({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:o}){const{Fp2:a}=this;return{c0:a.sub(t,s),c1:a.sub(r,i),c2:a.sub(n,o)}}mul({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;if(typeof s=="bigint")return{c0:i.mul(t,s),c1:i.mul(r,s),c2:i.mul(n,s)};const{c0:o,c1:a,c2:c}=s,u=i.mul(t,o),f=i.mul(r,a),d=i.mul(n,c);return{c0:i.add(u,i.mulByNonresidue(i.sub(i.mul(i.add(r,n),i.add(a,c)),i.add(f,d)))),c1:i.add(i.sub(i.mul(i.add(t,r),i.add(o,a)),i.add(u,f)),i.mulByNonresidue(d)),c2:i.sub(i.add(f,i.mul(i.add(t,n),i.add(o,c))),i.add(u,d))}}sqr({c0:t,c1:r,c2:n}){const{Fp2:s}=this;let i=s.sqr(t),o=s.mul(s.mul(t,r),Be),a=s.mul(s.mul(r,n),Be),c=s.sqr(n);return{c0:s.add(s.mulByNonresidue(a),i),c1:s.add(s.mulByNonresidue(c),o),c2:s.sub(s.sub(s.add(s.add(o,s.sqr(s.add(s.sub(t,r),n))),a),i),c)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}create(t){return t}isValid({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return s.isValid(t)&&s.isValid(r)&&s.isValid(n)}is0({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return s.is0(t)&&s.is0(r)&&s.is0(n)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return{c0:s.neg(t),c1:s.neg(r),c2:s.neg(n)}}eql({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:o}){const{Fp2:a}=this;return a.eql(t,s)&&a.eql(r,i)&&a.eql(n,o)}sqrt(t){return ol()}div(t,r){const{Fp2:n}=this,{Fp:s}=n;return this.mul(t,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(t,r){return ni(this,t,r)}invertBatch(t){return Vr(this,t)}inv({c0:t,c1:r,c2:n}){const{Fp2:s}=this;let i=s.sub(s.sqr(t),s.mulByNonresidue(s.mul(n,r))),o=s.sub(s.mulByNonresidue(s.sqr(n)),s.mul(t,r)),a=s.sub(s.sqr(r),s.mul(t,n)),c=s.inv(s.add(s.mulByNonresidue(s.add(s.mul(n,o),s.mul(r,a))),s.mul(t,i)));return{c0:s.mul(c,i),c1:s.mul(c,o),c2:s.mul(c,a)}}fromBytes(t){const{Fp2:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);const n=r.BYTES;return{c0:r.fromBytes(t.subarray(0,n)),c1:r.fromBytes(t.subarray(n,n*2)),c2:r.fromBytes(t.subarray(2*n))}}toBytes({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return ee(s.toBytes(t),s.toBytes(r),s.toBytes(n))}cmov({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:o},a){const{Fp2:c}=this;return{c0:c.cmov(t,s,a),c1:c.cmov(r,i,a),c2:c.cmov(n,o,a)}}fromBigSix(t){const{Fp2:r}=this;if(!Array.isArray(t)||t.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(t.slice(0,2)),c1:r.fromBigTuple(t.slice(2,4)),c2:r.fromBigTuple(t.slice(4,6))}}frobeniusMap({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.frobeniusMap(t,s),c1:i.mul(i.frobeniusMap(r,s),this.FROBENIUS_COEFFICIENTS_1[s%6]),c2:i.mul(i.frobeniusMap(n,s),this.FROBENIUS_COEFFICIENTS_2[s%6])}}mulByFp2({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.mul(t,s),c1:i.mul(r,s),c2:i.mul(n,s)}}mulByNonresidue({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return{c0:s.mulByNonresidue(n),c1:t,c2:r}}mul1({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.mulByNonresidue(i.mul(n,s)),c1:i.mul(t,s),c2:i.mul(r,s)}}mul01({c0:t,c1:r,c2:n},s,i){const{Fp2:o}=this;let a=o.mul(t,s),c=o.mul(r,i);return{c0:o.add(o.mulByNonresidue(o.sub(o.mul(o.add(r,n),i),c)),a),c1:o.sub(o.sub(o.mul(o.add(s,i),o.add(t,r)),a),c),c2:o.add(o.sub(o.mul(o.add(t,n),s),a),c)}}}class xh{constructor(t,r){this.MASK=It;const{Fp2:n}=t,{Fp:s}=n;this.Fp6=t,this.ORDER=n.ORDER,this.BITS=2*t.BITS,this.BYTES=2*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.FROBENIUS_COEFFICIENTS=_a(n,n.NONRESIDUE,s.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(t){return t}isValid({c0:t,c1:r}){const{Fp6:n}=this;return n.isValid(t)&&n.isValid(r)}is0({c0:t,c1:r}){const{Fp6:n}=this;return n.is0(t)&&n.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r}){const{Fp6:n}=this;return{c0:n.neg(t),c1:n.neg(r)}}eql({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return i.eql(t,n)&&i.eql(r,s)}sqrt(t){ol()}inv({c0:t,c1:r}){const{Fp6:n}=this;let s=n.inv(n.sub(n.sqr(t),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(t,s),c1:n.neg(n.mul(r,s))}}div(t,r){const{Fp6:n}=this,{Fp2:s}=n,{Fp:i}=s;return this.mul(t,typeof r=="bigint"?i.inv(i.create(r)):this.inv(r))}pow(t,r){return ni(this,t,r)}invertBatch(t){return Vr(this,t)}add({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return{c0:i.add(t,n),c1:i.add(r,s)}}sub({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return{c0:i.sub(t,n),c1:i.sub(r,s)}}mul({c0:t,c1:r},n){const{Fp6:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};let{c0:i,c1:o}=n,a=s.mul(t,i),c=s.mul(r,o);return{c0:s.add(a,s.mulByNonresidue(c)),c1:s.sub(s.mul(s.add(t,r),s.add(i,o)),s.add(a,c))}}sqr({c0:t,c1:r}){const{Fp6:n}=this;let s=n.mul(t,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),t),n.add(t,r)),s),n.mulByNonresidue(s)),c1:n.add(s,s)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}fromBytes(t){const{Fp6:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){const{Fp6:n}=this;return ee(n.toBytes(t),n.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},i){const{Fp6:o}=this;return{c0:o.cmov(t,n,i),c1:o.cmov(r,s,i)}}fromBigTwelve(t){const{Fp6:r}=this;return{c0:r.fromBigSix(t.slice(0,6)),c1:r.fromBigSix(t.slice(6,12))}}frobeniusMap(t,r){const{Fp6:n}=this,{Fp2:s}=n,{c0:i,c1:o,c2:a}=n.frobeniusMap(t.c1,r),c=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(t.c0,r),c1:n.create({c0:s.mul(i,c),c1:s.mul(o,c),c2:s.mul(a,c)})}}mulByFp2({c0:t,c1:r},n){const{Fp6:s}=this;return{c0:s.mulByFp2(t,n),c1:s.mulByFp2(r,n)}}conjugate({c0:t,c1:r}){return{c0:t,c1:this.Fp6.neg(r)}}mul014({c0:t,c1:r},n,s,i){const{Fp6:o}=this,{Fp2:a}=o;let c=o.mul01(t,n,s),u=o.mul1(r,i);return{c0:o.add(o.mulByNonresidue(u),c),c1:o.sub(o.sub(o.mul01(o.add(r,t),n,a.add(s,i)),c),u)}}mul034({c0:t,c1:r},n,s,i){const{Fp6:o}=this,{Fp2:a}=o,c=o.create({c0:a.mul(t.c0,n),c1:a.mul(t.c1,n),c2:a.mul(t.c2,n)}),u=o.mul01(r,s,i),f=o.mul01(o.add(t,r),a.add(n,s),i);return{c0:o.add(o.mulByNonresidue(u),c),c1:o.sub(f,o.add(c,u))}}_cyclotomicSquare({c0:t,c1:r}){const{Fp6:n}=this,{Fp2:s}=n,{c0:i,c1:o,c2:a}=t,{c0:c,c1:u,c2:f}=r,{first:d,second:l}=s.Fp4Square(i,u),{first:h,second:y}=s.Fp4Square(c,a),{first:g,second:_}=s.Fp4Square(o,f),m=s.mulByNonresidue(_);return{c0:n.create({c0:s.add(s.mul(s.sub(d,i),Be),d),c1:s.add(s.mul(s.sub(h,o),Be),h),c2:s.add(s.mul(s.sub(g,a),Be),g)}),c1:n.create({c0:s.add(s.mul(s.add(m,c),Be),m),c1:s.add(s.mul(s.add(l,u),Be),l),c2:s.add(s.mul(s.add(y,f),Be),y)})}}_cyclotomicExp(t,r){let n=this.ONE;for(let s=this.X_LEN-1;s>=0;s--)n=this._cyclotomicSquare(n),Lf(r,s)&&(n=this.mul(n,t));return n}}function Eh(e){const t=Qt(e.ORDER),r=new bh(t,e),n=new wh(r),s=new xh(n,e);return{Fp:t,Fp2:r,Fp6:n,Fp12:s}}const Oe=BigInt(0),Ms=BigInt(1),Ze=BigInt(2),si=BigInt(3),kn=BigInt(4),Kt=BigInt("0xd201000000010000"),vh=Cn(Kt),Or={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:Oe,b:kn,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},Nh=Qt(Or.n,{modFromBytes:!0,isLE:!0}),{Fp:M,Fp2:j,Fp6:Th,Fp12:Y}=Eh({ORDER:Or.p,X_LEN:vh,FP2_NONRESIDUE:[Ms,Ms],Fp2mulByB:({c0:e,c1:t})=>{const r=M.mul(e,kn),n=M.mul(t,kn);return{c0:M.sub(r,n),c1:M.add(r,n)}},Fp12finalExponentiate:e=>{const t=Kt,r=Y.div(Y.frobeniusMap(e,6),e),n=Y.mul(Y.frobeniusMap(r,2),r),s=Y.conjugate(Y._cyclotomicExp(n,t)),i=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),s),o=Y.conjugate(Y._cyclotomicExp(i,t)),a=Y.conjugate(Y._cyclotomicExp(o,t)),c=Y.mul(Y.conjugate(Y._cyclotomicExp(a,t)),Y._cyclotomicSquare(s)),u=Y.conjugate(Y._cyclotomicExp(c,t)),f=Y.frobeniusMap(Y.mul(s,a),2),d=Y.frobeniusMap(Y.mul(o,n),3),l=Y.frobeniusMap(Y.mul(c,Y.conjugate(n)),1),h=Y.mul(Y.mul(u,Y.conjugate(i)),n);return Y.mul(Y.mul(Y.mul(f,d),l),h)}}),{G2psi:dc,G2psi2:Ih}=_h(M,j,j.div(j.ONE,j.NONRESIDUE)),Qi=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:M.ORDER,m:2,k:128,expand:"xmd",hash:Ge}),ba={p:j.ORDER,n:Or.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:j.ZERO,b:j.fromBigTuple([kn,kn]),Gx:j.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:j.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},ii=ns(M.toBytes(Oe),{infinity:!0,compressed:!0});function oi(e){e=e.slice();const t=e[0]&224,r=!!(t>>7&1),n=!!(t>>6&1),s=!!(t>>5&1);return e[0]&=31,{compressed:r,infinity:n,sort:s,value:e}}function ns(e,t){if(e[0]&224)throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Rh(e,t,r){const{BYTES:n,ORDER:s}=M,i=t.is0(),{x:o,y:a}=t.toAffine();if(r){if(i)return ii.slice();const c=!!(a*Ze/s);return ns(ve(o,n),{compressed:!0,sort:c})}else return i?ee(Uint8Array.of(64),new Uint8Array(2*n-1)):ee(ve(o,n),ve(a,n))}function eo(e){e.assertValidity();const{BYTES:t,ORDER:r}=M,{x:n,y:s}=e.toAffine();if(e.is0())return ii.slice();const i=!!(s*Ze/r);return ns(ve(n,t),{compressed:!0,sort:i})}function Oh(e){const{compressed:t,infinity:r,sort:n,value:s}=oi(e),{BYTES:i,ORDER:o}=M;if(s.length===48&&t){const a=ft(s),c=M.create(a&Br(M.BITS));if(r){if(c!==Oe)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:Oe,y:Oe}}const u=M.add(M.pow(c,si),M.create(Or.b));let f=M.sqrt(u);if(!f)throw new Error("invalid G1 point: compressed point");return f*Ze/o!==BigInt(n)&&(f=M.neg(f)),{x:M.create(c),y:M.create(f)}}else if(s.length===96&&!t){const a=ft(s.subarray(0,i)),c=ft(s.subarray(i));if(r){if(a!==Oe||c!==Oe)throw new Error("G1: non-empty point at infinity");return ai.G1.Point.ZERO.toAffine()}return{x:M.create(a),y:M.create(c)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function fc(e){const{infinity:t,sort:r,value:n}=oi(Ve("signatureHex",e,48)),s=M.ORDER,i=ai.G1.Point,o=ft(n);if(t)return i.ZERO;const a=M.create(o&Br(M.BITS)),c=M.add(M.pow(a,si),M.create(Or.b));let u=M.sqrt(c);if(!u)throw new Error("invalid G1 point: compressed");const f=BigInt(r);u*Ze/s!==f&&(u=M.neg(u));const d=i.fromAffine({x:a,y:u});return d.assertValidity(),d}function Sh(e,t,r){const{BYTES:n,ORDER:s}=M,i=t.is0(),{x:o,y:a}=t.toAffine();if(r){if(i)return ee(ii,ve(Oe,n));const c=!!(a.c1===Oe?a.c0*Ze/s:a.c1*Ze/s);return ee(ns(ve(o.c1,n),{compressed:!0,sort:c}),ve(o.c0,n))}else{if(i)return ee(Uint8Array.of(64),new Uint8Array(4*n-1));const{re:c,im:u}=j.reim(o),{re:f,im:d}=j.reim(a);return ee(ve(u,n),ve(c,n),ve(d,n),ve(f,n))}}function to(e){e.assertValidity();const{BYTES:t}=M;if(e.is0())return ee(ii,ve(Oe,t));const{x:r,y:n}=e.toAffine(),{re:s,im:i}=j.reim(r),{re:o,im:a}=j.reim(n),u=!!((a>Oe?a*Ze:o*Ze)/M.ORDER&Ms),f=s;return ee(ns(ve(i,t),{sort:u,compressed:!0}),ve(f,t))}function Ah(e){const{BYTES:t,ORDER:r}=M,{compressed:n,infinity:s,sort:i,value:o}=oi(e);if(!n&&!s&&i||!n&&s&&i||i&&s&&n)throw new Error("invalid encoding flag: "+(e[0]&224));const a=(c,u,f)=>ft(c.slice(u,f));if(o.length===96&&n){if(s){if(o.reduce((y,g)=>y!==0?g+1:g,0)>0)throw new Error("invalid G2 point: compressed");return{x:j.ZERO,y:j.ZERO}}const c=a(o,0,t),u=a(o,t,2*t),f=j.create({c0:M.create(u),c1:M.create(c)}),d=j.add(j.pow(f,si),ba.b);let l=j.sqrt(d);const h=l.c1===Oe?l.c0*Ze/r:l.c1*Ze/r?Ms:Oe;return l=i&&h>0?l:j.neg(l),{x:f,y:l}}else if(o.length===192&&!n){if(s){if(o.reduce((l,h)=>l!==0?h+1:h,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:j.ZERO,y:j.ZERO}}const c=a(o,0*t,1*t),u=a(o,1*t,2*t),f=a(o,2*t,3*t),d=a(o,3*t,4*t);return{x:j.fromBigTuple([u,c]),y:j.fromBigTuple([d,f])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function hc(e){const{ORDER:t}=M,{infinity:r,sort:n,value:s}=oi(Ve("signatureHex",e)),i=ai.G2.Point,o=s.length/2;if(o!==48&&o!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");const a=ft(s.slice(0,o)),c=ft(s.slice(o));if(r)return i.ZERO;const u=M.create(a&Br(M.BITS)),f=M.create(c),d=j.create({c0:f,c1:u}),l=j.add(j.pow(d,si),ba.b);let h=j.sqrt(l);if(!h)throw new Error("Failed to find a square root");const{re:y,im:g}=j.reim(h),_=BigInt(n),m=g>Oe&&g*Ze/t!==_,b=g===Oe&&y*Ze/t!==_;(m||b)&&(h=j.neg(h));const p=i.fromAffine({x:d,y:h});return p.assertValidity(),p}const ai=gh({fields:{Fp:M,Fp2:j,Fp6:Th,Fp12:Y,Fr:Nh},G1:{...Or,Fp:M,htfDefaults:{...Qi,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{const r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new e(M.mul(t.X,r),t.Y,t.Z);return t.multiplyUnsafe(Kt).negate().multiplyUnsafe(Kt).equals(n)},clearCofactor:(e,t)=>t.multiplyUnsafe(Kt).add(t),mapToCurve:Fh,fromBytes:Oh,toBytes:Rh,ShortSignature:{fromBytes(e){return He(e),fc(e)},fromHex(e){return fc(e)},toBytes(e){return eo(e)},toRawBytes(e){return eo(e)},toHex(e){return re(eo(e))}}},G2:{...ba,Fp:j,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Qi},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:Uh,isTorsionFree:(e,t)=>t.multiplyUnsafe(Kt).negate().equals(dc(e,t)),clearCofactor:(e,t)=>{const r=Kt;let n=t.multiplyUnsafe(r).negate(),s=dc(e,t),i=t.double();return i=Ih(e,i),i=i.subtract(s),s=n.add(s),s=s.multiplyUnsafe(r).negate(),i=i.add(s),i=i.subtract(n),i.subtract(t)},fromBytes:Ah,toBytes:Sh,Signature:{fromBytes(e){return He(e),hc(e)},fromHex(e){return hc(e)},toBytes(e){return to(e)},toRawBytes(e){return to(e)},toHex(e){return re(to(e))}}},params:{ateLoopSize:Kt,r:Or.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:Qi}),Ch=vl(j,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(t=>j.fromBigTuple(t.map(BigInt))))),Bh=vl(M,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),Vh=Nl(M,{A:M.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:M.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:M.create(BigInt(11))}),kh=Nl(j,{A:j.create({c0:M.create(Oe),c1:M.create(BigInt(240))}),B:j.create({c0:M.create(BigInt(1012)),c1:M.create(BigInt(1012))}),Z:j.create({c0:M.create(BigInt(-2)),c1:M.create(BigInt(-1))})});function Fh(e){const{x:t,y:r}=Vh(M.create(e[0]));return Bh(t,r)}function Uh(e){const{x:t,y:r}=kh(j.fromBigTuple(e));return Ch(t,r)}function Ph(e,t,r){const n=typeof e=="string"?e:re(e),s=typeof t=="string"?t:re(t),i=typeof r=="string"?r:re(r);return ai.verifyShortSignature(s,i,n)}const Dh=BigInt(1e6),Tl=e=>be(new sn(e)),ci=e=>{const r=Tl(e)/Dh;return new Date(Number(r))},pc=60*1e3,Mh=60,$h=24,Lh=$h*Mh,qh=5,jh=5,Kh=30*Lh;var le;(function(e){e[e.Empty=0]="Empty",e[e.Fork=1]="Fork",e[e.Labeled=2]="Labeled",e[e.Leaf=3]="Leaf",e[e.Pruned=4]="Pruned"})(le||(le={}));function Gh(e,t){for(let r=0;r<e.length;r++)if(e[r]>t[r])return!0;return!1}class ht{#e=!1;#t=void 0;static async create(t){const r=ht.createUnverified(t);return await r.verify(),r}static createUnverified(t){return new ht(t.certificate,t.rootKey,t.principal,t.blsVerify??Ph,t.maxAgeInMinutes,t.disableTimeVerification,t.agent)}constructor(t,r,n,s,i=qh,o=!1,a){this._rootKey=r,this._principal=n,this._blsVerify=s,this._maxAgeInMinutes=i,this.#e=o,this.cert=ct(t),a&&"getTimeDiffMsecs"in a&&"hasSyncedTime"in a&&"syncTime"in a&&"syncTimeWithSubnet"in a&&(this.#t=a)}lookup_path(t){return cn(t,this.cert.tree)}lookup_subtree(t){return ui(t,this.cert.tree)}async verify(){const t=await ws(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,s=zh(r),i=ee(sf,t),o=Fe(this.lookup_path(["time"]));if(!o)throw ae.fromCode(new zt("Certificate does not contain a time"));if(!this.#e){const a=this.#t?.getTimeDiffMsecs()??0,c=this._maxAgeInMinutes*pc,u=new Date,f=u.getTime()+a,d=f-c,l=f+jh*pc,h=ci(o),y=h.getTime()<d,g=h.getTime()>l;if((y||g)&&this.#t&&!this.#t.hasSyncedTime())return await this._syncTime(),await this.verify();if(y)throw De.fromCode(new Jr(this._maxAgeInMinutes,h,u,a,"past"));if(g)throw this.#t?.hasSyncedTime()?Re.fromCode(new Me("System time has been synced with the IC network, but certificate is still too far in the future.")):De.fromCode(new Jr(5,h,u,a,"future"))}try{if(!await this._blsVerify(s,n,i))throw De.fromCode(new zt("Invalid signature"))}catch(a){throw De.fromCode(new zt("Signature verification failed",a))}}async _checkDelegationAndGetKey(t){if(!t)return this._rootKey;const r=ht.createUnverified({certificate:t.certificate,rootKey:this._rootKey,principal:this._principal,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:Kh,agent:this.#t});if(r.cert.delegation)throw ae.fromCode(new qo);await r.verify();let n;if(yc(this._principal)){const i=this._principal.canisterId;if(n=D.fromUint8Array(t.subnet_id),!Rl({canisterId:i,subnetId:n,tree:r.cert.tree}))throw De.fromCode(new Qn(i,n))}else if(mc(this._principal))n=this._principal.subnetId;else throw Ot;const s=Fe(r.lookup_path(["subnet",n.toUint8Array(),"public_key"]));if(!s)throw mc(this._principal)?De.fromCode(new jo(n)):De.fromCode(new Go(`Could not find subnet key for subnet ID ${n.toText()}`));return s}async _syncTime(){this.#t&&(yc(this._principal)?await this.#t.syncTime(this._principal.canisterId):await this.#t.syncTimeWithSubnet(this._principal.subnetId))}}function mc(e){return"subnetId"in e}function yc(e){return"canisterId"in e}const pn=dt("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),Hh=96;function zh(e){const t=pn.byteLength+Hh;if(e.byteLength!==t)throw ae.fromCode(new Ys(t,e.byteLength));const r=e.slice(0,pn.byteLength);if(!ri(r,pn))throw ae.fromCode(new Ho(pn,r));return e.slice(pn.byteLength)}function Fe(e){if(e.status===Le.Found&&e.value instanceof Uint8Array)return e.value}async function ws(e){switch(e[0]){case le.Empty:return Ge(fs("ic-hashtree-empty"));case le.Pruned:return e[1];case le.Leaf:return Ge(ee(fs("ic-hashtree-leaf"),e[1]));case le.Labeled:return Ge(ee(fs("ic-hashtree-labeled"),e[1],await ws(e[2])));case le.Fork:return Ge(ee(fs("ic-hashtree-fork"),await ws(e[1]),await ws(e[2])));default:throw Ot}}function fs(e){const t=new Uint8Array([e.length]),r=new TextEncoder().encode(e);return ee(t,r)}function Il(e){return typeof e[0]=="string"?Q(e[0]):e[0]}var Le;(function(e){e.Unknown="Unknown",e.Absent="Absent",e.Found="Found",e.Error="Error"})(Le||(Le={}));var Er;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found"})(Er||(Er={}));var oe;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found",e.Less="Less",e.Greater="Greater"})(oe||(oe={}));function cn(e,t){if(e.length===0)switch(t[0]){case le.Empty:return{status:Le.Absent};case le.Leaf:{if(!t[1])throw Re.fromCode(new es("Invalid tree structure for leaf"));if(t[1]instanceof Uint8Array)return{status:Le.Found,value:t[1].slice(t[1].byteOffset,t[1].byteLength+t[1].byteOffset)};throw Ot}case le.Pruned:return{status:Le.Unknown};case le.Labeled:case le.Fork:return{status:Le.Error};default:throw Ot}const r=Il(e),n=bn(r,t);switch(n.status){case oe.Found:return cn(e.slice(1),n.value);case oe.Absent:case oe.Greater:case oe.Less:return{status:Le.Absent};case oe.Unknown:return{status:Le.Unknown};default:throw Ot}}function ui(e,t){if(e.length===0)return{status:Er.Found,value:t};const r=Il(e),n=bn(r,t);switch(n.status){case oe.Found:return ui(e.slice(1),n.value);case oe.Unknown:return{status:Er.Unknown};case oe.Absent:case oe.Greater:case oe.Less:return{status:Er.Absent};default:throw Ot}}function Ao(e){switch(e[0]){case le.Empty:return[];case le.Fork:return Ao(e[1]).concat(Ao(e[2]));default:return[e]}}function bn(e,t){switch(t[0]){case le.Labeled:return Gh(e,t[1])?{status:oe.Greater}:ri(e,t[1])?{status:oe.Found,value:t[2]}:{status:oe.Less};case le.Fork:{const r=bn(e,t[1]);switch(r.status){case oe.Greater:{const n=bn(e,t[2]);return n.status===oe.Less?{status:oe.Absent}:n}case oe.Unknown:{const n=bn(e,t[2]);return n.status===oe.Less?{status:oe.Unknown}:n}default:return r}}case le.Pruned:return{status:oe.Unknown};default:return{status:oe.Absent}}}function xs(e,t){switch(t[0]){case le.Empty|le.Pruned:return[];case le.Leaf:return[e];case le.Fork:return xs(e,t[1]).concat(xs(e,t[2]));case le.Labeled:{const r=t[1],n=t[2],s=[...e,r];return xs(s,n)}default:throw Ot}}function Rl(e){const t=Zh(e),r=Ol(t),{canisterId:n}=e;return r.some(i=>i[0].ltEq(n)&&i[1].gtEq(n))}function Zh(e){const{subnetId:t,tree:r,canisterId:n}=e,s=ui(["canister_ranges",t.toUint8Array()],r);if(s.status!==Er.Found)return Yh(t,r);const i=s.value,o=Wh(i);if(o.length===0)throw ae.fromCode(new Qn(n,t));o.sort(Js);const a=Xh(o,n),c=o[a];return Jh(c,i)}function Yh(e,t){const r=cn(["subnet",e.toUint8Array(),"canister_ranges"],t);if(r.status!==Le.Found)throw ae.fromCode(new vr(`Could not find canister ranges for subnet ${e.toText()}`,r.status));return r.value}function Ol(e){return ct(e).map(n=>[D.fromUint8Array(n[0]),D.fromUint8Array(n[1])])}function Wh(e){const t=[];for(const r of xs([],e)){const n=r[0];if(!n)throw ae.fromCode(new zt("Path is invalid"));t.push(n)}return t}function Xh(e,t){const r=t.toUint8Array();let n=0,s=e.length-1;for(;n<s;){const i=Math.floor((n+s)/2);Js(e[i],r)<=0?s=i:n=i+1}return n}function Jh(e,t){const r=cn([e],t);if(r.status!==Le.Found)throw ae.fromCode(new vr(`Could not find canister range for shard ${e.toString()}`,r.status));return r.value}function gc(e,t){return e.delegation?D.fromUint8Array(e.delegation.subnet_id):D.selfAuthenticating(t)}const Qh=D.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe");function Sl(e,t){switch(t){case"raw":return e;case"leb128":return Tl(e);case"cbor":return ct(e);case"hex":return re(e);case"utf-8":return new TextDecoder().decode(e)}}function e0(e){return ct(e).map(r=>D.fromUint8Array(r))}function t0(e,t){const r=typeof e=="string"?Q(e):e;return[Q("canister"),t,Q("metadata"),r]}function rn(e){return typeof e=="object"&&e!==null&&"key"in e&&"path"in e}function wa(e,t){const r=ui(["subnet",t.toUint8Array(),"node"],e.tree);if(r.status!==Er.Found)throw ae.fromCode(new vr("Node not found",r.status));if(r.value instanceof Uint8Array)throw Re.fromCode(new es("Invalid node tree"));const n=Ao(r.value),s=new Map;return n.forEach(i=>{const o=D.from(i[1]).toText(),a=cn(["public_key"],i[2]);if(a.status!==Le.Found)throw ae.fromCode(new vr("Public key not found",a.status));const c=a.value;if(c.byteLength!==44)throw ae.fromCode(new Ys(44,c.byteLength));s.set(o,c)}),s}const r0=async e=>{const{agent:t,paths:r,disableCertificateTimeVerification:n=!1}=e,s=D.from(e.canisterId),i=[...new Set(r)],o=new Map,a=i.map((c,u)=>{const f=s0(c,s);return(async()=>{try{if(t.rootKey===null)throw Ce.fromCode(new Ar);const d=t.rootKey,l=await t.readState(s,{paths:[f]}),h=await ht.create({certificate:l.certificate,rootKey:d,principal:{canisterId:s},disableTimeVerification:n,agent:t}),y=(m,b)=>{if(b==="subnet"){const p=n0(l.certificate,s,d);return{path:b,data:p}}else return{path:b,data:Fe(m.lookup_path(f))}},{path:g,data:_}=y(h,i[u]);if(!_)typeof g=="string"?o.set(g,null):o.set(g.key,null);else switch(g){case"time":{o.set(g,ci(_));break}case"controllers":{o.set(g,e0(_));break}case"module_hash":{o.set(g,re(_));break}case"subnet":{o.set(g,_);break}case"candid":{o.set(g,new TextDecoder().decode(_));break}default:rn(g)&&o.set(g.key,Sl(_,g.decodeStrategy))}}catch(d){if(d instanceof at&&(d.hasCode(zt)||d.hasCode(Jr)))throw d;rn(c)?o.set(c.key,null):o.set(c,null)}})()});return await Promise.all(a),o},n0=(e,t,r)=>{if(!t._isPrincipal)throw ne.fromCode(new Me("Invalid canisterId"));const n=ct(e),{delegation:s}=n;let i;s&&s.subnet_id?i=D.fromUint8Array(new Uint8Array(s.subnet_id)):!s&&typeof r<"u"?i=D.selfAuthenticating(new Uint8Array(r)):i=Qh;const o=wa(n,i);return{subnetId:i.toText(),nodeKeys:o}},s0=(e,t)=>{const r=t.toUint8Array();switch(e){case"time":return[Q("time")];case"controllers":return[Q("canister"),r,Q("controllers")];case"module_hash":return[Q("canister"),r,Q("module_hash")];case"subnet":return[Q("subnet")];case"candid":return[Q("canister"),r,Q("metadata"),Q("candid:service")];default:if(rn(e))return typeof e.path=="string"||e.path instanceof Uint8Array?t0(e.path,r):e.path}throw Re.fromCode(new Me(`Error while encoding your path for canister status. Please ensure that your path ${e} was formatted correctly.`))};async function i0(e){const{agent:t,paths:r,disableCertificateTimeVerification:n=!1}=e,s=D.from(e.subnetId),i=[...new Set(r)],o=new Map,a=i.map((c,u)=>{const f=o0(c,s);return(async()=>{try{if(t.rootKey===null)throw Ce.fromCode(new Ar);const d=t.rootKey,l=await t.readSubnetState(s,{paths:[f]}),h=await ht.create({certificate:l.certificate,rootKey:d,principal:{subnetId:s},disableTimeVerification:n,agent:t}),y=(m,b)=>{if(b==="nodeKeys"){const p=wa(m.cert,s);return{path:b,data:p}}else return{path:b,data:Fe(m.lookup_path(f))}},{path:g,data:_}=y(h,i[u]);if(!_)typeof g=="string"?o.set(g,null):o.set(g.key,null);else switch(g){case"time":{o.set(g,ci(_));break}case"canisterRanges":{o.set(g,Ol(_));break}case"publicKey":{o.set(g,_);break}case"nodeKeys":{o.set(g,_);break}default:rn(g)&&o.set(g.key,Sl(_,g.decodeStrategy))}}catch(d){if(d instanceof at&&(d.hasCode(zt)||d.hasCode(Jr)))throw d;rn(c)?o.set(c.key,null):o.set(c,null)}})()});return await Promise.all(a),o}function o0(e,t){const r=t.toUint8Array();switch(e){case"time":return[Q("time")];case"canisterRanges":return[Q("canister_ranges"),r];case"publicKey":return[Q("subnet"),r,Q("public_key")];case"nodeKeys":return[Q("subnet"),r,Q("node")];default:if(rn(e))if(typeof e.path=="string"||e.path instanceof Uint8Array){const n=typeof e.path=="string"?Q(e.path):e.path;return[Q("subnet"),r,n]}else return e.path}throw Re.fromCode(new Me(`Error while encoding your path for subnet status. Please ensure that your path ${e} was formatted correctly.`))}const Dt=BigInt(0),_e=BigInt(1),ro=BigInt(2),a0=BigInt(8);function c0(e,t,r,n){const s=e.sqr(r),i=e.sqr(n),o=e.add(e.mul(t.a,s),i),a=e.add(e.ONE,e.mul(t.d,e.mul(s,i)));return e.eql(o,a)}function u0(e,t={}){const r=xl("edwards",e,t,t.FpFnLE),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o}=i;rs(t,{},{uvRatio:"function"});const a=ro<<BigInt(s.BYTES*8)-_e,c=_=>n.create(_),u=t.uvRatio||((_,m)=>{try{return{isValid:!0,value:n.sqrt(n.div(_,m))}}catch{return{isValid:!1,value:Dt}}});if(!c0(n,i,i.Gx,i.Gy))throw new Error("bad curve params: generator point");function f(_,m,b=!1){const p=b?_e:Dt;return Ja("coordinate "+_,m,p,a),m}function d(_){if(!(_ instanceof y))throw new Error("ExtendedPoint expected")}const l=Bn((_,m)=>{const{X:b,Y:p,Z:E}=_,v=_.is0();m==null&&(m=v?a0:n.inv(E));const N=c(b*m),I=c(p*m),R=n.mul(E,m);if(v)return{x:Dt,y:_e};if(R!==_e)throw new Error("invZ was invalid");return{x:N,y:I}}),h=Bn(_=>{const{a:m,d:b}=i;if(_.is0())throw new Error("bad point: ZERO");const{X:p,Y:E,Z:v,T:N}=_,I=c(p*p),R=c(E*E),x=c(v*v),O=c(x*x),B=c(I*m),A=c(x*c(B+R)),w=c(O+c(b*c(I*R)));if(A!==w)throw new Error("bad point: equation left != right (1)");const T=c(p*E),C=c(v*N);if(T!==C)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(m,b,p,E){this.X=f("x",m),this.Y=f("y",b),this.Z=f("z",p,!0),this.T=f("t",E),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){if(m instanceof y)throw new Error("extended point not allowed");const{x:b,y:p}=m||{};return f("x",b),f("y",p),new y(b,p,_e,c(b*p))}static fromBytes(m,b=!1){const p=n.BYTES,{a:E,d:v}=i;m=Xa(zr(m,p,"point")),Sn(b,"zip215");const N=Xa(m),I=m[p-1];N[p-1]=I&-129;const R=An(N),x=b?a:n.ORDER;Ja("point.y",R,Dt,x);const O=c(R*R),B=c(O-_e),A=c(v*O-E);let{isValid:w,value:T}=u(B,A);if(!w)throw new Error("bad point: invalid y coordinate");const C=(T&_e)===_e,F=(I&128)!==0;if(!b&&T===Dt&&F)throw new Error("bad point: x=0 and x_0=1");return F!==C&&(T=c(-T)),y.fromAffine({x:T,y:R})}static fromHex(m,b=!1){return y.fromBytes(Ve("point",m),b)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,b=!0){return g.createCache(this,m),b||this.multiply(ro),this}assertValidity(){h(this)}equals(m){d(m);const{X:b,Y:p,Z:E}=this,{X:v,Y:N,Z:I}=m,R=c(b*I),x=c(v*E),O=c(p*I),B=c(N*E);return R===x&&O===B}is0(){return this.equals(y.ZERO)}negate(){return new y(c(-this.X),this.Y,this.Z,c(-this.T))}double(){const{a:m}=i,{X:b,Y:p,Z:E}=this,v=c(b*b),N=c(p*p),I=c(ro*c(E*E)),R=c(m*v),x=b+p,O=c(c(x*x)-v-N),B=R+N,A=B-I,w=R-N,T=c(O*A),C=c(B*w),F=c(O*w),$=c(A*B);return new y(T,C,$,F)}add(m){d(m);const{a:b,d:p}=i,{X:E,Y:v,Z:N,T:I}=this,{X:R,Y:x,Z:O,T:B}=m,A=c(E*R),w=c(v*x),T=c(I*p*B),C=c(N*O),F=c((E+v)*(R+x)-A-w),$=C-T,S=C+T,V=c(w-b*A),k=c(F*$),U=c(S*V),P=c(F*V),se=c($*S);return new y(k,U,se,P)}subtract(m){return this.add(m.negate())}multiply(m){if(!s.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:b,f:p}=g.cached(this,m,E=>Tt(y,E));return Tt(y,[b,p])[0]}multiplyUnsafe(m,b=y.ZERO){if(!s.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===Dt?y.ZERO:this.is0()||m===_e?this:g.unsafe(this,m,p=>Tt(y,p),b)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return g.unsafe(this,i.n).is0()}toAffine(m){return l(this,m)}clearCofactor(){return o===_e?this:this.multiplyUnsafe(o)}toBytes(){const{x:m,y:b}=this.toAffine(),p=n.toBytes(b);return p[p.length-1]|=m&_e?128:0,p}toHex(){return re(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return Tt(y,m)}static msm(m,b){return wl(y,s,m,b)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}y.BASE=new y(i.Gx,i.Gy,_e,c(i.Gx*i.Gy)),y.ZERO=new y(Dt,_e,_e,Dt),y.Fp=n,y.Fn=s;const g=new bl(y,s.BITS);return y.BASE.precompute(8),y}function l0(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');rs(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:n}=r,{BASE:s,Fp:i,Fn:o}=e,a=r.randomBytes||uu,c=r.adjustScalarBytes||(x=>x),u=r.domain||((x,O,B)=>{if(Sn(B,"phflag"),O.length||B)throw new Error("Contexts/pre-hash are not supported");return x});function f(x){return o.create(An(x))}function d(x){const O=p.secretKey;x=Ve("private key",x,O);const B=Ve("hashed private key",t(x),2*O),A=c(B.slice(0,O)),w=B.slice(O,2*O),T=f(A);return{head:A,prefix:w,scalar:T}}function l(x){const{head:O,prefix:B,scalar:A}=d(x),w=s.multiply(A),T=w.toBytes();return{head:O,prefix:B,scalar:A,point:w,pointBytes:T}}function h(x){return l(x).pointBytes}function y(x=Uint8Array.of(),...O){const B=ee(...O);return f(t(u(B,Ve("context",x),!!n)))}function g(x,O,B={}){x=Ve("message",x),n&&(x=n(x));const{prefix:A,scalar:w,pointBytes:T}=l(O),C=y(B.context,A,x),F=s.multiply(C).toBytes(),$=y(B.context,F,T,x),S=o.create(C+$*w);if(!o.isValid(S))throw new Error("sign failed: invalid s");const V=ee(F,o.toBytes(S));return zr(V,p.signature,"result")}const _={zip215:!0};function m(x,O,B,A=_){const{context:w,zip215:T}=A,C=p.signature;x=Ve("signature",x,C),O=Ve("message",O),B=Ve("publicKey",B,p.publicKey),T!==void 0&&Sn(T,"zip215"),n&&(O=n(O));const F=C/2,$=x.subarray(0,F),S=An(x.subarray(F,C));let V,k,U;try{V=e.fromBytes(B,T),k=e.fromBytes($,T),U=s.multiplyUnsafe(S)}catch{return!1}if(!T&&V.isSmallOrder())return!1;const P=y(w,k.toBytes(),V.toBytes(),O);return k.add(V.multiplyUnsafe(P)).subtract(U).clearCofactor().is0()}const b=i.BYTES,p={secretKey:b,publicKey:b,signature:2*b,seed:b};function E(x=a(p.seed)){return zr(x,p.seed,"seed")}function v(x){const O=R.randomSecretKey(x);return{secretKey:O,publicKey:h(O)}}function N(x){return Jn(x)&&x.length===o.BYTES}function I(x,O){try{return!!e.fromBytes(x,O)}catch{return!1}}const R={getExtendedPublicKey:l,randomSecretKey:E,isValidSecretKey:N,isValidPublicKey:I,toMontgomery(x){const{y:O}=e.fromBytes(x),B=p.publicKey,A=B===32;if(!A&&B!==57)throw new Error("only defined for 25519 and 448");const w=A?i.div(_e+O,_e-O):i.div(O-_e,O+_e);return i.toBytes(w)},toMontgomerySecret(x){const O=p.secretKey;zr(x,O);const B=t(x.subarray(0,O));return c(B).subarray(0,O)},randomPrivateKey:E,precompute(x=8,O=e.BASE){return O.precompute(x,!1)}};return Object.freeze({keygen:v,getPublicKey:h,sign:g,verify:m,utils:R,Point:e,lengths:p})}function d0(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Qt(t.n,e.nBitLength,!0),s={Fp:r,Fn:n,uvRatio:e.uvRatio},i={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:s,hash:e.hash,eddsaOpts:i}}function f0(e,t){const r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function h0(e){const{CURVE:t,curveOpts:r,hash:n,eddsaOpts:s}=d0(e),i=u0(t,r),o=l0(i,n,s);return f0(e,o)}const p0=BigInt(1),_c=BigInt(2);BigInt(3);const m0=BigInt(5),y0=BigInt(8),xa=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Al={p:xa,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:y0,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function g0(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=xa,a=e*e%i*e%i,c=it(a,_c,i)*a%i,u=it(c,p0,i)*e%i,f=it(u,m0,i)*u%i,d=it(f,t,i)*f%i,l=it(d,r,i)*d%i,h=it(l,n,i)*l%i,y=it(h,s,i)*h%i,g=it(y,s,i)*h%i,_=it(g,t,i)*f%i;return{pow_p_5_8:it(_,_c,i)*e%i,b2:a}}function _0(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const bc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function b0(e,t){const r=xa,n=de(t*t*t,r),s=de(n*n*t,r),i=g0(e*s).pow_p_5_8;let o=de(e*n*i,r);const a=de(t*o*o,r),c=o,u=de(o*bc,r),f=a===e,d=a===de(-e,r),l=a===de(-e*bc,r);return f&&(o=c),(d||l)&&(o=u),Zf(o,r)&&(o=de(-o,r)),{isValid:f||d,value:o}}const w0=Qt(Al.p,{isLE:!0}),x0={...Al,Fp:w0,hash:Kd,adjustScalarBytes:_0,uvRatio:b0},Mr=h0(x0);var wc,xc,Ee,Zr;class E0{constructor(t={}){Te(this,Ee);Te(this,Zr);this[wc]=this.entries.bind(this),this[xc]="ExpirableMap";const{source:r=[],expirationTime:n=600*1e3}=t,s=Date.now();xe(this,Ee,new Map([...r].map(([i,o])=>[i,{value:o,timestamp:s}]))),xe(this,Zr,n)}prune(){const t=Date.now();for(const[r,n]of G(this,Ee).entries())t-n.timestamp>G(this,Zr)&&G(this,Ee).delete(r);return this}set(t,r){this.prune();const n={value:r,timestamp:Date.now()};return G(this,Ee).set(t,n),this}get(t){const r=G(this,Ee).get(t);if(r!==void 0){if(Date.now()-r.timestamp>G(this,Zr)){G(this,Ee).delete(t);return}return r.value}}clear(){G(this,Ee).clear()}entries(){const t=G(this,Ee).entries();return function*(){for(const[n,s]of t)yield[n,s.value]}()}values(){const t=G(this,Ee).values();return function*(){for(const n of t)yield n.value}()}keys(){return G(this,Ee).keys()}forEach(t,r){for(const[n,s]of G(this,Ee).entries())t.call(r,s.value,n,this)}has(t){return G(this,Ee).has(t)}delete(t){return G(this,Ee).delete(t)}get size(){return G(this,Ee).size}}Ee=new WeakMap,Zr=new WeakMap,wc=Symbol.iterator,xc=Symbol.toStringTag;const Ec=e=>{if(e<=127)return 1;if(e<=255)return 2;if(e<=65535)return 3;if(e<=16777215)return 4;throw ne.fromCode(new Ws("Length too long (> 4 bytes)"))},vc=(e,t,r)=>{if(r<=127)return e[t]=r,1;if(r<=255)return e[t]=129,e[t+1]=r,2;if(r<=65535)return e[t]=130,e[t+1]=r>>8,e[t+2]=r,3;if(r<=16777215)return e[t]=131,e[t+1]=r>>16,e[t+2]=r>>8,e[t+3]=r,4;throw ne.fromCode(new Ws("Length too long (> 4 bytes)"))},Co=(e,t)=>{if(e[t]<128)return 1;if(e[t]===128)throw ne.fromCode(new At("Invalid length 0"));if(e[t]===129)return 2;if(e[t]===130)return 3;if(e[t]===131)return 4;throw ne.fromCode(new At("Length too long (> 4 bytes)"))},v0=(e,t)=>{const r=Co(e,t);if(r===1)return e[t];if(r===2)return e[t+1];if(r===3)return(e[t+1]<<8)+e[t+2];if(r===4)return(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];throw ne.fromCode(new At("Length too long (> 4 bytes)"))};Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]);const $s=Uint8Array.from([48,5,6,3,43,101,112]);Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]);Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function Cl(e,t){const r=2+Ec(e.byteLength+1),n=t.byteLength+r+e.byteLength;let s=0;const i=new Uint8Array(1+Ec(n)+n);return i[s++]=48,s+=vc(i,s,n),i.set(t,s),s+=t.byteLength,i[s++]=3,s+=vc(i,s,e.byteLength+1),i[s++]=0,i.set(new Uint8Array(e),s),i}const Bl=(e,t)=>{let r=0;const n=(a,c)=>{if(s[r++]!==a)throw ne.fromCode(new At(`Expected ${c} at offset ${r}`))},s=new Uint8Array(e);if(n(48,"sequence"),r+=Co(s,r),!ri(s.slice(r,r+t.byteLength),t))throw ne.fromCode(new At("Not the expected OID."));r+=t.byteLength,n(3,"bit string");const i=v0(s,r)-1;r+=Co(s,r),n(0,"0 padding");const o=s.slice(r);if(i!==o.length)throw ne.fromCode(new zo(i,o.length));return o};var Ln,qn,lt;let N0=(lt=class{constructor(t){Te(this,Ln);Te(this,qn);if(t.byteLength!==lt.RAW_KEY_LENGTH)throw ne.fromCode(new At("An Ed25519 public key must be exactly 32 bytes long"));xe(this,Ln,t),xe(this,qn,lt.derEncode(t))}static from(t){return this.fromDer(t.toDer())}static fromRaw(t){return new lt(t)}static fromDer(t){return new lt(this.derDecode(t))}static derEncode(t){return Cl(t,$s)}static derDecode(t){const r=Bl(t,$s);if(r.length!==this.RAW_KEY_LENGTH)throw ne.fromCode(new At("An Ed25519 public key must be exactly 32 bytes long"));return r}get rawKey(){return G(this,Ln)}get derKey(){return G(this,qn)}toDer(){return this.derKey}toRaw(){return this.rawKey}},Ln=new WeakMap,qn=new WeakMap,lt.RAW_KEY_LENGTH=32,lt);class T0{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(r=>r!==t)}notify(t,...r){this.observers.forEach(n=>n(t,...r))}}class I0 extends T0{constructor(){super()}print(t,...r){this.notify({message:t,level:"info"},...r)}warn(t,...r){this.notify({message:t,level:"warn"},...r)}error(t,r,...n){this.notify({message:t,level:"error",error:r},...n)}}const Nc=.5,Tc=1.5,Ic=500,Rc=6e4,Oc=9e5,Sc=10;var Qe,jn,Kn,Gn,Hn,zn,Zn,Yn,Yr;const Zs=class Zs{constructor(t=Zs.default){Te(this,Qe);Te(this,jn);Te(this,Kn);Te(this,Gn);Te(this,Hn);Te(this,zn);Te(this,Zn);Te(this,Yn);Te(this,Yr,0);const{initialInterval:r=Ic,randomizationFactor:n=Nc,multiplier:s=Tc,maxInterval:i=Rc,maxElapsedTime:o=Oc,maxIterations:a=Sc,date:c=Date}=t;xe(this,Qe,r),xe(this,jn,n),xe(this,Kn,s),xe(this,Gn,i),xe(this,Yn,c),xe(this,Hn,c.now()),xe(this,zn,o),xe(this,Zn,a)}get ellapsedTimeInMsec(){return G(this,Yn).now()-G(this,Hn)}get currentInterval(){return G(this,Qe)}get count(){return G(this,Yr)}get randomValueFromInterval(){const t=G(this,jn)*G(this,Qe),r=G(this,Qe)-t,n=G(this,Qe)+t;return Math.random()*(n-r)+r}incrementCurrentInterval(){return xe(this,Qe,Math.min(G(this,Qe)*G(this,Kn),G(this,Gn))),Ma(this,Yr)._++,G(this,Qe)}next(){return this.ellapsedTimeInMsec>=G(this,zn)||G(this,Yr)>=G(this,Zn)?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};Qe=new WeakMap,jn=new WeakMap,Kn=new WeakMap,Gn=new WeakMap,Hn=new WeakMap,zn=new WeakMap,Zn=new WeakMap,Yn=new WeakMap,Yr=new WeakMap,Zs.default={initialInterval:Ic,randomizationFactor:Nc,multiplier:Tc,maxInterval:Rc,maxElapsedTime:Oc,maxIterations:Sc,date:Date};let Bo=Zs;var vt;(function(e){e.Received="received",e.Processing="processing",e.Replied="replied",e.Rejected="rejected",e.Unknown="unknown",e.Done="done"})(vt||(vt={}));const Vo=60*1e3,R0=1e6,O0=0,S0="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae",A0="ic0.app",C0=".ic0.app",B0="icp0.io",V0=".icp0.io",k0="icp-api.io",F0=".icp-api.io",no=200,U0=202,P0=404;function D0(){let e;if(typeof window<"u")if(window.fetch)e=window.fetch.bind(window);else throw Ce.fromCode(new _n("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof globalThis<"u")if(globalThis.fetch)e=globalThis.fetch.bind(globalThis);else throw Ce.fromCode(new _n("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(e=self.fetch.bind(self));if(e)return e;throw Ce.fromCode(new _n("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function M0(e){let t;if(e!==void 0)!e.match(/^[a-z]+:/)&&typeof window<"u"?t=new URL(window.location.protocol+"//"+e):t=new URL(e);else{const r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],s=typeof window<"u"?window.location:void 0,i=s?.hostname;let o;i&&typeof i=="string"&&(n.some(a=>i.endsWith(a))?o=i:o=r.find(a=>i.endsWith(a))),s&&o?t=new URL(`${s.protocol}//${o}${s.port?":"+s.port:""}`):t=new URL("https://icp-api.io")}return t.toString()}class ut{#e;#t;#s;#c;#l;#w;#r;#i;#_;#x;#n;#a;#d;#o;get#T(){return this.#o*Vo}#f;#h;#p;#m;constructor(t={}){this.#e=null,this.#t=!1,this.#s=O0,this.#c=!1,this.#l=null,this.#w=!1,this._isAgent=!0,this.config={},this.log=new I0,this.#f=[],this.#h=[],this.#p=new E0({expirationTime:5*Vo}),this.#m=!0,this.#E=(s,i)=>{if(this.#m===!1)return s;const{status:o,signatures:a=[],requestId:c}=s;for(const u of a){const{timestamp:f,identity:d}=u,l=D.fromUint8Array(d).toText();let h;if(o===Wr.Replied){const{reply:b}=s;h=ks({status:o,reply:b,timestamp:BigInt(f),request_id:c})}else if(o===Wr.Rejected){const{reject_code:b,reject_message:p,error_code:E}=s;h=ks({status:o,reject_code:b,reject_message:p,error_code:E,timestamp:BigInt(f),request_id:c})}else throw Re.fromCode(new Me(`Unknown status: ${o}`));const y=ee(of,h),g=i.get(l);if(!g)throw ae.fromCode(new sa);const _=N0.fromDer(g).rawKey;if(!Mr.verify(u.signature,y,_))throw De.fromCode(new ia(l))}return s},this.config=t,this.#i=t.fetch||D0()||fetch.bind(globalThis),this.#_=t.fetchOptions,this.#x=t.callOptions,this.#t=t.shouldFetchRootKey??!1,this.#w=t.shouldSyncTime??!1,t.rootKey?this.rootKey=t.rootKey:this.#t?this.rootKey=null:this.rootKey=dt(S0);const r=M0(t.host);this.host=new URL(r),t.verifyQuerySignatures!==void 0&&(this.#m=t.verifyQuerySignatures),this.#a=t.retryTimes??3;const n=()=>new Bo({maxIterations:this.#a});if(this.#d=t.backoffStrategy||n,this.host.hostname.endsWith(C0)?this.host.hostname=A0:this.host.hostname.endsWith(V0)?this.host.hostname=B0:this.host.hostname.endsWith(F0)&&(this.host.hostname=k0),t.credentials){const{name:s,password:i}=t.credentials;this.#n=`${s}${i?":"+i:""}`}if(this.#r=Promise.resolve(t.identity||new Kr),t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes>5)throw ne.fromCode(new Et("The maximum ingress expiry time is 5 minutes.",t.ingressExpiryInMinutes));if(t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes<=0)throw ne.fromCode(new Et("Ingress expiry time must be greater than 0.",t.ingressExpiryInMinutes));this.#o=t.ingressExpiryInMinutes||5,this.addTransform("update",Ya(Io)),t.useQueryNonces&&this.addTransform("query",Ya(Io)),t.logToConsole&&this.log.subscribe(s=>{s.level==="error"?console.error(s.message):s.level==="warn"?console.warn(s.message):console.log(s.message)})}static createSync(t={}){return new this({...t})}static async create(t={}){const r=ut.createSync(t);return await r.#u(),r}static async from(t){try{return"config"in t?await ut.create(t.config):await ut.create({fetch:t._fetch,fetchOptions:t._fetchOptions,callOptions:t._callOptions,host:t._host.toString(),identity:t._identity??void 0})}catch{throw ne.fromCode(new ta)}}isLocal(){const t=this.host.hostname;return t==="127.0.0.1"||t.endsWith("127.0.0.1")}addTransform(t,r,n=r.priority||0){if(t==="update"){const s=this.#h.findIndex(i=>(i.priority||0)<n);this.#h.splice(s>=0?s:this.#h.length,0,Object.assign(r,{priority:n}))}else if(t==="query"){const s=this.#f.findIndex(i=>(i.priority||0)<n);this.#f.splice(s>=0?s:this.#f.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw Ce.fromCode(new pr);return(await this.#r).getPrincipal()}async call(t,r,n){const s=r.callSync??!0,i=await(n??this.#r);if(!i)throw Ce.fromCode(new pr);const o=D.from(t),a=r.effectiveCanisterId?D.from(r.effectiveCanisterId):o;await this.#u(a);const c=i.getPrincipal(),u=so(this.#o,this.#s),f={request_type:To.Call,canister_id:o,method_name:r.methodName,arg:r.arg,sender:c,ingress_expiry:u};let d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.Call,body:f}),l;r?.nonce?l=h(r.nonce):d.body.nonce?l=h(d.body.nonce):l=void 0,f.nonce=l;function h(m){return Object.assign(m,{__nonce__:void 0})}d=await i.transformRequest(d);const y=Hi(d.body),g=this.#d(),_=jr(f);try{const p=s?()=>{const I=new URL(`/api/v4/canister/${a.toText()}/call`,this.host);return this.log.print(`fetching "${I.pathname}" with request:`,d),this.#i(I,{...this.#x,...d.request,body:y})}:()=>{const I=new URL(`/api/v2/canister/${a.toText()}/call`,this.host);return this.log.print(`fetching "${I.pathname}" with request:`,d),this.#i(I,{...this.#x,...d.request,body:y})},{responseBodyBytes:E,...v}=await this.#y({requestFn:p,backoff:g,tries:0}),N=E.byteLength>0?ct(E):null;return{requestId:_,response:{...v,body:N},requestDetails:f}}catch(m){let b;if(m instanceof at){if(m.hasCode(Os))return this.log.warn("v4 api not supported. Fall back to v2"),this.call(t,{...r,callSync:!1},n);if(m.hasCode(Et)&&!this.#c)return await this.syncTime(o),this.call(o,r,n);m.code.requestContext={requestId:_,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},b=m}else b=Re.fromCode(new Me(m));throw this.log.error(`Error while making call: ${b.message}`,b),b}}async#b(t){const{ecid:r,transformedRequest:n,body:s,requestId:i,backoff:o,tries:a}=t,c=a===0?0:o.next(),u=new URL(`/api/v3/canister/${r.toString()}/query`,this.host);if(this.log.print(`fetching "${u.pathname}" with tries:`,{tries:a,backoff:o,delay:c}),c===null)throw Re.fromCode(new vn(`Backoff strategy exhausted after ${a} attempts.`,i));c>0&&await new Promise(m=>setTimeout(m,c));let f;try{this.log.print(`fetching "${u.pathname}" with request:`,n),f=await this.#i(u,{...this.#_,...n.request,body:s})}catch(m){if(a<this.#a)return this.log.warn(`Caught exception while attempting to make query:
  ${m}
  Retrying query.`),await this.#b({...t,tries:a+1});throw Is.fromCode(new Ss(m))}const d=Wa(f.headers);if(f.status!==no){const m=await f.text();if(Ac(m))throw ne.fromCode(new Et(m,this.#o));if(a<this.#a)return await this.#b({...t,tries:a+1});throw ae.fromCode(new Rs(f.status,f.statusText,d,m))}const h={...ct(Vs(await f.arrayBuffer())),httpDetails:{ok:f.ok,status:f.status,statusText:f.statusText,headers:d},requestId:i};if(!this.#m)return h;const y=h.signatures?.[0]?.timestamp;if(!y)throw ae.fromCode(new ra("Timestamp not found in query response. This suggests a malformed or malicious response."));const g=Number(BigInt(y)/BigInt(R0));if(Date.now()+this.#s-g>this.#T){if(a<this.#a)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:i,signatureTimestampMs:g}),await this.syncTime(r),await this.#b({...t,tries:a+1});throw De.fromCode(new Wo(this.#o,i,a))}return h}async#y(t){const{requestFn:r,backoff:n,tries:s}=t,i=s===0?0:n.next();if(i===null)throw ae.fromCode(new vn(`Retry strategy exhausted after ${s} attempts.`));i>0&&await new Promise(f=>setTimeout(f,i));let o,a=new Uint8Array;try{o=await r(),o.status===no&&(a=Vs(await o.clone().arrayBuffer()))}catch(f){if(s<this.#a)return this.log.warn(`Caught exception while attempting to make request:
  ${f}
  Retrying request.`),await this.#y({requestFn:r,backoff:n,tries:s+1});throw Is.fromCode(new Ss(f))}const c=Wa(o.headers);if(o.status===no||o.status===U0)return{ok:o.ok,status:o.status,statusText:o.statusText,responseBodyBytes:a,headers:c};const u=await o.text();if(o.status===P0&&o.url.includes("api/v4"))throw ae.fromCode(new Os);if(Ac(u))throw ne.fromCode(new Et(u,this.#o));if(s<this.#a)return await this.#y({requestFn:r,backoff:n,tries:s+1});throw ae.fromCode(new Rs(o.status,o.statusText,c,u))}async query(t,r,n){const s=this.#d(),i=r.effectiveCanisterId?D.from(r.effectiveCanisterId):D.from(t);await this.#u(i),this.log.print(`ecid ${i.toString()}`),this.log.print(`canisterId ${t.toString()}`);let o;const a=await(n??this.#r);if(!a)throw Ce.fromCode(new pr);const c=D.from(t),u=a.getPrincipal(),f=so(this.#o,this.#s),d={request_type:On.Query,canister_id:c,method_name:r.methodName,arg:r.arg,sender:u,ingress_expiry:f},l=jr(d);o=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.Query,body:d}),o=await a.transformRequest(o);const h=Hi(o.body),y={canister:c.toText(),ecid:i,transformedRequest:o,body:h,requestId:l,backoff:s,tries:0},g=async()=>{const m=await this.#b(y);return{requestDetails:d,...m}},_=async()=>{const m=this.#p.get(i.toString());if(m)return m;await this.fetchSubnetKeys(i.toString());const b=this.#p.get(i.toString());if(!b)throw De.fromCode(new na);return b};try{if(!this.#m)return await g();const[m,b]=await Promise.all([g(),_()]);try{return this.#E(m,b)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#p.delete(i.toString());const p=await _();return this.#E(m,p)}}catch(m){let b;if(m instanceof at){if(m.hasCode(Et)&&!this.#c)return await this.syncTime(i),this.query(t,r,n);m.code.requestContext={requestId:l,senderPubKey:o.body.sender_pubkey,senderSignature:o.body.sender_sig,ingressExpiry:o.body.content.ingress_expiry},b=m}else b=Re.fromCode(new Me(m));throw this.log.error(`Error while making query: ${b.message}`,b),b}}#E;async createReadStateRequest(t,r){await this.#u();const n=await(r??this.#r);if(!n)throw Ce.fromCode(new pr);const s=n.getPrincipal(),i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.ReadState,body:{request_type:On.ReadState,paths:t.paths,sender:s,ingress_expiry:so(this.#o,this.#s)}});return n.transformRequest(i)}async readState(t,r,n,s){await this.#g();const i=D.from(t);function o(f){for(const d of f.paths){const[l,h]=d,y=new TextEncoder().encode("request_status");if(ri(l,y))return h}}let a,c;if(s)a=s;else{c=o(r);const f=await this.#r;if(!f)throw Ce.fromCode(new pr);a=await this.createReadStateRequest(r,f)}const u=new URL(`/api/v3/canister/${i.toString()}/read_state`,this.host);return await this.#v(u,{canisterId:i},a,c)}async readSubnetState(t,r){await this.#g();const n=D.from(t),s=new URL(`/api/v3/subnet/${n.toString()}/read_state`,this.host),i=await this.createReadStateRequest(r,this.#r??void 0);return await this.#v(s,{subnetId:n},i)}async#v(t,r,n,s){const i=this.#d();try{const{responseBodyBytes:o}=await this.#y({requestFn:()=>this.#i(t,{...this.#_,...n.request,body:Hi(n.body)}),backoff:i,tries:0});return ct(o)}catch(o){let a;if(o instanceof at){if(o.hasCode(Et)&&!this.#c){if("canisterId"in r)await this.syncTime(r.canisterId);else if("subnetId"in r)await this.syncTimeWithSubnet(r.subnetId);else throw Ot;return await this.#v(t,r,n,s)}o.code.requestContext={requestId:s??jr(n),senderPubKey:n.body.sender_pubkey,senderSignature:n.body.sender_sig,ingressExpiry:n.body.content.ingress_expiry},a=o}else a=Re.fromCode(new Me(o));throw this.log.error(`Error while making read state: ${a.message}`,a),a}}parseTimeFromResponse(t){let r;if(t.certificate){const n=ct(t.certificate);if(n&&"tree"in n)r=n.tree;else throw ae.fromCode(new es("Could not decode time from response"));const s=cn(["time"],r);if(s.status!==Le.Found)throw ae.fromCode(new vr("Time was not found in the response or was not in its expected format.",s.status));if(!(s.value instanceof Uint8Array)&&!ArrayBuffer.isView(s))throw ae.fromCode(new Ko("Time was not in its expected format."));const i=ci(s.value);return this.log.print("Time from response:",i),this.log.print("Time from response in milliseconds:",i.getTime()),i.getTime()}else this.log.warn("No certificate found in response");return 0}async syncTime(t){this.#l=this.#l??(async()=>{await this.#g();const r=Date.now();try{t||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");const n=t??D.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),s=ut.createSync({identity:new Kr,host:this.host.toString(),fetch:this.#i,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),i=await Promise.all(Array(3).fill(null).map(async()=>{const a=(await r0({canisterId:n,agent:s,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(a instanceof Date)return a.getTime()},[]));this.#N(r,i)}catch(n){const s=n instanceof at?n:Re.fromCode(new Me(n));throw this.log.error("Caught exception while attempting to sync time",s),s}})(),await this.#l.finally(()=>{this.#l=null})}async syncTimeWithSubnet(t){await this.#g();const r=Date.now();try{const n=ut.createSync({identity:new Kr,host:this.host.toString(),fetch:this.#i,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),s=await Promise.all(Array(3).fill(null).map(async()=>{const o=(await i0({subnetId:t,agent:n,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(o instanceof Date)return o.getTime()},[]));this.#N(r,s)}catch(n){const s=n instanceof at?n:Re.fromCode(new Me(n));throw this.log.error("Caught exception while attempting to sync time with subnet",s),s}}#N(t,r){const n=r.reduce((s,i)=>typeof i=="number"&&i>s?i:s,0);n>0&&(this.#s=n-t,this.#c=!0,this.log.notify({message:`Syncing time: offset of ${this.#s}`,level:"info"}))}async status(){const t=this.#n?{Authorization:"Basic "+btoa(this.#n)}:{},r=new URL("/api/v2/status",this.host);this.log.print(`fetching "${r.pathname}"`);const n=this.#d(),{responseBodyBytes:s}=await this.#y({backoff:n,requestFn:()=>this.#i(r,{headers:t,...this.#_}),tries:0});return ct(s)}async fetchRootKey(){return this.#e=this.#e??(async()=>{const t=await this.status();return this.rootKey=t.root_key,this.rootKey})(),await this.#e.finally(()=>{this.#e=null})}async#u(t){await Promise.all([this.#g(),this.#I(t)])}async#g(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#t)await this.fetchRootKey();else throw Ce.fromCode(new Ar(this.#t))}async#I(t){this.#w&&!this.hasSyncedTime()&&await this.syncTime(t)}invalidateIdentity(){this.#r=null}replaceIdentity(t){this.#r=Promise.resolve(t)}async fetchSubnetKeys(t){const r=D.from(t);await this.#u(r);const n=this.rootKey,s=await this.readState(r,{paths:[[Q("subnet")]]}),i=await ht.create({certificate:s.certificate,rootKey:n,principal:{canisterId:r},agent:this});if(!i.cert.delegation){const c=D.selfAuthenticating(n);if(!Rl({canisterId:r,subnetId:c,tree:i.cert.tree}))throw De.fromCode(new Qn(r,c))}const o=gc(i.cert,n),a=wa(i.cert,o);return this.#p.set(r.toText(),a),a}async getSubnetIdFromCanister(t){const r=D.from(t);await this.#u(r);const n=await this.readState(r,{paths:[[Q("time")]]}),s=await ht.create({certificate:n.certificate,rootKey:this.rootKey,principal:{canisterId:r},agent:this});return gc(s.cert,this.rootKey)}_transform(t){let r=Promise.resolve(t);if(t.endpoint===yr.Call)for(const n of this.#h)r=r.then(s=>n(s).then(i=>i||s));else for(const n of this.#f)r=r.then(s=>n(s).then(i=>i||s));return r}getTimeDiffMsecs(){return this.#s}hasSyncedTime(){return this.#c}}function so(e,t){const r=e*Vo;return Hr.fromDeltaInMilliseconds(r,t)}function Ac(e){return e.includes("Invalid request expiry: ")}const $0=300*1e3;function L0(){return H0(j0(q0(),1e3),G0(1e3,1.2),K0($0))}function q0(){let e=!0;return async()=>e?(e=!1,!0):!1}function j0(e,t){return async(r,n,s)=>{if(await e(r,n,s))return new Promise(i=>setTimeout(i,t))}}function K0(e){const t=Date.now()+e;return async(r,n,s)=>{if(Date.now()>t)throw ae.fromCode(new vn(`Request timed out after ${e} msec`,n,s))}}function G0(e,t){let r=e;return()=>new Promise(n=>setTimeout(()=>{r*=t,n()},r))}function H0(...e){return async(t,r,n)=>{for(const s of e)await s(t,r,n)}}const z0={preSignReadStateRequest:!1};function Vl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function io(e,t){return e!==null&&typeof e=="object"&&Vl(e,t)}function Z0(e,t){return Vl(e,t)&&typeof e[t]=="function"}function Cc(e){return io(e,"body")&&io(e.body,"content")&&e.body.content.request_type===On.ReadState&&io(e.body.content,"ingress_expiry")&&typeof e.body.content.ingress_expiry=="object"&&e.body.content.ingress_expiry!==null&&Z0(e.body.content.ingress_expiry,"toHash")}async function kl(e,t,r,n={}){const s=[Q("request_status"),r];let i,o;if(n.preSignReadStateRequest??!1?(o=await Y0({paths:[s],agent:e,pollingOptions:n}),i=await e.readState(t,{paths:[s]},void 0,o)):i=await e.readState(t,{paths:[s]}),e.rootKey==null)throw Ce.fromCode(new Ar);const c=await ht.create({certificate:i.certificate,rootKey:e.rootKey,principal:{canisterId:t},blsVerify:n.blsVerify,agent:e}),u=Fe(c.lookup_path([...s,Q("status")]));let f;switch(typeof u>"u"?f=vt.Unknown:f=new TextDecoder().decode(u),f){case vt.Replied:return{reply:Fe(c.lookup_path([...s,"reply"])),certificate:c};case vt.Received:case vt.Unknown:case vt.Processing:{const d=n.strategy??L0();return await d(t,r,f),kl(e,t,r,{...n,strategy:d,request:o})}case vt.Rejected:{const d=new Uint8Array(Fe(c.lookup_path([...s,"reject_code"])))[0],l=new TextDecoder().decode(Fe(c.lookup_path([...s,"reject_message"]))),h=Fe(c.lookup_path([...s,"error_code"])),y=h?new TextDecoder().decode(h):void 0;throw qr.fromCode(new Xs(r,d,l,y))}case vt.Done:throw Re.fromCode(new Qo(r))}throw Ot}async function Y0(e){const{paths:t,agent:r,pollingOptions:n}=e;if(n.request&&Cc(n.request))return n.request;const s=await r.createReadStateRequest?.({paths:t},void 0);if(!Cc(s))throw ne.fromCode(new oa(s));return s}const Ke=Symbol.for("ic-agent-metadata");class Fn{static agentOf(t){return t[Ke].config.agent}static interfaceOf(t){return t[Ke].service}static canisterIdOf(t){return D.from(t[Ke].config.canisterId)}static createActorClass(t,r){const n=t({IDL:nf});class s extends Fn{constructor(o){if(!o.canisterId)throw ne.fromCode(new As(o.canisterId));const a=typeof o.canisterId=="string"?D.fromText(o.canisterId):o.canisterId;super({config:{...Fl,...o,canisterId:a},service:n});for(const[c,u]of n._fields)r?.httpDetails&&u.annotations.push(ko),r?.certificate&&u.annotations.push(Ul),this[c]=W0(this,c,u,o.blsVerify)}}return s}static createActor(t,r){if(!r.canisterId)throw ne.fromCode(new As(r.canisterId));return new(this.createActorClass(t))(r)}static createActorWithHttpDetails(t,r){return new(this.createActorClass(t,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(t,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(t,n))(r)}constructor(t){this[Ke]=Object.freeze(t)}}function Pr(e,t){const r=xu(e,t);switch(r.length){case 0:return;case 1:return r[0];default:return r}}const Fl={pollingOptions:z0},ko="http-details",Ul="certificate";function W0(e,t,r,n){let s;r.annotations.includes("query")||r.annotations.includes("composite_query")?s=async(o,...a)=>{o={...o,...e[Ke].config.queryTransform?.(t,a,{...e[Ke].config,...o})};const c=o.agent||e[Ke].config.agent||new ut,u=D.from(o.canisterId||e[Ke].config.canisterId),f=xo(r.argTypes,a),d=await c.query(u,{methodName:t,arg:f,effectiveCanisterId:o.effectiveCanisterId}),l={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case Wr.Rejected:{const h=new Xo(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw h.callContext={canisterId:u,methodName:t,httpDetails:l},qr.fromCode(h)}case Wr.Replied:return r.annotations.includes(ko)?{httpDetails:l,result:Pr(r.retTypes,d.reply.arg)}:Pr(r.retTypes,d.reply.arg)}}:s=async(o,...a)=>{o={...o,...e[Ke].config.callTransform?.(t,a,{...e[Ke].config,...o})};const c=o.agent||e[Ke].config.agent||ut.createSync(),{canisterId:u,effectiveCanisterId:f,pollingOptions:d}={...Fl,...e[Ke].config,...o},l=D.from(u),h=f!==void 0?D.from(f):l,y=xo(r.argTypes,a),{requestId:g,response:_,requestDetails:m}=await c.call(l,{methodName:t,arg:y,effectiveCanisterId:h,nonce:o.nonce});let b,p;if(_d(_.body)){if(c.rootKey==null)throw Ce.fromCode(new Ar);const I=_.body.certificate;p=await ht.create({certificate:I,rootKey:c.rootKey,principal:{canisterId:h},blsVerify:n,agent:c});const R=[Q("request_status"),g];switch(new TextDecoder().decode(Fe(p.lookup_path([...R,"status"])))){case"replied":b=Fe(p.lookup_path([...R,"reply"]));break;case"rejected":{const O=new Uint8Array(Fe(p.lookup_path([...R,"reject_code"])))[0],B=new TextDecoder().decode(Fe(p.lookup_path([...R,"reject_message"]))),A=Fe(p.lookup_path([...R,"error_code"])),w=A?new TextDecoder().decode(A):void 0,T=new Xs(g,O,B,w);throw T.callContext={canisterId:l,methodName:t,httpDetails:_},qr.fromCode(T)}}}else if(gd(_.body)){const{reject_code:I,reject_message:R,error_code:x}=_.body,O=new Jo(g,I,R,x);throw O.callContext={canisterId:l,methodName:t,httpDetails:_},qr.fromCode(O)}if(_.status===202){const I={...d,blsVerify:n},R=await kl(c,h,g,I);p=R.certificate,b=R.reply}const E=r.annotations.includes(ko),v=r.annotations.includes(Ul),N={..._,requestDetails:m};if(b!==void 0)return E&&v?{httpDetails:N,certificate:p,result:Pr(r.retTypes,b)}:v?{certificate:p,result:Pr(r.retTypes,b)}:E?{httpDetails:N,result:Pr(r.retTypes,b)}:Pr(r.retTypes,b);{const I=new Me(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(R=>R.display()).join(",")}].`);throw I.callContext={canisterId:l,methodName:t,httpDetails:N},Re.fromCode(I)}};const i=(...o)=>s({},...o);return i.withOptions=o=>(...a)=>s(o,...a),i}function Bc(e){return e!==null&&typeof e=="object"}var Wn,Xn;const mr=class mr{constructor(t){Te(this,Wn);Te(this,Xn);if(t.byteLength!==mr.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");xe(this,Wn,t),xe(this,Xn,mr.derEncode(t))}static from(t){if(typeof t=="string"){const r=dt(t);return this.fromRaw(r)}else if(Bc(t)){const r=t;if(Bc(r)&&Object.hasOwnProperty.call(r,"__derEncodedPublicKey__"))return this.fromDer(r);if(ArrayBuffer.isView(r)){const n=r;return this.fromRaw(Zt(n.buffer))}else{if(r instanceof ArrayBuffer)return this.fromRaw(Zt(r));if("rawKey"in r&&r.rawKey instanceof Uint8Array)return this.fromRaw(r.rawKey);if("derKey"in r)return this.fromDer(r.derKey);if("toDer"in r)return this.fromDer(r.toDer())}}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(t){return new mr(t)}static fromDer(t){return new mr(this.derDecode(t))}static derEncode(t){const r=Cl(t,$s);return r.__derEncodedPublicKey__=void 0,r}static derDecode(t){const r=Bl(t,$s);if(r.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return r}get rawKey(){return G(this,Wn)}get derKey(){return G(this,Xn)}toDer(){return this.derKey}toRaw(){return this.rawKey}};Wn=new WeakMap,Xn=new WeakMap,mr.RAW_KEY_LENGTH=32;let wn=mr;class Rt extends ha{static generate(t){if(t&&t.length!==32)throw new Error("Ed25519 Seed needs to be 32 bytes long.");t||(t=Mr.utils.randomPrivateKey()),zd(t,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");const r=new Uint8Array(32);for(let s=0;s<32;s++)r[s]=t[s];const n=Mr.getPublicKey(r);return Rt.fromKeyPair(n,r)}static fromParsedJson(t){const[r,n]=t;return new Rt(wn.fromDer(dt(r)),dt(n))}static fromJSON(t){const r=JSON.parse(t);if(Array.isArray(r)){if(typeof r[0]=="string"&&typeof r[1]=="string")return this.fromParsedJson([r[0],r[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(t)}`)}static fromKeyPair(t,r){return new Rt(wn.fromRaw(t),r)}static fromSecretKey(t){const r=Mr.getPublicKey(t);return Rt.fromKeyPair(r,t)}#e;#t;constructor(t,r){super(),this.#e=wn.from(t),this.#t=r}toJSON(){return[re(this.#e.toDer()),re(this.#t)]}getKeyPair(){return{secretKey:this.#t,publicKey:this.#e}}getPublicKey(){return this.#e}async sign(t){const r=Mr.sign(t,this.#t.slice(0,32));return Object.defineProperty(r,"__signature__",{enumerable:!1,value:void 0}),r}static verify(t,r,n){const[s,i,o]=[t,r,n].map(a=>(typeof a=="string"&&(a=dt(a)),Zt(a)));return Mr.verify(s,i,o)}}class Ea extends Error{constructor(t){super(t),this.message=t,Object.setPrototypeOf(this,Ea.prototype)}}function Vc(e){if(typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle)return globalThis.crypto.subtle;if(e)return e;if(typeof crypto<"u"&&crypto.subtle)return crypto.subtle;throw new Ea("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}class Un extends ha{static async generate(t){const{extractable:r=!1,keyUsages:n=["sign","verify"],subtleCrypto:s}=t??{},i=Vc(s),o=await i.generateKey({name:"ECDSA",namedCurve:"P-256"},r,n),a=Zt(await i.exportKey("spki",o.publicKey));return Object.assign(a,{__derEncodedPublicKey__:void 0}),new this(o,a,i)}static async fromKeyPair(t,r){const n=Vc(r),s=Zt(await n.exportKey("spki",t.publicKey));return Object.assign(s,{__derEncodedPublicKey__:void 0}),new Un(t,s,n)}constructor(t,r,n){super(),this._keyPair=t,this._derKey=r,this._subtleCrypto=n}getKeyPair(){return this._keyPair}getPublicKey(){const t=this._derKey,r=Object.create(this._keyPair.publicKey);return r.toDer=function(){return t},r}async sign(t){const r={name:"ECDSA",hash:{name:"SHA-256"}},n=Zt(await this._subtleCrypto.sign(r,this._keyPair.privateKey,t));return Object.assign(n,{__signature__:void 0}),n}}class X0{#e;get rawKey(){return this.#e.rawKey}get derKey(){return this.#e.derKey}toDer(){return this.#e.toDer()}getPublicKey(){return this.#e}getPrincipal(){if(!this.#e.rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return D.fromUint8Array(new Uint8Array(this.#e.rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}constructor(t){this.#e=t}}function Es(e){return e instanceof Uint8Array?re(e):re(new Uint8Array(e))}function oo(e){if(typeof e!="string"||e.length<64)throw new Error("Invalid public key.");return dt(e)}class va{constructor(t,r,n){this.pubkey=t,this.expiration=r,this.targets=n}toCborValue(){return{pubkey:this.pubkey,expiration:this.expiration,...this.targets&&{targets:this.targets}}}toJSON(){return{expiration:this.expiration.toString(16),pubkey:Es(this.pubkey),...this.targets&&{targets:this.targets.map(t=>t.toHex())}}}}async function J0(e,t,r,n){const s=new va(t.toDer(),BigInt(+r)*BigInt(1e6),n),i=new Uint8Array([...af,...new Uint8Array(jr({...s}))]),o=await e.sign(i);return{delegation:s,signature:o}}class Ls{static async create(t,r,n=new Date(Date.now()+900*1e3),s={}){const i=await J0(t,r,n,s.targets);return new Ls([...s.previous?.delegations||[],i],s.previous?.publicKey||t.getPublicKey().toDer())}static fromJSON(t){const{publicKey:r,delegations:n}=typeof t=="string"?JSON.parse(t):t;if(!Array.isArray(n))throw new Error("Invalid delegations.");const s=n.map(i=>{const{delegation:o,signature:a}=i,{pubkey:c,expiration:u,targets:f}=o;if(f!==void 0&&!Array.isArray(f))throw new Error("Invalid targets.");return{delegation:new va(oo(c),BigInt("0x"+u),f&&f.map(d=>{if(typeof d!="string")throw new Error("Invalid target.");return D.fromHex(d)})),signature:oo(a)}});return new this(s,oo(r))}static fromDelegations(t,r){return new this(t,r)}constructor(t,r){this.delegations=t,this.publicKey=r}toJSON(){return{delegations:this.delegations.map(t=>{const{delegation:r,signature:n}=t,{targets:s}=r;return{delegation:{expiration:r.expiration.toString(16),pubkey:Es(r.pubkey),...s&&{targets:s.map(i=>i.toHex())}},signature:Es(n)}}),publicKey:Es(this.publicKey)}}}class kc extends ha{static fromDelegation(t,r){return new this(t,r)}constructor(t,r){super(),this._inner=t,this._delegation=r}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(t){return this._inner.sign(t)}async transformRequest(t){const{body:r,...n}=t,s=await jr(r);return{...n,body:{content:r,sender_sig:await this.sign(new Uint8Array([...Yu,...new Uint8Array(s)])),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}}}}class qs extends X0{#e;get delegation(){return this.#e}constructor(t,r){super(t),this.#e=r}static fromDelegation(t,r){return new qs(t,r)}}function Fc(e,t){for(const{delegation:n}of e.delegations)if(+new Date(Number(n.expiration/BigInt(1e6)))<=+Date.now())return!1;const r=[];for(const n of r){const s=n.toText();for(const{delegation:i}of e.delegations){if(i.targets===void 0)continue;let o=!0;for(const a of i.targets)if(a.toText()===s){o=!1;break}if(o)return!1}}return!0}const Uc=["mousedown","mousemove","keydown","touchstart","wheel"];class js{callbacks=[];idleTimeout=600*1e3;timeoutID=void 0;static create(t={}){return new js(t)}constructor(t={}){const{onIdle:r,idleTimeout:n=600*1e3}=t||{};this.callbacks=r?[r]:[],this.idleTimeout=n;const s=this._resetTimer.bind(this);window.addEventListener("load",s,!0),Uc.forEach(o=>{document.addEventListener(o,s,!0)});const i=(o,a)=>{let c;return(...u)=>{const f=this,d=()=>{c=void 0,o.apply(f,u)};clearTimeout(c),c=window.setTimeout(d,a)}};if(t?.captureScroll){const o=i(s,t?.scrollDebounce??100);window.addEventListener("scroll",o,!0)}s()}registerCallback(t){this.callbacks.push(t)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);const t=this._resetTimer.bind(this);Uc.forEach(r=>{document.removeEventListener(r,t,!0)}),this.callbacks.forEach(r=>{r()})}_resetTimer(){const t=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(t,this.idleTimeout)}}const Q0=(e,t)=>t.some(r=>e instanceof r);let Pc,Dc;function ep(){return Pc||(Pc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tp(){return Dc||(Dc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pl=new WeakMap,Fo=new WeakMap,Dl=new WeakMap,ao=new WeakMap,Na=new WeakMap;function rp(e){const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{r(Wt(e.result)),s()},o=()=>{n(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&Pl.set(r,e)}).catch(()=>{}),Na.set(t,e),t}function np(e){if(Fo.has(e))return;const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{r(),s()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});Fo.set(e,t)}let Uo={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Fo.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Dl.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Wt(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function sp(e){Uo=e(Uo)}function ip(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(co(this),t,...r);return Dl.set(n,t.sort?t.sort():[t]),Wt(n)}:tp().includes(e)?function(...t){return e.apply(co(this),t),Wt(Pl.get(this))}:function(...t){return Wt(e.apply(co(this),t))}}function op(e){return typeof e=="function"?ip(e):(e instanceof IDBTransaction&&np(e),Q0(e,ep())?new Proxy(e,Uo):e)}function Wt(e){if(e instanceof IDBRequest)return rp(e);if(ao.has(e))return ao.get(e);const t=op(e);return t!==e&&(ao.set(e,t),Na.set(t,e)),t}const co=e=>Na.get(e);function ap(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=Wt(o);return n&&o.addEventListener("upgradeneeded",c=>{n(Wt(o.result),c.oldVersion,c.newVersion,Wt(o.transaction),c)}),r&&o.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const cp=["get","getKey","getAll","getAllKeys","count"],up=["put","add","delete","clear"],uo=new Map;function Mc(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(uo.get(t))return uo.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=up.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||cp.includes(r)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[r](...a),s&&c.done]))[0]};return uo.set(t,i),i}sp(e=>({...e,get:(t,r,n)=>Mc(t,r)||e.get(t,r,n),has:(t,r)=>!!Mc(t,r)||e.has(t,r)}));const Ml="auth-client-db",$l="ic-keyval",lp=async(e=Ml,t=$l,r)=>(globalThis.localStorage?.getItem(Gt)&&(globalThis.localStorage.removeItem(Gt),globalThis.localStorage.removeItem(wr)),await ap(e,r,{upgrade:n=>{n.objectStoreNames.contains(t)&&n.clear(t),n.createObjectStore(t)}}));async function dp(e,t,r){return await e.get(t,r)}async function fp(e,t,r,n){return await e.put(t,n,r)}async function hp(e,t,r){return await e.delete(t,r)}class Ta{constructor(t,r){this._db=t,this._storeName=r}static async create(t){const{dbName:r=Ml,storeName:n=$l,version:s=mp}=t??{},i=await lp(r,n,s);return new Ta(i,n)}async set(t,r){return await fp(this._db,this._storeName,t,r)}async get(t){return await dp(this._db,this._storeName,t)??null}async remove(t){return await hp(this._db,this._storeName,t)}}const wr="identity",Gt="delegation",pp="iv",mp=1;class yp{constructor(t="ic-",r){this.prefix=t,this._localStorage=r}get(t){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+t))}set(t,r){return this._getLocalStorage().setItem(this.prefix+t,r),Promise.resolve()}remove(t){return this._getLocalStorage().removeItem(this.prefix+t),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;const t=globalThis.localStorage;if(!t)throw new Error("Could not find local storage.");return t}}class gp{#e;constructor(t){this.#e=t??{}}initializedDb;get _db(){return new Promise((t,r)=>{if(this.initializedDb){t(this.initializedDb);return}Ta.create(this.#e).then(n=>{this.initializedDb=n,t(n)}).catch(r)})}async get(t){return await(await this._db).get(t)}async set(t,r){await(await this._db).set(t,r)}async remove(t){await(await this._db).remove(t)}}const _p=BigInt(1e9),bp=BigInt(3600),wp=_p*bp,xp="https://identity.internetcomputer.org",Ep="#authorize",vp=BigInt(8)*wp,lo="ECDSA",fo="Ed25519",Np=500,Tp="UserInterrupt";class Pn{constructor(t,r,n,s,i,o,a,c){this._identity=t,this._key=r,this._chain=n,this._storage=s,this.idleManager=i,this._createOptions=o,this._idpWindow=a,this._eventHandler=c,this._registerDefaultIdleCallback()}static async create(t={}){const r=t.storage??new gp,n=t.keyType??lo;let s=null;if(t.identity)s=t.identity;else{let c=await r.get(wr);if(!c)try{const u=new yp,f=await u.get(Gt),d=await u.get(wr);f&&d&&n===lo&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await r.set(Gt,f),await r.set(wr,d),c=f,await u.remove(Gt),await u.remove(wr))}catch(u){console.error(`error while attempting to recover localstorage: ${u}`)}if(c)try{typeof c=="object"?n===fo&&typeof c=="string"?s=Rt.fromJSON(c):s=await Un.fromKeyPair(c):typeof c=="string"&&(s=Rt.fromJSON(c))}catch{}}let i=new Kr,o=null;if(s)try{const c=await r.get(Gt);if(typeof c=="object"&&c!==null)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");t.identity?i=t.identity:c&&(o=Ls.fromJSON(c),Fc(o)?"toDer"in s?i=qs.fromDelegation(s,o):i=kc.fromDelegation(s,o):(await ho(r),s=null))}catch(c){console.error(c),await ho(r),s=null}let a;return t.idleOptions?.disableIdle?a=void 0:(o||t.identity)&&(a=js.create(t.idleOptions)),s||(n===fo?s=Rt.generate():(t.storage&&n===lo&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${fo}' as the key type, as it can serialize to a string`),s=await Un.generate()),await $c(r,s)),new Pn(i,s,o,r,a,t)}_registerDefaultIdleCallback(){const t=this._createOptions?.idleOptions;!t?.onIdle&&!t?.disableDefaultIdleCallback&&this.idleManager?.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(t,r){const n=t.delegations.map(a=>({delegation:new va(a.delegation.pubkey,a.delegation.expiration,a.delegation.targets),signature:a.signature})),s=Ls.fromDelegations(n,t.userPublicKey),i=this._key;if(!i)return;this._chain=s,"toDer"in i?this._identity=qs.fromDelegation(i,this._chain):this._identity=kc.fromDelegation(i,this._chain),this._idpWindow?.close();const o=this._createOptions?.idleOptions;!this.idleManager&&!o?.disableIdle&&(this.idleManager=js.create(o),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(Gt,JSON.stringify(this._chain.toJSON())),await $c(this._storage,this._key),r?.(t)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&this._chain!==null&&Fc(this._chain)}async login(t){const r=Ip(this._createOptions?.loginOptions,t),n=r?.maxTimeToLive??vp,s=new URL(r?.identityProvider?.toString()||xp);s.hash=Ep,this._idpWindow?.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(s,{maxTimeToLive:n,...r}),window.addEventListener("message",this._eventHandler),this._idpWindow=window.open(s.toString(),"idpWindow",r?.windowOpenerFeatures)??void 0;const i=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure(Tp,r?.onError):setTimeout(i,Np))};i()}_getEventHandler(t,r){return async n=>{if(n.origin!==t.origin)return;const s=n.data;switch(s.kind){case"authorize-ready":{const i={kind:"authorize-client",sessionPublicKey:new Uint8Array(this._key?.getPublicKey().toDer()),maxTimeToLive:r?.maxTimeToLive,allowPinAuthentication:r?.allowPinAuthentication,derivationOrigin:r?.derivationOrigin?.toString(),...r?.customValues};this._idpWindow?.postMessage(i,t.origin);break}case"authorize-client-success":try{await this._handleSuccess(s,r?.onSuccess)}catch(i){this._handleFailure(i.message,r?.onError)}break;case"authorize-client-failure":this._handleFailure(s.text,r?.onError);break}}}_handleFailure(t,r){this._idpWindow?.close(),r?.(t),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(t={}){if(await ho(this._storage),this._identity=new Kr,this._chain=null,t.returnTo)try{window.history.pushState({},"",t.returnTo)}catch{window.location.href=t.returnTo}}}async function ho(e){await e.remove(wr),await e.remove(Gt),await e.remove(pp)}function Ip(e,t){if(!e&&!t)return;const r=e?.customValues||t?.customValues?{...e?.customValues,...t?.customValues}:void 0;return{...e,...t,customValues:r}}function Rp(e){if(e instanceof Un)return e.getKeyPair();if(e instanceof Rt)return JSON.stringify(e.toJSON());throw new Error("Unsupported key type")}async function $c(e,t){const r=Rp(t);await e.set(wr,r)}(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Op=({IDL:e})=>{let t=e.Variant({Set:e.Principal,Unset:e.Null}),r=e.Text;e.Record({exchange_rate_canister:e.Opt(t),cycles_ledger_canister_id:e.Opt(e.Principal),last_purged_notification:e.Opt(e.Nat64),governance_canister_id:e.Opt(e.Principal),minting_account_id:e.Opt(r),ledger_canister_id:e.Opt(e.Principal)});let n=e.Record({subnets:e.Vec(e.Principal),subnet_type:e.Text}),s=e.Variant({Add:n,Remove:n}),i=e.Record({subnet_type:e.Opt(e.Text)}),o=e.Variant({Filter:i,Subnet:e.Record({subnet:e.Principal})}),a=e.Record({value:e.Text,name:e.Text}),c=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),u=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(a)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(c),log_memory_limit:e.Opt(e.Nat),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),f=e.Record({subnet_selection:e.Opt(o),settings:e.Opt(u),subnet_type:e.Opt(e.Text)}),d=e.Variant({Refunded:e.Record({create_error:e.Text,refund_amount:e.Nat})}),l=e.Variant({Ok:e.Principal,Err:d}),h=e.Record({xdr_permyriad_per_icp:e.Nat64,timestamp_seconds:e.Nat64}),y=e.Record({certificate:e.Vec(e.Nat8),data:h,hash_tree:e.Vec(e.Nat8)}),g=e.Record({data:e.Vec(e.Tuple(e.Principal,e.Vec(e.Principal)))}),_=e.Record({data:e.Vec(e.Tuple(e.Text,e.Vec(e.Principal)))}),m=e.Nat64,b=e.Record({controller:e.Principal,block_index:m,subnet_selection:e.Opt(o),settings:e.Opt(u),subnet_type:e.Opt(e.Text)}),p=e.Variant({Refunded:e.Record({block_index:e.Opt(m),reason:e.Text}),InvalidTransaction:e.Text,Other:e.Record({error_message:e.Text,error_code:e.Nat64}),Processing:e.Null,TransactionTooOld:m}),E=e.Variant({Ok:e.Principal,Err:p}),v=e.Opt(e.Vec(e.Nat8)),N=e.Opt(e.Vec(e.Nat8)),I=e.Record({block_index:m,deposit_memo:v,to_subaccount:N}),R=e.Record({balance:e.Nat,block_index:e.Nat,minted:e.Nat}),x=e.Variant({Ok:R,Err:p}),O=e.Record({block_index:m,canister_id:e.Principal}),B=e.Nat,A=e.Variant({Ok:B,Err:p}),w=e.Record({who:e.Opt(e.Principal),subnets:e.Vec(e.Principal)}),T=e.Variant({Add:e.Text,Remove:e.Text});return e.Service({change_subnet_type_assignment:e.Func([s],[],[]),create_canister:e.Func([f],[l],[]),get_build_metadata:e.Func([],[e.Text],[]),get_default_subnets:e.Func([],[e.Vec(e.Principal)],[]),get_icp_xdr_conversion_rate:e.Func([],[y],[]),get_principals_authorized_to_create_canisters_to_subnets:e.Func([],[g],[]),get_subnet_types_to_subnets:e.Func([],[_],[]),notify_create_canister:e.Func([b],[E],[]),notify_mint_cycles:e.Func([I],[x],[]),notify_top_up:e.Func([O],[A],[]),set_authorized_subnetwork_list:e.Func([w],[],[]),update_subnet_type:e.Func([T],[],[])})},Sp=({IDL:e})=>{let t=e.Variant({Set:e.Principal,Unset:e.Null}),r=e.Text;e.Record({exchange_rate_canister:e.Opt(t),cycles_ledger_canister_id:e.Opt(e.Principal),last_purged_notification:e.Opt(e.Nat64),governance_canister_id:e.Opt(e.Principal),minting_account_id:e.Opt(r),ledger_canister_id:e.Opt(e.Principal)});let n=e.Record({subnets:e.Vec(e.Principal),subnet_type:e.Text}),s=e.Variant({Add:n,Remove:n}),i=e.Record({subnet_type:e.Opt(e.Text)}),o=e.Variant({Filter:i,Subnet:e.Record({subnet:e.Principal})}),a=e.Record({value:e.Text,name:e.Text}),c=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),u=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(a)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(c),log_memory_limit:e.Opt(e.Nat),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),f=e.Record({subnet_selection:e.Opt(o),settings:e.Opt(u),subnet_type:e.Opt(e.Text)}),d=e.Variant({Refunded:e.Record({create_error:e.Text,refund_amount:e.Nat})}),l=e.Variant({Ok:e.Principal,Err:d}),h=e.Record({xdr_permyriad_per_icp:e.Nat64,timestamp_seconds:e.Nat64}),y=e.Record({certificate:e.Vec(e.Nat8),data:h,hash_tree:e.Vec(e.Nat8)}),g=e.Record({data:e.Vec(e.Tuple(e.Principal,e.Vec(e.Principal)))}),_=e.Record({data:e.Vec(e.Tuple(e.Text,e.Vec(e.Principal)))}),m=e.Nat64,b=e.Record({controller:e.Principal,block_index:m,subnet_selection:e.Opt(o),settings:e.Opt(u),subnet_type:e.Opt(e.Text)}),p=e.Variant({Refunded:e.Record({block_index:e.Opt(m),reason:e.Text}),InvalidTransaction:e.Text,Other:e.Record({error_message:e.Text,error_code:e.Nat64}),Processing:e.Null,TransactionTooOld:m}),E=e.Variant({Ok:e.Principal,Err:p}),v=e.Opt(e.Vec(e.Nat8)),N=e.Opt(e.Vec(e.Nat8)),I=e.Record({block_index:m,deposit_memo:v,to_subaccount:N}),R=e.Record({balance:e.Nat,block_index:e.Nat,minted:e.Nat}),x=e.Variant({Ok:R,Err:p}),O=e.Record({block_index:m,canister_id:e.Principal}),B=e.Nat,A=e.Variant({Ok:B,Err:p}),w=e.Record({who:e.Opt(e.Principal),subnets:e.Vec(e.Principal)}),T=e.Variant({Add:e.Text,Remove:e.Text});return e.Service({change_subnet_type_assignment:e.Func([s],[],[]),create_canister:e.Func([f],[l],[]),get_build_metadata:e.Func([],[e.Text],["query"]),get_default_subnets:e.Func([],[e.Vec(e.Principal)],["query"]),get_icp_xdr_conversion_rate:e.Func([],[y],["query"]),get_principals_authorized_to_create_canisters_to_subnets:e.Func([],[g],["query"]),get_subnet_types_to_subnets:e.Func([],[_],["query"]),notify_create_canister:e.Func([b],[E],[]),notify_mint_cycles:e.Func([I],[x],[]),notify_top_up:e.Func([O],[A],[]),set_authorized_subnetwork_list:e.Func([w],[],[]),update_subnet_type:e.Func([T],[],[])})},Ap=({IDL:e})=>{let t=e.Variant({mainnet:e.Null,testnet:e.Null}),r=e.Text,n=e.Record({network:t,address:r,min_confirmations:e.Opt(e.Nat32)}),s=e.Nat64,i=s,o=e.Nat32,a=e.Record({start_height:o,end_height:e.Opt(o),network:t}),c=e.Vec(e.Nat8),u=e.Record({tip_height:o,block_headers:e.Vec(c)}),f=e.Record({network:t}),d=e.Nat64,l=e.Vec(d),h=e.Record({network:t,filter:e.Opt(e.Variant({page:e.Vec(e.Nat8),min_confirmations:e.Nat32})),address:r}),y=e.Vec(e.Nat8),g=e.Record({txid:e.Vec(e.Nat8),vout:e.Nat32}),_=e.Record({height:e.Nat32,value:s,outpoint:g}),m=e.Record({next_page:e.Opt(e.Vec(e.Nat8)),tip_height:o,tip_block_hash:y,utxos:e.Vec(_)}),b=e.Record({transaction:e.Vec(e.Nat8),network:t}),p=e.Principal,E=e.Record({canister_id:p,num_requested_changes:e.Opt(e.Nat64)}),v=e.Variant({from_user:e.Record({user_id:e.Principal}),from_canister:e.Record({canister_version:e.Opt(e.Nat64),canister_id:e.Principal})}),N=e.Vec(e.Nat8),I=e.Variant({creation:e.Record({controllers:e.Vec(e.Principal),environment_variables_hash:e.Opt(e.Vec(e.Nat8))}),code_deployment:e.Record({mode:e.Variant({reinstall:e.Null,upgrade:e.Null,install:e.Null}),module_hash:e.Vec(e.Nat8)}),load_snapshot:e.Record({canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),from_canister_id:e.Opt(e.Principal),taken_at_timestamp:e.Nat64,snapshot_id:N}),controllers_change:e.Record({controllers:e.Vec(e.Principal)}),code_uninstall:e.Null}),R=e.Record({timestamp_nanos:e.Nat64,canister_version:e.Nat64,origin:v,details:I}),x=e.Record({controllers:e.Vec(e.Principal),module_hash:e.Opt(e.Vec(e.Nat8)),recent_changes:e.Vec(R),total_num_changes:e.Nat64}),O=e.Record({name:e.Text,canister_id:p}),B=e.Record({value:e.Vec(e.Nat8)}),A=e.Record({canister_id:p}),w=e.Record({value:e.Text,name:e.Text}),T=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),C=e.Record({freezing_threshold:e.Nat,wasm_memory_threshold:e.Nat,environment_variables:e.Vec(w),controllers:e.Vec(e.Principal),reserved_cycles_limit:e.Nat,log_visibility:T,wasm_memory_limit:e.Nat,memory_allocation:e.Nat,compute_allocation:e.Nat}),F=e.Record({memory_metrics:e.Record({wasm_binary_size:e.Nat,wasm_chunk_store_size:e.Nat,canister_history_size:e.Nat,stable_memory_size:e.Nat,snapshots_size:e.Nat,wasm_memory_size:e.Nat,global_memory_size:e.Nat,custom_sections_size:e.Nat}),status:e.Variant({stopped:e.Null,stopping:e.Null,running:e.Null}),memory_size:e.Nat,ready_for_migration:e.Bool,version:e.Nat64,cycles:e.Nat,settings:C,query_stats:e.Record({response_payload_bytes_total:e.Nat,num_instructions_total:e.Nat,num_calls_total:e.Nat,request_payload_bytes_total:e.Nat}),idle_cycles_burned_per_day:e.Nat,module_hash:e.Opt(e.Vec(e.Nat8)),reserved_cycles:e.Nat}),$=e.Record({canister_id:p}),S=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(w)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(T),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),V=e.Record({settings:e.Opt(S),sender_canister_version:e.Opt(e.Nat64)}),k=e.Record({canister_id:p}),U=e.Record({canister_id:p}),P=e.Record({canister_id:p,snapshot_id:N}),se=e.Record({canister_id:p}),te=e.Variant({secp256k1:e.Null}),Z=e.Record({key_id:e.Record({name:e.Text,curve:te}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),z=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),ie=e.Record({canister_id:p}),ge=e.Record({idx:e.Nat64,timestamp_nanos:e.Nat64,content:e.Vec(e.Nat8)}),J=e.Record({canister_log_records:e.Vec(ge)}),he=e.Record({value:e.Text,name:e.Text}),We=e.Record({status:e.Nat,body:e.Vec(e.Nat8),headers:e.Vec(he)}),mt=e.Record({url:e.Text,method:e.Variant({get:e.Null,head:e.Null,post:e.Null}),max_response_bytes:e.Opt(e.Nat64),body:e.Opt(e.Vec(e.Nat8)),transform:e.Opt(e.Record({function:e.Func([e.Record({context:e.Vec(e.Nat8),response:We})],[We],[]),context:e.Vec(e.Nat8)})),headers:e.Vec(he),is_replicated:e.Opt(e.Bool)}),yt=e.Variant({reinstall:e.Null,upgrade:e.Opt(e.Record({wasm_memory_persistence:e.Opt(e.Variant({keep:e.Null,replace:e.Null})),skip_pre_upgrade:e.Opt(e.Bool)})),install:e.Null}),Pe=e.Record({hash:e.Vec(e.Nat8)}),tr=e.Record({arg:e.Vec(e.Nat8),wasm_module_hash:e.Vec(e.Nat8),mode:yt,chunk_hashes_list:e.Vec(Pe),target_canister:p,store_canister:e.Opt(p),sender_canister_version:e.Opt(e.Nat64)}),rr=e.Vec(e.Nat8),nr=e.Record({arg:e.Vec(e.Nat8),wasm_module:rr,mode:yt,canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),sr=e.Record({canister_id:p}),gt=e.Record({id:N,total_size:e.Nat64,taken_at_timestamp:e.Nat64}),ir=e.Vec(gt),or=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64),snapshot_id:N}),ar=e.Record({start_at_timestamp_nanos:e.Nat64,subnet_id:e.Principal}),cr=e.Record({num_block_failures_total:e.Nat64,node_id:e.Principal,num_blocks_proposed_total:e.Nat64}),ur=e.Vec(e.Record({timestamp_nanos:e.Nat64,node_metrics:e.Vec(cr)})),lr=e.Record({settings:e.Opt(S),specified_id:e.Opt(p),amount:e.Opt(e.Nat),sender_canister_version:e.Opt(e.Nat64)}),dr=e.Record({canister_id:p}),fr=e.Record({canister_id:p,amount:e.Nat}),hr=e.Vec(e.Nat8),hi=e.Record({kind:e.Variant({wasm_module:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_memory:e.Record({size:e.Nat64,offset:e.Nat64}),stable_memory:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_chunk:e.Record({hash:e.Vec(e.Nat8)})}),canister_id:p,snapshot_id:N}),pi=e.Record({chunk:e.Vec(e.Nat8)}),mi=e.Record({canister_id:p,snapshot_id:N}),yi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,stable_memory_size:e.Nat64,wasm_chunk_store:e.Vec(e.Record({hash:e.Vec(e.Nat8)})),taken_at_timestamp:e.Nat64,wasm_memory_size:e.Nat64}),ln=e.Variant({ed25519:e.Null,bip340secp256k1:e.Null}),gi=e.Record({key_id:e.Record({algorithm:ln,name:e.Text}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),_i=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),bi=e.Record({key_id:e.Record({name:e.Text,curve:te}),derivation_path:e.Vec(e.Vec(e.Nat8)),message_hash:e.Vec(e.Nat8)}),wi=e.Record({signature:e.Vec(e.Nat8)}),xi=e.Variant({bip341:e.Record({merkle_root_hash:e.Vec(e.Nat8)})}),Ei=e.Record({aux:e.Opt(xi),key_id:e.Record({algorithm:ln,name:e.Text}),derivation_path:e.Vec(e.Vec(e.Nat8)),message:e.Vec(e.Nat8)}),vi=e.Record({signature:e.Vec(e.Nat8)}),Ni=e.Record({canister_id:p}),Ti=e.Record({canister_id:p}),Ii=e.Record({canister_id:p}),Ri=e.Vec(Pe),Oi=e.Record({subnet_id:e.Principal}),Si=e.Record({replica_version:e.Text,registry_version:e.Nat64}),Ai=e.Record({replace_snapshot:e.Opt(N),canister_id:p,uninstall_code:e.Opt(e.Bool),sender_canister_version:e.Opt(e.Nat64)}),Ci=gt,Bi=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),Vi=e.Record({canister_id:e.Principal,settings:S,sender_canister_version:e.Opt(e.Nat64)}),ki=e.Record({chunk:e.Vec(e.Nat8),kind:e.Variant({wasm_module:e.Record({offset:e.Nat64}),wasm_memory:e.Record({offset:e.Nat64}),stable_memory:e.Record({offset:e.Nat64}),wasm_chunk:e.Null}),canister_id:p,snapshot_id:N}),Fi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),replace_snapshot:e.Opt(N),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,canister_id:p,stable_memory_size:e.Nat64,wasm_memory_size:e.Nat64}),Ui=e.Record({snapshot_id:N}),Pi=e.Record({chunk:e.Vec(e.Nat8),canister_id:e.Principal}),Di=Pe,dn=e.Variant({bls12_381_g2:e.Null}),Mi=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),input:e.Vec(e.Nat8),transport_public_key:e.Vec(e.Nat8)}),$i=e.Record({encrypted_key:e.Vec(e.Nat8)}),Li=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),canister_id:e.Opt(p)}),qi=e.Record({public_key:e.Vec(e.Nat8)});return e.Service({bitcoin_get_balance:e.Func([n],[i],[]),bitcoin_get_block_headers:e.Func([a],[u],[]),bitcoin_get_current_fee_percentiles:e.Func([f],[l],[]),bitcoin_get_utxos:e.Func([h],[m],[]),bitcoin_send_transaction:e.Func([b],[],[]),canister_info:e.Func([E],[x],[]),canister_metadata:e.Func([O],[B],[]),canister_status:e.Func([A],[F],[]),clear_chunk_store:e.Func([$],[],[]),create_canister:e.Func([V],[k],[]),delete_canister:e.Func([U],[],[]),delete_canister_snapshot:e.Func([P],[],[]),deposit_cycles:e.Func([se],[],[]),ecdsa_public_key:e.Func([Z],[z],[]),fetch_canister_logs:e.Func([ie],[J],[]),http_request:e.Func([mt],[We],[]),install_chunked_code:e.Func([tr],[],[]),install_code:e.Func([nr],[],[]),list_canister_snapshots:e.Func([sr],[ir],[]),load_canister_snapshot:e.Func([or],[],[]),node_metrics_history:e.Func([ar],[ur],[]),provisional_create_canister_with_cycles:e.Func([lr],[dr],[]),provisional_top_up_canister:e.Func([fr],[],[]),raw_rand:e.Func([],[hr],[]),read_canister_snapshot_data:e.Func([hi],[pi],[]),read_canister_snapshot_metadata:e.Func([mi],[yi],[]),schnorr_public_key:e.Func([gi],[_i],[]),sign_with_ecdsa:e.Func([bi],[wi],[]),sign_with_schnorr:e.Func([Ei],[vi],[]),start_canister:e.Func([Ni],[],[]),stop_canister:e.Func([Ti],[],[]),stored_chunks:e.Func([Ii],[Ri],[]),subnet_info:e.Func([Oi],[Si],[]),take_canister_snapshot:e.Func([Ai],[Ci],[]),uninstall_code:e.Func([Bi],[],[]),update_settings:e.Func([Vi],[],[]),upload_canister_snapshot_data:e.Func([ki],[],[]),upload_canister_snapshot_metadata:e.Func([Fi],[Ui],[]),upload_chunk:e.Func([Pi],[Di],[]),vetkd_derive_key:e.Func([Mi],[$i],[]),vetkd_public_key:e.Func([Li],[qi],[])})},Cp=({IDL:e})=>{let t=e.Variant({mainnet:e.Null,testnet:e.Null}),r=e.Text,n=e.Record({network:t,address:r,min_confirmations:e.Opt(e.Nat32)}),s=e.Nat64,i=s,o=e.Nat32,a=e.Record({start_height:o,end_height:e.Opt(o),network:t}),c=e.Vec(e.Nat8),u=e.Record({tip_height:o,block_headers:e.Vec(c)}),f=e.Record({network:t}),d=e.Nat64,l=e.Vec(d),h=e.Record({network:t,filter:e.Opt(e.Variant({page:e.Vec(e.Nat8),min_confirmations:e.Nat32})),address:r}),y=e.Vec(e.Nat8),g=e.Record({txid:e.Vec(e.Nat8),vout:e.Nat32}),_=e.Record({height:e.Nat32,value:s,outpoint:g}),m=e.Record({next_page:e.Opt(e.Vec(e.Nat8)),tip_height:o,tip_block_hash:y,utxos:e.Vec(_)}),b=e.Record({transaction:e.Vec(e.Nat8),network:t}),p=e.Principal,E=e.Record({canister_id:p,num_requested_changes:e.Opt(e.Nat64)}),v=e.Variant({from_user:e.Record({user_id:e.Principal}),from_canister:e.Record({canister_version:e.Opt(e.Nat64),canister_id:e.Principal})}),N=e.Vec(e.Nat8),I=e.Variant({creation:e.Record({controllers:e.Vec(e.Principal),environment_variables_hash:e.Opt(e.Vec(e.Nat8))}),code_deployment:e.Record({mode:e.Variant({reinstall:e.Null,upgrade:e.Null,install:e.Null}),module_hash:e.Vec(e.Nat8)}),load_snapshot:e.Record({canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),from_canister_id:e.Opt(e.Principal),taken_at_timestamp:e.Nat64,snapshot_id:N}),controllers_change:e.Record({controllers:e.Vec(e.Principal)}),code_uninstall:e.Null}),R=e.Record({timestamp_nanos:e.Nat64,canister_version:e.Nat64,origin:v,details:I}),x=e.Record({controllers:e.Vec(e.Principal),module_hash:e.Opt(e.Vec(e.Nat8)),recent_changes:e.Vec(R),total_num_changes:e.Nat64}),O=e.Record({name:e.Text,canister_id:p}),B=e.Record({value:e.Vec(e.Nat8)}),A=e.Record({canister_id:p}),w=e.Record({value:e.Text,name:e.Text}),T=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),C=e.Record({freezing_threshold:e.Nat,wasm_memory_threshold:e.Nat,environment_variables:e.Vec(w),controllers:e.Vec(e.Principal),reserved_cycles_limit:e.Nat,log_visibility:T,wasm_memory_limit:e.Nat,memory_allocation:e.Nat,compute_allocation:e.Nat}),F=e.Record({memory_metrics:e.Record({wasm_binary_size:e.Nat,wasm_chunk_store_size:e.Nat,canister_history_size:e.Nat,stable_memory_size:e.Nat,snapshots_size:e.Nat,wasm_memory_size:e.Nat,global_memory_size:e.Nat,custom_sections_size:e.Nat}),status:e.Variant({stopped:e.Null,stopping:e.Null,running:e.Null}),memory_size:e.Nat,ready_for_migration:e.Bool,version:e.Nat64,cycles:e.Nat,settings:C,query_stats:e.Record({response_payload_bytes_total:e.Nat,num_instructions_total:e.Nat,num_calls_total:e.Nat,request_payload_bytes_total:e.Nat}),idle_cycles_burned_per_day:e.Nat,module_hash:e.Opt(e.Vec(e.Nat8)),reserved_cycles:e.Nat}),$=e.Record({canister_id:p}),S=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(w)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(T),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),V=e.Record({settings:e.Opt(S),sender_canister_version:e.Opt(e.Nat64)}),k=e.Record({canister_id:p}),U=e.Record({canister_id:p}),P=e.Record({canister_id:p,snapshot_id:N}),se=e.Record({canister_id:p}),te=e.Variant({secp256k1:e.Null}),Z=e.Record({key_id:e.Record({name:e.Text,curve:te}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),z=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),ie=e.Record({canister_id:p}),ge=e.Record({idx:e.Nat64,timestamp_nanos:e.Nat64,content:e.Vec(e.Nat8)}),J=e.Record({canister_log_records:e.Vec(ge)}),he=e.Record({value:e.Text,name:e.Text}),We=e.Record({status:e.Nat,body:e.Vec(e.Nat8),headers:e.Vec(he)}),mt=e.Record({url:e.Text,method:e.Variant({get:e.Null,head:e.Null,post:e.Null}),max_response_bytes:e.Opt(e.Nat64),body:e.Opt(e.Vec(e.Nat8)),transform:e.Opt(e.Record({function:e.Func([e.Record({context:e.Vec(e.Nat8),response:We})],[We],["query"]),context:e.Vec(e.Nat8)})),headers:e.Vec(he),is_replicated:e.Opt(e.Bool)}),yt=e.Variant({reinstall:e.Null,upgrade:e.Opt(e.Record({wasm_memory_persistence:e.Opt(e.Variant({keep:e.Null,replace:e.Null})),skip_pre_upgrade:e.Opt(e.Bool)})),install:e.Null}),Pe=e.Record({hash:e.Vec(e.Nat8)}),tr=e.Record({arg:e.Vec(e.Nat8),wasm_module_hash:e.Vec(e.Nat8),mode:yt,chunk_hashes_list:e.Vec(Pe),target_canister:p,store_canister:e.Opt(p),sender_canister_version:e.Opt(e.Nat64)}),rr=e.Vec(e.Nat8),nr=e.Record({arg:e.Vec(e.Nat8),wasm_module:rr,mode:yt,canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),sr=e.Record({canister_id:p}),gt=e.Record({id:N,total_size:e.Nat64,taken_at_timestamp:e.Nat64}),ir=e.Vec(gt),or=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64),snapshot_id:N}),ar=e.Record({start_at_timestamp_nanos:e.Nat64,subnet_id:e.Principal}),cr=e.Record({num_block_failures_total:e.Nat64,node_id:e.Principal,num_blocks_proposed_total:e.Nat64}),ur=e.Vec(e.Record({timestamp_nanos:e.Nat64,node_metrics:e.Vec(cr)})),lr=e.Record({settings:e.Opt(S),specified_id:e.Opt(p),amount:e.Opt(e.Nat),sender_canister_version:e.Opt(e.Nat64)}),dr=e.Record({canister_id:p}),fr=e.Record({canister_id:p,amount:e.Nat}),hr=e.Vec(e.Nat8),hi=e.Record({kind:e.Variant({wasm_module:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_memory:e.Record({size:e.Nat64,offset:e.Nat64}),stable_memory:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_chunk:e.Record({hash:e.Vec(e.Nat8)})}),canister_id:p,snapshot_id:N}),pi=e.Record({chunk:e.Vec(e.Nat8)}),mi=e.Record({canister_id:p,snapshot_id:N}),yi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,stable_memory_size:e.Nat64,wasm_chunk_store:e.Vec(e.Record({hash:e.Vec(e.Nat8)})),taken_at_timestamp:e.Nat64,wasm_memory_size:e.Nat64}),ln=e.Variant({ed25519:e.Null,bip340secp256k1:e.Null}),gi=e.Record({key_id:e.Record({algorithm:ln,name:e.Text}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),_i=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),bi=e.Record({key_id:e.Record({name:e.Text,curve:te}),derivation_path:e.Vec(e.Vec(e.Nat8)),message_hash:e.Vec(e.Nat8)}),wi=e.Record({signature:e.Vec(e.Nat8)}),xi=e.Variant({bip341:e.Record({merkle_root_hash:e.Vec(e.Nat8)})}),Ei=e.Record({aux:e.Opt(xi),key_id:e.Record({algorithm:ln,name:e.Text}),derivation_path:e.Vec(e.Vec(e.Nat8)),message:e.Vec(e.Nat8)}),vi=e.Record({signature:e.Vec(e.Nat8)}),Ni=e.Record({canister_id:p}),Ti=e.Record({canister_id:p}),Ii=e.Record({canister_id:p}),Ri=e.Vec(Pe),Oi=e.Record({subnet_id:e.Principal}),Si=e.Record({replica_version:e.Text,registry_version:e.Nat64}),Ai=e.Record({replace_snapshot:e.Opt(N),canister_id:p,uninstall_code:e.Opt(e.Bool),sender_canister_version:e.Opt(e.Nat64)}),Ci=gt,Bi=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),Vi=e.Record({canister_id:e.Principal,settings:S,sender_canister_version:e.Opt(e.Nat64)}),ki=e.Record({chunk:e.Vec(e.Nat8),kind:e.Variant({wasm_module:e.Record({offset:e.Nat64}),wasm_memory:e.Record({offset:e.Nat64}),stable_memory:e.Record({offset:e.Nat64}),wasm_chunk:e.Null}),canister_id:p,snapshot_id:N}),Fi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),replace_snapshot:e.Opt(N),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,canister_id:p,stable_memory_size:e.Nat64,wasm_memory_size:e.Nat64}),Ui=e.Record({snapshot_id:N}),Pi=e.Record({chunk:e.Vec(e.Nat8),canister_id:e.Principal}),Di=Pe,dn=e.Variant({bls12_381_g2:e.Null}),Mi=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),input:e.Vec(e.Nat8),transport_public_key:e.Vec(e.Nat8)}),$i=e.Record({encrypted_key:e.Vec(e.Nat8)}),Li=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),canister_id:e.Opt(p)}),qi=e.Record({public_key:e.Vec(e.Nat8)});return e.Service({bitcoin_get_balance:e.Func([n],[i],[]),bitcoin_get_block_headers:e.Func([a],[u],[]),bitcoin_get_current_fee_percentiles:e.Func([f],[l],[]),bitcoin_get_utxos:e.Func([h],[m],[]),bitcoin_send_transaction:e.Func([b],[],[]),canister_info:e.Func([E],[x],[]),canister_metadata:e.Func([O],[B],[]),canister_status:e.Func([A],[F],["query"]),clear_chunk_store:e.Func([$],[],[]),create_canister:e.Func([V],[k],[]),delete_canister:e.Func([U],[],[]),delete_canister_snapshot:e.Func([P],[],[]),deposit_cycles:e.Func([se],[],[]),ecdsa_public_key:e.Func([Z],[z],[]),fetch_canister_logs:e.Func([ie],[J],["query"]),http_request:e.Func([mt],[We],[]),install_chunked_code:e.Func([tr],[],[]),install_code:e.Func([nr],[],[]),list_canister_snapshots:e.Func([sr],[ir],[]),load_canister_snapshot:e.Func([or],[],[]),node_metrics_history:e.Func([ar],[ur],[]),provisional_create_canister_with_cycles:e.Func([lr],[dr],[]),provisional_top_up_canister:e.Func([fr],[],[]),raw_rand:e.Func([],[hr],[]),read_canister_snapshot_data:e.Func([hi],[pi],[]),read_canister_snapshot_metadata:e.Func([mi],[yi],[]),schnorr_public_key:e.Func([gi],[_i],[]),sign_with_ecdsa:e.Func([bi],[wi],[]),sign_with_schnorr:e.Func([Ei],[vi],[]),start_canister:e.Func([Ni],[],[]),stop_canister:e.Func([Ti],[],[]),stored_chunks:e.Func([Ii],[Ri],[]),subnet_info:e.Func([Oi],[Si],[]),take_canister_snapshot:e.Func([Ai],[Ci],[]),uninstall_code:e.Func([Bi],[],[]),update_settings:e.Func([Vi],[],[]),upload_canister_snapshot_data:e.Func([ki],[],[]),upload_canister_snapshot_metadata:e.Func([Fi],[Ui],[]),upload_chunk:e.Func([Pi],[Di],[]),vetkd_derive_key:e.Func([Mi],[$i],[]),vetkd_public_key:e.Func([Li],[qi],[])})},Bp=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({owner:e.Principal,subaccount:e.Opt(t)}),n=e.Record({icrc2:e.Bool}),s=e.Record({icrc1_minting_account:e.Opt(r),feature_flags:e.Opt(n)}),i=e.Record({e8s:e.Nat64}),o=e.Text,a=e.Record({secs:e.Nat64,nanos:e.Nat32}),c=e.Record({num_blocks_to_archive:e.Nat64,max_transactions_per_response:e.Opt(e.Nat64),trigger_threshold:e.Nat64,more_controller_ids:e.Opt(e.Vec(e.Principal)),max_message_size_bytes:e.Opt(e.Nat64),cycles_for_archive_creation:e.Opt(e.Nat64),node_max_memory_size_bytes:e.Opt(e.Nat64),controller_id:e.Principal}),u=e.Record({send_whitelist:e.Vec(e.Principal),token_symbol:e.Opt(e.Text),transfer_fee:e.Opt(i),minting_account:o,transaction_window:e.Opt(a),max_message_size_bytes:e.Opt(e.Nat64),icrc1_minting_account:e.Opt(r),archive_options:e.Opt(c),initial_values:e.Vec(e.Tuple(o,i)),token_name:e.Opt(e.Text),feature_flags:e.Opt(n)});e.Variant({Upgrade:e.Opt(s),Init:u});let f=e.Vec(e.Nat8),d=e.Record({account:f}),l=e.Record({account:o}),h=e.Record({canister_id:e.Principal}),y=e.Record({archives:e.Vec(h)}),g=e.Record({prev_spender_id:e.Opt(o),from_account_id:o,take:e.Opt(e.Nat64)}),_=e.Vec(e.Record({from_account_id:o,to_spender_id:o,allowance:i,expires_at:e.Opt(e.Nat64)})),m=e.Nat,b=e.Variant({Int:e.Int,Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text}),p=e.Nat64,E=e.Record({to:r,fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m}),v=e.Nat,N=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),I=e.Variant({Ok:v,Err:N}),R=e.Record({utc_offset_minutes:e.Opt(e.Int16),language:e.Text}),x=e.Record({metadata:R,device_spec:e.Opt(e.Variant({GenericDisplay:e.Null,FieldsDisplay:e.Null}))}),O=e.Record({arg:e.Vec(e.Nat8),method:e.Text,user_preferences:x}),B=e.Variant({Text:e.Record({content:e.Text}),TokenAmount:e.Record({decimals:e.Nat8,amount:e.Nat64,symbol:e.Text}),TimestampSeconds:e.Record({amount:e.Nat64}),DurationSeconds:e.Record({amount:e.Nat64})}),A=e.Record({fields:e.Vec(e.Tuple(e.Text,B)),intent:e.Text}),w=e.Variant({FieldsDisplayMessage:A,GenericDisplayMessage:e.Text}),T=e.Record({metadata:R,consent_message:w}),C=e.Record({description:e.Text}),F=e.Variant({GenericError:e.Record({description:e.Text,error_code:e.Nat}),InsufficientPayment:C,UnsupportedCanisterCall:C,ConsentMessageUnavailable:C}),$=e.Variant({Ok:T,Err:F}),S=e.Record({account:r,spender:r}),V=e.Record({allowance:m,expires_at:e.Opt(p)}),k=e.Record({fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m,expected_allowance:e.Opt(m),expires_at:e.Opt(p),spender:r}),U=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),AllowanceChanged:e.Record({current_allowance:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,Expired:e.Record({ledger_time:e.Nat64}),InsufficientFunds:e.Record({balance:m})}),P=e.Variant({Ok:v,Err:U}),se=e.Record({to:r,fee:e.Opt(m),spender_subaccount:e.Opt(t),from:r,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(p),amount:m}),te=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,InsufficientAllowance:e.Record({allowance:m}),BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:p}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),Z=e.Variant({Ok:v,Err:te}),z=e.Nat64,ie=e.Record({start:z,length:e.Nat64}),ge=e.Nat64,J=e.Record({timestamp_nanos:e.Nat64}),he=e.Variant({Approve:e.Record({fee:i,from:f,allowance_e8s:e.Int,allowance:i,expected_allowance:e.Opt(i),expires_at:e.Opt(J),spender:f}),Burn:e.Record({from:f,amount:i,spender:e.Opt(f)}),Mint:e.Record({to:f,amount:i}),Transfer:e.Record({to:f,fee:i,from:f,amount:i,spender:e.Opt(e.Vec(e.Nat8))})}),We=e.Record({memo:ge,icrc1_memo:e.Opt(e.Vec(e.Nat8)),operation:e.Opt(he),created_at_time:J}),mt=e.Record({transaction:We,timestamp:J,parent_hash:e.Opt(e.Vec(e.Nat8))}),yt=e.Record({blocks:e.Vec(mt)}),Pe=e.Variant({BadFirstBlockIndex:e.Record({requested_index:z,first_valid_index:z}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),tr=e.Variant({Ok:yt,Err:Pe}),rr=e.Func([ie],[tr],[]),nr=e.Record({callback:rr,start:z,length:e.Nat64}),sr=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(mt),chain_length:e.Nat64,first_block_index:z,archived_blocks:e.Vec(nr)}),gt=e.Record({callback:e.Func([ie],[e.Variant({Ok:e.Vec(e.Vec(e.Nat8)),Err:Pe})],[]),start:e.Nat64,length:e.Nat64}),ir=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(e.Vec(e.Nat8)),chain_length:e.Nat64,first_block_index:e.Nat64,archived_blocks:e.Vec(gt)}),or=e.Record({fee:e.Opt(m),from_subaccount:e.Opt(t),spender:f}),ar=e.Record({to:o,fee:i,memo:ge,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),cr=e.Record({certification:e.Opt(e.Vec(e.Nat8)),tip_index:z}),ur=e.Record({to:f,fee:i,memo:ge,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),lr=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:i}),TxDuplicate:e.Record({duplicate_of:z}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:i})}),dr=e.Variant({Ok:z,Err:lr}),fr=e.Record({}),hr=e.Record({transfer_fee:i});return e.Service({account_balance:e.Func([d],[i],[]),account_balance_dfx:e.Func([l],[i],[]),account_identifier:e.Func([r],[f],[]),archives:e.Func([],[y],[]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],[]),get_allowances:e.Func([g],[_],[]),icrc10_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],[]),icrc1_balance_of:e.Func([r],[m],[]),icrc1_decimals:e.Func([],[e.Nat8],[]),icrc1_fee:e.Func([],[m],[]),icrc1_metadata:e.Func([],[e.Vec(e.Tuple(e.Text,b))],[]),icrc1_minting_account:e.Func([],[e.Opt(r)],[]),icrc1_name:e.Func([],[e.Text],[]),icrc1_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],[]),icrc1_symbol:e.Func([],[e.Text],[]),icrc1_total_supply:e.Func([],[m],[]),icrc1_transfer:e.Func([E],[I],[]),icrc21_canister_call_consent_message:e.Func([O],[$],[]),icrc2_allowance:e.Func([S],[V],[]),icrc2_approve:e.Func([k],[P],[]),icrc2_transfer_from:e.Func([se],[Z],[]),is_ledger_ready:e.Func([],[e.Bool],["query"]),name:e.Func([],[e.Record({name:e.Text})],[]),query_blocks:e.Func([ie],[sr],[]),query_encoded_blocks:e.Func([ie],[ir],[]),remove_approval:e.Func([or],[P],[]),send_dfx:e.Func([ar],[z],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],[]),tip_of_chain:e.Func([],[cr],[]),transfer:e.Func([ur],[dr],[]),transfer_fee:e.Func([fr],[hr],[])})},Vp=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({owner:e.Principal,subaccount:e.Opt(t)}),n=e.Record({icrc2:e.Bool}),s=e.Record({icrc1_minting_account:e.Opt(r),feature_flags:e.Opt(n)}),i=e.Record({e8s:e.Nat64}),o=e.Text,a=e.Record({secs:e.Nat64,nanos:e.Nat32}),c=e.Record({num_blocks_to_archive:e.Nat64,max_transactions_per_response:e.Opt(e.Nat64),trigger_threshold:e.Nat64,more_controller_ids:e.Opt(e.Vec(e.Principal)),max_message_size_bytes:e.Opt(e.Nat64),cycles_for_archive_creation:e.Opt(e.Nat64),node_max_memory_size_bytes:e.Opt(e.Nat64),controller_id:e.Principal}),u=e.Record({send_whitelist:e.Vec(e.Principal),token_symbol:e.Opt(e.Text),transfer_fee:e.Opt(i),minting_account:o,transaction_window:e.Opt(a),max_message_size_bytes:e.Opt(e.Nat64),icrc1_minting_account:e.Opt(r),archive_options:e.Opt(c),initial_values:e.Vec(e.Tuple(o,i)),token_name:e.Opt(e.Text),feature_flags:e.Opt(n)});e.Variant({Upgrade:e.Opt(s),Init:u});let f=e.Vec(e.Nat8),d=e.Record({account:f}),l=e.Record({account:o}),h=e.Record({canister_id:e.Principal}),y=e.Record({archives:e.Vec(h)}),g=e.Record({prev_spender_id:e.Opt(o),from_account_id:o,take:e.Opt(e.Nat64)}),_=e.Vec(e.Record({from_account_id:o,to_spender_id:o,allowance:i,expires_at:e.Opt(e.Nat64)})),m=e.Nat,b=e.Variant({Int:e.Int,Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text}),p=e.Nat64,E=e.Record({to:r,fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m}),v=e.Nat,N=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),I=e.Variant({Ok:v,Err:N}),R=e.Record({utc_offset_minutes:e.Opt(e.Int16),language:e.Text}),x=e.Record({metadata:R,device_spec:e.Opt(e.Variant({GenericDisplay:e.Null,FieldsDisplay:e.Null}))}),O=e.Record({arg:e.Vec(e.Nat8),method:e.Text,user_preferences:x}),B=e.Variant({Text:e.Record({content:e.Text}),TokenAmount:e.Record({decimals:e.Nat8,amount:e.Nat64,symbol:e.Text}),TimestampSeconds:e.Record({amount:e.Nat64}),DurationSeconds:e.Record({amount:e.Nat64})}),A=e.Record({fields:e.Vec(e.Tuple(e.Text,B)),intent:e.Text}),w=e.Variant({FieldsDisplayMessage:A,GenericDisplayMessage:e.Text}),T=e.Record({metadata:R,consent_message:w}),C=e.Record({description:e.Text}),F=e.Variant({GenericError:e.Record({description:e.Text,error_code:e.Nat}),InsufficientPayment:C,UnsupportedCanisterCall:C,ConsentMessageUnavailable:C}),$=e.Variant({Ok:T,Err:F}),S=e.Record({account:r,spender:r}),V=e.Record({allowance:m,expires_at:e.Opt(p)}),k=e.Record({fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m,expected_allowance:e.Opt(m),expires_at:e.Opt(p),spender:r}),U=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),AllowanceChanged:e.Record({current_allowance:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,Expired:e.Record({ledger_time:e.Nat64}),InsufficientFunds:e.Record({balance:m})}),P=e.Variant({Ok:v,Err:U}),se=e.Record({to:r,fee:e.Opt(m),spender_subaccount:e.Opt(t),from:r,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(p),amount:m}),te=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,InsufficientAllowance:e.Record({allowance:m}),BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:p}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),Z=e.Variant({Ok:v,Err:te}),z=e.Nat64,ie=e.Record({start:z,length:e.Nat64}),ge=e.Nat64,J=e.Record({timestamp_nanos:e.Nat64}),he=e.Variant({Approve:e.Record({fee:i,from:f,allowance_e8s:e.Int,allowance:i,expected_allowance:e.Opt(i),expires_at:e.Opt(J),spender:f}),Burn:e.Record({from:f,amount:i,spender:e.Opt(f)}),Mint:e.Record({to:f,amount:i}),Transfer:e.Record({to:f,fee:i,from:f,amount:i,spender:e.Opt(e.Vec(e.Nat8))})}),We=e.Record({memo:ge,icrc1_memo:e.Opt(e.Vec(e.Nat8)),operation:e.Opt(he),created_at_time:J}),mt=e.Record({transaction:We,timestamp:J,parent_hash:e.Opt(e.Vec(e.Nat8))}),yt=e.Record({blocks:e.Vec(mt)}),Pe=e.Variant({BadFirstBlockIndex:e.Record({requested_index:z,first_valid_index:z}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),tr=e.Variant({Ok:yt,Err:Pe}),rr=e.Func([ie],[tr],["query"]),nr=e.Record({callback:rr,start:z,length:e.Nat64}),sr=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(mt),chain_length:e.Nat64,first_block_index:z,archived_blocks:e.Vec(nr)}),gt=e.Record({callback:e.Func([ie],[e.Variant({Ok:e.Vec(e.Vec(e.Nat8)),Err:Pe})],["query"]),start:e.Nat64,length:e.Nat64}),ir=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(e.Vec(e.Nat8)),chain_length:e.Nat64,first_block_index:e.Nat64,archived_blocks:e.Vec(gt)}),or=e.Record({fee:e.Opt(m),from_subaccount:e.Opt(t),spender:f}),ar=e.Record({to:o,fee:i,memo:ge,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),cr=e.Record({certification:e.Opt(e.Vec(e.Nat8)),tip_index:z}),ur=e.Record({to:f,fee:i,memo:ge,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),lr=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:i}),TxDuplicate:e.Record({duplicate_of:z}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:i})}),dr=e.Variant({Ok:z,Err:lr}),fr=e.Record({}),hr=e.Record({transfer_fee:i});return e.Service({account_balance:e.Func([d],[i],["query"]),account_balance_dfx:e.Func([l],[i],["query"]),account_identifier:e.Func([r],[f],["query"]),archives:e.Func([],[y],["query"]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],["query"]),get_allowances:e.Func([g],[_],["query"]),icrc10_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],["query"]),icrc1_balance_of:e.Func([r],[m],["query"]),icrc1_decimals:e.Func([],[e.Nat8],["query"]),icrc1_fee:e.Func([],[m],["query"]),icrc1_metadata:e.Func([],[e.Vec(e.Tuple(e.Text,b))],["query"]),icrc1_minting_account:e.Func([],[e.Opt(r)],["query"]),icrc1_name:e.Func([],[e.Text],["query"]),icrc1_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],["query"]),icrc1_symbol:e.Func([],[e.Text],["query"]),icrc1_total_supply:e.Func([],[m],["query"]),icrc1_transfer:e.Func([E],[I],[]),icrc21_canister_call_consent_message:e.Func([O],[$],[]),icrc2_allowance:e.Func([S],[V],["query"]),icrc2_approve:e.Func([k],[P],[]),icrc2_transfer_from:e.Func([se],[Z],[]),is_ledger_ready:e.Func([],[e.Bool],["query"]),name:e.Func([],[e.Record({name:e.Text})],["query"]),query_blocks:e.Func([ie],[sr],["query"]),query_encoded_blocks:e.Func([ie],[ir],["query"]),remove_approval:e.Func([or],[P],[]),send_dfx:e.Func([ar],[z],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],["query"]),tip_of_chain:e.Func([],[cr],["query"]),transfer:e.Func([ur],[dr],[]),transfer_fee:e.Func([fr],[hr],["query"])})},kp=(e=>(e[e.FractionalMoreThan8Decimals=0]="FractionalMoreThan8Decimals",e[e.InvalidFormat=1]="InvalidFormat",e[e.FractionalTooManyDecimals=2]="FractionalTooManyDecimals",e))(kp||{});BigInt(1e8);var Ll=class{constructor(t,r,n){this.id=t,this.service=r,this.certifiedService=n}get canisterId(){return this.id}caller=({certified:t=!0})=>t?this.certifiedService:this.service},ss=e=>e==null,Nt=e=>!ss(e),Fp=()=>ut.createSync({host:"https://icp-api.io",identity:new Kr}),Ia=({options:{canisterId:e,serviceOverride:t,certifiedServiceOverride:r,agent:n,callTransform:s,queryTransform:i},idlFactory:o,certifiedIdlFactory:a})=>{let c=n??Fp(),u=t??Fn.createActor(o,{agent:c,canisterId:e,callTransform:s,queryTransform:i}),f=r??Fn.createActor(a,{agent:c,canisterId:e,callTransform:s,queryTransform:i});return{service:u,certifiedService:f,agent:c,canisterId:e}},Up=class extends Error{},Pp=(e,t)=>{if(e==null)throw new Up(t)},Dn=(e,t)=>{throw new Error(t)},ql=e=>new Uint8Array(e),Dp=e=>Array.from(e).map(t=>t.charCodeAt(0)),Ra=e=>{let t=e.match(/.{1,2}/g);return Pp(t,"Invalid hex string."),Uint8Array.from(t.map(r=>parseInt(r,16)))},vs=e=>(e instanceof Uint8Array||(e=Uint8Array.from(e)),e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),"")),Lc="abcdefghijklmnopqrstuvwxyz234567",Mn=Object.create(null);for(let e=0;e<Lc.length;e++)Mn[Lc[e]]=e;Mn[0]=Mn.o;Mn[1]=Mn.i;var Mp=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),$p=e=>{let t=-1;for(let r=0;r<e.length;r++){let n=(e[r]^t)&255;t=Mp[n]^t>>>8}return(t^-1)>>>0},qc=e=>{let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,$p(e),!1),new Uint8Array(t)},Lp="__bigint__",qp="__principal__",jp="__uint8array__",Kp=(e,t)=>typeof t=="bigint"?{[Lp]:`${t}`}:Nt(t)&&D.isPrincipal(t)?{[qp]:D.from(t).toText()}:Nt(t)&&t instanceof Uint8Array?{[jp]:Array.from(t)}:t,q=e=>Nt(e)?[e]:[],Po=e=>e?.[0],Gp=(e=>(e[e.Controllers=0]="Controllers",e[e.Public=1]="Public",e))(Gp||{}),Hp=class extends Error{},po=({controllers:e,freezingThreshold:t,memoryAllocation:r,computeAllocation:n,reservedCyclesLimit:s,logVisibility:i,wasmMemoryLimit:o,wasmMemoryThreshold:a,environmentVariables:c}={})=>{let u=()=>{switch(i){case 0:return{controllers:null};case 1:return{public:null};default:throw new Hp}};return{controllers:q(e?.map(f=>D.fromText(f))),freezing_threshold:q(t),memory_allocation:q(r),compute_allocation:q(n),reserved_cycles_limit:q(s),log_visibility:ss(i)?[]:[u()],wasm_memory_limit:q(o),wasm_memory_threshold:q(a),environment_variables:q(c)}},zp=e=>Ra(e),jl=e=>typeof e=="string"?zp(e):e,mn=({canisterId:e,snapshotId:t})=>({canister_id:e,snapshot_id:jl(t)}),jc=({canisterId:e,snapshotId:t})=>({canister_id:e,replace_snapshot:q(Nt(t)?jl(t):void 0)}),Zp=e=>{if("wasmModule"in e)return{wasm_module:e.wasmModule};if("wasmMemory"in e)return{wasm_memory:e.wasmMemory};if("stableMemory"in e)return{stable_memory:e.stableMemory};if("wasmChunk"in e)return{wasm_chunk:e.wasmChunk};Dn(e,"Unsupported snapshot metadata kind")},Yp=({globals:e,certifiedData:t,globalTimer:r,onLowWasmMemoryHookStatus:n,wasmModuleSize:s,stableMemorySize:i,wasmMemorySize:o})=>{let a=()=>ss(n)?q():"conditionNotSatisfied"in n?q({condition_not_satisfied:n.conditionNotSatisfied}):q(n);return{globals:e,certified_data:t,global_timer:q(r),on_low_wasm_memory_hook_status:a(),wasm_module_size:s,stable_memory_size:i,wasm_memory_size:o}},Wp=e=>{if("wasmModule"in e)return{wasm_module:e.wasmModule};if("wasmMemory"in e)return{wasm_memory:e.wasmMemory};if("stableMemory"in e)return{stable_memory:e.stableMemory};if("wasmChunk"in e)return{wasm_chunk:null};Dn(e,"Unsupported snapshot data kind")},Xp=({globals:e,canister_version:t,source:r,certified_data:n,global_timer:s,on_low_wasm_memory_hook_status:i,wasm_module_size:o,stable_memory_size:a,wasm_chunk_store:c,taken_at_timestamp:u,wasm_memory_size:f})=>{let d=()=>{if("metadata_upload"in r)return{metadataUpload:r.metadata_upload};if("taken_from_canister"in r)return{takenFromCanister:r.taken_from_canister};Dn(r,"Unsupported snapshot metadata source")},l=()=>{let h=Po(i);if(!ss(h)){if("condition_not_satisfied"in h)return{conditionNotSatisfied:h.condition_not_satisfied};if("executed"in h)return{executed:h.executed};if("ready"in h)return{ready:h.ready};Dn(h,"Unsupported snapshot metadata on_low_wasm_memory_hook_status")}};return{globals:e,canisterVersion:t,source:d(),certifiedData:n,globalTimer:Po(s),onLowWasmMemoryHookStatus:l(),wasmModuleSize:o,stableMemorySize:a,wasmChunkStore:c,takenAtTimestamp:u,wasmMemorySize:f}},Kc=(e,t,r)=>{let[n]=t;if(Nt(n)&&typeof n=="object"){if(e==="install_chunked_code"&&Nt(n.target_canister))return{effectiveCanisterId:D.from(n.target_canister)};if(e==="provisional_create_canister_with_cycles"&&Nt(n.specified_id)){let s=Po(n.specified_id);if(Nt(s))return{effectiveCanisterId:D.from(s)}}if(Nt(n.canister_id))return{effectiveCanisterId:D.from(n.canister_id)}}return{effectiveCanisterId:D.fromHex("")}},Kl=class Gl{constructor(t,r){this.service=t,this.certifiedService=r}caller=({certified:t=!0})=>t?this.certifiedService:this.service;static create(t){let{service:r,certifiedService:n}=Ia({options:{...t,canisterId:D.fromHex(""),callTransform:Kc,queryTransform:Kc},idlFactory:Cp,certifiedIdlFactory:Ap});return new Gl(r,n)}createCanister=async({settings:t,senderCanisterVersion:r}={})=>{let{create_canister:n}=this.certifiedService,{canister_id:s}=await n({settings:q(po(t)),sender_canister_version:q(r)});return s};updateSettings=({canisterId:t,senderCanisterVersion:r,settings:n})=>{let{update_settings:s}=this.certifiedService;return s({canister_id:t,sender_canister_version:q(r),settings:po(n)})};installCode=({canisterId:t,wasmModule:r,senderCanisterVersion:n,...s})=>{let{install_code:i}=this.certifiedService;return i({...s,canister_id:t,wasm_module:r,sender_canister_version:q(n)})};uploadChunk=({canisterId:t,...r})=>{let{upload_chunk:n}=this.certifiedService;return n({canister_id:t,...r})};clearChunkStore=async({canisterId:t})=>{let{clear_chunk_store:r}=this.certifiedService;await r({canister_id:t})};storedChunks=({canisterId:t})=>{let{stored_chunks:r}=this.certifiedService;return r({canister_id:t})};installChunkedCode=async({senderCanisterVersion:t,chunkHashesList:r,targetCanisterId:n,storeCanisterId:s,wasmModuleHash:i,...o})=>{let{install_chunked_code:a}=this.certifiedService;await a({...o,target_canister:n,store_canister:q(s),sender_canister_version:q(t),chunk_hashes_list:r,wasm_module_hash:typeof i=="string"?Ra(i):i})};uninstallCode=({canisterId:t,senderCanisterVersion:r})=>{let{uninstall_code:n}=this.certifiedService;return n({canister_id:t,sender_canister_version:q(r)})};startCanister=t=>{let{start_canister:r}=this.certifiedService;return r({canister_id:t})};stopCanister=t=>{let{stop_canister:r}=this.certifiedService;return r({canister_id:t})};canisterStatus=({canisterId:t,certified:r})=>{let{canister_status:n}=this.caller({certified:r});return n({canister_id:t})};deleteCanister=t=>{let{delete_canister:r}=this.certifiedService;return r({canister_id:t})};provisionalCreateCanisterWithCycles=async({settings:t,amount:r,canisterId:n}={})=>{let{provisional_create_canister_with_cycles:s}=this.certifiedService,{canister_id:i}=await s({settings:q(po(t)),amount:q(r),specified_id:q(n),sender_canister_version:[]});return i};fetchCanisterLogs=t=>{let{fetch_canister_logs:r}=this.caller({certified:!1});return r({canister_id:t})};takeCanisterSnapshot=({senderCanisterVersion:t,uninstallCode:r,...n})=>{let{take_canister_snapshot:s}=this.certifiedService;return s({...jc(n),sender_canister_version:q(t),uninstall_code:q(r)})};listCanisterSnapshots=({canisterId:t})=>{let{list_canister_snapshots:r}=this.certifiedService;return r({canister_id:t})};loadCanisterSnapshot=async({senderCanisterVersion:t,...r})=>{let{load_canister_snapshot:n}=this.certifiedService;await n({...mn(r),sender_canister_version:q(t)})};deleteCanisterSnapshot=async t=>{let{delete_canister_snapshot:r}=this.certifiedService;await r(mn(t))};readCanisterSnapshotMetadata=async t=>{let{read_canister_snapshot_metadata:r}=this.certifiedService,n=await r(mn(t));return Xp(n)};readCanisterSnapshotData=({kind:t,...r})=>{let{read_canister_snapshot_data:n}=this.certifiedService;return n({...mn(r),kind:Zp(t)})};uploadCanisterSnapshotMetadata=({metadata:t,...r})=>{let{upload_canister_snapshot_metadata:n}=this.certifiedService;return n({...Yp(t),...jc(r)})};uploadCanisterSnapshotData=async({kind:t,chunk:r,...n})=>{let{upload_canister_snapshot_data:s}=this.certifiedService;await s({...mn(n),chunk:r,kind:Wp(t)})}};const Jp=1000000000000n,Qp=({IDL:e})=>{const t=e.Record({url:e.Text,method:e.Text,body:e.Vec(e.Nat8),headers:e.Vec(e.Tuple(e.Text,e.Text))}),r=e.Record({body:e.Vec(e.Nat8),headers:e.Vec(e.Tuple(e.Text,e.Text)),status_code:e.Nat16}),n=e.Variant({Add:e.Text,Remove:e.Text}),s=e.Variant({Ok:e.Null,Err:e.Text}),i=e.Variant({Get:e.Null,Set:e.Principal}),o=e.Variant({Ok:e.Principal,Err:e.Text}),a=e.Variant({Hourly:e.Null,Weekly:e.Null,Daily:e.Null,Monthly:e.Null}),c=e.Variant({_1T:e.Null,_2T:e.Null,_5T:e.Null,_10T:e.Null,_50T:e.Null,_0_5T:e.Null,_100T:e.Null,_0_25T:e.Null}),u=e.Record({interval:a,cycles_amount:c,cycles_threshold:c}),f=e.Variant({Add:u,Get:e.Null,Clear:e.Null}),d=e.Variant({Ok:e.Opt(u),Err:e.Text}),l=e.Record({memo:e.Opt(e.Text),name:e.Text,version:e.Nat16});return e.Service({http_request:e.Func([t],[r],["query"]),manage_alternative_origins:e.Func([n],[s],[]),manage_ii_principal:e.Func([i],[o],[]),manage_top_up_rule:e.Func([f],[d],[]),wasm_status:e.Func([],[l],["query"])})};function Hl(e){if(e.canisterId==="")throw new Error("canisterId is required");return Fn.createActor(Qp,{agent:e.agent,canisterId:e.canisterId})}let em=class zl{actor;constructor(t){this.actor=t}static create(t){const r=Hl(t);return new zl(r)}async httpRequest(t){return await this.actor.http_request(t)}async manageAlternativeOrigins(t){return await this.actor.manage_alternative_origins(t)}async manageIIPrincipal(t){return await this.actor.manage_ii_principal(t)}async wasmStatus(){return await this.actor.wasm_status()}async manageTopUpRule(t){return await this.actor.manage_top_up_rule(t)}},tm=class Zl{constructor(t,r){this.agent=t,this.canisterId=r,this.icManagement=Kl.create({agent:this.agent})}icManagement;static create(t,r){return new Zl(t,r)}async checkCyclesBalance(t){try{const r=t?.threshold??Jp,n=(await this.icManagement.canisterStatus({canisterId:this.canisterId})).cycles;return n<r?{error:`Low cycles warning: ${n.toString()} cycles remaining (threshold: ${r.toString()})`}:{ok:n}}catch(r){return{error:String(r)}}}async isAuthenticated(){try{return"Ok"in await em.create({agent:this.agent,canisterId:this.canisterId}).manageIIPrincipal({Get:null})}catch{return!1}}};function rm(){const e=window.location.hostname,t=window.location.protocol,r=/^([a-z0-9-]+)\.localhost$/.exec(e);if(r?.[1]!=null){if(t!=="http:")throw new Error(`Invalid protocol for localhost: ${t}. Only http: is allowed for localhost.`);return D.fromText(r[1])}const n=/^([a-z0-9-]+)\.icp0\.io$/.exec(e);if(n?.[1]!=null){if(t!=="https:")throw new Error(`Invalid protocol for production: ${t}. Only https: is allowed for icp0.io.`);return D.fromText(n[1])}throw new Error(`Could not infer canister ID from hostname: ${e}`)}const nm=BigInt(15)*BigInt(60)*BigInt(1e9),Yl="rkp4c-7iaaa-aaaaa-aaaca-cai",mo=BigInt(1e4),sm=1e8,im=new Uint8Array([84,80,85,80,0,0,0,0]),om={host:"http://localhost:8080",identityProvider:"http://uxrrr-q7777-77774-qaaaq-cai.localhost:8080"},am={host:"https://icp-api.io",identityProvider:"https://identity.internetcomputer.org"};var Gc={host:"http://localhost:8080",identityProvider:"http://uxrrr-q7777-77774-qaaaq-cai.localhost:8080"},Hc={host:"https://icp-api.io",identityProvider:"https://identity.internetcomputer.org"};let yo=null,hs=null;function Wl(){if(typeof window>"u"||!window.location)return!1;const e=window.location.origin.toLowerCase();return e.startsWith("http://")||e.includes("localhost")||e.includes("127.0.0.1")}function cm(){if(yo!==null)return yo;const t=Wl()?typeof Gc<"u"?Gc:om:typeof Hc<"u"?Hc:am;return yo=t,t}function um(){return hs!==null||(hs=Wl()),hs}function lm(){try{return rm()}catch{return D.fromText("22ajg-aqaaa-aaaap-adukq-cai")}}function Se(e){const t=document.getElementById(e);return t||(console.error(`Element with id '${e}' not found`),document.createElement("div"))}function Ht(e,t){const r=Se(e);r.textContent=t}function nt(e,t){const r=Se(e);t?r.classList.remove("hidden"):r.classList.add("hidden")}const ps=new WeakMap;function Bt(e,t,r){const n=Se(e),i=ps.get(n)?.get(t);i&&n.removeEventListener(t,i);const o=async()=>{try{await r()}catch(c){console.error(`Unhandled error in '${t}' handler for #${e}:`,c),we(gm)}};n.addEventListener(t,o);const a=ps.get(n)??new Map;a.set(t,o),ps.has(n)||ps.set(n,a)}function dm(e,t){const r=Se("logout-btn");r.onclick=async()=>{try{await t()}catch{we(Jl)}},nt("auth-logged-out",!1),nt("auth-logged-in",!0),Ht("ii-principal",e),nt("authenticated-content",!0)}function fm(e){const t=Se("auth-btn");t.onclick=async()=>await e(),nt("auth-logged-out",!0),nt("auth-logged-in",!1),Ht("ii-principal",""),nt("authenticated-content",!1),nt("loading-overlay",!1)}function zc(e,t,r,n){Ht("status-value",e),Ht("memory-size-value",t),Ht("cycles-value",r),Ht("module-hash-value",n)}function hm(e){Ht("balance-value",e)}function pm(e){Ht("icrc1-account",e)}function qe(){nt("loading-overlay",!0)}function je(){nt("loading-overlay",!1)}function we(e){const t=Se("error-section"),r=document.createElement("div");r.className="error-message",r.textContent=e,t.appendChild(r),nt("error-section",!0)}function Zc(){const e=Se("error-section");e.innerHTML="",nt("error-section",!1)}function Ks(e){return Se(e).value.trim()}function Je(e){const t=Se(e);t.value=""}function mm(e,t){const r=Se("canister-id");r.textContent=e;const n=Se("canister-icp-balance");n.textContent=t}function ym(e){const t=Se("top-up-rule-display");if(t.textContent="",!e){t.textContent="No rule set";return}const r=document.createElement("pre");r.textContent=e,t.appendChild(r)}function go(e){return Se(e).value}function Xl(e){const t=document.createElement("li");t.className="copyable";const r=document.createElement("div");r.className="data-display",r.textContent=e;const n=document.createElement("button");return n.type="button",n.className="copy-btn",n.setAttribute("aria-label","Copy to clipboard"),n.dataset.copyText=e,n.innerHTML=`
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
      <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"/>
    </svg>
  `,t.appendChild(r),t.appendChild(n),t}const ce="Network error occurred. Please try again.",gm="Something went wrong. Please try again.",_m="Failed to initialize dashboard.",Yc="Invalid principal format.",bm="URL must start with 'http://localhost:', 'http://*.localhost:', or 'https://'",wm="Please select threshold and amount.",Wc="Unable to determine canister ID.",xm="Failed to create HTTP agent.",Em="You are not authorized to access this application.",Jl="Logout failed. Please try again.",ms="Auth manager not initialized",vm="User is not authenticated",Nm="Failed to add alternative origin",Tm="Unknown error adding alternative origin",Im="Failed to remove alternative origin",Rm="Unknown error removing alternative origin",Om="Insufficient balance for this operation.",Xc="TopUpRule Error:",Jc="TopUpError:",Sm="Controller already exists.",Am="Controller not found.",Qc="Cannot remove required controllers.";function H(e,t){t?console.error(e,t):console.error(e);try{we(e)}catch{}}function Ql(){return cm()}function pt(){try{return lm()}catch(e){throw H(Wc,e),new Error(Wc)}}async function nn(){try{const e=await Pn.create({idleOptions:{disableIdle:!0}}),t=Ql(),r=e.getIdentity(),n=await ut.create({identity:r,host:t.host});return um()&&await n.fetchRootKey(),n}catch(e){throw H(xm,e),e}}function eu(e){try{return D.fromText(e),!0}catch{return!1}}function Cm(e){try{const t=new URL(e),r=t.protocol==="https:",n=t.protocol==="http:"&&(t.hostname==="localhost"||t.hostname.endsWith(".localhost"))&&/:\d+$/.test(t.host);return r||n}catch{return!1}}class li{authClient=null;constructor(){}static async create(){const t=new li;return t.authClient=await Pn.create({idleOptions:{disableIdle:!0}}),t}async ensureAuthClient(){return this.authClient||(this.authClient=await Pn.create({idleOptions:{disableIdle:!0}})),this.authClient}async isIIPrincipal(){try{if(!this.authClient||!await this.authClient.isAuthenticated())return!1;const t=await nn(),r=pt();return await tm.create(t,r).isAuthenticated()}catch(t){return console.warn("Failed to check II principal authorization:",t),!1}}async login(){const t=await this.ensureAuthClient();if(await t.isAuthenticated()){if(await this.isIIPrincipal())return;await t.logout(),this.authClient=null}const n=Ql(),s=await this.ensureAuthClient();if(await new Promise((o,a)=>{s.login({identityProvider:n.identityProvider,maxTimeToLive:nm,onSuccess:()=>{o()},onError:c=>{a(c)}})}),!await this.isIIPrincipal()){we(Em),await(await this.ensureAuthClient()).logout(),this.authClient=null;return}}async logout(){await(await this.ensureAuthClient()).logout(),this.authClient=null}async isAuthenticated(){return await(await this.ensureAuthClient()).isAuthenticated()?await this.isIIPrincipal():!1}async getPrincipal(){const t=await this.ensureAuthClient();return await t.isAuthenticated()||H(vm),t.getIdentity().getPrincipal()}}class Gs{async managmentApi(){const t=await nn();return Kl.create({agent:t})}async getCanisterStatus(){try{const t=await this.managmentApi(),r=pt();return await t.canisterStatus({canisterId:r})}catch(t){throw H(ce,t),t}}async updateControllers(t){try{const r=await this.managmentApi(),n=pt();await r.updateSettings({canisterId:n,settings:{controllers:t.map(s=>s.toString())}})}catch(r){throw H(ce,r),r}}async getCanisterLogs(){try{const t=await this.managmentApi(),r=pt();return await t.fetchCanisterLogs(r)}catch(t){throw H(ce,t),t}}}function Bm(){let e=null,t=null;const r=async()=>new Gs().getCanisterStatus(),n=async()=>(t||(t=r().then(i=>(e=i,i)).finally(()=>{t=null})),t);return{getStatus:async()=>e||t||n(),refresh:n}}const xn=Bm();function Vm(e){const t=e.toUint8Array(),r=new Uint8Array(32);return r[0]=t.length,r.set(t,1),r}function km(e){return e<0?"0.00 MB":`${(Number(e)/(1024*1024)).toFixed(2)} MB`}function Fm(e){return e<0?"0.00 T":`${(Number(e)/1e12).toFixed(2)} T`}function ed(e){return e<0?"0.00000000":(Number(e)/sm).toFixed(8)}class $n{constructor(){}static async create(){const t=new $n;try{const r=await xn.getStatus(),{statusText:n,memorySizeFormatted:s,cyclesFormatted:i,moduleHashHex:o}=t.formatStatusData(r);zc(n,s,i,o)}catch(r){H(ce,r)}return t}static async refresh(){try{const t=await xn.refresh(),r=new $n,{statusText:n,memorySizeFormatted:s,cyclesFormatted:i,moduleHashHex:o}=r.formatStatusData(t);zc(n,s,i,o)}catch(t){H(ce,t)}}formatStatusData(t){const r="running"in t.status?"Running":"stopped"in t.status?"Stopped":"stopping"in t.status?"Stopping":"Unknown",n=km(t.memory_size),s=Fm(t.cycles),i=t.module_hash.length>0?vs(t.module_hash[0]):"N/A";return{statusText:r,memorySizeFormatted:n,cyclesFormatted:s,moduleHashHex:i}}}function Um(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Oa(e,...t){if(!Um(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function tu(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Pm(e,t){Oa(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Do(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _o(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ot(e,t){return e<<32-t|e>>>t}function Dm(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function td(e){return typeof e=="string"&&(e=Dm(e)),Oa(e),e}var Mm=class{};function rd(e){let t=n=>e().update(td(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function $m(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}function Lm(e,t,r){return e&t^~e&r}function qm(e,t,r){return e&t^e&r^t&r}var jm=class extends Mm{constructor(t,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(t),this.view=_o(this.buffer)}update(t){tu(this),t=td(t),Oa(t);let{view:r,buffer:n,blockLen:s}=this,i=t.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=_o(t);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){tu(this),Pm(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;r[o++]=128,Do(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let d=o;d<s;d++)r[d]=0;$m(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=_o(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,f[d],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=i,t.length=s,t.pos=a,s%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Mt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),$t=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),Km=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lt=new Uint32Array(64),nd=class extends jm{constructor(t=32){super(64,t,8,!1),this.A=Mt[0]|0,this.B=Mt[1]|0,this.C=Mt[2]|0,this.D=Mt[3]|0,this.E=Mt[4]|0,this.F=Mt[5]|0,this.G=Mt[6]|0,this.H=Mt[7]|0}get(){let{A:t,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[t,r,n,s,i,o,a,c]}set(t,r,n,s,i,o,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,r){for(let d=0;d<16;d++,r+=4)Lt[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){let l=Lt[d-15],h=Lt[d-2],y=ot(l,7)^ot(l,18)^l>>>3,g=ot(h,17)^ot(h,19)^h>>>10;Lt[d]=g+Lt[d-7]+y+Lt[d-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:u,H:f}=this;for(let d=0;d<64;d++){let l=ot(a,6)^ot(a,11)^ot(a,25),h=f+l+Lm(a,c,u)+Km[d]+Lt[d]|0,y=(ot(n,2)^ot(n,13)^ot(n,22))+qm(n,s,i)|0;f=u,u=c,c=a,a=o+h|0,o=i,i=s,s=n,n=h+y|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,s,i,o,a,c,u,f)}roundClean(){Do(Lt)}destroy(){this.set(0,0,0,0,0,0,0,0),Do(this.buffer)}},Gm=class extends nd{constructor(){super(28),this.A=$t[0]|0,this.B=$t[1]|0,this.C=$t[2]|0,this.D=$t[3]|0,this.E=$t[4]|0,this.F=$t[5]|0,this.G=$t[6]|0,this.H=$t[7]|0}};rd(()=>new nd);var Hm=rd(()=>new Gm);var Hs=class Mo{constructor(t){this.bytes=t}static fromHex(t){let r=Ra(t);if(r.length!==32)throw new Error(`Invalid AccountIdentifier: expected 32 bytes, got ${r.length}.`);let n=vs(r.slice(0,4)),s=r.slice(4),i=vs(qc(s));if(n!==i)throw Error(`Checksum mismatch. Expected ${i}, but got ${n}.`);return new Mo(r)}static fromPrincipal({principal:t,subAccount:r=zm.fromID(0)}){let n=Dp(`
account-id`),s=Hm.create();s.update(ql([...n,...t.toUint8Array(),...r.toUint8Array()]));let i=s.digest(),o=qc(i),a=new Uint8Array([...o,...i]);return new Mo(a)}toHex(){return vs(this.bytes)}toUint8Array(){return this.bytes}toNumbers(){return Array.from(this.bytes)}toAccountIdentifierHash(){return{hash:this.toUint8Array()}}},zm=class Ns{constructor(t){this.bytes=t}static fromBytes(t){if(t.length!==32)throw new Error("Subaccount length must be 32-bytes");return new Ns(t)}static fromPrincipal(t){let r=new Uint8Array(32).fill(0),n=t.toUint8Array();r[0]=n.length;for(let s=0;s<n.length;s++)r[1+s]=n[s];return new Ns(r)}static fromID(t){if(t<0)throw new Error("Number cannot be negative");if(t>Number.MAX_SAFE_INTEGER)throw new Error("Number is too large to fit in 32 bytes.");let r=new DataView(new ArrayBuffer(32));if(typeof r.setBigUint64=="function")r.setBigUint64(24,BigInt(t));else{let s=BigInt(1)<<BigInt(32);r.setUint32(24,Number(BigInt(t)>>BigInt(32))),r.setUint32(28,Number(BigInt(t)%s))}let n=new Uint8Array(r.buffer);return new Ns(n)}toUint8Array(){return this.bytes}};BigInt(1095062083);BigInt(1347768404);var Sa=BigInt(1e4);BigInt(1e8);var ru=e=>({e8s:e}),Zm=({to:e,amount:t,memo:r,fee:n,fromSubAccount:s,createdAt:i})=>({to:e.toUint8Array(),fee:ru(n??Sa),amount:ru(t),memo:r??BigInt(0),created_at_time:i!==void 0?[{timestamp_nanos:i}]:[],from_subaccount:s===void 0?[]:[ql(s)]}),Ym=({fromSubAccount:e,to:t,amount:r,fee:n,icrc1Memo:s,createdAt:i})=>({to:t,fee:q(n??Sa),amount:r,memo:q(s),created_at_time:q(i),from_subaccount:q(e)}),Wm=({fee:e,createdAt:t,icrc1Memo:r,fromSubAccount:n,expected_allowance:s,expires_at:i,amount:o,...a})=>({...a,fee:q(e??Sa),memo:q(r),from_subaccount:q(n),created_at_time:q(t),amount:o,expected_allowance:q(s),expires_at:q(i)}),Xm=({userPreferences:{metadata:{utcOffsetMinutes:e,language:t},deriveSpec:r},...n})=>({...n,user_preferences:{metadata:{language:t,utc_offset_minutes:q(e)},device_spec:ss(r)?q():q("GenericDisplay"in r?{GenericDisplay:null}:{FieldsDisplay:null})}}),di=class extends Error{},un=class extends di{},er=class extends di{},fi=class extends di{},Aa=class extends un{constructor(e){super(),this.balance=e}},sd=class extends un{constructor(e){super(),this.allowed_window_secs=e}},id=class extends un{},od=class extends un{constructor(e){super(),this.duplicateOf=e}},Ca=class extends di{constructor(e){super(),this.expectedFee=e}},ad=class extends er{constructor(e,t){super(),this.message=e,this.error_code=t}},Jm=class extends er{},Qm=class extends er{constructor(e){super(),this.duplicateOf=e}},ey=class extends er{constructor(e){super(),this.currentAllowance=e}},ty=class extends er{},ry=class extends er{},ny=class extends er{constructor(e){super(),this.ledgerTime=e}},sy=class extends fi{},iy=class extends fi{},oy=class extends fi{},ay=e=>"TxDuplicate"in e?new od(e.TxDuplicate.duplicate_of):"InsufficientFunds"in e?new Aa(e.InsufficientFunds.balance.e8s):"TxCreatedInFuture"in e?new id:"TxTooOld"in e?new sd(Number(e.TxTooOld.allowed_window_nanos)):"BadFee"in e?new Ca(e.BadFee.expected_fee.e8s):new un(`Unknown error type ${JSON.stringify(e)}`),cy=e=>"Duplicate"in e?new od(e.Duplicate.duplicate_of):"InsufficientFunds"in e?new Aa(e.InsufficientFunds.balance):"CreatedInFuture"in e?new id:"TooOld"in e?new sd:"BadFee"in e?new Ca(e.BadFee.expected_fee):new un(`Unknown error type ${JSON.stringify(e)}`),uy=e=>"GenericError"in e?new ad(e.GenericError.message,e.GenericError.error_code):"TemporarilyUnavailable"in e?new Jm:"Duplicate"in e?new Qm(e.Duplicate.duplicate_of):"BadFee"in e?new Ca(e.BadFee.expected_fee):"AllowanceChanged"in e?new ey(e.AllowanceChanged.current_allowance):"CreatedInFuture"in e?new ty:"TooOld"in e?new ry:"Expired"in e?new ny(e.Expired.ledger_time):"InsufficientFunds"in e?new Aa(e.InsufficientFunds.balance):new er(`Unknown error type ${JSON.stringify(e)}`),ly=e=>"GenericError"in e?new ad(e.GenericError.description,e.GenericError.error_code):"InsufficientPayment"in e?new sy(e.InsufficientPayment.description):"UnsupportedCanisterCall"in e?new iy(e.UnsupportedCanisterCall.description):"ConsentMessageUnavailable"in e?new oy(e.ConsentMessageUnavailable.description):new fi(`Unknown error type ${JSON.stringify(e)}`),dy=D.fromText("ryjl3-tyaaa-aaaaa-aaaba-cai");D.fromText("qhbym-qaaaa-aaaaa-aaafq-cai");var fy=e=>e instanceof Hs?e:Hs.fromHex(e),hy=class cd extends Ll{static create(t={}){let r=t.canisterId??dy,{service:n,certifiedService:s}=Ia({options:{...t,canisterId:r},idlFactory:Vp,certifiedIdlFactory:Bp});return new cd(r,n,s)}accountBalance=async({accountIdentifier:t,certified:r=!0})=>{let n=fy(t);return(await(r?this.certifiedService:this.service).account_balance({account:n.toUint8Array()})).e8s};metadata=t=>{let{icrc1_metadata:r}=this.caller(t);return r()};transactionFee=async(t={certified:!1})=>{let{transfer_fee:r}=this.caller(t),{transfer_fee:{e8s:n}}=await r({});return n};transfer=async t=>{let r=Zm(t),n=await this.certifiedService.transfer(r);if("Err"in n)throw ay(n.Err);return n.Ok};icrc1Transfer=async t=>{let r=Ym(t),n=await this.certifiedService.icrc1_transfer(r);if("Err"in n)throw cy(n.Err);return n.Ok};icrc2Approve=async t=>{let{icrc2_approve:r}=this.caller({certified:!0}),n=await r(Wm(t));if("Err"in n)throw uy(n.Err);return n.Ok};icrc21ConsentMessage=async t=>{let{icrc21_canister_call_consent_message:r}=this.caller({certified:!0}),n=await r(Xm(t));if("Err"in n)throw ly(n.Err);return n.Ok}};class gn{async ledgerApi(){const t=await nn();return hy.create({agent:t})}async balance(){try{const r=await(await nn()).getPrincipal(),n=Hs.fromPrincipal({principal:r});return await(await this.ledgerApi()).accountBalance({accountIdentifier:n})}catch(t){throw H(ce,t),t}}async canisterBalance(){try{const t=pt(),r=Hs.fromPrincipal({principal:t});return await(await this.ledgerApi()).accountBalance({accountIdentifier:r})}catch(t){throw H(ce,t),t}}async transfer(t,r,n,s,i){try{return await(await this.ledgerApi()).icrc1Transfer({to:{owner:t,subaccount:[r]},amount:n,icrc1Memo:s,fee:i})}catch(o){throw H(ce,o),o}}}var py=class extends Error{},my=class extends Error{},yy=class extends Error{},gy=class extends Error{},_y=class extends Error{},bo=({Err:e})=>{if("Refunded"in e)throw new py(e.Refunded.reason);if("InvalidTransaction"in e)throw new my(e.InvalidTransaction);if("Processing"in e)throw new gy;if("TransactionTooOld"in e)throw new _y;if("Other"in e)throw new yy(`Error in CMC with code ${e.Other.error_code}: ${e.Other.error_message}`);Dn(e,`Unsupported error type ${JSON.stringify(e,Kp)}`)},by=class ud extends Ll{static create(t){let{service:r,certifiedService:n,canisterId:s}=Ia({options:t,idlFactory:Sp,certifiedIdlFactory:Op});return new ud(s,r,n)}getIcpToCyclesConversionRate=async({certified:t}={})=>{let{data:r}=await this.caller({certified:t}).get_icp_xdr_conversion_rate();return r.xdr_permyriad_per_icp};notifyCreateCanister=async t=>{let{notify_create_canister:r}=this.service,n=await r(t);if("Err"in n&&bo(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyCreateCanister ${JSON.stringify(n)}`)};notifyTopUp=async t=>{let{notify_top_up:r}=this.service,n=await r(t);if("Err"in n&&bo(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyTopUp ${JSON.stringify(n)}`)};notifyMintCycles=async t=>{let{notify_mint_cycles:r}=this.service,n=await r(t);if("Err"in n&&bo(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyMintCycles ${JSON.stringify(n)}`)};getDefaultSubnets=({certified:t}={})=>{let{get_default_subnets:r}=this.caller({certified:t});return r()};getSubnetTypesToSubnets=({certified:t}={})=>{let{get_subnet_types_to_subnets:r}=this.caller({certified:t});return r()}};class wy{async cmcApi(){const t=await nn();return by.create({agent:t,canisterId:D.fromText(Yl)})}async notifyTopUp(t,r){try{return await(await this.cmcApi()).notifyTopUp({canister_id:D.fromText(t),block_index:r})}catch(n){throw H(ce,n),n}}}class Ba{constructor(){}static async create(){const t=new Ba;return await t.fetchAndRenderBalance(),t.attachEventListeners(),t}async fetchAndRenderBalance(){const r=await new gn().balance(),n=ed(r);hm(n);const i=await(await li.create()).getPrincipal();pm(i.toText())}attachEventListeners(){Bt("top-up-btn","click",()=>this.performTopUp()),Bt("refresh-balance-btn","click",()=>this.refreshBalance())}async refreshBalance(){qe();try{await this.fetchAndRenderBalance()}catch(t){H(ce,t)}finally{je()}}async performTopUp(){qe();try{if(!await this.checkBalanceForTopUp()){we(Om);return}const s=await new gn().balance()-mo,i=await this.transferToCMC(s),o=new wy,c=pt().toString();await o.notifyTopUp(c,i),await this.updateBalanceAndStatus()}catch(t){H(ce,t)}finally{je()}}async updateBalanceAndStatus(){await $n.refresh(),await this.fetchAndRenderBalance()}async checkBalanceForTopUp(){const r=await new gn().balance(),n=mo*2n;return r>=n}async transferToCMC(t){const r=new gn,n=pt(),s=Vm(n),i=D.fromText(Yl);return await r.transfer(i,s,t,im,mo)}}function xy(){document.querySelectorAll(".copy-btn").forEach(e=>{e.addEventListener("click",ld)})}async function ld(e){const t=e.currentTarget,r=t.dataset.copyTarget;let s=t.dataset.copyText??"";if(!s&&r){const i=document.getElementById(r);if(!i)return;s=i.textContent?.trim()??""}if(!(!s||s==="Loading..."))try{await navigator.clipboard.writeText(s),Ey(t)}catch(i){console.error("Failed to copy to clipboard:",i)}}function Ey(e){e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1500)}function dd(e){e.addEventListener("click",ld)}class Va{canisterId;iiPrincipal;controllersList=[];constructor(t,r){this.canisterId=t,this.iiPrincipal=r}static async create(t,r){const n=new Va(t,r),s=await xn.getStatus();return n.controllersList=s.settings.controllers,n.renderControllersContent(),n.attachEventListeners(),n}renderControllersContent(){const t=Se("controllers-list");t.textContent="";for(const r of this.controllersList){const n=Xl(r.toString()),s=n.querySelector(".copy-btn");s&&dd(s),t.appendChild(n)}}attachEventListeners(){Bt("controller-add","click",()=>this.handleAdd()),Bt("controller-remove","click",()=>this.handleRemove())}async handleAdd(){const t=Ks("controller-input");if(!t)return;if(!eu(t)){we(Yc),Je("controller-input");return}const r=D.fromText(t),n=[...this.controllersList,r],s=n.map(o=>o.toString());if(s.length!==new Set(s).size){we(Sm),Je("controller-input");return}if(!this.hasRequiredPrincipals(n)){we(Qc),Je("controller-input");return}qe();try{await new Gs().updateControllers(n),await xn.refresh(),this.controllersList=n,Je("controller-input"),this.renderControllersContent()}catch(o){H(ce,o)}finally{je()}}async handleRemove(){const t=Ks("controller-input");if(!t)return;if(!eu(t)){we(Yc),Je("controller-input");return}const r=D.fromText(t);if(!this.controllersList.some(i=>i.toString()===r.toString())){we(Am),Je("controller-input");return}const s=this.controllersList.filter(i=>i.toString()!==r.toString());if(!this.hasRequiredPrincipals(s)){we(Qc),Je("controller-input");return}qe();try{await new Gs().updateControllers(s),await xn.refresh(),this.controllersList=s,Je("controller-input"),this.renderControllersContent()}catch(i){H(ce,i)}finally{je()}}hasRequiredPrincipals(t){const r=t.some(s=>s.toString()===this.canisterId.toString()),n=t.some(s=>s.toString()===this.iiPrincipal.toString());return r&&n}}class fd{canisterApi;ready;constructor(){this.ready=this.create()}async create(){const t=await nn(),r=pt();this.canisterApi=Hl({agent:t,canisterId:r})}async manageAlternativeOrigins(t){try{return await this.ready,await this.canisterApi.manage_alternative_origins(t)}catch(r){throw H(ce,r),r}}async manageTopUpRule(t){try{return await this.ready,await this.canisterApi.manage_top_up_rule(t)}catch(r){throw H(ce,r),r}}}const nu=3e3;class ka{canisterApi;constructor(){this.canisterApi=new fd}static async create(){const t=new ka;return await t.initializeDisplay(),t.attachEventListeners(),t}async initializeDisplay(){const t=await this.fetchAlternativeOrigins();this.renderAlternativeOriginsContent(t)}renderAlternativeOriginsContent(t){const r=Se("alternative-origins-list");r.textContent="";for(const n of t){const s=Xl(n),i=s.querySelector(".copy-btn");i&&dd(i),r.appendChild(s)}}async fetchAlternativeOrigins(){try{const t=await fetch("/.well-known/ii-alternative-origins");return t.ok?(await t.json()).alternativeOrigins:(H(ce),[])}catch(t){return H(ce,t),[]}}attachEventListeners(){Bt("alternative-origin-add","click",()=>this.handleAdd()),Bt("alternative-origin-remove","click",()=>this.handleRemove())}async handleAdd(){const t=Ks("alternative-origin-input");if(t){if(!Cm(t)){we(bm),Je("alternative-origin-input");return}qe();try{const r=await this.canisterApi.manageAlternativeOrigins({Add:t});if("Ok"in r)await new Promise(n=>setTimeout(n,nu)),await this.initializeDisplay(),Je("alternative-origin-input");else if("Err"in r){const n=r.Err;H(ce+` (${n})`)}else H("Unknown error adding alternative origin"),H(Tm)}catch(r){H(Nm,r)}finally{je()}}}async handleRemove(){const t=Ks("alternative-origin-input");if(t){qe();try{const r=await this.canisterApi.manageAlternativeOrigins({Remove:t});if("Ok"in r)await new Promise(n=>setTimeout(n,nu)),await this.initializeDisplay(),Je("alternative-origin-input");else if("Err"in r){const n=r.Err;H(ce+` (${n})`)}else H("Unknown error removing alternative origin"),H(Rm)}catch(r){H(Im,r)}finally{je()}}}}function vy(e){const t=BigInt(e),r=1000000000000n,n=t/r,i=t%r*100n/r;return`${n}.${i.toString().padStart(2,"0")} T`}function Ny(e){const t=BigInt(e),r=100000000n,n=t/r,i=(t%r).toString().padStart(8,"0").slice(0,4);return`${n}.${i} ICP`}function Ty(e){const t=parseInt(e,10);if(t>=86400){const r=Math.floor(t/86400);return r===1?"1 day":`${r} days`}if(t>=3600){const r=Math.floor(t/3600);return r===1?"1 hour":`${r} hours`}if(t>=60){const r=Math.floor(t/60);return r===1?"1 minute":`${r} minutes`}return t===1?"1 second":`${t} seconds`}function Iy(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}function Ry(e){const t=e.indexOf(":");if(t===-1)return{category:"log",message:e.trim(),keyValuePairs:[]};const r=e.slice(0,t).trim(),n=e.slice(t+1).trim(),s=/\b(\w+)=(\S+)/g,i=[];let o;for(;(o=s.exec(n))!==null;)i.push({key:o[1],value:o[2]});let a=n;if(i.length>0){const c=i[0],u=n.indexOf(`${c.key}=`);u>0?a=n.slice(0,u).trim():u===0&&(a="")}return{category:r,message:a,keyValuePairs:i}}function Oy(e,t){const r=e.toLowerCase(),n=t.toLowerCase();return r.includes("error")||n.includes("error")||n.includes("failed")?"error":n.includes("skipping")||n.includes("in-flight")||n.includes("still processing")?"warning":n.includes("succeeded")||n.includes("completed")||n.includes("transfer ok")||n.includes("rule set")||n.includes("rule cleared")||n.includes("timer set")||n.includes("timer cleared")?"success":"info"}function Sy(e){const r=new Date().getTime()-e.getTime();if(r<0)return"just now";const n=Math.floor(r/1e3),s=Math.floor(n/60),i=Math.floor(s/60),o=Math.floor(i/24);if(n<60)return n<=1?"just now":`${n}s ago`;if(s<60)return s===1?"1 min ago":`${s} min ago`;if(i<24)return i===1?"1 hour ago":`${i} hours ago`;if(o<7)return o===1?"1 day ago":`${o} days ago`;if(o<30){const a=Math.floor(o/7);return a===1?"1 week ago":`${a} weeks ago`}return"over a month ago"}const su={"rule set":{text:"Rule Set",level:"success"},"rule cleared":{text:"Rule Cleared",level:"success"},"timer cleared":{text:"Timer Stopped",level:"success"},tick:{text:"Tick",level:"info"},"active rule":{text:"Active Rule",level:"info"},"cycles above threshold; skipping":{text:"Cycles Above Threshold (Skipped)",level:"warning"},"below threshold":{text:"Below Threshold",level:"info"},"starting transfer + notify flow":{text:"Starting Top-Up Flow",level:"info"},"flow completed":{text:"Top-Up Completed",level:"success"},"no rule set; skipping":{text:"No Rule Set (Skipped)",level:"warning"},"notify succeeded":{text:"Notify Succeeded",level:"success"},"notify previous block succeeded":{text:"Previous Block Succeeded",level:"success"},"notify still processing":{text:"Notify Still Processing",level:"warning"},"notify processing; will retry later":{text:"Notify Processing (Will Retry)",level:"warning"},"notify failed non-retriable; proceeding to new transfer":{text:"Previous Notify Failed",level:"warning"},"transfer ok":{text:"Transfer Successful",level:"success"}};function Ay(e,t){const r=e.toLowerCase(),n=su[r];if(n)return n;for(const[i,o]of Object.entries(su))if(r.startsWith(i))return o;return r.startsWith("timer set every")?{text:"Timer Started",level:"success"}:r.startsWith("convert cycles")?{text:"Converting Cycles to ICP",level:"info"}:r.startsWith("xrc cycles_per_icp")?{text:"Exchange Rate",level:"info"}:r.startsWith("notifying previous")?{text:"Retrying Previous Block",level:"info"}:r.startsWith("notifying block")?{text:"Notifying CMC",level:"info"}:r.startsWith("transfer ")&&r.includes("e8s to cmc")?{text:"ICP Transfer to CMC",level:"info"}:r.includes("failed to compute")?{text:"Failed to Compute ICP",level:"error"}:r.includes("mint in-flight")?{text:"Mint In-Flight (Skipped)",level:"warning"}:r.includes("cmc mint error")?{text:"CMC Mint Error",level:"error"}:{text:e.replace(/\b\w/g,i=>i.toUpperCase()),level:Oy(t,e)}}const Cy=["amount","threshold","current","cycles","cycles_per_icp"],By=["icp_e8s","transfer_amount_e8s","fee"],Vy=["every"];function ky(e,t){const r=e.toLowerCase();if(Cy.includes(r))return vy(t);if(By.includes(r))return Ny(t);if(Vy.includes(r)){const n=t.replace(/s$/,"");return Ty(n)}return r==="interval"?t:r==="block_index"?`#${t}`:t}function yn(e){return e.toString().padStart(2,"0")}function Fy(e){const t=e.getFullYear(),r=yn(e.getMonth()+1),n=yn(e.getDate()),s=yn(e.getHours()),i=yn(e.getMinutes()),o=yn(e.getSeconds());return`${t}-${r}-${n} ${s}:${i}:${o}`}function ys(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Uy(e){const t=ys(e.category).toUpperCase(),r=ys(e.message).replace(/\r\n|\n|\r/g,"<br>"),n=e.keyValuePairs.length>0?`<div class="log-kv-table">${e.keyValuePairs.map(i=>{const o=Iy(i.key),a=ky(i.key,i.value);return`<div class="log-kv-row">
              <span class="log-kv-key">${ys(o)}</span>
              <span class="log-kv-value">${ys(a)}</span>
            </div>`}).join("")}</div>`:"",s=e.relativeTimestamp?`<span class="log-timestamp">
        <span class="log-timestamp-relative">${e.relativeTimestamp}</span>
        <span class="log-timestamp-absolute">${e.absoluteTimestamp}</span>
      </span>`:`<span class="log-timestamp">
        <span class="log-timestamp-absolute" style="margin-left: 0;">${e.absoluteTimestamp}</span>
      </span>`;return`
    <li class="log-entry log-level-${e.level}">
      <div class="log-header">
        <span class="log-badge log-badge-${e.level}">${t}</span>
        <span class="log-index">#${e.index}</span>
        ${s}
      </div>
      <div class="log-body">
        <span class="log-message">${r}</span>
        ${n}
      </div>
    </li>
  `}class Fa{constructor(){}static async create(){const t=new Fa;return await t.renderLogs(),t.attachEventListeners(),t}attachEventListeners(){Bt("refresh-logs-btn","click",()=>this.refreshLogs())}async refreshLogs(){qe(),await this.renderLogs(),je()}async renderLogs(){try{const t=new Gs,{canister_log_records:r}=await t.getCanisterLogs(),n=Se("logs-list");if(r.length===0){n.innerHTML='<li class="log-entry log-level-info"><div class="log-body"><span class="log-message">No logs found.</span></div></li>';return}const s=r.reverse().map(i=>{const o=i.content instanceof Uint8Array?i.content:Uint8Array.from(i.content),a=new TextDecoder().decode(o),c=Number(i.timestamp_nanos/1000000n),u=new Date(c),f=!isNaN(u.getTime()),{category:d,message:l,keyValuePairs:h}=Ry(a),{text:y,level:g}=Ay(l,d),_={category:d,message:y,level:g,keyValuePairs:h,absoluteTimestamp:f?Fy(u):"Unknown time",relativeTimestamp:f?Sy(u):"",index:i.idx.toString()};return Uy(_)}).join("");n.innerHTML=s}catch(t){H(ce,t)}}}class Ua{api=new fd;constructor(){}static async create(){const t=new Ua;return await Promise.all([t.fetchAndRender(),t.renderCanisterInfo()]),t.attachEventListeners(),t}async renderCanisterInfo(){const t=pt(),r=await new gn().canisterBalance(),n=t.toString(),s=ed(r);mm(n,s)}attachEventListeners(){Bt("top-up-rule-set","click",()=>this.handleSet()),Bt("top-up-rule-clear","click",()=>this.handleClear())}async fetchAndRender(){try{this.render(await this.api.manageTopUpRule({Get:null}))}catch(t){H(ce,t)}}render(t){if("Err"in t)return we(Xc+" "+t.Err);if("Ok"in t){const r=t.Ok[0];ym(r?Dy(r):null)}}async handleSet(){const t=go("top-up-rule-interval"),r=go("top-up-rule-threshold"),n=go("top-up-rule-amount");if(!r||!n)return we(wm);qe();try{const s=await this.api.manageTopUpRule({Add:{interval:Ly(t),cycles_threshold:ou(r),cycles_amount:ou(n)}});if("Err"in s)return we(s.Err);await this.fetchAndRender()}catch(s){H(Jc+" "+ce,s)}finally{je()}}async handleClear(){qe();try{const t=await this.api.manageTopUpRule({Clear:null});if("Err"in t)return we(Xc+" "+t.Err);await this.fetchAndRender()}catch(t){H(Jc+" "+ce,t)}finally{je()}}}function hd(e){if(e)return Object.keys(e)[0]}function iu(e){const t=hd(e);return t?t.replace(/^_/,"").replace("_","."):"Unknown"}function Py(e){return hd(e)||"Unknown"}function Dy(e){return[`Interval: ${Py(e.interval)}`,`Threshold: ${iu(e.cycles_threshold)} cycles`,`Amount: ${iu(e.cycles_amount)} cycles`].join(`
`)}const My={_0_25T:{_0_25T:null},_0_5T:{_0_5T:null},_1T:{_1T:null},_2T:{_2T:null},_5T:{_5T:null},_10T:{_10T:null},_50T:{_50T:null},_100T:{_100T:null}},$y={Hourly:{Hourly:null},Daily:{Daily:null},Weekly:{Weekly:null},Monthly:{Monthly:null}};function ou(e){const t=My[e];if(!t)throw new Error(`Invalid cycles amount: ${e}`);return t}function Ly(e){const t=$y[e];return t||{Monthly:null}}const pd="canister-dashboard-theme";function qy(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function md(){const e=localStorage.getItem(pd);return e==="light"||e==="dark"?e:null}function yd(){return md()??qy()}function $o(e){document.documentElement.dataset.theme=e}function jy(){const t=yd()==="dark"?"light":"dark";localStorage.setItem(pd,t),$o(t)}function Ky(){const e=yd();$o(e);const t=document.getElementById("theme-toggle");t&&t.addEventListener("click",jy),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",r=>{md()||$o(r.matches?"dark":"light")})}class Gy{authManager=null;currentState="initializing";managers={topup:null,topUpRule:null,status:null,controllers:null,alternativeOrigins:null,canisterLogs:null};constructor(){this.initialize()}async initialize(){try{this.setState("initializing"),qe(),this.authManager=await li.create(),await this.checkAuthenticationState()}catch(t){console.error("Dashboard initialization error:",t),this.setState("error"),we(_m)}finally{je()}}async checkAuthenticationState(){if(!this.authManager)return H(ms);try{await this.authManager.isAuthenticated()?await this.transitionToLoggedIn():this.transitionToLoggedOut()}catch(t){console.error("Authentication check failed:",t),this.transitionToLoggedOut()}}async transitionToLoggedIn(){if(!this.authManager)return H(ms);try{this.setState("logged-in");const t=await this.authManager.getPrincipal(),r=t.toText();dm(r,()=>this.handleLogout());const n=pt();await this.initializeManagers(n,t)}catch(t){console.error("Failed to transition to logged in state:",t),this.transitionToLoggedOut()}}transitionToLoggedOut(){this.setState("logged-out"),this.clearManagers(),fm(()=>this.handleLogin())}setState(t){this.currentState=t}async initializeManagers(t,r){try{qe();const[n,s,i,o,a,c]=await Promise.all([Ba.create(),Ua.create(),$n.create(),Va.create(t,r),ka.create(),Fa.create()]);this.managers.topup=n,this.managers.topUpRule=s,this.managers.status=i,this.managers.controllers=o,this.managers.alternativeOrigins=a,this.managers.canisterLogs=c}finally{je()}}clearManagers(){this.managers.topup=null,this.managers.topUpRule=null,this.managers.status=null,this.managers.controllers=null,this.managers.alternativeOrigins=null,this.managers.canisterLogs=null}async handleLogin(){if(!this.authManager)return H(ms);if(this.currentState!=="logging-in")try{await this.authManager.logout().catch(()=>{}),this.setState("logging-in"),qe(),Zc(),await this.authManager.login(),await this.authManager.isAuthenticated()?await this.transitionToLoggedIn():this.transitionToLoggedOut()}catch(t){console.error("Login failed:",t),this.setState("error"),this.transitionToLoggedOut()}finally{je()}}async handleLogout(){if(!this.authManager)return H(ms);try{qe(),Zc(),await this.authManager.logout(),this.transitionToLoggedOut()}catch(t){console.error("Logout failed:",t),we(Jl)}finally{je()}}}document.addEventListener("DOMContentLoaded",()=>{Ky(),xy(),new Gy});
