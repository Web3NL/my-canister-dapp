var Uo=e=>{throw TypeError(e)};var Po=(e,t,r)=>t.has(e)||Uo("Cannot "+r);var G=(e,t,r)=>(Po(e,t,"read from private field"),r?r.call(e):t.get(e)),Te=(e,t,r)=>t.has(e)?Uo("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),xe=(e,t,r,n)=>(Po(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var Do=(e,t,r,n)=>({set _(s){xe(e,t,s,r)},get _(){return G(e,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Mo;(function(e){e[e.SysFatal=1]="SysFatal",e[e.SysTransient=2]="SysTransient",e[e.DestinationInvalid=3]="DestinationInvalid",e[e.CanisterReject=4]="CanisterReject",e[e.CanisterError=5]="CanisterError"})(Mo||(Mo={}));var Wr;(function(e){e.Replied="replied",e.Rejected="rejected"})(Wr||(Wr={}));function md(e){return e!=null&&"reject_code"in e}function yd(e){return e!=null&&"certificate"in e}const Ns="abcdefghijklmnopqrstuvwxyz234567",Xr=Object.create(null);for(let e=0;e<Ns.length;e++)Xr[Ns[e]]=e;Xr[0]=Xr.o;Xr[1]=Xr.i;function _d(e){let t=0,r=0,n="";function s(i){return t<0?r|=i>>-t:r=i<<t&248,t>3?(t-=8,1):(t<4&&(n+=Ns[r>>3],t+=5),0)}for(let i=0;i<e.length;)i+=s(e[i]);return n+(t<0?Ns[r>>3]:"")}function gd(e){let t=0,r=0;const n=new Uint8Array(e.length*4/3|0);let s=0;function i(a){let o=Xr[a.toLowerCase()];if(o===void 0)throw new Error(`Invalid character: ${JSON.stringify(a)}`);o<<=3,r|=o>>>t,t+=5,t>=8&&(n[s++]=r,t-=8,t>0?r=o<<5-t&255:r=0)}for(const a of e)i(a);return n.slice(0,s)}const bd=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function wd(e){let t=-1;for(let r=0;r<e.length;r++){const s=(e[r]^t)&255;t=bd[s]^t>>>8}return(t^-1)>>>0}const kr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Jn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function xd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function He(e,...t){if(!Jn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Lo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ed(e,t){He(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function En(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function qi(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function st(e,t){return e<<32-t|e>>>t}const iu=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",vd=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function re(e){if(He(e),iu)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=vd[e[r]];return t}const gt={_0:48,_9:57,A:65,F:70,a:97,f:102};function $o(e){if(e>=gt._0&&e<=gt._9)return e-gt._0;if(e>=gt.A&&e<=gt.F)return e-(gt.A-10);if(e>=gt.a&&e<=gt.f)return e-(gt.a-10)}function dt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(iu)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const a=$o(e.charCodeAt(i)),o=$o(e.charCodeAt(i+1));if(a===void 0||o===void 0){const c=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=a*16+o}return n}function Q(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function au(e){return typeof e=="string"&&(e=Q(e)),He(e),e}function ee(...e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];He(s),t+=s.length}const r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){const i=e[n];r.set(i,s),s+=i.length}return r}class Nd{}function Ma(e){const t=n=>e().update(au(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ou(e=32){if(kr&&typeof kr.getRandomValues=="function")return kr.getRandomValues(new Uint8Array(e));if(kr&&typeof kr.randomBytes=="function")return Uint8Array.from(kr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Td(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),a=Number(r>>s&i),o=Number(r&i),c=n?4:0,l=n?0:4;e.setUint32(t+c,a,n),e.setUint32(t+l,o,n)}function Id(e,t,r){return e&t^~e&r}function Od(e,t,r){return e&t^e&r^t&r}class cu extends Nd{constructor(t,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(t),this.view=qi(this.buffer)}update(t){Lo(this),t=au(t),He(t);const{view:r,buffer:n,blockLen:s}=this,i=t.length;for(let a=0;a<i;){const o=Math.min(s-this.pos,i-a);if(o===s){const c=qi(t);for(;s<=i-a;a+=s)this.process(c,a);continue}n.set(t.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Lo(this),Ed(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:a}=this;r[a++]=128,En(this.buffer.subarray(a)),this.padOffset>s-a&&(this.process(n,0),a=0);for(let d=a;d<s;d++)r[d]=0;Td(n,s-8,BigInt(this.length*8),i),this.process(n,0);const o=qi(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)o.setUint32(4*d,f[d],i)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:a,pos:o}=this;return t.destroyed=a,t.finished=i,t.length=s,t.pos=o,s%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const Vt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),Ie=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),is=BigInt(2**32-1),qo=BigInt(32);function Rd(e,t=!1){return t?{h:Number(e&is),l:Number(e>>qo&is)}:{h:Number(e>>qo&is)|0,l:Number(e&is)|0}}function Sd(e,t=!1){const r=e.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:a,l:o}=Rd(e[i],t);[n[i],s[i]]=[a,o]}return[n,s]}const jo=(e,t,r)=>e>>>r,Ko=(e,t,r)=>e<<32-r|t>>>r,Fr=(e,t,r)=>e>>>r|t<<32-r,Ur=(e,t,r)=>e<<32-r|t>>>r,as=(e,t,r)=>e<<64-r|t>>>r-32,os=(e,t,r)=>e>>>r-32|t<<64-r;function bt(e,t,r,n){const s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:s|0}}const Ad=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Cd=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Bd=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Vd=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0,kd=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0),Fd=(e,t,r,n,s,i)=>t+r+n+s+i+(e/2**32|0)|0,Ud=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64);class uu extends cu{constructor(t=32){super(64,t,8,!1),this.A=Vt[0]|0,this.B=Vt[1]|0,this.C=Vt[2]|0,this.D=Vt[3]|0,this.E=Vt[4]|0,this.F=Vt[5]|0,this.G=Vt[6]|0,this.H=Vt[7]|0}get(){const{A:t,B:r,C:n,D:s,E:i,F:a,G:o,H:c}=this;return[t,r,n,s,i,a,o,c]}set(t,r,n,s,i,a,o,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=c|0}process(t,r){for(let d=0;d<16;d++,r+=4)Ft[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){const u=Ft[d-15],h=Ft[d-2],y=st(u,7)^st(u,18)^u>>>3,_=st(h,17)^st(h,19)^h>>>10;Ft[d]=_+Ft[d-7]+y+Ft[d-16]|0}let{A:n,B:s,C:i,D:a,E:o,F:c,G:l,H:f}=this;for(let d=0;d<64;d++){const u=st(o,6)^st(o,11)^st(o,25),h=f+u+Id(o,c,l)+Ud[d]+Ft[d]|0,_=(st(n,2)^st(n,13)^st(n,22))+Od(n,s,i)|0;f=l,l=c,c=o,o=a+h|0,a=i,i=s,s=n,n=h+_|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(n,s,i,a,o,c,l,f)}roundClean(){En(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),En(this.buffer)}}class Pd extends uu{constructor(){super(28),this.A=kt[0]|0,this.B=kt[1]|0,this.C=kt[2]|0,this.D=kt[3]|0,this.E=kt[4]|0,this.F=kt[5]|0,this.G=kt[6]|0,this.H=kt[7]|0}}const lu=Sd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Dd=lu[0],Md=lu[1],Ut=new Uint32Array(80),Pt=new Uint32Array(80);class Ld extends cu{constructor(t=64){super(128,t,16,!1),this.Ah=Ie[0]|0,this.Al=Ie[1]|0,this.Bh=Ie[2]|0,this.Bl=Ie[3]|0,this.Ch=Ie[4]|0,this.Cl=Ie[5]|0,this.Dh=Ie[6]|0,this.Dl=Ie[7]|0,this.Eh=Ie[8]|0,this.El=Ie[9]|0,this.Fh=Ie[10]|0,this.Fl=Ie[11]|0,this.Gh=Ie[12]|0,this.Gl=Ie[13]|0,this.Hh=Ie[14]|0,this.Hl=Ie[15]|0}get(){const{Ah:t,Al:r,Bh:n,Bl:s,Ch:i,Cl:a,Dh:o,Dl:c,Eh:l,El:f,Fh:d,Fl:u,Gh:h,Gl:y,Hh:_,Hl:g}=this;return[t,r,n,s,i,a,o,c,l,f,d,u,h,y,_,g]}set(t,r,n,s,i,a,o,c,l,f,d,u,h,y,_,g){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=d|0,this.Fl=u|0,this.Gh=h|0,this.Gl=y|0,this.Hh=_|0,this.Hl=g|0}process(t,r){for(let p=0;p<16;p++,r+=4)Ut[p]=t.getUint32(r),Pt[p]=t.getUint32(r+=4);for(let p=16;p<80;p++){const E=Ut[p-15]|0,v=Pt[p-15]|0,N=Fr(E,v,1)^Fr(E,v,8)^jo(E,v,7),I=Ur(E,v,1)^Ur(E,v,8)^Ko(E,v,7),O=Ut[p-2]|0,x=Pt[p-2]|0,R=Fr(O,x,19)^as(O,x,61)^jo(O,x,6),B=Ur(O,x,19)^os(O,x,61)^Ko(O,x,6),A=Bd(I,B,Pt[p-7],Pt[p-16]),w=Vd(A,N,R,Ut[p-7],Ut[p-16]);Ut[p]=w|0,Pt[p]=A|0}let{Ah:n,Al:s,Bh:i,Bl:a,Ch:o,Cl:c,Dh:l,Dl:f,Eh:d,El:u,Fh:h,Fl:y,Gh:_,Gl:g,Hh:m,Hl:b}=this;for(let p=0;p<80;p++){const E=Fr(d,u,14)^Fr(d,u,18)^as(d,u,41),v=Ur(d,u,14)^Ur(d,u,18)^os(d,u,41),N=d&h^~d&_,I=u&y^~u&g,O=kd(b,v,I,Md[p],Pt[p]),x=Fd(O,m,E,N,Dd[p],Ut[p]),R=O|0,B=Fr(n,s,28)^as(n,s,34)^as(n,s,39),A=Ur(n,s,28)^os(n,s,34)^os(n,s,39),w=n&i^n&o^i&o,T=s&a^s&c^a&c;m=_|0,b=g|0,_=h|0,g=y|0,h=d|0,y=u|0,{h:d,l:u}=bt(l|0,f|0,x|0,R|0),l=o|0,f=c|0,o=i|0,c=a|0,i=n|0,a=s|0;const C=Ad(R,A,T);n=Cd(C,x,B,w),s=C|0}({h:n,l:s}=bt(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:a}=bt(this.Bh|0,this.Bl|0,i|0,a|0),{h:o,l:c}=bt(this.Ch|0,this.Cl|0,o|0,c|0),{h:l,l:f}=bt(this.Dh|0,this.Dl|0,l|0,f|0),{h:d,l:u}=bt(this.Eh|0,this.El|0,d|0,u|0),{h,l:y}=bt(this.Fh|0,this.Fl|0,h|0,y|0),{h:_,l:g}=bt(this.Gh|0,this.Gl|0,_|0,g|0),{h:m,l:b}=bt(this.Hh|0,this.Hl|0,m|0,b|0),this.set(n,s,i,a,o,c,l,f,d,u,h,y,_,g,m,b)}roundClean(){En(Ut,Pt)}destroy(){En(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Ge=Ma(()=>new uu),$d=Ma(()=>new Pd),qd=Ma(()=>new Ld),cs="__principal__",jd=2,Go=4,Kd="aaaaa-aa";let D=class Dr{static anonymous(){return new this(new Uint8Array([Go]))}static managementCanister(){return this.fromText(Kd)}static selfAuthenticating(t){const r=$d(t);return new this(new Uint8Array([...r,jd]))}static from(t){if(typeof t=="string")return Dr.fromText(t);if(Object.getPrototypeOf(t)===Uint8Array.prototype)return new Dr(t);if(Dr.isPrincipal(t))return new Dr(t._arr);throw new Error(`Impossible to convert ${JSON.stringify(t)} to Principal.`)}static fromHex(t){return new this(dt(t))}static fromText(t){let r=t;if(t.includes(cs)){const a=JSON.parse(t);cs in a&&(r=a[cs])}const n=r.toLowerCase().replace(/-/g,"");let s=gd(n);s=s.slice(4,s.length);const i=new this(s);if(i.toText()!==r)throw new Error(`Principal "${i.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return i}static fromUint8Array(t){return new this(t)}static isPrincipal(t){return t instanceof Dr||typeof t=="object"&&t!==null&&"_isPrincipal"in t&&t._isPrincipal===!0&&"_arr"in t&&t._arr instanceof Uint8Array}constructor(t){this._arr=t,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===Go}toUint8Array(){return this._arr}toHex(){return re(this._arr).toUpperCase()}toText(){const t=new ArrayBuffer(4);new DataView(t).setUint32(0,wd(this._arr));const n=new Uint8Array(t),s=new Uint8Array([...n,...this._arr]),a=_d(s).match(/.{1,5}/g);if(!a)throw new Error;return a.join("-")}toString(){return this.toText()}toJSON(){return{[cs]:this.toText()}}compareTo(t){for(let r=0;r<Math.min(this._arr.length,t._arr.length);r++){if(this._arr[r]<t._arr[r])return"lt";if(this._arr[r]>t._arr[r])return"gt"}return this._arr.length<t._arr.length?"lt":this._arr.length>t._arr.length?"gt":"eq"}ltEq(t){const r=this.compareTo(t);return r=="lt"||r=="eq"}gtEq(t){const r=this.compareTo(t);return r=="gt"||r=="eq"}};var St;(function(e){e.Trust="Trust",e.Protocol="Protocol",e.Reject="Reject",e.Transport="Transport",e.External="External",e.Limit="Limit",e.Input="Input",e.Unknown="Unknown"})(St||(St={}));class K{constructor(t=!1){this.isCertified=t}toString(){let t=this.toErrorMessage();return this.requestContext&&(t+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?re(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${re(this.requestContext.senderPubKey)}
  Sender signature (hex): ${re(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(t+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),t}}class ot extends Error{get code(){return this.cause.code}set code(t){this.cause.code=t}get kind(){return this.cause.kind}set kind(t){this.cause.kind=t}get isCertified(){return this.code.isCertified}constructor(t,r){super(t.toString()),this.name="AgentError",this.cause={code:t,kind:r},Object.setPrototypeOf(this,ot.prototype)}hasCode(t){return this.code instanceof t}toString(){return`${this.name} (${this.kind}): ${this.message}`}}class Sr extends ot{static fromCode(t){return new this(t)}}class De extends Sr{constructor(t){super(t,St.Trust),this.name="TrustError",Object.setPrototypeOf(this,De.prototype)}}class oe extends Sr{constructor(t){super(t,St.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,oe.prototype)}}class qr extends Sr{constructor(t){super(t,St.Reject),this.name="RejectError",Object.setPrototypeOf(this,qr.prototype)}}class Ts extends Sr{constructor(t){super(t,St.Transport),this.name="TransportError",Object.setPrototypeOf(this,Ts.prototype)}}class Ce extends Sr{constructor(t){super(t,St.External),this.name="ExternalError",Object.setPrototypeOf(this,Ce.prototype)}}class ne extends Sr{constructor(t){super(t,St.Input),this.name="InputError",Object.setPrototypeOf(this,ne.prototype)}}class Oe extends Sr{constructor(t){super(t,St.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,Oe.prototype)}}class zt extends K{constructor(t,r){super(),this.reason=t,this.error=r,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,zt.prototype)}toErrorMessage(){let t=this.reason;return this.error&&(t+=`: ${ts(this.error)}`),`Certificate verification error: "${t}"`}}class Jr extends K{constructor(t,r,n,s,i){super(),this.maxAgeInMinutes=t,this.certificateTime=r,this.currentTime=n,this.timeDiffMsecs=s,this.ageType=i,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,Jr.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()} Clock drift: ${this.timeDiffMsecs}ms`}}class La extends K{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,La.prototype)}toErrorMessage(){return"Certificate has too many delegations"}}class Qn extends K{constructor(t,r){super(),this.canisterId=t,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,Qn.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: ${this.subnetId.toText()}`}}class $a extends K{constructor(t){super(),this.subnetId=t,this.name="CertificateNotAuthorizedForSubnetErrorCode",Object.setPrototypeOf(this,$a.prototype)}toErrorMessage(){return`The certificate is not authorized for subnet ${this.subnetId.toText()}`}}class vr extends K{constructor(t,r){super(),this.message=t,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,vr.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}}class qa extends K{constructor(t){super(),this.message=t,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,qa.prototype)}toErrorMessage(){return this.message}}class ja extends K{constructor(t){super(),this.message=t,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,ja.prototype)}toErrorMessage(){return this.message}}class Zs extends K{constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,Zs.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}}class Ka extends K{constructor(t,r){super(),this.expectedPrefix=t,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,Ka.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${re(this.expectedPrefix)}, but got ${re(this.actualPrefix)}`}}class Ga extends K{constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,Ga.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}}class At extends K{constructor(t){super(),this.error=t,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,At.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}}class Ys extends K{constructor(t){super(),this.error=t,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,Ys.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}}class Ha extends K{constructor(t,r){super(),this.error=t,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,Ha.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${ts(this.error)}, input: ${re(this.input)}`}}class za extends K{constructor(t,r){super(),this.error=t,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,za.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${ts(this.error)}, input: ${this.value}`}}class vn extends K{constructor(t,r,n){super(),this.message=t,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,vn.prototype)}toErrorMessage(){let t=`${this.message}
`;return this.requestId&&(t+=`  Request ID: ${re(this.requestId)}
`),this.status&&(t+=`  Request status: ${this.status}
`),t}}class Za extends K{constructor(t,r,n){super(),this.maxIngressExpiryInMinutes=t,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,Za.prototype)}toErrorMessage(){let t=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${re(this.requestId)}
`;return this.retryTimes!==void 0&&(t+=`  Retried ${this.retryTimes} times.`),t}}class Ws extends K{constructor(t,r,n,s){super(!0),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,Ws.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Ya extends K{constructor(t,r,n,s,i){super(),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.signatures=i,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,Ya.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Wa extends K{constructor(t,r,n,s){super(),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.name="UncertifiedRejectUpdateErrorCode",Object.setPrototypeOf(this,Wa.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${re(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}}class Xa extends K{constructor(t){super(),this.requestId=t,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,Xa.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${re(this.requestId)}
`}}class Ar extends K{constructor(t){super(),this.shouldFetchRootKey=t,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,Ar.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}}class Ja extends K{constructor(t){super(),this.value=t,this.name="HashValueErrorCode",Object.setPrototypeOf(this,Ja.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}}class gn extends K{constructor(t){super(),this.error=t,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,gn.prototype)}toErrorMessage(){return this.error}}class pr extends K{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,pr.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}}class Et extends K{constructor(t,r){super(),this.message=t,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,Et.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}}class Qa extends K{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,Qa.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}}class eo extends K{constructor(t){super(),this.error=t,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,eo.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}}class to extends K{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,to.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}}class ro extends K{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,ro.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}}class no extends K{constructor(t){super(),this.nodeId=t,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,no.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}}class Me extends K{constructor(t){super(),this.error=t,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,Me.prototype)}toErrorMessage(){return`Unexpected error: ${ts(this.error)}`}}class es extends K{constructor(t){super(),this.error=t,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,es.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}}class Is extends K{constructor(t,r,n,s){super(),this.status=t,this.statusText=r,this.headers=n,this.bodyText=s,this.name="HttpErrorCode",Object.setPrototypeOf(this,Is.prototype)}toErrorMessage(){let t=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(t+=`  Body: ${this.bodyText}
`),t}}class Os extends K{constructor(){super(),this.name="HttpV4ApiNotSupportedErrorCode",Object.setPrototypeOf(this,Os.prototype)}toErrorMessage(){return"HTTP request failed: v4 API is not supported"}}class Rs extends K{constructor(t){super(),this.error=t,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,Rs.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${ts(this.error)}`}}class Ss extends K{constructor(t){super(),this.receivedCanisterId=t,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,Ss.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}}class so extends K{constructor(t){super(),this.request=t,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,so.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}}class As extends K{constructor(t){super(),this.error=t,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,As.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}}function ts(e){if(e instanceof Error)return e.stack??e.message;try{return JSON.stringify(e)}catch{return String(e)}}const Rt=new Error("unreachable");function X(...e){const t=new Uint8Array(e.reduce((n,s)=>n+s.byteLength,0));let r=0;for(const n of e)t.set(n,r),r+=n.byteLength;return t}class sn{save(){return this._view}restore(t){if(!(t instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=t}constructor(t,r=t?.byteLength||0){if(t&&!(t instanceof Uint8Array))try{t=Zt(t)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(t&&r>t.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=t||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(t){const r=this._view.subarray(0,t);return this._view=this._view.subarray(t),r.slice()}readUint8(){if(this._view.byteLength===0)return;const t=this._view[0];return this._view=this._view.subarray(1),t}write(t){if(!(t instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");const r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+t.byteLength>=this._buffer.byteLength?this.alloc(t.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+t.byteLength),this._view.set(t,r)}get end(){return this._view.byteLength===0}alloc(t){if(t<=0||!Number.isInteger(t))throw new Error("Amount must be a positive integer");const r=new Uint8Array((this._buffer.byteLength+t)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+t);n.set(this._view),this._buffer=r,this._view=n}}function Zt(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?Zt(e.buffer):new Uint8Array(e)}function Xs(e,t){if(e.byteLength!==t.byteLength)return e.byteLength-t.byteLength;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]-t[r];return 0}function Gd(e,t){return Xs(e,t)===0}function Hd(e){if(!(e instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(e.buffer,e.byteOffset,e.byteLength)}function zd(e){const r=new TextEncoder().encode(e);let n=0;for(const s of r)n=(n*223+s)%2**32;return n}function ke(e){if(/^_\d+_$/.test(e)||/^_0x[0-9a-fA-F]+_$/.test(e)){const t=+e.slice(1,-1);if(Number.isSafeInteger(t)&&t>=0&&t<2**32)return t}return zd(e)}function du(e){const t=BigInt(e);if(e<=0)throw new RangeError("Input must be positive");return t.toString(2).length-1}function ga(e){const t=BigInt(e);if(e<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<t}function fu(){throw new Error("unexpected end of buffer")}function Nr(e,t){return e.byteLength<t&&fu(),e.read(t)}function Tr(e){const t=e.readUint8();return t===void 0&&fu(),t}function ue(e){if(typeof e=="number"&&(e=BigInt(e)),e<BigInt(0))throw new Error("Cannot leb encode negative values.");const t=(e===BigInt(0)?0:du(e))+1,r=new sn(new Uint8Array(t),0);for(;;){const n=Number(e&BigInt(127));if(e/=BigInt(128),e===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function be(e){let t=BigInt(1),r=BigInt(0),n;do n=Tr(e),r+=BigInt(n&127).valueOf()*t,t*=BigInt(128);while(n>=128);return r}function ye(e){typeof e=="number"&&(e=BigInt(e));const t=e<BigInt(0);t&&(e=-e-BigInt(1));const r=(e===BigInt(0)?0:du(e))+1,n=new sn(new Uint8Array(r),0);for(;;){const i=s(e);if(e/=BigInt(128),t&&e===BigInt(0)&&(i&64)!==0||!t&&e===BigInt(0)&&(i&64)===0){n.write(new Uint8Array([i]));break}else n.write(new Uint8Array([i|128]))}function s(i){const a=i%BigInt(128);return Number(t?BigInt(128)-a-BigInt(1):a)}return n.buffer}function qt(e){const t=new Uint8Array(e.buffer);let r=0;for(;r<t.byteLength;r++)if(t[r]<128){if((t[r]&64)===0)return be(e);break}const n=new Uint8Array(Nr(e,r+1));let s=BigInt(0);for(let i=n.byteLength-1;i>=0;i--)s=s*BigInt(128)+BigInt(128-(n[i]&127)-1);return-s-BigInt(1)}function Zd(e,t){if(BigInt(e)<BigInt(0))throw new Error("Cannot write negative values.");return hu(e,t)}function hu(e,t){e=BigInt(e);const r=new sn(new Uint8Array(Math.min(1,t)),0);let n=0,s=BigInt(256),i=BigInt(0),a=Number(e%s);for(r.write(new Uint8Array([a]));++n<t;)e<0&&i===BigInt(0)&&a!==0&&(i=BigInt(1)),a=Number((e/s-i)%BigInt(256)),r.write(new Uint8Array([a])),s*=BigInt(256);return r.buffer}function pu(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=BigInt(Tr(e)),n=BigInt(1),s=0;for(;++s<t;){n*=BigInt(256);const i=BigInt(Tr(e));r=r+n*i}return r}function Yd(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=pu(e,t);const n=BigInt(2)**(BigInt(8)*BigInt(t-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var W;(function(e){e[e.Null=-1]="Null",e[e.Bool=-2]="Bool",e[e.Nat=-3]="Nat",e[e.Int=-4]="Int",e[e.Float32=-13]="Float32",e[e.Float64=-14]="Float64",e[e.Text=-15]="Text",e[e.Reserved=-16]="Reserved",e[e.Empty=-17]="Empty",e[e.Opt=-18]="Opt",e[e.Vector=-19]="Vector",e[e.Record=-20]="Record",e[e.Variant=-21]="Variant",e[e.Func=-22]="Func",e[e.Service=-23]="Service",e[e.Principal=-24]="Principal"})(W||(W={}));const ys="DIDL",Wd=new TextEncoder().encode(ys),Ho=400;function Nn(e,t,r){return e.map((n,s)=>r(n,t[s]))}class Xd{constructor(){this._typs=[],this._idx=new Map,this._idxRefCount=new Map}has(t){return this._idx.has(t.name)}add(t,r){const n=this._typs.length;this._idx.set(t.name,n),this._idxRefCount.set(n,1),this._typs.push(r)}merge(t,r){const n=this._idx.get(t.name),s=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+t);if(s===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[s];const i=this._getIdxRefCount(n),a=this._getIdxRefCount(s);this._idxRefCount.set(n,i+a),this._idx.set(r,n),this._idxRefCount.set(s,0),this._compactFromEnd()}_getIdxRefCount(t){return this._idxRefCount.get(t)||0}_compactFromEnd(){for(;this._typs.length>0;){const t=this._typs.length-1;if(this._getIdxRefCount(t)>0)break;this._typs.pop(),this._idxRefCount.delete(t)}}encode(){const t=ue(this._typs.length),r=X(...this._typs);return X(t,r)}indexOf(t){if(!this._idx.has(t))throw new Error("Missing type index for "+t);return ye(this._idx.get(t)||0)}}class Jd{visitType(t,r){throw new Error("Not implemented")}visitPrimitive(t,r){return this.visitType(t,r)}visitEmpty(t,r){return this.visitPrimitive(t,r)}visitBool(t,r){return this.visitPrimitive(t,r)}visitNull(t,r){return this.visitPrimitive(t,r)}visitReserved(t,r){return this.visitPrimitive(t,r)}visitText(t,r){return this.visitPrimitive(t,r)}visitNumber(t,r){return this.visitPrimitive(t,r)}visitInt(t,r){return this.visitNumber(t,r)}visitNat(t,r){return this.visitNumber(t,r)}visitFloat(t,r){return this.visitPrimitive(t,r)}visitFixedInt(t,r){return this.visitNumber(t,r)}visitFixedNat(t,r){return this.visitNumber(t,r)}visitPrincipal(t,r){return this.visitPrimitive(t,r)}visitConstruct(t,r){return this.visitType(t,r)}visitVec(t,r,n){return this.visitConstruct(t,n)}visitOpt(t,r,n){return this.visitConstruct(t,n)}visitRecord(t,r,n){return this.visitConstruct(t,n)}visitTuple(t,r,n){const s=r.map((i,a)=>[`_${a}_`,i]);return this.visitRecord(t,s,n)}visitVariant(t,r,n){return this.visitConstruct(t,n)}visitRec(t,r,n){return this.visitConstruct(r,n)}visitFunc(t,r){return this.visitConstruct(t,r)}visitService(t,r){return this.visitConstruct(t,r)}}var $;(function(e){e.EmptyClass="__IDL_EmptyClass__",e.UnknownClass="__IDL_UnknownClass__",e.BoolClass="__IDL_BoolClass__",e.NullClass="__IDL_NullClass__",e.ReservedClass="__IDL_ReservedClass__",e.TextClass="__IDL_TextClass__",e.IntClass="__IDL_IntClass__",e.NatClass="__IDL_NatClass__",e.FloatClass="__IDL_FloatClass__",e.FixedIntClass="__IDL_FixedIntClass__",e.FixedNatClass="__IDL_FixedNatClass__",e.VecClass="__IDL_VecClass__",e.OptClass="__IDL_OptClass__",e.RecordClass="__IDL_RecordClass__",e.TupleClass="__IDL_TupleClass__",e.VariantClass="__IDL_VariantClass__",e.RecClass="__IDL_RecClass__",e.PrincipalClass="__IDL_PrincipalClass__",e.FuncClass="__IDL_FuncClass__",e.ServiceClass="__IDL_ServiceClass__"})($||($={}));class Js{display(){return this.name}valueToString(t){return fe(t)}buildTypeTable(t){t.has(this)||this._buildTypeTableImpl(t)}}class Ye extends Js{checkType(t){if(this.name!==t.name)throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`);return t}_buildTypeTableImpl(t){}}class Jt extends Js{checkType(t){if(t instanceof ze){const r=t.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`)}encodeType(t){return t.indexOf(this.name)}}class io extends Ye{get typeName(){return $.EmptyClass}static[Symbol.hasInstance](t){return t.typeName===$.EmptyClass}accept(t,r){return t.visitEmpty(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return ye(W.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}}class mu extends Js{get typeName(){return $.UnknownClass}static[Symbol.hasInstance](t){return t.typeName===$.UnknownClass}checkType(t){throw new Error("Method not implemented for unknown.")}accept(t,r){throw t.visitType(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(t,r){let n=r.decodeValue(t,r);Object(n)!==n&&(n=Object(n));let s;return r instanceof ze?s=()=>r.getType():s=()=>r,Object.defineProperty(n,"type",{value:s,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}}class yu extends Ye{get typeName(){return $.BoolClass}static[Symbol.hasInstance](t){return t.typeName===$.BoolClass}accept(t,r){return t.visitBool(this,r)}covariant(t){if(typeof t=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return new Uint8Array([t?1:0])}encodeType(){return ye(W.Bool)}decodeValue(t,r){switch(this.checkType(r),Tr(t)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}}class Tn extends Ye{get typeName(){return $.NullClass}static[Symbol.hasInstance](t){return t.typeName===$.NullClass}accept(t,r){return t.visitNull(this,r)}covariant(t){if(t===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return ye(W.Null)}decodeValue(t,r){return this.checkType(r),null}get name(){return"null"}}class Xt extends Ye{get typeName(){return $.ReservedClass}static[Symbol.hasInstance](t){return t.typeName===$.ReservedClass}accept(t,r){return t.visitReserved(this,r)}covariant(t){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return ye(W.Reserved)}decodeValue(t,r){return r.name!==this.name&&r.decodeValue(t,r),null}get name(){return"reserved"}}class _u extends Ye{get typeName(){return $.TextClass}static[Symbol.hasInstance](t){return t.typeName===$.TextClass}accept(t,r){return t.visitText(this,r)}covariant(t){if(typeof t=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=new TextEncoder().encode(t),n=ue(r.byteLength);return X(n,r)}encodeType(){return ye(W.Text)}decodeValue(t,r){this.checkType(r);const n=be(t),s=Nr(t,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(s)}get name(){return"text"}valueToString(t){return'"'+t+'"'}}class ao extends Ye{get typeName(){return $.IntClass}static[Symbol.hasInstance](t){return t.typeName===$.IntClass}accept(t,r){return t.visitInt(this,r)}covariant(t){if(typeof t=="bigint"||Number.isInteger(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return ye(t)}encodeType(){return ye(W.Int)}decodeValue(t,r){return this.checkType(r),qt(t)}get name(){return"int"}valueToString(t){return t.toString()}}class oo extends Ye{get typeName(){return $.NatClass}static[Symbol.hasInstance](t){return t.typeName===$.NatClass}accept(t,r){return t.visitNat(this,r)}covariant(t){if(typeof t=="bigint"&&t>=BigInt(0)||Number.isInteger(t)&&t>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return ue(t)}encodeType(){return ye(W.Nat)}decodeValue(t,r){return this.checkType(r),be(t)}get name(){return"nat"}valueToString(t){return t.toString()}}class co extends Ye{get typeName(){return $.FloatClass}static[Symbol.hasInstance](t){return t.typeName===$.FloatClass}constructor(t){if(super(),this._bits=t,t!==32&&t!==64)throw new Error("not a valid float type")}accept(t,r){return t.visitFloat(this,r)}covariant(t){if(typeof t=="number"||t instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,t,!0):n.setFloat64(0,t,!0),new Uint8Array(r)}encodeType(){const t=this._bits===32?W.Float32:W.Float64;return ye(t)}decodeValue(t,r){this.checkType(r);const n=Nr(t,this._bits/8),s=Hd(n);return this._bits===32?s.getFloat32(0,!0):s.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(t){return t.toString()}}class Ir extends Ye{get typeName(){return $.FixedIntClass}static[Symbol.hasInstance](t){return t.typeName===$.FixedIntClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedInt(this,r)}covariant(t){const r=ga(this._bits-1)*BigInt(-1),n=ga(this._bits-1)-BigInt(1);let s=!1;if(typeof t=="bigint")s=t>=r&&t<=n;else if(Number.isInteger(t)){const i=BigInt(t);s=i>=r&&i<=n}else s=!1;if(s)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return hu(t,this._bits/8)}encodeType(){const t=Math.log2(this._bits)-3;return ye(-9-t)}decodeValue(t,r){this.checkType(r);const n=Yd(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(t){return t.toString()}}class Yt extends Ye{get typeName(){return $.FixedNatClass}static[Symbol.hasInstance](t){return t.typeName===$.FixedNatClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedNat(this,r)}covariant(t){const r=ga(this._bits);let n=!1;if(typeof t=="bigint"&&t>=BigInt(0)?n=t<r:Number.isInteger(t)&&t>=0?n=BigInt(t)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return Zd(t,this._bits/8)}encodeType(){const t=Math.log2(this._bits)-3;return ye(-5-t)}decodeValue(t,r){this.checkType(r);const n=pu(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(t){return t.toString()}}class Qr extends Jt{get typeName(){return $.VecClass}static[Symbol.hasInstance](t){return t.typeName===$.VecClass}constructor(t){super(),this._type=t,this._blobOptimization=!1,t instanceof Yt&&t._bits===8&&(this._blobOptimization=!0)}accept(t,r){return t.visitVec(this,this._type,r)}covariant(t){const r=this._type instanceof Yt?this._type._bits:this._type instanceof Ir?this._type._bits:0;if(ArrayBuffer.isView(t)&&r==t.BYTES_PER_ELEMENT*8||Array.isArray(t)&&t.every((n,s)=>{try{return this._type.covariant(n)}catch(i){throw new Error(`Invalid ${this.display()} argument: 

index ${s} -> ${i.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=ue(t.length);if(this._blobOptimization)return X(r,new Uint8Array(t));if(ArrayBuffer.isView(t))if(t instanceof Int16Array||t instanceof Uint16Array){const s=new DataView(new ArrayBuffer(t.length*2));for(let i=0;i<t.length;i++)t instanceof Int16Array?s.setInt16(i*2,t[i],!0):s.setUint16(i*2,t[i],!0);return X(r,new Uint8Array(s.buffer))}else if(t instanceof Int32Array||t instanceof Uint32Array){const s=new DataView(new ArrayBuffer(t.length*4));for(let i=0;i<t.length;i++)t instanceof Int32Array?s.setInt32(i*4,t[i],!0):s.setUint32(i*4,t[i],!0);return X(r,new Uint8Array(s.buffer))}else if(t instanceof BigInt64Array||t instanceof BigUint64Array){const s=new DataView(new ArrayBuffer(t.length*8));for(let i=0;i<t.length;i++)t instanceof BigInt64Array?s.setBigInt64(i*8,t[i],!0):s.setBigUint64(i*8,t[i],!0);return X(r,new Uint8Array(s.buffer))}else return X(r,new Uint8Array(t.buffer,t.byteOffset,t.byteLength));const n=new sn(new Uint8Array(r.byteLength+t.length),0);n.write(r);for(const s of t){const i=this._type.encodeValue(s);n.write(new Uint8Array(i))}return n.buffer}_buildTypeTableImpl(t){this._type.buildTypeTable(t);const r=ye(W.Vector),n=this._type.encodeType(t);t.add(this,X(r,n))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof Qr))throw new Error("Not a vector type");const s=Number(be(t));if(this._type instanceof Yt){if(this._type._bits==8)return new Uint8Array(t.read(s));if(this._type._bits==16){const a=t.read(s*2);return new Uint16Array(a.buffer,a.byteOffset,s)}if(this._type._bits==32){const a=t.read(s*4);return new Uint32Array(a.buffer,a.byteOffset,s)}if(this._type._bits==64)return new BigUint64Array(t.read(s*8).buffer)}if(this._type instanceof Ir){if(this._type._bits==8)return new Int8Array(t.read(s));if(this._type._bits==16){const a=t.read(s*2),o=new DataView(a.buffer,a.byteOffset,a.byteLength),c=new Int16Array(s);for(let l=0;l<s;l++)c[l]=o.getInt16(l*2,!0);return c}if(this._type._bits==32){const a=t.read(s*4),o=new DataView(a.buffer,a.byteOffset,a.byteLength),c=new Int32Array(s);for(let l=0;l<s;l++)c[l]=o.getInt32(l*4,!0);return c}if(this._type._bits==64){const a=t.read(s*8),o=new DataView(a.buffer,a.byteOffset,a.byteLength),c=new BigInt64Array(s);for(let l=0;l<s;l++)c[l]=o.getBigInt64(l*8,!0);return c}}const i=[];for(let a=0;a<s;a++)i.push(this._type.decodeValue(t,n._type));return i}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(t){return"vec {"+t.map(n=>this._type.valueToString(n)).join("; ")+"}"}}class Ct extends Jt{get typeName(){return $.OptClass}static[Symbol.hasInstance](t){return t.typeName===$.OptClass}constructor(t){super(),this._type=t}accept(t,r){return t.visitOpt(this,this._type,r)}covariant(t){try{if(Array.isArray(t)&&(t.length===0||t.length===1&&this._type.covariant(t[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${fe(t)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){return t.length===0?new Uint8Array([0]):X(new Uint8Array([1]),this._type.encodeValue(t[0]))}_buildTypeTableImpl(t){this._type.buildTypeTable(t);const r=ye(W.Opt),n=this._type.encodeType(t);t.add(this,X(r,n))}decodeValue(t,r){if(r instanceof Tn)return[];if(r instanceof Xt)return[];let n=r;if(r instanceof ze){const s=r.getType();if(typeof s>"u")throw new Error("type mismatch with uninitialized type");n=s}if(n instanceof Ct)switch(Tr(t)){case 0:return[];case 1:{const s=t.save();try{return[this._type.decodeValue(t,n._type)]}catch{return t.restore(s),n._type.decodeValue(t,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof Tn||this._type instanceof Ct||this._type instanceof Xt)return n.decodeValue(t,n),[];{const s=t.save();try{return[this._type.decodeValue(t,r)]}catch{return t.restore(s),n.decodeValue(t,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(t){return t.length===0?"null":`opt ${this._type.valueToString(t[0])}`}}class Or extends Jt{get typeName(){return $.RecordClass}static[Symbol.hasInstance](t){return t.typeName===$.RecordClass||t.typeName===$.TupleClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>ke(r[0])-ke(n[0]))}accept(t,r){return t.visitRecord(this,this._fields,r)}tryAsTuple(){const t=[];for(let r=0;r<this._fields.length;r++){const[n,s]=this._fields[r];if(n!==`_${r}_`)return null;t.push(s)}return t}covariant(t){if(typeof t=="object"&&this._fields.every(([r,n])=>{if(!t.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=this._fields.map(([s])=>t[s]),n=Nn(this._fields,r,([,s],i)=>s.encodeValue(i));return X(...n)}_buildTypeTableImpl(t){this._fields.forEach(([i,a])=>a.buildTypeTable(t));const r=ye(W.Record),n=ue(this._fields.length),s=this._fields.map(([i,a])=>X(ue(ke(i)),a.encodeType(t)));t.add(this,X(r,n,X(...s)))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof Or))throw new Error("Not a record type");const s={};let i=0,a=0;for(;a<n._fields.length;){const[o,c]=n._fields[a];if(i>=this._fields.length){c.decodeValue(t,c),a++;continue}const[l,f]=this._fields[i],d=ke(this._fields[i][0]),u=ke(o);if(d===u)s[l]=f.decodeValue(t,c),i++,a++;else if(u>d)if(f instanceof Ct||f instanceof Xt)s[l]=[],i++;else throw new Error("Cannot find required field "+l);else c.decodeValue(t,c),a++}for(const[o,c]of this._fields.slice(i))if(c instanceof Ct||c instanceof Xt)s[o]=[];else throw new Error("Cannot find required field "+o);return s}get fieldsAsObject(){const t={};for(const[r,n]of this._fields)t[ke(r)]=n;return t}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(t){const r=this._fields.map(([s])=>t[s]);return`record {${Nn(this._fields,r,([s,i],a)=>s+"="+i.valueToString(a)).join("; ")}}`}}class Qs extends Or{get typeName(){return $.TupleClass}static[Symbol.hasInstance](t){return t.typeName===$.TupleClass}constructor(t){const r={};t.forEach((n,s)=>r["_"+s+"_"]=n),super(r),this._components=t}accept(t,r){return t.visitTuple(this,this._components,r)}covariant(t){if(Array.isArray(t)&&t.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(t[n])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=Nn(this._components,t,(n,s)=>n.encodeValue(s));return X(...r)}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof Qs))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");const s=[];for(const[i,a]of n._components.entries())i>=this._components.length?a.decodeValue(t,a):s.push(this._components[i].decodeValue(t,a));return s}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(t){return`record {${Nn(this._components,t,(n,s)=>n.valueToString(s)).join("; ")}}`}}class en extends Jt{get typeName(){return $.VariantClass}static[Symbol.hasInstance](t){return t.typeName===$.VariantClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>ke(r[0])-ke(n[0]))}accept(t,r){return t.visitVariant(this,this._fields,r)}covariant(t){if(typeof t=="object"&&Object.entries(t).length===1&&this._fields.every(([r,n])=>{try{return!t.hasOwnProperty(r)||n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){for(let r=0;r<this._fields.length;r++){const[n,s]=this._fields[r];if(t.hasOwnProperty(n)){const i=ue(r),a=s.encodeValue(t[n]);return X(i,a)}}throw Error("Variant has no data: "+t)}_buildTypeTableImpl(t){this._fields.forEach(([,i])=>{i.buildTypeTable(t)});const r=ye(W.Variant),n=ue(this._fields.length),s=this._fields.map(([i,a])=>X(ue(ke(i)),a.encodeType(t)));t.add(this,X(r,n,...s))}decodeValue(t,r){const n=this.checkType(r);if(!(n instanceof en))throw new Error("Not a variant type");const s=Number(be(t));if(s>=n._fields.length)throw Error("Invalid variant index: "+s);const[i,a]=n._fields[s];for(const[o,c]of this._fields)if(ke(i)===ke(o)){const l=c.decodeValue(t,a);return{[o]:l}}throw new Error("Cannot find field hash "+i)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(t){for(const[r,n]of this._fields)if(t.hasOwnProperty(r)){const s=n.valueToString(t[r]);return s==="null"?`variant {${r}}`:`variant {${r}=${s}}`}throw new Error("Variant has no data: "+t)}get alternativesAsObject(){const t={};for(const[r,n]of this._fields)t[ke(r)]=n;return t}}const Hs=class Hs extends Jt{constructor(){super(...arguments),this._id=Hs._counter++}get typeName(){return $.RecClass}static[Symbol.hasInstance](t){return t.typeName===$.RecClass}accept(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return t.visitRec(this,this._type,r)}fill(t){this._type=t}getType(){return this._type}covariant(t){if(this._type&&this._type.covariant(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(t)}_buildTypeTableImpl(t){if(!this._type)throw Error("Recursive type uninitialized.");t.add(this,new Uint8Array([])),this._type.buildTypeTable(t),t.merge(this,this._type.name)}decodeValue(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(t,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`${this.name}.${this._type.name}`}valueToString(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(t)}};Hs._counter=0;let ze=Hs;function uo(e){if(Tr(e)!==1)throw new Error("Cannot decode principal");const r=Number(be(e));return D.fromUint8Array(new Uint8Array(Nr(e,r)))}class gu extends Ye{get typeName(){return $.PrincipalClass}static[Symbol.hasInstance](t){return t.typeName===$.PrincipalClass}accept(t,r){return t.visitPrincipal(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=t.toUint8Array(),n=ue(r.byteLength);return X(new Uint8Array([1]),n,r)}encodeType(){return ye(W.Principal)}decodeValue(t,r){return this.checkType(r),uo(t)}get name(){return"principal"}valueToString(t){return`${this.name} "${t.toText()}"`}}class In extends Jt{get typeName(){return $.FuncClass}static[Symbol.hasInstance](t){return t.typeName===$.FuncClass}static argsToString(t,r){if(t.length!==r.length)throw new Error("arity mismatch");return"("+t.map((n,s)=>n.valueToString(r[s])).join(", ")+")"}constructor(t,r,n=[]){super(),this.argTypes=t,this.retTypes=r,this.annotations=n}accept(t,r){return t.visitFunc(this,r)}covariant(t){if(Array.isArray(t)&&t.length===2&&t[0]&&t[0]._isPrincipal&&typeof t[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue([t,r]){const n=t.toUint8Array(),s=ue(n.byteLength),i=X(new Uint8Array([1]),s,n),a=new TextEncoder().encode(r),o=ue(a.byteLength);return X(new Uint8Array([1]),i,o,a)}_buildTypeTableImpl(t){this.argTypes.forEach(l=>l.buildTypeTable(t)),this.retTypes.forEach(l=>l.buildTypeTable(t));const r=ye(W.Func),n=ue(this.argTypes.length),s=X(...this.argTypes.map(l=>l.encodeType(t))),i=ue(this.retTypes.length),a=X(...this.retTypes.map(l=>l.encodeType(t))),o=ue(this.annotations.length),c=X(...this.annotations.map(l=>this.encodeAnnotation(l)));t.add(this,X(r,n,s,i,a,o,c))}decodeValue(t,r){const n=r instanceof ze?r.getType()??r:r;if(!lo(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(Tr(t)!==1)throw new Error("Cannot decode function reference");const i=uo(t),a=Number(be(t)),o=Nr(t,a),l=new TextDecoder("utf8",{fatal:!0}).decode(o);return[i,l]}get name(){const t=this.argTypes.map(s=>s.name).join(", "),r=this.retTypes.map(s=>s.name).join(", "),n=" "+this.annotations.join(" ");return`(${t}) -> (${r})${n}`}valueToString([t,r]){return`func "${t.toText()}".${r}`}display(){const t=this.argTypes.map(s=>s.display()).join(", "),r=this.retTypes.map(s=>s.display()).join(", "),n=" "+this.annotations.join(" ");return`(${t})  (${r})${n}`}encodeAnnotation(t){if(t==="query")return new Uint8Array([1]);if(t==="oneway")return new Uint8Array([2]);if(t==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}}class Cs extends Jt{get typeName(){return $.ServiceClass}static[Symbol.hasInstance](t){return t.typeName===$.ServiceClass}constructor(t){super(),this._fields=Object.entries(t).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(t,r){return t.visitService(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${fe(t)}`)}encodeValue(t){const r=t.toUint8Array(),n=ue(r.length);return X(new Uint8Array([1]),n,r)}_buildTypeTableImpl(t){this._fields.forEach(([i,a])=>a.buildTypeTable(t));const r=ye(W.Service),n=ue(this._fields.length),s=this._fields.map(([i,a])=>{const o=new TextEncoder().encode(i),c=ue(o.length);return X(c,o,a.encodeType(t))});t.add(this,X(r,n,...s))}decodeValue(t,r){const n=r instanceof ze?r.getType()??r:r;if(!lo(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return uo(t)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(t){return`service "${t.toText()}"`}fieldsAsObject(){const t={};for(const[r,n]of this._fields)t[r]=n;return t}}function fe(e){const t=JSON.stringify(e,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return t&&t.length>Ho?t.substring(0,Ho-3)+"...":t}function ba(e,t){if(t.length<e.length)throw Error("Wrong number of message arguments");const r=new Xd;e.forEach(o=>o.buildTypeTable(r));const n=r.encode(),s=ue(t.length),i=X(...e.map(o=>o.encodeType(r))),a=X(...Nn(e,t,(o,c)=>{try{o.covariant(c)}catch(l){throw new Error(l.message+`

`)}return o.encodeValue(c)}));return X(Wd,n,s,i,a)}function bu(e,t){const r=new sn(t);if(t.byteLength<ys.length)throw new Error("Message length smaller than magic number");const n=Nr(r,ys.length),s=new TextDecoder().decode(n);if(s!==ys)throw new Error("Wrong magic number: "+JSON.stringify(s));function i(u){const h=[],y=Number(be(u));for(let m=0;m<y;m++){const b=Number(qt(u));switch(b){case W.Opt:case W.Vector:{const p=Number(qt(u));h.push([b,p]);break}case W.Record:case W.Variant:{const p=[];let E=Number(be(u)),v;for(;E--;){const N=Number(be(u));if(N>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof v=="number"&&v>=N)throw new Error("field id collision or not sorted");v=N;const I=Number(qt(u));p.push([N,I])}h.push([b,p]);break}case W.Func:{const p=[];let E=Number(be(u));for(;E--;)p.push(Number(qt(u)));const v=[];let N=Number(be(u));for(;N--;)v.push(Number(qt(u)));const I=[];let O=Number(be(u));for(;O--;)switch(Number(be(u))){case 1:{I.push("query");break}case 2:{I.push("oneway");break}case 3:{I.push("composite_query");break}default:throw new Error("unknown annotation")}h.push([b,[p,v,I]]);break}case W.Service:{let p=Number(be(u));const E=[];for(;p--;){const v=Number(be(u)),N=new TextDecoder().decode(Nr(u,v)),I=qt(u);E.push([N,I])}h.push([b,E]);break}default:throw new Error("Illegal op_code: "+b)}}const _=[],g=Number(be(u));for(let m=0;m<g;m++)_.push(Number(qt(u)));return[h,_]}const[a,o]=i(r);if(o.length<e.length)throw new Error("Wrong number of return values");const c=a.map(u=>ju());function l(u){if(u<-24)throw new Error("future value not supported");if(u<0)switch(u){case-1:return vu;case-2:return Eu;case-3:return Iu;case-4:return Tu;case-5:return Vu;case-6:return ku;case-7:return Fu;case-8:return Uu;case-9:return Su;case-10:return Au;case-11:return Cu;case-12:return Bu;case-13:return Ou;case-14:return Ru;case-15:return Nu;case-16:return xu;case-17:return wu;case-24:return Pu;default:throw new Error("Illegal op_code: "+u)}if(u>=a.length)throw new Error("type index out of range");return c[u]}function f(u){switch(u[0]){case W.Vector:{const h=l(u[1]);return Mu(h)}case W.Opt:{const h=l(u[1]);return Lu(h)}case W.Record:{const h={};for(const[g,m]of u[1]){const b=`_${g}_`;h[b]=l(m)}const y=$u(h),_=y.tryAsTuple();return Array.isArray(_)?Du(..._):y}case W.Variant:{const h={};for(const[y,_]of u[1]){const g=`_${y}_`;h[g]=l(_)}return qu(h)}case W.Func:{const[h,y,_]=u[1];return Ku(h.map(g=>l(g)),y.map(g=>l(g)),_)}case W.Service:{const h={},y=u[1];for(const[_,g]of y){let m=l(g);if(m instanceof ze&&(m=m.getType()),!(m instanceof In))throw new Error("Illegal service definition: services can only contain functions");h[_]=m}return Gu(h)}default:throw new Error("Illegal op_code: "+u[0])}}a.forEach((u,h)=>{if(u[0]===W.Func){const y=f(u);c[h].fill(y)}}),a.forEach((u,h)=>{if(u[0]!==W.Func){const y=f(u);c[h].fill(y)}}),wa();const d=o.map(u=>l(u));try{const u=e.map((h,y)=>h.decodeValue(r,d[y]));for(let h=e.length;h<d.length;h++)d[h].decodeValue(r,d[h]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return u}finally{wa()}}const wu=new io,xu=new Xt,Qd=new mu,Eu=new yu,vu=new Tn,Nu=new _u,Tu=new ao,Iu=new oo,Ou=new co(32),Ru=new co(64),Su=new Ir(8),Au=new Ir(16),Cu=new Ir(32),Bu=new Ir(64),Vu=new Yt(8),ku=new Yt(16),Fu=new Yt(32),Uu=new Yt(64),Pu=new gu;function Du(...e){return new Qs(e)}function Mu(e){return new Qr(e)}function Lu(e){return new Ct(e)}function $u(e){return new Or(e)}function qu(e){return new en(e)}function ju(){return new ze}function Ku(e,t,r=[]){return new In(e,t,r)}function Gu(e){return new Cs(e)}class ei{constructor(t=new Map){this.rels=t}copy(){const t=new Map;for(const[r,n]of this.rels.entries()){const s=new Map(n);t.set(r,s)}return new ei(t)}known(t,r){return this.rels.get(t.name)?.get(r.name)}addNegative(t,r){this.addNames(t.name,r.name,!1)}add(t,r){this.addNames(t.name,r.name,!0)}display(){let t="";for(const[r,n]of this.rels)for(const[s,i]of n)t+=`${r} ${i?":<":"!<:"} ${s}
`;return t}addNames(t,r,n){const s=this.rels.get(t);if(s==null){const i=new Map;i.set(r,n),this.rels.set(t,i)}else s.set(r,n)}}let _s=new ei;function wa(){_s=new ei}function ef(e,t){const r=new Set(e.annotations),n=new Set(t.annotations);if(r.size!==n.size)return!1;for(const s of r)if(!n.has(s))return!1;return!0}function ji(e){return e instanceof Ct||e instanceof Tn||e instanceof Xt}function lo(e,t){const r=_s.copy(),n=wt(r,e,t);return n?_s.add(e,t):_s.addNegative(e,t),n}function wt(e,t,r){if(t.name===r.name)return!0;const n=e.known(t,r);if(n!==void 0)return n;if(e.add(t,r),r instanceof Xt||t instanceof io||t instanceof oo&&r instanceof ao)return!0;if(t instanceof Qr&&r instanceof Qr)return wt(e,t._type,r._type);if(r instanceof Ct)return!0;if(t instanceof Or&&r instanceof Or){const s=t.fieldsAsObject;for(const[i,a]of r._fields){const o=s[ke(i)];if(o){if(!wt(e,o,a))return!1}else if(!ji(a))return!1}return!0}if(t instanceof In&&r instanceof In){if(!ef(t,r))return!1;for(let s=0;s<t.argTypes.length;s++){const i=t.argTypes[s];if(s<r.argTypes.length){if(!wt(e,r.argTypes[s],i))return!1}else if(!ji(i))return!1}for(let s=0;s<r.retTypes.length;s++){const i=r.retTypes[s];if(s<t.retTypes.length){if(!wt(e,t.retTypes[s],i))return!1}else if(!ji(i))return!1}return!0}if(t instanceof en&&r instanceof en){const s=r.alternativesAsObject;for(const[i,a]of t._fields){const o=s[ke(i)];if(!o||!wt(e,a,o))return!1}return!0}if(t instanceof Cs&&r instanceof Cs){const s=t.fieldsAsObject();for(const[i,a]of r._fields){const o=s[i];if(!o||!wt(e,o,a))return!1}return!0}return t instanceof ze?wt(e,t.getType(),r):r instanceof ze?wt(e,t,r.getType()):!1}const tf=Object.freeze(Object.defineProperty({__proto__:null,Bool:Eu,BoolClass:yu,ConstructType:Jt,Empty:wu,EmptyClass:io,FixedIntClass:Ir,FixedNatClass:Yt,Float32:Ou,Float64:Ru,FloatClass:co,Func:Ku,FuncClass:In,Int:Tu,Int16:Au,Int32:Cu,Int64:Bu,Int8:Su,IntClass:ao,Nat:Iu,Nat16:ku,Nat32:Fu,Nat64:Uu,Nat8:Vu,NatClass:oo,Null:vu,NullClass:Tn,Opt:Lu,OptClass:Ct,PrimitiveType:Ye,Principal:Pu,PrincipalClass:gu,Rec:ju,RecClass:ze,Record:$u,RecordClass:Or,Reserved:xu,ReservedClass:Xt,Service:Gu,ServiceClass:Cs,Text:Nu,TextClass:_u,Tuple:Du,TupleClass:Qs,Type:Js,Unknown:Qd,UnknownClass:mu,Variant:qu,VariantClass:en,Vec:Mu,VecClass:Qr,Visitor:Jd,decode:bu,encode:ba,resetSubtypeCache:wa,subtype:lo},Symbol.toStringTag,{value:"Module"}));function Bs(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?Bs(e.buffer):new Uint8Array(e)}function ti(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function xa(e){if(typeof e=="string")return Hu(e);if(typeof e=="number")return Ge(ue(e));if(e instanceof Uint8Array||ArrayBuffer.isView(e))return Ge(Bs(e));if(Array.isArray(e)){const t=e.map(xa);return Ge(ee(...t))}else{if(e&&typeof e=="object"&&e._isPrincipal)return Ge(e.toUint8Array());if(typeof e=="object"&&e!==null&&typeof e.toHash=="function")return xa(e.toHash());if(typeof e=="object")return Vs(e);if(typeof e=="bigint")return Ge(ue(e))}throw ne.fromCode(new Ja(e))}const Hu=e=>{const t=new TextEncoder().encode(e);return Ge(t)};function jr(e){return Vs(e)}function Vs(e){const n=Object.entries(e).filter(([,a])=>a!==void 0).map(([a,o])=>{const c=Hu(a),l=xa(o);return[c,l]}).sort(([a],[o])=>Xs(a,o)),s=ee(...n.map(a=>ee(...a)));return Ge(s)}const rf=new TextEncoder().encode("\ric-state-root"),zu=new TextEncoder().encode(`
ic-request`),nf=new TextEncoder().encode("\vic-response"),sf=new TextEncoder().encode("ic-request-auth-delegation");class fo{getPrincipal(){return this._principal||(this._principal=D.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()))),this._principal}async transformRequest(t){const{body:r,...n}=t,s=jr(r);return{...n,body:{content:r,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(ee(zu,s))}}}}class Kr{getPrincipal(){return D.anonymous()}async transformRequest(t){return{...t,body:{content:t.body}}}}let Cr=class extends Error{constructor(t){super(t),this.name="DecodingError"}};const Zu=55799,Yu=Symbol("CBOR_STOP_CODE");var tt=(e=>(e[e.False=20]="False",e[e.True=21]="True",e[e.Null=22]="Null",e[e.Undefined=23]="Undefined",e[e.Break=31]="Break",e))(tt||{}),me=(e=>(e[e.UnsignedInteger=0]="UnsignedInteger",e[e.NegativeInteger=1]="NegativeInteger",e[e.ByteString=2]="ByteString",e[e.TextString=3]="TextString",e[e.Array=4]="Array",e[e.Map=5]="Map",e[e.Tag=6]="Tag",e[e.Simple=7]="Simple",e))(me||{});const af=23,of=255,cf=65535,uf=4294967295,lf=BigInt("0xffffffffffffffff");var et=(e=>(e[e.Value=23]="Value",e[e.OneByte=24]="OneByte",e[e.TwoBytes=25]="TwoBytes",e[e.FourBytes=26]="FourBytes",e[e.EightBytes=27]="EightBytes",e[e.Indefinite=31]="Indefinite",e))(et||{});const Gr=!1;function df(e){return e==null}function Wu(e,t){const r=new Uint8Array(t);return r.set(e),r}const ff=new TextDecoder;function hf(e){return(e&224)>>5}function pf(e){return e&31}let On=new Uint8Array,fn,rt=0;function mf(e,t){On=e,rt=0;const r=xr();return t?.(r)??r}function xr(e){const[t,r]=gs();switch(t){case me.UnsignedInteger:return an(r);case me.NegativeInteger:return bf(r);case me.ByteString:return Xu(r);case me.TextString:return Ea(r);case me.Array:return yf(r);case me.Map:return gf(r);case me.Tag:return wf(r);case me.Simple:return _f(r)}throw new Cr(`Unsupported major type: ${t}`)}function gs(){const e=On.at(rt);if(df(e))throw new Cr("Provided CBOR data is empty");const t=hf(e),r=pf(e);return rt++,[t,r]}function yf(e,t){const r=an(e);if(r===1/0){const s=[];let i=xr();for(;i!==Yu;)s.push(i),i=xr();return s}const n=new Array(r);for(let s=0;s<r;s++){const i=xr();n[s]=i}return n}function _f(e){switch(e){case tt.False:return!1;case tt.True:return!0;case tt.Null:return null;case tt.Undefined:return;case tt.Break:return Yu}throw new Cr(`Unrecognized simple type: ${e.toString(2)}`)}function gf(e,t){const r=an(e),n={};if(r===1/0){let[s,i]=gs();for(;s!==me.Simple&&i!==tt.Break;){const a=Ea(i),o=xr();n[a]=o,[s,i]=gs()}return n}for(let s=0;s<r;s++){const[i,a]=gs();if(i!==me.TextString)throw new Cr("Map keys must be text strings");const o=Ea(a),c=xr();n[o]=c}return n}function an(e){if(e<=et.Value)return e;switch(fn=new DataView(On.buffer,On.byteOffset+rt),e){case et.OneByte:return rt++,fn.getUint8(0);case et.TwoBytes:return rt+=2,fn.getUint16(0,Gr);case et.FourBytes:return rt+=4,fn.getUint32(0,Gr);case et.EightBytes:return rt+=8,fn.getBigUint64(0,Gr);case et.Indefinite:return 1/0;default:throw new Cr(`Unsupported integer info: ${e.toString(2)}`)}}function bf(e){const t=an(e);return typeof t=="number"?-1-t:-1n-t}function Xu(e){const t=an(e);if(t>Number.MAX_SAFE_INTEGER)throw new Cr("Byte length is too large");const r=Number(t);return rt+=r,On.slice(rt-r,rt)}function Ea(e){const t=Xu(e);return ff.decode(t)}function wf(e,t){const r=an(e);if(r===Zu)return xr();throw new Cr(`Unsupported tag: ${r}.`)}let ho=class extends Error{constructor(t){super(t),this.name="SerializationError"}};const xf=2*1024,Ef=100,vf=new TextEncoder;function hn(e){return e<<5}let Le=new Uint8Array(xf),Xe=new DataView(Le.buffer),pe=0,Ki=[];function Nf(e,t){pe=0;const r=t?.(e)??e;return Bf(Zu,r,t),Le.slice(0,pe)}function po(e,t){if(pe>Le.length-Ef&&(Le=Wu(Le,Le.length*2),Xe=new DataView(Le.buffer)),e===!1||e===!0||e===null||e===void 0){Of(e);return}if(typeof e=="number"||typeof e=="bigint"){Cf(e);return}if(typeof e=="string"){el(e);return}if(e instanceof Uint8Array){zo(e);return}if(e instanceof ArrayBuffer){zo(new Uint8Array(e));return}if(Array.isArray(e)){Tf(e,t);return}if(typeof e=="object"){If(e,t);return}throw new ho(`Unsupported type: ${typeof e}`)}function Tf(e,t){on(me.Array,e.length),e.forEach((r,n)=>{po(t?.(r,n.toString())??r,t)})}function If(e,t){Ki=Object.entries(e),on(me.Map,Ki.length),Ki.forEach(([r,n])=>{el(r),po(t?.(n,r)??n,t)})}function on(e,t){if(t<=af){Xe.setUint8(pe++,hn(e)|Number(t));return}if(t<=of){Xe.setUint8(pe++,hn(e)|et.OneByte),Xe.setUint8(pe,Number(t)),pe+=1;return}if(t<=cf){Xe.setUint8(pe++,hn(e)|et.TwoBytes),Xe.setUint16(pe,Number(t),Gr),pe+=2;return}if(t<=uf){Xe.setUint8(pe++,hn(e)|et.FourBytes),Xe.setUint32(pe,Number(t),Gr),pe+=4;return}if(t<=lf){Xe.setUint8(pe++,hn(e)|et.EightBytes),Xe.setBigUint64(pe,BigInt(t),Gr),pe+=8;return}throw new ho(`Value too large to encode: ${t}`)}function Of(e){on(me.Simple,Rf(e))}function Rf(e){if(e===!1)return tt.False;if(e===!0)return tt.True;if(e===null)return tt.Null;if(e===void 0)return tt.Undefined;throw new ho(`Unrecognized simple value: ${e.toString()}`)}function Ju(e,t){on(e,t.length),pe>Le.length-t.length&&(Le=Wu(Le,Le.length+t.length),Xe=new DataView(Le.buffer)),Le.set(t,pe),pe+=t.length}function Qu(e,t){on(e,t)}function Sf(e){Qu(me.UnsignedInteger,e)}function Af(e){Qu(me.NegativeInteger,typeof e=="bigint"?-1n-e:-1-e)}function Cf(e){e>=0?Sf(e):Af(e)}function el(e){Ju(me.TextString,vf.encode(e))}function zo(e){Ju(me.ByteString,e)}function Bf(e,t,r){on(me.Tag,e),po(t,r)}function Vf(e){return typeof e=="object"&&e!==null&&"toCborValue"in e}function Gi(e){try{return Nf(e,t=>D.isPrincipal(t)?t.toUint8Array():Hr.isExpiry(t)?t.toBigInt():Vf(t)?t.toCborValue():t)}catch(t){throw ne.fromCode(new za(t,e))}}function ct(e){try{return mf(e)}catch(t){throw ne.fromCode(new Ha(t,e))}}const us=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){const e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]}if(typeof crypto<"u"&&crypto.getRandomValues){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var yr;(function(e){e.Query="read",e.ReadState="read_state",e.Call="call"})(yr||(yr={}));var va;(function(e){e.Call="call"})(va||(va={}));var Rn;(function(e){e.Query="query",e.ReadState="read_state"})(Rn||(Rn={}));function Na(){const e=new ArrayBuffer(16),t=new DataView(e),r=us(),n=us(),s=us(),i=us();return t.setUint32(0,r),t.setUint32(4,n),t.setUint32(8,s),t.setUint32(12,i),Object.assign(new Uint8Array(e),{__nonce__:void 0})}const ls="__expiry__",Ta=BigInt(1e3),kf=BigInt(1e6),Ff=BigInt(60),Ia=Ff*Ta,Uf=BigInt(1)*Ia;function Pf(e){return e/Ta*Ta}function Df(e){return e/Ia*Ia}class Hr{constructor(t){this.__expiry__=t,this._isExpiry=!0}static fromDeltaInMilliseconds(t,r=0){const n=BigInt(Date.now())+BigInt(r),s=n+BigInt(t),i=Df(s);let a;return i>=n+Uf?a=i:a=Pf(s),new Hr(a*kf)}toBigInt(){return this.__expiry__}toHash(){return ue(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[ls]:this.toString()}}static fromJSON(t){const r=JSON.parse(t);if(r[ls])try{const n=BigInt(r[ls]);return new Hr(n)}catch(n){throw new ne(new As(`Not a valid BigInt: ${n}`))}throw new ne(new As(`The input does not contain the key ${ls}`))}static isExpiry(t){return t instanceof Hr||typeof t=="object"&&t!==null&&"_isExpiry"in t&&t._isExpiry===!0&&"__expiry__"in t&&typeof t.__expiry__=="bigint"}}function Zo(e=Na){return async t=>{const r=t.request.headers;t.request.headers=r,t.endpoint===yr.Call&&(t.body.nonce=e())}}function Yo(e){const t=[];return e.forEach((r,n)=>{t.push([n,r])}),t}const mo=BigInt(0),ks=BigInt(1);function Sn(e,t=""){if(typeof e!="boolean"){const r=t&&`"${t}"`;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function zr(e,t,r=""){const n=Jn(e),s=e?.length,i=t!==void 0;if(!n||i&&s!==t){const a=r&&`"${r}" `,o=i?` of length ${t}`:"",c=n?`length=${s}`:`type=${typeof e}`;throw new Error(a+"expected Uint8Array"+o+", got "+c)}return e}function tl(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?mo:BigInt("0x"+e)}function ft(e){return tl(re(e))}function An(e){return He(e),tl(re(Uint8Array.from(e).reverse()))}function ve(e,t){return dt(e.toString(16).padStart(t*2,"0"))}function rl(e,t){return ve(e,t).reverse()}function Ve(e,t,r){let n;if(typeof t=="string")try{n=dt(t)}catch(i){throw new Error(e+" must be hex string or Uint8Array, cause: "+i)}else if(Jn(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(e+" of length "+r+" expected, got "+s);return n}function Wo(e){return Uint8Array.from(e)}const Hi=e=>typeof e=="bigint"&&mo<=e;function nl(e,t,r){return Hi(e)&&Hi(t)&&Hi(r)&&t<=e&&e<r}function Xo(e,t,r,n){if(!nl(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Cn(e){let t;for(t=0;e>mo;e>>=ks,t+=1);return t}function Mf(e,t){return e>>BigInt(t)&ks}const Br=e=>(ks<<BigInt(e))-ks;function Lf(e){return typeof e=="function"&&Number.isSafeInteger(e.outputLen)}function rs(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,a){const o=e[s];if(a&&o===void 0)return;const c=typeof o;if(c!==i||o===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(t).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}const sl=()=>{throw new Error("not implemented")};function Bn(e){const t=new WeakMap;return(r,...n)=>{const s=t.get(r);if(s!==void 0)return s;const i=e(r,...n);return t.set(r,i),i}}const Ue=BigInt(0),Ne=BigInt(1),_r=BigInt(2),il=BigInt(3),al=BigInt(4),ol=BigInt(5),$f=BigInt(7),cl=BigInt(8),qf=BigInt(9),ul=BigInt(16);function de(e,t){const r=e%t;return r>=Ue?r:t+r}function it(e,t,r){let n=e;for(;t-- >Ue;)n*=n,n%=r;return n}function Jo(e,t){if(e===Ue)throw new Error("invert: expected non-zero number");if(t<=Ue)throw new Error("invert: expected positive modulus, got "+t);let r=de(e,t),n=t,s=Ue,i=Ne;for(;r!==Ue;){const o=n/r,c=n%r,l=s-i*o;n=r,r=c,s=i,i=l}if(n!==Ne)throw new Error("invert: does not exist");return de(s,t)}function yo(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function ll(e,t){const r=(e.ORDER+Ne)/al,n=e.pow(t,r);return yo(e,n,t),n}function jf(e,t){const r=(e.ORDER-ol)/cl,n=e.mul(t,_r),s=e.pow(n,r),i=e.mul(t,s),a=e.mul(e.mul(i,_r),s),o=e.mul(i,e.sub(a,e.ONE));return yo(e,o,t),o}function Kf(e){const t=Qt(e),r=dl(e),n=r(t,t.neg(t.ONE)),s=r(t,n),i=r(t,t.neg(n)),a=(e+$f)/ul;return(o,c)=>{let l=o.pow(c,a),f=o.mul(l,n);const d=o.mul(l,s),u=o.mul(l,i),h=o.eql(o.sqr(f),c),y=o.eql(o.sqr(d),c);l=o.cmov(l,f,h),f=o.cmov(u,d,y);const _=o.eql(o.sqr(f),c),g=o.cmov(l,f,_);return yo(o,g,c),g}}function dl(e){if(e<il)throw new Error("sqrt is not defined for small field");let t=e-Ne,r=0;for(;t%_r===Ue;)t/=_r,r++;let n=_r;const s=Qt(e);for(;Fs(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return ll;let i=s.pow(n,t);const a=(t+Ne)/_r;return function(c,l){if(c.is0(l))return l;if(Fs(c,l)!==1)throw new Error("Cannot find square root");let f=r,d=c.mul(c.ONE,i),u=c.pow(l,t),h=c.pow(l,a);for(;!c.eql(u,c.ONE);){if(c.is0(u))return c.ZERO;let y=1,_=c.sqr(u);for(;!c.eql(_,c.ONE);)if(y++,_=c.sqr(_),y===f)throw new Error("Cannot find square root");const g=Ne<<BigInt(f-y-1),m=c.pow(d,g);f=y,d=c.sqr(m),u=c.mul(u,d),h=c.mul(h,m)}return h}}function Gf(e){return e%al===il?ll:e%cl===ol?jf:e%ul===qf?Kf(e):dl(e)}const Hf=(e,t)=>(de(e,t)&Ne)===Ne,zf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fl(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=zf.reduce((n,s)=>(n[s]="function",n),t);return rs(e,r),e}function ri(e,t,r){if(r<Ue)throw new Error("invalid exponent, negatives unsupported");if(r===Ue)return e.ONE;if(r===Ne)return t;let n=e.ONE,s=t;for(;r>Ue;)r&Ne&&(n=e.mul(n,s)),s=e.sqr(s),r>>=Ne;return n}function Vr(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),s=t.reduce((a,o,c)=>e.is0(o)?a:(n[c]=a,e.mul(a,o)),e.ONE),i=e.inv(s);return t.reduceRight((a,o,c)=>e.is0(o)?a:(n[c]=e.mul(a,n[c]),e.mul(a,o)),i),n}function Fs(e,t){const r=(e.ORDER-Ne)/_r,n=e.pow(t,r),s=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),a=e.eql(n,e.neg(e.ONE));if(!s&&!i&&!a)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function Zf(e,t){t!==void 0&&xd(t);const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Qt(e,t,r=!1,n={}){if(e<=Ue)throw new Error("invalid field: expected ORDER > 0, got "+e);let s,i,a=!1,o;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=t;u.BITS&&(s=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(a=u.modFromBytes),o=u.allowedLengths}else typeof t=="number"&&(s=t),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=Zf(e,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let f;const d=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:l,MASK:Br(c),ZERO:Ue,ONE:Ne,allowedLengths:o,create:u=>de(u,e),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Ue<=u&&u<e},is0:u=>u===Ue,isValidNot0:u=>!d.is0(u)&&d.isValid(u),isOdd:u=>(u&Ne)===Ne,neg:u=>de(-u,e),eql:(u,h)=>u===h,sqr:u=>de(u*u,e),add:(u,h)=>de(u+h,e),sub:(u,h)=>de(u-h,e),mul:(u,h)=>de(u*h,e),pow:(u,h)=>ri(d,u,h),div:(u,h)=>de(u*Jo(h,e),e),sqrN:u=>u*u,addN:(u,h)=>u+h,subN:(u,h)=>u-h,mulN:(u,h)=>u*h,inv:u=>Jo(u,e),sqrt:i||(u=>(f||(f=Gf(e)),f(d,u))),toBytes:u=>r?rl(u,l):ve(u,l),fromBytes:(u,h=!0)=>{if(o){if(!o.includes(u.length)||u.length>l)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+u.length);const _=new Uint8Array(l);_.set(u,r?0:_.length-u.length),u=_}if(u.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+u.length);let y=r?An(u):ft(u);if(a&&(y=de(y,e)),!h&&!d.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y},invertBatch:u=>Vr(d,u),cmov:(u,h,y)=>y?h:u});return Object.freeze(d)}function hl(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function pl(e){const t=hl(e);return t+Math.ceil(t/2)}function Yf(e,t,r=!1){const n=e.length,s=hl(t),i=pl(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const a=r?An(e):ft(e),o=de(a,t-Ne)+Ne;return r?rl(o,s):ve(o,s)}const tn=BigInt(0),gr=BigInt(1);function Us(e,t){const r=t.negate();return e?r:t}function Tt(e,t){const r=Vr(e.Fp,t.map(n=>n.Z));return t.map((n,s)=>e.fromAffine(n.toAffine(r[s])))}function ml(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function zi(e,t){ml(e,t);const r=Math.ceil(t/e)+1,n=2**(e-1),s=2**e,i=Br(e),a=BigInt(e);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:a}}function Qo(e,t,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:a}=r;let o=Number(e&s),c=e>>a;o>n&&(o-=i,c+=gr);const l=t*n,f=l+Math.abs(o)-1,d=o===0,u=o<0,h=t%2!==0;return{nextN:c,offset:f,isZero:d,isNeg:u,isNegF:h,offsetF:l}}function Wf(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Xf(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Zi=new WeakMap,yl=new WeakMap;function Yi(e){return yl.get(e)||1}function ec(e){if(e!==tn)throw new Error("invalid wNAF")}class _l{constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let s=t;for(;r>tn;)r&gr&&(n=n.add(s)),s=s.double(),r>>=gr;return n}precomputeWindow(t,r){const{windows:n,windowSize:s}=zi(r,this.bits),i=[];let a=t,o=a;for(let c=0;c<n;c++){o=a,i.push(o);for(let l=1;l<s;l++)o=o.add(a),i.push(o);a=o.double()}return i}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const a=zi(t,this.bits);for(let o=0;o<a.windows;o++){const{nextN:c,offset:l,isZero:f,isNeg:d,isNegF:u,offsetF:h}=Qo(n,o,a);n=c,f?i=i.add(Us(u,r[h])):s=s.add(Us(d,r[l]))}return ec(n),{p:s,f:i}}wNAFUnsafe(t,r,n,s=this.ZERO){const i=zi(t,this.bits);for(let a=0;a<i.windows&&n!==tn;a++){const{nextN:o,offset:c,isZero:l,isNeg:f}=Qo(n,a,i);if(n=o,!l){const d=r[c];s=s.add(f?d.negate():d)}}return ec(n),s}getPrecomputes(t,r,n){let s=Zi.get(r);return s||(s=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(s=n(s)),Zi.set(r,s))),s}cached(t,r,n){const s=Yi(t);return this.wNAF(s,this.getPrecomputes(s,t,n),r)}unsafe(t,r,n,s){const i=Yi(t);return i===1?this._unsafeLadder(t,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,t,n),r,s)}createCache(t,r){ml(r,this.bits),yl.set(t,r),Zi.delete(t)}hasCache(t){return Yi(t)!==1}}function Jf(e,t,r,n){let s=t,i=e.ZERO,a=e.ZERO;for(;r>tn||n>tn;)r&gr&&(i=i.add(s)),n&gr&&(a=a.add(s)),s=s.double(),r>>=gr,n>>=gr;return{p1:i,p2:a}}function gl(e,t,r,n){Wf(r,e),Xf(n,t);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const a=e.ZERO,o=Cn(BigInt(s));let c=1;o>12?c=o-3:o>4?c=o-2:o>0&&(c=2);const l=Br(c),f=new Array(Number(l)+1).fill(a),d=Math.floor((t.BITS-1)/c)*c;let u=a;for(let h=d;h>=0;h-=c){f.fill(a);for(let _=0;_<i;_++){const g=n[_],m=Number(g>>BigInt(h)&l);f[m]=f[m].add(r[_])}let y=a;for(let _=f.length-1,g=a;_>0;_--)g=g.add(f[_]),y=y.add(g);if(u=u.add(y),h!==0)for(let _=0;_<c;_++)u=u.double()}return u}function tc(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return fl(t),t}else return Qt(e,{isLE:r})}function bl(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const c of["p","n","h"]){const l=t[c];if(!(typeof l=="bigint"&&l>tn))throw new Error(`CURVE.${c} must be positive bigint`)}const s=tc(t.p,r.Fp,n),i=tc(t.n,r.Fn,n),o=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const c of o)if(!s.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:s,Fn:i}}const Qf=ft;function jt(e,t){if(Vn(e),Vn(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=e&255,e>>>=8;return new Uint8Array(r)}function eh(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function Vn(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function wl(e){if(!Jn(e)&&typeof e!="string")throw new Error("DST must be Uint8Array or string");return typeof e=="string"?Q(e):e}function th(e,t,r,n){He(e),Vn(r),t=wl(t),t.length>255&&(t=n(ee(Q("H2C-OVERSIZE-DST-"),t)));const{outputLen:s,blockLen:i}=n,a=Math.ceil(r/s);if(r>65535||a>255)throw new Error("expand_message_xmd: invalid lenInBytes");const o=ee(t,jt(t.length,1)),c=jt(0,i),l=jt(r,2),f=new Array(a),d=n(ee(c,e,l,jt(0,1),o));f[0]=n(ee(d,jt(1,1),o));for(let h=1;h<=a;h++){const y=[eh(d,f[h-1]),jt(h+1,1),o];f[h]=n(ee(...y))}return ee(...f).slice(0,r)}function rh(e,t,r,n,s){if(He(e),Vn(r),t=wl(t),t.length>255){const i=Math.ceil(2*n/8);t=s.create({dkLen:i}).update(Q("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return s.create({dkLen:r}).update(e).update(jt(r,2)).update(t).update(jt(t.length,1)).digest()}function Wi(e,t,r){rs(r,{p:"bigint",m:"number",k:"number",hash:"function"});const{p:n,k:s,m:i,hash:a,expand:o,DST:c}=r;if(!Lf(r.hash))throw new Error("expected valid hash");He(e),Vn(t);const l=n.toString(2).length,f=Math.ceil((l+s)/8),d=t*i*f;let u;if(o==="xmd")u=th(e,c,d,a);else if(o==="xof")u=rh(e,c,d,s,a);else if(o==="_internal_pass")u=e;else throw new Error('expand must be "xmd" or "xof"');const h=new Array(t);for(let y=0;y<t;y++){const _=new Array(i);for(let g=0;g<i;g++){const m=f*(g+y*i),b=u.subarray(m,m+f);_[g]=de(Qf(b),n)}h[y]=_}return h}function xl(e,t){const r=t.map(n=>Array.from(n).reverse());return(n,s)=>{const[i,a,o,c]=r.map(d=>d.reduce((u,h)=>e.add(e.mul(u,n),h))),[l,f]=Vr(e,[a,c],!0);return n=e.mul(i,l),s=e.mul(s,e.mul(o,f)),{x:n,y:s}}}const nh=Q("HashToScalar-");function rc(e,t,r){if(typeof t!="function")throw new Error("mapToCurve() must be defined");function n(i){return e.fromAffine(t(i))}function s(i){const a=i.clearCofactor();return a.equals(e.ZERO)?e.ZERO:(a.assertValidity(),a)}return{defaults:r,hashToCurve(i,a){const o=Object.assign({},r,a),c=Wi(i,2,o),l=n(c[0]),f=n(c[1]);return s(l.add(f))},encodeToCurve(i,a){const o=r.encodeDST?{DST:r.encodeDST}:{},c=Object.assign({},r,o,a),l=Wi(i,1,c),f=n(l[0]);return s(f)},mapToCurve(i){if(!Array.isArray(i))throw new Error("expected array of bigints");for(const a of i)if(typeof a!="bigint")throw new Error("expected array of bigints");return s(n(i))},hashToScalar(i,a){const o=e.Fn.ORDER,c=Object.assign({},r,{p:o,m:1,DST:nh},a);return Wi(i,1,c)[0][0]}}}const nc=(e,t)=>(e+(e>=0?t:-t)/xt)/t;function sh(e,t,r){const[[n,s],[i,a]]=t,o=nc(a*e,r),c=nc(-s*e,r);let l=e-o*n-c*i,f=-o*s-c*a;const d=l<br,u=f<br;d&&(l=-l),u&&(f=-f);const h=Br(Math.ceil(Cn(r)/2))+Ae;if(l<br||l>=h||f<br||f>=h)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:l,k2neg:u,k2:f}}const br=BigInt(0),Ae=BigInt(1),xt=BigInt(2),Lr=BigInt(3),Oa=BigInt(4);function Ps(e,t){const{BYTES:r}=e;let n;if(typeof t=="bigint")n=t;else{let s=Ve("private key",t);try{n=e.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function ih(e,t={}){const r=bl("weierstrass",e,t),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:a,n:o}=i;rs(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=ch(n,s);function f(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(A,w,T){const{x:C,y:F}=w.toAffine(),L=n.toBytes(C);if(Sn(T,"isCompressed"),T){f();const S=!n.isOdd(F);return ee(ah(S),L)}else return ee(Uint8Array.of(4),L,n.toBytes(F))}function u(A){zr(A,void 0,"Point");const{publicKey:w,publicKeyUncompressed:T}=l,C=A.length,F=A[0],L=A.subarray(1);if(C===w&&(F===2||F===3)){const S=n.fromBytes(L);if(!n.isValid(S))throw new Error("bad point: is not on curve, wrong x");const V=_(S);let k;try{k=n.sqrt(V)}catch(se){const te=se instanceof Error?": "+se.message:"";throw new Error("bad point: is not on curve, sqrt error"+te)}f();const U=n.isOdd(k);return(F&1)===1!==U&&(k=n.neg(k)),{x:S,y:k}}else if(C===T&&F===4){const S=n.BYTES,V=n.fromBytes(L.subarray(0,S)),k=n.fromBytes(L.subarray(S,S*2));if(!g(V,k))throw new Error("bad point: is not on curve");return{x:V,y:k}}else throw new Error(`bad point: got length ${C}, expected compressed=${w} or uncompressed=${T}`)}const h=t.toBytes||d,y=t.fromBytes||u;function _(A){const w=n.sqr(A),T=n.mul(w,A);return n.add(n.add(T,n.mul(A,i.a)),i.b)}function g(A,w){const T=n.sqr(w),C=_(A);return n.eql(T,C)}if(!g(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const m=n.mul(n.pow(i.a,Lr),Oa),b=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(m,b)))throw new Error("bad curve params: a or b");function p(A,w,T=!1){if(!n.isValid(w)||T&&n.is0(w))throw new Error(`bad point coordinate ${A}`);return w}function E(A){if(!(A instanceof x))throw new Error("ProjectivePoint expected")}function v(A){if(!c||!c.basises)throw new Error("no endo");return sh(A,c.basises,s.ORDER)}const N=Bn((A,w)=>{const{X:T,Y:C,Z:F}=A;if(n.eql(F,n.ONE))return{x:T,y:C};const L=A.is0();w==null&&(w=L?n.ONE:n.inv(F));const S=n.mul(T,w),V=n.mul(C,w),k=n.mul(F,w);if(L)return{x:n.ZERO,y:n.ZERO};if(!n.eql(k,n.ONE))throw new Error("invZ was invalid");return{x:S,y:V}}),I=Bn(A=>{if(A.is0()){if(t.allowInfinityPoint&&!n.is0(A.Y))return;throw new Error("bad point: ZERO")}const{x:w,y:T}=A.toAffine();if(!n.isValid(w)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!g(w,T))throw new Error("bad point: equation left != right");if(!A.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function O(A,w,T,C,F){return T=new x(n.mul(T.X,A),T.Y,T.Z),w=Us(C,w),T=Us(F,T),w.add(T)}class x{constructor(w,T,C){this.X=p("x",w),this.Y=p("y",T,!0),this.Z=p("z",C),Object.freeze(this)}static CURVE(){return i}static fromAffine(w){const{x:T,y:C}=w||{};if(!w||!n.isValid(T)||!n.isValid(C))throw new Error("invalid affine point");if(w instanceof x)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(C)?x.ZERO:new x(T,C,n.ONE)}static fromBytes(w){const T=x.fromAffine(y(zr(w,void 0,"point")));return T.assertValidity(),T}static fromHex(w){return x.fromBytes(Ve("pointHex",w))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(w=8,T=!0){return B.createCache(this,w),T||this.multiply(Lr),this}assertValidity(){I(this)}hasEvenY(){const{y:w}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(w)}equals(w){E(w);const{X:T,Y:C,Z:F}=this,{X:L,Y:S,Z:V}=w,k=n.eql(n.mul(T,V),n.mul(L,F)),U=n.eql(n.mul(C,V),n.mul(S,F));return k&&U}negate(){return new x(this.X,n.neg(this.Y),this.Z)}double(){const{a:w,b:T}=i,C=n.mul(T,Lr),{X:F,Y:L,Z:S}=this;let V=n.ZERO,k=n.ZERO,U=n.ZERO,P=n.mul(F,F),se=n.mul(L,L),te=n.mul(S,S),Z=n.mul(F,L);return Z=n.add(Z,Z),U=n.mul(F,S),U=n.add(U,U),V=n.mul(w,U),k=n.mul(C,te),k=n.add(V,k),V=n.sub(se,k),k=n.add(se,k),k=n.mul(V,k),V=n.mul(Z,V),U=n.mul(C,U),te=n.mul(w,te),Z=n.sub(P,te),Z=n.mul(w,Z),Z=n.add(Z,U),U=n.add(P,P),P=n.add(U,P),P=n.add(P,te),P=n.mul(P,Z),k=n.add(k,P),te=n.mul(L,S),te=n.add(te,te),P=n.mul(te,Z),V=n.sub(V,P),U=n.mul(te,se),U=n.add(U,U),U=n.add(U,U),new x(V,k,U)}add(w){E(w);const{X:T,Y:C,Z:F}=this,{X:L,Y:S,Z:V}=w;let k=n.ZERO,U=n.ZERO,P=n.ZERO;const se=i.a,te=n.mul(i.b,Lr);let Z=n.mul(T,L),z=n.mul(C,S),ie=n.mul(F,V),_e=n.add(T,C),J=n.add(L,S);_e=n.mul(_e,J),J=n.add(Z,z),_e=n.sub(_e,J),J=n.add(T,F);let he=n.add(L,V);return J=n.mul(J,he),he=n.add(Z,ie),J=n.sub(J,he),he=n.add(C,F),k=n.add(S,V),he=n.mul(he,k),k=n.add(z,ie),he=n.sub(he,k),P=n.mul(se,J),k=n.mul(te,ie),P=n.add(k,P),k=n.sub(z,P),P=n.add(z,P),U=n.mul(k,P),z=n.add(Z,Z),z=n.add(z,Z),ie=n.mul(se,ie),J=n.mul(te,J),z=n.add(z,ie),ie=n.sub(Z,ie),ie=n.mul(se,ie),J=n.add(J,ie),Z=n.mul(z,J),U=n.add(U,Z),Z=n.mul(he,J),k=n.mul(_e,k),k=n.sub(k,Z),Z=n.mul(_e,z),P=n.mul(he,P),P=n.add(P,Z),new x(k,U,P)}subtract(w){return this.add(w.negate())}is0(){return this.equals(x.ZERO)}multiply(w){const{endo:T}=t;if(!s.isValidNot0(w))throw new Error("invalid scalar: out of range");let C,F;const L=S=>B.cached(this,S,V=>Tt(x,V));if(T){const{k1neg:S,k1:V,k2neg:k,k2:U}=v(w),{p:P,f:se}=L(V),{p:te,f:Z}=L(U);F=se.add(Z),C=O(T.beta,P,te,S,k)}else{const{p:S,f:V}=L(w);C=S,F=V}return Tt(x,[C,F])[0]}multiplyUnsafe(w){const{endo:T}=t,C=this;if(!s.isValid(w))throw new Error("invalid scalar: out of range");if(w===br||C.is0())return x.ZERO;if(w===Ae)return C;if(B.hasCache(this))return this.multiply(w);if(T){const{k1neg:F,k1:L,k2neg:S,k2:V}=v(w),{p1:k,p2:U}=Jf(x,C,L,V);return O(T.beta,k,U,F,S)}else return B.unsafe(C,w)}multiplyAndAddUnsafe(w,T,C){const F=this.multiplyUnsafe(T).add(w.multiplyUnsafe(C));return F.is0()?void 0:F}toAffine(w){return N(this,w)}isTorsionFree(){const{isTorsionFree:w}=t;return a===Ae?!0:w?w(x,this):B.unsafe(this,o).is0()}clearCofactor(){const{clearCofactor:w}=t;return a===Ae?this:w?w(x,this):this.multiplyUnsafe(a)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}toBytes(w=!0){return Sn(w,"isCompressed"),this.assertValidity(),h(x,this,w)}toHex(w=!0){return re(this.toBytes(w))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(w=!0){return this.toBytes(w)}_setWindowSize(w){this.precompute(w)}static normalizeZ(w){return Tt(x,w)}static msm(w,T){return gl(x,s,w,T)}static fromPrivateKey(w){return x.BASE.multiply(Ps(s,w))}}x.BASE=new x(i.Gx,i.Gy,n.ONE),x.ZERO=new x(n.ZERO,n.ONE,n.ZERO),x.Fp=n,x.Fn=s;const R=s.BITS,B=new _l(x,t.endo?Math.ceil(R/2):R);return x.BASE.precompute(8),x}function ah(e){return Uint8Array.of(e?2:3)}function oh(e,t){const r=e.ORDER;let n=br;for(let y=r-Ae;y%xt===br;y/=xt)n+=Ae;const s=n,i=xt<<s-Ae-Ae,a=i*xt,o=(r-Ae)/a,c=(o-Ae)/xt,l=a-Ae,f=i,d=e.pow(t,o),u=e.pow(t,(o+Ae)/xt);let h=(y,_)=>{let g=d,m=e.pow(_,l),b=e.sqr(m);b=e.mul(b,_);let p=e.mul(y,b);p=e.pow(p,c),p=e.mul(p,m),m=e.mul(p,_),b=e.mul(p,y);let E=e.mul(b,m);p=e.pow(E,f);let v=e.eql(p,e.ONE);m=e.mul(b,u),p=e.mul(E,g),b=e.cmov(m,b,v),E=e.cmov(p,E,v);for(let N=s;N>Ae;N--){let I=N-xt;I=xt<<I-Ae;let O=e.pow(E,I);const x=e.eql(O,e.ONE);m=e.mul(b,g),g=e.mul(g,g),O=e.mul(E,g),b=e.cmov(m,b,x),E=e.cmov(O,E,x)}return{isValid:v,value:b}};if(e.ORDER%Oa===Lr){const y=(e.ORDER-Lr)/Oa,_=e.sqrt(e.neg(t));h=(g,m)=>{let b=e.sqr(m);const p=e.mul(g,m);b=e.mul(b,p);let E=e.pow(b,y);E=e.mul(E,p);const v=e.mul(E,_),N=e.mul(e.sqr(E),m),I=e.eql(N,g);let O=e.cmov(v,E,I);return{isValid:I,value:O}}}return h}function El(e,t){fl(e);const{A:r,B:n,Z:s}=t;if(!e.isValid(r)||!e.isValid(n)||!e.isValid(s))throw new Error("mapToCurveSimpleSWU: invalid opts");const i=oh(e,s);if(!e.isOdd)throw new Error("Field does not have .isOdd()");return a=>{let o,c,l,f,d,u,h,y;o=e.sqr(a),o=e.mul(o,s),c=e.sqr(o),c=e.add(c,o),l=e.add(c,e.ONE),l=e.mul(l,n),f=e.cmov(s,e.neg(c),!e.eql(c,e.ZERO)),f=e.mul(f,r),c=e.sqr(l),u=e.sqr(f),d=e.mul(u,r),c=e.add(c,d),c=e.mul(c,l),u=e.mul(u,f),d=e.mul(u,n),c=e.add(c,d),h=e.mul(o,l);const{isValid:_,value:g}=i(c,u);y=e.mul(o,a),y=e.mul(y,g),h=e.cmov(h,l,_),y=e.cmov(y,g,_);const m=e.isOdd(a)===e.isOdd(y);y=e.cmov(e.neg(y),y,m);const b=Vr(e,[f],!0)[0];return h=e.mul(h,b),{x:h,y}}}function ch(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function sc(e){const{CURVE:t,curveOpts:r}=uh(e),n=ih(t,r);return dh(e,n)}function uh(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp;let n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0;const s=Qt(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:i}}function lh(e,t,r){function n(s){const i=e.sqr(s),a=e.mul(i,s);return e.add(e.add(a,e.mul(s,t)),r)}return n}function dh(e,t){const{Fp:r,Fn:n}=t;function s(a){return nl(a,Ae,n.ORDER)}const i=lh(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:a=>Ps(n,a),weierstrassEquation:i,isWithinCurveOrder:s})}const fh=BigInt(0),ds=BigInt(1),ic=BigInt(2),$r=BigInt(3);function hh(e){const t=[];for(;e>ds;e>>=ds)(e&ds)===fh?t.unshift(0):(e&$r)===$r?(t.unshift(-1),e+=ds):t.unshift(1);return t}function Xi(e){if(!Array.isArray(e)||e.length===0)throw new Error("expected non-empty array")}function ph(e,t,r,n){const{Fp2:s,Fp12:i}=e,{twistType:a,ateLoopSize:o,xNegative:c,postPrecompute:l}=n;let f;if(a==="multiplicative")f=(p,E,v,N,I,O)=>i.mul014(N,p,s.mul(E,I),s.mul(v,O));else if(a==="divisive")f=(p,E,v,N,I,O)=>i.mul034(N,s.mul(v,O),s.mul(E,I),p);else throw new Error("bls: unknown twist type");const d=s.div(s.ONE,s.mul(s.ONE,ic));function u(p,E,v,N){const I=s.sqr(v),O=s.sqr(N),x=s.mulByB(s.mul(O,$r)),R=s.mul(x,$r),B=s.sub(s.sub(s.sqr(s.add(v,N)),O),I),A=s.sub(x,I),w=s.mul(s.sqr(E),$r),T=s.neg(B);return p.push([A,w,T]),E=s.mul(s.mul(s.mul(s.sub(I,R),E),v),d),v=s.sub(s.sqr(s.mul(s.add(I,R),d)),s.mul(s.sqr(x),$r)),N=s.mul(I,B),{Rx:E,Ry:v,Rz:N}}function h(p,E,v,N,I,O){const x=s.sub(v,s.mul(O,N)),R=s.sub(E,s.mul(I,N)),B=s.sub(s.mul(x,I),s.mul(R,O)),A=s.neg(x),w=R;p.push([B,A,w]);const T=s.sqr(R),C=s.mul(T,R),F=s.mul(T,E),L=s.add(s.sub(C,s.mul(F,ic)),s.mul(s.sqr(x),N));return E=s.mul(R,L),v=s.sub(s.mul(s.sub(F,L),x),s.mul(C,v)),N=s.mul(N,C),{Rx:E,Ry:v,Rz:N}}const y=hh(o),_=Bn(p=>{const E=p,{x:v,y:N}=E.toAffine(),I=v,O=N,x=s.neg(N);let R=I,B=O,A=s.ONE;const w=[];for(const T of y){const C=[];({Rx:R,Ry:B,Rz:A}=u(C,R,B,A)),T&&({Rx:R,Ry:B,Rz:A}=h(C,R,B,A,I,T===-1?x:O)),w.push(C)}if(l){const T=w[w.length-1];l(R,B,A,I,O,h.bind(null,T))}return w});function g(p,E=!1){let v=i.ONE;if(p.length){const N=p[0][0].length;for(let I=0;I<N;I++){v=i.sqr(v);for(const[O,x,R]of p)for(const[B,A,w]of O[I])v=f(B,A,w,v,x,R)}}return c&&(v=i.conjugate(v)),E?i.finalExponentiate(v):v}function m(p,E=!0){const v=[];Tt(t,p.map(({g1:N})=>N)),Tt(r,p.map(({g2:N})=>N));for(const{g1:N,g2:I}of p){if(N.is0()||I.is0())throw new Error("pairing is not available for ZERO point");N.assertValidity(),I.assertValidity();const O=N.toAffine();v.push([_(I),O.x,O.y])}return g(v,E)}function b(p,E,v=!0){return m([{g1:p,g2:E}],v)}return{Fp12:i,millerLoopBatch:g,pairing:b,pairingBatch:m,calcPairingPrecomputes:_}}function ac(e,t,r,n,s){const{Fp12:i,pairingBatch:a}=e;function o(d){return d instanceof t.Point?d:t.Point.fromHex(d)}function c(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function l(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${s?"G1":"G2"} curve`);return d}const f=s?(d,u)=>({g1:u,g2:d}):(d,u)=>({g1:d,g2:u});return{getPublicKey(d){const u=Ps(t.Point.Fn,d);return t.Point.BASE.multiply(u)},sign(d,u,h){if(h!=null)throw new Error("sign() expects 2 arguments");const y=Ps(t.Point.Fn,u);return l(d).assertValidity(),d.multiply(y)},verify(d,u,h,y){if(y!=null)throw new Error("verify() expects 3 arguments");d=c(d),h=o(h);const _=h.negate(),g=t.Point.BASE,m=l(u),b=d,p=a([f(_,m),f(g,b)]);return i.eql(p,i.ONE)},verifyBatch(d,u,h){if(Xi(u),h.length!==u.length)throw new Error("amount of public keys and messages should be equal");const y=c(d),_=u,g=h.map(o),m=new Map;for(let E=0;E<g.length;E++){const v=g[E],N=_[E];let I=m.get(N);I===void 0&&(I=[],m.set(N,I)),I.push(v)}const b=[],p=t.Point.BASE;try{for(const[E,v]of m){const N=v.reduce((I,O)=>I.add(O));b.push(f(N,E))}return b.push(f(p.negate(),y)),i.eql(a(b),i.ONE)}catch{return!1}},aggregatePublicKeys(d){Xi(d),d=d.map(h=>o(h));const u=d.reduce((h,y)=>h.add(y),t.Point.ZERO);return u.assertValidity(),u},aggregateSignatures(d){Xi(d),d=d.map(h=>c(h));const u=d.reduce((h,y)=>h.add(y),r.Point.ZERO);return u.assertValidity(),u},hash(d,u){He(d);const h=u?{DST:u}:void 0;return r.hashToCurve(d,h)},Signature:n}}function mh(e){const{Fp:t,Fr:r,Fp2:n,Fp6:s,Fp12:i}=e.fields,a=sc(e.G1),o=Object.assign(a,rc(a.Point,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),c=sc(e.G2),l=Object.assign(c,rc(c.Point,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults})),f=ph(e.fields,o.Point,l.Point,{...e.params,postPrecompute:e.postPrecompute}),{millerLoopBatch:d,pairing:u,pairingBatch:h,calcPairingPrecomputes:y}=f,_=ac(f,o,l,e.G2.Signature,!1),g=ac(f,l,o,e.G1.ShortSignature,!0),m=e.randomBytes||ou,b=()=>{const S=pl(r.ORDER);return Yf(m(S),r.ORDER)},p={randomSecretKey:b,randomPrivateKey:b,calcPairingPrecomputes:y},{ShortSignature:E}=e.G1,{Signature:v}=e.G2;function N(S,V){return S instanceof o.Point?S:g.hash(Ve("point",S),V?.DST)}function I(S,V){return S instanceof l.Point?S:_.hash(Ve("point",S),V?.DST)}function O(S){return _.getPublicKey(S).toBytes(!0)}function x(S){return g.getPublicKey(S).toBytes(!0)}function R(S,V,k){const U=I(S,k),P=_.sign(U,V);return S instanceof l.Point?P:v.toBytes(P)}function B(S,V,k){const U=N(S,k),P=g.sign(U,V);return S instanceof o.Point?P:E.toBytes(P)}function A(S,V,k,U){const P=I(V,U);return _.verify(S,P,k)}function w(S,V,k,U){const P=N(V,U);return g.verify(S,P,k)}function T(S){const V=_.aggregatePublicKeys(S);return S[0]instanceof o.Point?V:V.toBytes(!0)}function C(S){const V=_.aggregateSignatures(S);return S[0]instanceof l.Point?V:v.toBytes(V)}function F(S){const V=g.aggregateSignatures(S);return S[0]instanceof o.Point?V:E.toBytes(V)}function L(S,V,k,U){const P=V.map(se=>I(se,U));return _.verifyBatch(S,P,k)}return o.Point.BASE.precompute(4),{longSignatures:_,shortSignatures:g,millerLoopBatch:d,pairing:u,pairingBatch:h,verifyBatch:L,fields:{Fr:r,Fp:t,Fp2:n,Fp6:s,Fp12:i},params:{ateLoopSize:e.params.ateLoopSize,twistType:e.params.twistType,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:p,getPublicKey:O,getPublicKeyForShortSignatures:x,sign:R,signShortSignature:B,verify:A,verifyShortSignature:w,aggregatePublicKeys:T,aggregateSignatures:C,aggregateShortSignatures:F,G1:o,G2:l,Signature:v,ShortSignature:E}}const oc=BigInt(0),It=BigInt(1),Be=BigInt(2),cc=BigInt(3);function _o(e,t,r,n,s=1,i){const a=BigInt(i===void 0?n:i),o=r**BigInt(n),c=[];for(let l=0;l<s;l++){const f=BigInt(l+1),d=[];for(let u=0,h=It;u<n;u++){const y=(f*h-f)/a%o;d.push(e.pow(t,y)),h*=r}c.push(d)}return c}function yh(e,t,r){const n=t.pow(r,(e.ORDER-It)/cc),s=t.pow(r,(e.ORDER-It)/Be);function i(u,h){const y=t.mul(t.frobeniusMap(u,1),n),_=t.mul(t.frobeniusMap(h,1),s);return[y,_]}const a=t.pow(r,(e.ORDER**Be-It)/cc),o=t.pow(r,(e.ORDER**Be-It)/Be);if(!t.eql(o,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(u,h){return[t.mul(u,a),t.neg(h)]}const l=u=>(h,y)=>{const _=y.toAffine(),g=u(_.x,_.y);return h.fromAffine({x:g[0],y:g[1]})},f=l(i),d=l(c);return{psi:i,psi2:c,G2psi:f,G2psi2:d,PSI_X:n,PSI_Y:s,PSI2_X:a,PSI2_Y:o}}const uc=(e,t)=>{if(t.length!==2)throw new Error("invalid tuple");const r=t.map(n=>e.create(n));return{c0:r[0],c1:r[1]}};class _h{constructor(t,r={}){this.MASK=It;const n=t.ORDER,s=n*n;this.Fp=t,this.ORDER=s,this.BITS=Cn(s),this.BYTES=Math.ceil(Cn(s)/8),this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.Fp_NONRESIDUE=t.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=t.div(t.ONE,Be),this.NONRESIDUE=uc(t,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=_o(t,this.Fp_NONRESIDUE,t.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(t){return uc(this.Fp,t)}create(t){return t}isValid({c0:t,c1:r}){function n(s,i){return typeof s=="bigint"&&oc<=s&&s<i}return n(t,this.ORDER)&&n(r,this.ORDER)}is0({c0:t,c1:r}){return this.Fp.is0(t)&&this.Fp.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}eql({c0:t,c1:r},{c0:n,c1:s}){return this.Fp.eql(t,n)&&this.Fp.eql(r,s)}neg({c0:t,c1:r}){return{c0:this.Fp.neg(t),c1:this.Fp.neg(r)}}pow(t,r){return ri(this,t,r)}invertBatch(t){return Vr(this,t)}add(t,r){const{c0:n,c1:s}=t,{c0:i,c1:a}=r;return{c0:this.Fp.add(n,i),c1:this.Fp.add(s,a)}}sub({c0:t,c1:r},{c0:n,c1:s}){return{c0:this.Fp.sub(t,n),c1:this.Fp.sub(r,s)}}mul({c0:t,c1:r},n){const{Fp:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};const{c0:i,c1:a}=n;let o=s.mul(t,i),c=s.mul(r,a);const l=s.sub(o,c),f=s.sub(s.mul(s.add(t,r),s.add(i,a)),s.add(o,c));return{c0:l,c1:f}}sqr({c0:t,c1:r}){const{Fp:n}=this,s=n.add(t,r),i=n.sub(t,r),a=n.add(t,t);return{c0:n.mul(s,i),c1:n.mul(a,r)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}div(t,r){const{Fp:n}=this;return this.mul(t,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:t,c1:r}){const{Fp:n}=this,s=n.inv(n.create(t*t+r*r));return{c0:n.mul(s,n.create(t)),c1:n.mul(s,n.create(-r))}}sqrt(t){const{Fp:r}=this,n=this,{c0:s,c1:i}=t;if(r.is0(i))return Fs(r,s)===1?n.create({c0:r.sqrt(s),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(s,this.Fp_NONRESIDUE))});const a=r.sqrt(r.sub(r.sqr(s),r.mul(r.sqr(i),this.Fp_NONRESIDUE)));let o=r.mul(r.add(a,s),this.Fp_div2);Fs(r,o)===-1&&(o=r.sub(o,a));const l=r.sqrt(o),f=n.create({c0:l,c1:r.div(r.mul(i,this.Fp_div2),l)});if(!n.eql(n.sqr(f),t))throw new Error("Cannot find square root");const d=f,u=n.neg(d),{re:h,im:y}=n.reim(d),{re:_,im:g}=n.reim(u);return y>g||y===g&&h>_?d:u}isOdd(t){const{re:r,im:n}=this.reim(t),s=r%Be,i=r===oc,a=n%Be;return BigInt(s||i&&a)==It}fromBytes(t){const{Fp:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){return ee(this.Fp.toBytes(t),this.Fp.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},i){return{c0:this.Fp.cmov(t,n,i),c1:this.Fp.cmov(r,s,i)}}reim({c0:t,c1:r}){return{re:t,im:r}}Fp4Square(t,r){const n=this,s=n.sqr(t),i=n.sqr(r);return{first:n.add(n.mulByNonresidue(i),s),second:n.sub(n.sub(n.sqr(n.add(t,r)),s),i)}}mulByNonresidue({c0:t,c1:r}){return this.mul({c0:t,c1:r},this.NONRESIDUE)}frobeniusMap({c0:t,c1:r},n){return{c0:t,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}}class gh{constructor(t){this.MASK=It,this.Fp2=t,this.ORDER=t.ORDER,this.BITS=3*t.BITS,this.BYTES=3*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO,c2:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO,c2:t.ZERO};const{Fp:r}=t,n=_o(t,t.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:a}){const{Fp2:o}=this;return{c0:o.add(t,s),c1:o.add(r,i),c2:o.add(n,a)}}sub({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:a}){const{Fp2:o}=this;return{c0:o.sub(t,s),c1:o.sub(r,i),c2:o.sub(n,a)}}mul({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;if(typeof s=="bigint")return{c0:i.mul(t,s),c1:i.mul(r,s),c2:i.mul(n,s)};const{c0:a,c1:o,c2:c}=s,l=i.mul(t,a),f=i.mul(r,o),d=i.mul(n,c);return{c0:i.add(l,i.mulByNonresidue(i.sub(i.mul(i.add(r,n),i.add(o,c)),i.add(f,d)))),c1:i.add(i.sub(i.mul(i.add(t,r),i.add(a,o)),i.add(l,f)),i.mulByNonresidue(d)),c2:i.sub(i.add(f,i.mul(i.add(t,n),i.add(a,c))),i.add(l,d))}}sqr({c0:t,c1:r,c2:n}){const{Fp2:s}=this;let i=s.sqr(t),a=s.mul(s.mul(t,r),Be),o=s.mul(s.mul(r,n),Be),c=s.sqr(n);return{c0:s.add(s.mulByNonresidue(o),i),c1:s.add(s.mulByNonresidue(c),a),c2:s.sub(s.sub(s.add(s.add(a,s.sqr(s.add(s.sub(t,r),n))),o),i),c)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}create(t){return t}isValid({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return s.isValid(t)&&s.isValid(r)&&s.isValid(n)}is0({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return s.is0(t)&&s.is0(r)&&s.is0(n)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return{c0:s.neg(t),c1:s.neg(r),c2:s.neg(n)}}eql({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:a}){const{Fp2:o}=this;return o.eql(t,s)&&o.eql(r,i)&&o.eql(n,a)}sqrt(t){return sl()}div(t,r){const{Fp2:n}=this,{Fp:s}=n;return this.mul(t,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(t,r){return ri(this,t,r)}invertBatch(t){return Vr(this,t)}inv({c0:t,c1:r,c2:n}){const{Fp2:s}=this;let i=s.sub(s.sqr(t),s.mulByNonresidue(s.mul(n,r))),a=s.sub(s.mulByNonresidue(s.sqr(n)),s.mul(t,r)),o=s.sub(s.sqr(r),s.mul(t,n)),c=s.inv(s.add(s.mulByNonresidue(s.add(s.mul(n,a),s.mul(r,o))),s.mul(t,i)));return{c0:s.mul(c,i),c1:s.mul(c,a),c2:s.mul(c,o)}}fromBytes(t){const{Fp2:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);const n=r.BYTES;return{c0:r.fromBytes(t.subarray(0,n)),c1:r.fromBytes(t.subarray(n,n*2)),c2:r.fromBytes(t.subarray(2*n))}}toBytes({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return ee(s.toBytes(t),s.toBytes(r),s.toBytes(n))}cmov({c0:t,c1:r,c2:n},{c0:s,c1:i,c2:a},o){const{Fp2:c}=this;return{c0:c.cmov(t,s,o),c1:c.cmov(r,i,o),c2:c.cmov(n,a,o)}}fromBigSix(t){const{Fp2:r}=this;if(!Array.isArray(t)||t.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(t.slice(0,2)),c1:r.fromBigTuple(t.slice(2,4)),c2:r.fromBigTuple(t.slice(4,6))}}frobeniusMap({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.frobeniusMap(t,s),c1:i.mul(i.frobeniusMap(r,s),this.FROBENIUS_COEFFICIENTS_1[s%6]),c2:i.mul(i.frobeniusMap(n,s),this.FROBENIUS_COEFFICIENTS_2[s%6])}}mulByFp2({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.mul(t,s),c1:i.mul(r,s),c2:i.mul(n,s)}}mulByNonresidue({c0:t,c1:r,c2:n}){const{Fp2:s}=this;return{c0:s.mulByNonresidue(n),c1:t,c2:r}}mul1({c0:t,c1:r,c2:n},s){const{Fp2:i}=this;return{c0:i.mulByNonresidue(i.mul(n,s)),c1:i.mul(t,s),c2:i.mul(r,s)}}mul01({c0:t,c1:r,c2:n},s,i){const{Fp2:a}=this;let o=a.mul(t,s),c=a.mul(r,i);return{c0:a.add(a.mulByNonresidue(a.sub(a.mul(a.add(r,n),i),c)),o),c1:a.sub(a.sub(a.mul(a.add(s,i),a.add(t,r)),o),c),c2:a.add(a.sub(a.mul(a.add(t,n),s),o),c)}}}class bh{constructor(t,r){this.MASK=It;const{Fp2:n}=t,{Fp:s}=n;this.Fp6=t,this.ORDER=n.ORDER,this.BITS=2*t.BITS,this.BYTES=2*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.FROBENIUS_COEFFICIENTS=_o(n,n.NONRESIDUE,s.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(t){return t}isValid({c0:t,c1:r}){const{Fp6:n}=this;return n.isValid(t)&&n.isValid(r)}is0({c0:t,c1:r}){const{Fp6:n}=this;return n.is0(t)&&n.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r}){const{Fp6:n}=this;return{c0:n.neg(t),c1:n.neg(r)}}eql({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return i.eql(t,n)&&i.eql(r,s)}sqrt(t){sl()}inv({c0:t,c1:r}){const{Fp6:n}=this;let s=n.inv(n.sub(n.sqr(t),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(t,s),c1:n.neg(n.mul(r,s))}}div(t,r){const{Fp6:n}=this,{Fp2:s}=n,{Fp:i}=s;return this.mul(t,typeof r=="bigint"?i.inv(i.create(r)):this.inv(r))}pow(t,r){return ri(this,t,r)}invertBatch(t){return Vr(this,t)}add({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return{c0:i.add(t,n),c1:i.add(r,s)}}sub({c0:t,c1:r},{c0:n,c1:s}){const{Fp6:i}=this;return{c0:i.sub(t,n),c1:i.sub(r,s)}}mul({c0:t,c1:r},n){const{Fp6:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};let{c0:i,c1:a}=n,o=s.mul(t,i),c=s.mul(r,a);return{c0:s.add(o,s.mulByNonresidue(c)),c1:s.sub(s.mul(s.add(t,r),s.add(i,a)),s.add(o,c))}}sqr({c0:t,c1:r}){const{Fp6:n}=this;let s=n.mul(t,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),t),n.add(t,r)),s),n.mulByNonresidue(s)),c1:n.add(s,s)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}fromBytes(t){const{Fp6:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){const{Fp6:n}=this;return ee(n.toBytes(t),n.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},i){const{Fp6:a}=this;return{c0:a.cmov(t,n,i),c1:a.cmov(r,s,i)}}fromBigTwelve(t){const{Fp6:r}=this;return{c0:r.fromBigSix(t.slice(0,6)),c1:r.fromBigSix(t.slice(6,12))}}frobeniusMap(t,r){const{Fp6:n}=this,{Fp2:s}=n,{c0:i,c1:a,c2:o}=n.frobeniusMap(t.c1,r),c=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(t.c0,r),c1:n.create({c0:s.mul(i,c),c1:s.mul(a,c),c2:s.mul(o,c)})}}mulByFp2({c0:t,c1:r},n){const{Fp6:s}=this;return{c0:s.mulByFp2(t,n),c1:s.mulByFp2(r,n)}}conjugate({c0:t,c1:r}){return{c0:t,c1:this.Fp6.neg(r)}}mul014({c0:t,c1:r},n,s,i){const{Fp6:a}=this,{Fp2:o}=a;let c=a.mul01(t,n,s),l=a.mul1(r,i);return{c0:a.add(a.mulByNonresidue(l),c),c1:a.sub(a.sub(a.mul01(a.add(r,t),n,o.add(s,i)),c),l)}}mul034({c0:t,c1:r},n,s,i){const{Fp6:a}=this,{Fp2:o}=a,c=a.create({c0:o.mul(t.c0,n),c1:o.mul(t.c1,n),c2:o.mul(t.c2,n)}),l=a.mul01(r,s,i),f=a.mul01(a.add(t,r),o.add(n,s),i);return{c0:a.add(a.mulByNonresidue(l),c),c1:a.sub(f,a.add(c,l))}}_cyclotomicSquare({c0:t,c1:r}){const{Fp6:n}=this,{Fp2:s}=n,{c0:i,c1:a,c2:o}=t,{c0:c,c1:l,c2:f}=r,{first:d,second:u}=s.Fp4Square(i,l),{first:h,second:y}=s.Fp4Square(c,o),{first:_,second:g}=s.Fp4Square(a,f),m=s.mulByNonresidue(g);return{c0:n.create({c0:s.add(s.mul(s.sub(d,i),Be),d),c1:s.add(s.mul(s.sub(h,a),Be),h),c2:s.add(s.mul(s.sub(_,o),Be),_)}),c1:n.create({c0:s.add(s.mul(s.add(m,c),Be),m),c1:s.add(s.mul(s.add(u,l),Be),u),c2:s.add(s.mul(s.add(y,f),Be),y)})}}_cyclotomicExp(t,r){let n=this.ONE;for(let s=this.X_LEN-1;s>=0;s--)n=this._cyclotomicSquare(n),Mf(r,s)&&(n=this.mul(n,t));return n}}function wh(e){const t=Qt(e.ORDER),r=new _h(t,e),n=new gh(r),s=new bh(n,e);return{Fp:t,Fp2:r,Fp6:n,Fp12:s}}const Re=BigInt(0),Ds=BigInt(1),Ze=BigInt(2),ni=BigInt(3),kn=BigInt(4),Kt=BigInt("0xd201000000010000"),xh=Cn(Kt),Rr={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:Re,b:kn,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},Eh=Qt(Rr.n,{modFromBytes:!0,isLE:!0}),{Fp:M,Fp2:j,Fp6:vh,Fp12:Y}=wh({ORDER:Rr.p,X_LEN:xh,FP2_NONRESIDUE:[Ds,Ds],Fp2mulByB:({c0:e,c1:t})=>{const r=M.mul(e,kn),n=M.mul(t,kn);return{c0:M.sub(r,n),c1:M.add(r,n)}},Fp12finalExponentiate:e=>{const t=Kt,r=Y.div(Y.frobeniusMap(e,6),e),n=Y.mul(Y.frobeniusMap(r,2),r),s=Y.conjugate(Y._cyclotomicExp(n,t)),i=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),s),a=Y.conjugate(Y._cyclotomicExp(i,t)),o=Y.conjugate(Y._cyclotomicExp(a,t)),c=Y.mul(Y.conjugate(Y._cyclotomicExp(o,t)),Y._cyclotomicSquare(s)),l=Y.conjugate(Y._cyclotomicExp(c,t)),f=Y.frobeniusMap(Y.mul(s,o),2),d=Y.frobeniusMap(Y.mul(a,n),3),u=Y.frobeniusMap(Y.mul(c,Y.conjugate(n)),1),h=Y.mul(Y.mul(l,Y.conjugate(i)),n);return Y.mul(Y.mul(Y.mul(f,d),u),h)}}),{G2psi:lc,G2psi2:Nh}=yh(M,j,j.div(j.ONE,j.NONRESIDUE)),Ji=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:M.ORDER,m:2,k:128,expand:"xmd",hash:Ge}),go={p:j.ORDER,n:Rr.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:j.ZERO,b:j.fromBigTuple([kn,kn]),Gx:j.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:j.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},si=ns(M.toBytes(Re),{infinity:!0,compressed:!0});function ii(e){e=e.slice();const t=e[0]&224,r=!!(t>>7&1),n=!!(t>>6&1),s=!!(t>>5&1);return e[0]&=31,{compressed:r,infinity:n,sort:s,value:e}}function ns(e,t){if(e[0]&224)throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Th(e,t,r){const{BYTES:n,ORDER:s}=M,i=t.is0(),{x:a,y:o}=t.toAffine();if(r){if(i)return si.slice();const c=!!(o*Ze/s);return ns(ve(a,n),{compressed:!0,sort:c})}else return i?ee(Uint8Array.of(64),new Uint8Array(2*n-1)):ee(ve(a,n),ve(o,n))}function Qi(e){e.assertValidity();const{BYTES:t,ORDER:r}=M,{x:n,y:s}=e.toAffine();if(e.is0())return si.slice();const i=!!(s*Ze/r);return ns(ve(n,t),{compressed:!0,sort:i})}function Ih(e){const{compressed:t,infinity:r,sort:n,value:s}=ii(e),{BYTES:i,ORDER:a}=M;if(s.length===48&&t){const o=ft(s),c=M.create(o&Br(M.BITS));if(r){if(c!==Re)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:Re,y:Re}}const l=M.add(M.pow(c,ni),M.create(Rr.b));let f=M.sqrt(l);if(!f)throw new Error("invalid G1 point: compressed point");return f*Ze/a!==BigInt(n)&&(f=M.neg(f)),{x:M.create(c),y:M.create(f)}}else if(s.length===96&&!t){const o=ft(s.subarray(0,i)),c=ft(s.subarray(i));if(r){if(o!==Re||c!==Re)throw new Error("G1: non-empty point at infinity");return ai.G1.Point.ZERO.toAffine()}return{x:M.create(o),y:M.create(c)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function dc(e){const{infinity:t,sort:r,value:n}=ii(Ve("signatureHex",e,48)),s=M.ORDER,i=ai.G1.Point,a=ft(n);if(t)return i.ZERO;const o=M.create(a&Br(M.BITS)),c=M.add(M.pow(o,ni),M.create(Rr.b));let l=M.sqrt(c);if(!l)throw new Error("invalid G1 point: compressed");const f=BigInt(r);l*Ze/s!==f&&(l=M.neg(l));const d=i.fromAffine({x:o,y:l});return d.assertValidity(),d}function Oh(e,t,r){const{BYTES:n,ORDER:s}=M,i=t.is0(),{x:a,y:o}=t.toAffine();if(r){if(i)return ee(si,ve(Re,n));const c=!!(o.c1===Re?o.c0*Ze/s:o.c1*Ze/s);return ee(ns(ve(a.c1,n),{compressed:!0,sort:c}),ve(a.c0,n))}else{if(i)return ee(Uint8Array.of(64),new Uint8Array(4*n-1));const{re:c,im:l}=j.reim(a),{re:f,im:d}=j.reim(o);return ee(ve(l,n),ve(c,n),ve(d,n),ve(f,n))}}function ea(e){e.assertValidity();const{BYTES:t}=M;if(e.is0())return ee(si,ve(Re,t));const{x:r,y:n}=e.toAffine(),{re:s,im:i}=j.reim(r),{re:a,im:o}=j.reim(n),l=!!((o>Re?o*Ze:a*Ze)/M.ORDER&Ds),f=s;return ee(ns(ve(i,t),{sort:l,compressed:!0}),ve(f,t))}function Rh(e){const{BYTES:t,ORDER:r}=M,{compressed:n,infinity:s,sort:i,value:a}=ii(e);if(!n&&!s&&i||!n&&s&&i||i&&s&&n)throw new Error("invalid encoding flag: "+(e[0]&224));const o=(c,l,f)=>ft(c.slice(l,f));if(a.length===96&&n){if(s){if(a.reduce((y,_)=>y!==0?_+1:_,0)>0)throw new Error("invalid G2 point: compressed");return{x:j.ZERO,y:j.ZERO}}const c=o(a,0,t),l=o(a,t,2*t),f=j.create({c0:M.create(l),c1:M.create(c)}),d=j.add(j.pow(f,ni),go.b);let u=j.sqrt(d);const h=u.c1===Re?u.c0*Ze/r:u.c1*Ze/r?Ds:Re;return u=i&&h>0?u:j.neg(u),{x:f,y:u}}else if(a.length===192&&!n){if(s){if(a.reduce((u,h)=>u!==0?h+1:h,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:j.ZERO,y:j.ZERO}}const c=o(a,0*t,1*t),l=o(a,1*t,2*t),f=o(a,2*t,3*t),d=o(a,3*t,4*t);return{x:j.fromBigTuple([l,c]),y:j.fromBigTuple([d,f])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function fc(e){const{ORDER:t}=M,{infinity:r,sort:n,value:s}=ii(Ve("signatureHex",e)),i=ai.G2.Point,a=s.length/2;if(a!==48&&a!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");const o=ft(s.slice(0,a)),c=ft(s.slice(a));if(r)return i.ZERO;const l=M.create(o&Br(M.BITS)),f=M.create(c),d=j.create({c0:f,c1:l}),u=j.add(j.pow(d,ni),go.b);let h=j.sqrt(u);if(!h)throw new Error("Failed to find a square root");const{re:y,im:_}=j.reim(h),g=BigInt(n),m=_>Re&&_*Ze/t!==g,b=_===Re&&y*Ze/t!==g;(m||b)&&(h=j.neg(h));const p=i.fromAffine({x:d,y:h});return p.assertValidity(),p}const ai=mh({fields:{Fp:M,Fp2:j,Fp6:vh,Fp12:Y,Fr:Eh},G1:{...Rr,Fp:M,htfDefaults:{...Ji,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{const r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new e(M.mul(t.X,r),t.Y,t.Z);return t.multiplyUnsafe(Kt).negate().multiplyUnsafe(Kt).equals(n)},clearCofactor:(e,t)=>t.multiplyUnsafe(Kt).add(t),mapToCurve:Vh,fromBytes:Ih,toBytes:Th,ShortSignature:{fromBytes(e){return He(e),dc(e)},fromHex(e){return dc(e)},toBytes(e){return Qi(e)},toRawBytes(e){return Qi(e)},toHex(e){return re(Qi(e))}}},G2:{...go,Fp:j,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Ji},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:kh,isTorsionFree:(e,t)=>t.multiplyUnsafe(Kt).negate().equals(lc(e,t)),clearCofactor:(e,t)=>{const r=Kt;let n=t.multiplyUnsafe(r).negate(),s=lc(e,t),i=t.double();return i=Nh(e,i),i=i.subtract(s),s=n.add(s),s=s.multiplyUnsafe(r).negate(),i=i.add(s),i=i.subtract(n),i.subtract(t)},fromBytes:Rh,toBytes:Oh,Signature:{fromBytes(e){return He(e),fc(e)},fromHex(e){return fc(e)},toBytes(e){return ea(e)},toRawBytes(e){return ea(e)},toHex(e){return re(ea(e))}}},params:{ateLoopSize:Kt,r:Rr.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:Ji}),Sh=xl(j,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(t=>j.fromBigTuple(t.map(BigInt))))),Ah=xl(M,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),Ch=El(M,{A:M.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:M.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:M.create(BigInt(11))}),Bh=El(j,{A:j.create({c0:M.create(Re),c1:M.create(BigInt(240))}),B:j.create({c0:M.create(BigInt(1012)),c1:M.create(BigInt(1012))}),Z:j.create({c0:M.create(BigInt(-2)),c1:M.create(BigInt(-1))})});function Vh(e){const{x:t,y:r}=Ch(M.create(e[0]));return Ah(t,r)}function kh(e){const{x:t,y:r}=Bh(j.fromBigTuple(e));return Sh(t,r)}function Fh(e,t,r){const n=typeof e=="string"?e:re(e),s=typeof t=="string"?t:re(t),i=typeof r=="string"?r:re(r);return ai.verifyShortSignature(s,i,n)}const Uh=BigInt(1e6),vl=e=>be(new sn(e)),oi=e=>{const r=vl(e)/Uh;return new Date(Number(r))},hc=60*1e3,Ph=60,Dh=24,Mh=Dh*Ph,Lh=5,$h=5,qh=30*Mh;var le;(function(e){e[e.Empty=0]="Empty",e[e.Fork=1]="Fork",e[e.Labeled=2]="Labeled",e[e.Leaf=3]="Leaf",e[e.Pruned=4]="Pruned"})(le||(le={}));function jh(e,t){for(let r=0;r<e.length;r++)if(e[r]>t[r])return!0;return!1}class ht{#e=!1;#t=void 0;static async create(t){const r=ht.createUnverified(t);return await r.verify(),r}static createUnverified(t){return new ht(t.certificate,t.rootKey,t.principal,t.blsVerify??Fh,t.maxAgeInMinutes,t.disableTimeVerification,t.agent)}constructor(t,r,n,s,i=Lh,a=!1,o){this._rootKey=r,this._principal=n,this._blsVerify=s,this._maxAgeInMinutes=i,this.#e=a,this.cert=ct(t),o&&"getTimeDiffMsecs"in o&&"hasSyncedTime"in o&&"syncTime"in o&&"syncTimeWithSubnet"in o&&(this.#t=o)}lookup_path(t){return cn(t,this.cert.tree)}lookup_subtree(t){return ci(t,this.cert.tree)}async verify(){const t=await bs(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,s=Gh(r),i=ee(rf,t),a=Fe(this.lookup_path(["time"]));if(!a)throw oe.fromCode(new zt("Certificate does not contain a time"));if(!this.#e){const o=this.#t?.getTimeDiffMsecs()??0,c=this._maxAgeInMinutes*hc,l=new Date,f=l.getTime()+o,d=f-c,u=f+$h*hc,h=oi(a),y=h.getTime()<d,_=h.getTime()>u;if((y||_)&&this.#t&&!this.#t.hasSyncedTime())return await this._syncTime(),await this.verify();if(y)throw De.fromCode(new Jr(this._maxAgeInMinutes,h,l,o,"past"));if(_)throw this.#t?.hasSyncedTime()?Oe.fromCode(new Me("System time has been synced with the IC network, but certificate is still too far in the future.")):De.fromCode(new Jr(5,h,l,o,"future"))}try{if(!await this._blsVerify(s,n,i))throw De.fromCode(new zt("Invalid signature"))}catch(o){throw De.fromCode(new zt("Signature verification failed",o))}}async _checkDelegationAndGetKey(t){if(!t)return this._rootKey;const r=ht.createUnverified({certificate:t.certificate,rootKey:this._rootKey,principal:this._principal,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:qh,agent:this.#t});if(r.cert.delegation)throw oe.fromCode(new La);await r.verify();let n;if(mc(this._principal)){const i=this._principal.canisterId;if(n=D.fromUint8Array(t.subnet_id),!Tl({canisterId:i,subnetId:n,tree:r.cert.tree}))throw De.fromCode(new Qn(i,n))}else if(pc(this._principal))n=this._principal.subnetId;else throw Rt;const s=Fe(r.lookup_path(["subnet",n.toUint8Array(),"public_key"]));if(!s)throw pc(this._principal)?De.fromCode(new $a(n)):De.fromCode(new ja(`Could not find subnet key for subnet ID ${n.toText()}`));return s}async _syncTime(){this.#t&&(mc(this._principal)?await this.#t.syncTime(this._principal.canisterId):await this.#t.syncTimeWithSubnet(this._principal.subnetId))}}function pc(e){return"subnetId"in e}function mc(e){return"canisterId"in e}const pn=dt("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),Kh=96;function Gh(e){const t=pn.byteLength+Kh;if(e.byteLength!==t)throw oe.fromCode(new Zs(t,e.byteLength));const r=e.slice(0,pn.byteLength);if(!ti(r,pn))throw oe.fromCode(new Ka(pn,r));return e.slice(pn.byteLength)}function Fe(e){if(e.status===$e.Found&&e.value instanceof Uint8Array)return e.value}async function bs(e){switch(e[0]){case le.Empty:return Ge(fs("ic-hashtree-empty"));case le.Pruned:return e[1];case le.Leaf:return Ge(ee(fs("ic-hashtree-leaf"),e[1]));case le.Labeled:return Ge(ee(fs("ic-hashtree-labeled"),e[1],await bs(e[2])));case le.Fork:return Ge(ee(fs("ic-hashtree-fork"),await bs(e[1]),await bs(e[2])));default:throw Rt}}function fs(e){const t=new Uint8Array([e.length]),r=new TextEncoder().encode(e);return ee(t,r)}function Nl(e){return typeof e[0]=="string"?Q(e[0]):e[0]}var $e;(function(e){e.Unknown="Unknown",e.Absent="Absent",e.Found="Found",e.Error="Error"})($e||($e={}));var Er;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found"})(Er||(Er={}));var ae;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found",e.Less="Less",e.Greater="Greater"})(ae||(ae={}));function cn(e,t){if(e.length===0)switch(t[0]){case le.Empty:return{status:$e.Absent};case le.Leaf:{if(!t[1])throw Oe.fromCode(new es("Invalid tree structure for leaf"));if(t[1]instanceof Uint8Array)return{status:$e.Found,value:t[1].slice(t[1].byteOffset,t[1].byteLength+t[1].byteOffset)};throw Rt}case le.Pruned:return{status:$e.Unknown};case le.Labeled:case le.Fork:return{status:$e.Error};default:throw Rt}const r=Nl(e),n=bn(r,t);switch(n.status){case ae.Found:return cn(e.slice(1),n.value);case ae.Absent:case ae.Greater:case ae.Less:return{status:$e.Absent};case ae.Unknown:return{status:$e.Unknown};default:throw Rt}}function ci(e,t){if(e.length===0)return{status:Er.Found,value:t};const r=Nl(e),n=bn(r,t);switch(n.status){case ae.Found:return ci(e.slice(1),n.value);case ae.Unknown:return{status:Er.Unknown};case ae.Absent:case ae.Greater:case ae.Less:return{status:Er.Absent};default:throw Rt}}function Ra(e){switch(e[0]){case le.Empty:return[];case le.Fork:return Ra(e[1]).concat(Ra(e[2]));default:return[e]}}function bn(e,t){switch(t[0]){case le.Labeled:return jh(e,t[1])?{status:ae.Greater}:ti(e,t[1])?{status:ae.Found,value:t[2]}:{status:ae.Less};case le.Fork:{const r=bn(e,t[1]);switch(r.status){case ae.Greater:{const n=bn(e,t[2]);return n.status===ae.Less?{status:ae.Absent}:n}case ae.Unknown:{const n=bn(e,t[2]);return n.status===ae.Less?{status:ae.Unknown}:n}default:return r}}case le.Pruned:return{status:ae.Unknown};default:return{status:ae.Absent}}}function ws(e,t){switch(t[0]){case le.Empty|le.Pruned:return[];case le.Leaf:return[e];case le.Fork:return ws(e,t[1]).concat(ws(e,t[2]));case le.Labeled:{const r=t[1],n=t[2],s=[...e,r];return ws(s,n)}default:throw Rt}}function Tl(e){const t=Hh(e),r=Il(t),{canisterId:n}=e;return r.some(i=>i[0].ltEq(n)&&i[1].gtEq(n))}function Hh(e){const{subnetId:t,tree:r,canisterId:n}=e,s=ci(["canister_ranges",t.toUint8Array()],r);if(s.status!==Er.Found)return zh(t,r);const i=s.value,a=Zh(i);if(a.length===0)throw oe.fromCode(new Qn(n,t));a.sort(Xs);const o=Yh(a,n),c=a[o];return Wh(c,i)}function zh(e,t){const r=cn(["subnet",e.toUint8Array(),"canister_ranges"],t);if(r.status!==$e.Found)throw oe.fromCode(new vr(`Could not find canister ranges for subnet ${e.toText()}`,r.status));return r.value}function Il(e){return ct(e).map(n=>[D.fromUint8Array(n[0]),D.fromUint8Array(n[1])])}function Zh(e){const t=[];for(const r of ws([],e)){const n=r[0];if(!n)throw oe.fromCode(new zt("Path is invalid"));t.push(n)}return t}function Yh(e,t){const r=t.toUint8Array();let n=0,s=e.length-1;for(;n<s;){const i=Math.floor((n+s)/2);Xs(e[i],r)<=0?s=i:n=i+1}return n}function Wh(e,t){const r=cn([e],t);if(r.status!==$e.Found)throw oe.fromCode(new vr(`Could not find canister range for shard ${e.toString()}`,r.status));return r.value}function yc(e,t){return e.delegation?D.fromUint8Array(e.delegation.subnet_id):D.selfAuthenticating(t)}const Xh=D.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe");function Ol(e,t){switch(t){case"raw":return e;case"leb128":return vl(e);case"cbor":return ct(e);case"hex":return re(e);case"utf-8":return new TextDecoder().decode(e)}}function Jh(e){return ct(e).map(r=>D.fromUint8Array(r))}function Qh(e,t){const r=typeof e=="string"?Q(e):e;return[Q("canister"),t,Q("metadata"),r]}function rn(e){return typeof e=="object"&&e!==null&&"key"in e&&"path"in e}function bo(e,t){const r=ci(["subnet",t.toUint8Array(),"node"],e.tree);if(r.status!==Er.Found)throw oe.fromCode(new vr("Node not found",r.status));if(r.value instanceof Uint8Array)throw Oe.fromCode(new es("Invalid node tree"));const n=Ra(r.value),s=new Map;return n.forEach(i=>{const a=D.from(i[1]).toText(),o=cn(["public_key"],i[2]);if(o.status!==$e.Found)throw oe.fromCode(new vr("Public key not found",o.status));const c=o.value;if(c.byteLength!==44)throw oe.fromCode(new Zs(44,c.byteLength));s.set(a,c)}),s}const e0=async e=>{const{agent:t,paths:r,disableCertificateTimeVerification:n=!1}=e,s=D.from(e.canisterId),i=[...new Set(r)],a=new Map,o=i.map((c,l)=>{const f=r0(c,s);return(async()=>{try{if(t.rootKey===null)throw Ce.fromCode(new Ar);const d=t.rootKey,u=await t.readState(s,{paths:[f]}),h=await ht.create({certificate:u.certificate,rootKey:d,principal:{canisterId:s},disableTimeVerification:n,agent:t}),y=(m,b)=>{if(b==="subnet"){const p=t0(u.certificate,s,d);return{path:b,data:p}}else return{path:b,data:Fe(m.lookup_path(f))}},{path:_,data:g}=y(h,i[l]);if(!g)typeof _=="string"?a.set(_,null):a.set(_.key,null);else switch(_){case"time":{a.set(_,oi(g));break}case"controllers":{a.set(_,Jh(g));break}case"module_hash":{a.set(_,re(g));break}case"subnet":{a.set(_,g);break}case"candid":{a.set(_,new TextDecoder().decode(g));break}default:rn(_)&&a.set(_.key,Ol(g,_.decodeStrategy))}}catch(d){if(d instanceof ot&&(d.hasCode(zt)||d.hasCode(Jr)))throw d;rn(c)?a.set(c.key,null):a.set(c,null)}})()});return await Promise.all(o),a},t0=(e,t,r)=>{if(!t._isPrincipal)throw ne.fromCode(new Me("Invalid canisterId"));const n=ct(e),{delegation:s}=n;let i;s&&s.subnet_id?i=D.fromUint8Array(new Uint8Array(s.subnet_id)):!s&&typeof r<"u"?i=D.selfAuthenticating(new Uint8Array(r)):i=Xh;const a=bo(n,i);return{subnetId:i.toText(),nodeKeys:a}},r0=(e,t)=>{const r=t.toUint8Array();switch(e){case"time":return[Q("time")];case"controllers":return[Q("canister"),r,Q("controllers")];case"module_hash":return[Q("canister"),r,Q("module_hash")];case"subnet":return[Q("subnet")];case"candid":return[Q("canister"),r,Q("metadata"),Q("candid:service")];default:if(rn(e))return typeof e.path=="string"||e.path instanceof Uint8Array?Qh(e.path,r):e.path}throw Oe.fromCode(new Me(`Error while encoding your path for canister status. Please ensure that your path ${e} was formatted correctly.`))};async function n0(e){const{agent:t,paths:r,disableCertificateTimeVerification:n=!1}=e,s=D.from(e.subnetId),i=[...new Set(r)],a=new Map,o=i.map((c,l)=>{const f=s0(c,s);return(async()=>{try{if(t.rootKey===null)throw Ce.fromCode(new Ar);const d=t.rootKey,u=await t.readSubnetState(s,{paths:[f]}),h=await ht.create({certificate:u.certificate,rootKey:d,principal:{subnetId:s},disableTimeVerification:n,agent:t}),y=(m,b)=>{if(b==="nodeKeys"){const p=bo(m.cert,s);return{path:b,data:p}}else return{path:b,data:Fe(m.lookup_path(f))}},{path:_,data:g}=y(h,i[l]);if(!g)typeof _=="string"?a.set(_,null):a.set(_.key,null);else switch(_){case"time":{a.set(_,oi(g));break}case"canisterRanges":{a.set(_,Il(g));break}case"publicKey":{a.set(_,g);break}case"nodeKeys":{a.set(_,g);break}default:rn(_)&&a.set(_.key,Ol(g,_.decodeStrategy))}}catch(d){if(d instanceof ot&&(d.hasCode(zt)||d.hasCode(Jr)))throw d;rn(c)?a.set(c.key,null):a.set(c,null)}})()});return await Promise.all(o),a}function s0(e,t){const r=t.toUint8Array();switch(e){case"time":return[Q("time")];case"canisterRanges":return[Q("canister_ranges"),r];case"publicKey":return[Q("subnet"),r,Q("public_key")];case"nodeKeys":return[Q("subnet"),r,Q("node")];default:if(rn(e))if(typeof e.path=="string"||e.path instanceof Uint8Array){const n=typeof e.path=="string"?Q(e.path):e.path;return[Q("subnet"),r,n]}else return e.path}throw Oe.fromCode(new Me(`Error while encoding your path for subnet status. Please ensure that your path ${e} was formatted correctly.`))}const Dt=BigInt(0),ge=BigInt(1),ta=BigInt(2),i0=BigInt(8);function a0(e,t,r,n){const s=e.sqr(r),i=e.sqr(n),a=e.add(e.mul(t.a,s),i),o=e.add(e.ONE,e.mul(t.d,e.mul(s,i)));return e.eql(a,o)}function o0(e,t={}){const r=bl("edwards",e,t,t.FpFnLE),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:a}=i;rs(t,{},{uvRatio:"function"});const o=ta<<BigInt(s.BYTES*8)-ge,c=g=>n.create(g),l=t.uvRatio||((g,m)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,m))}}catch{return{isValid:!1,value:Dt}}});if(!a0(n,i,i.Gx,i.Gy))throw new Error("bad curve params: generator point");function f(g,m,b=!1){const p=b?ge:Dt;return Xo("coordinate "+g,m,p,o),m}function d(g){if(!(g instanceof y))throw new Error("ExtendedPoint expected")}const u=Bn((g,m)=>{const{X:b,Y:p,Z:E}=g,v=g.is0();m==null&&(m=v?i0:n.inv(E));const N=c(b*m),I=c(p*m),O=n.mul(E,m);if(v)return{x:Dt,y:ge};if(O!==ge)throw new Error("invZ was invalid");return{x:N,y:I}}),h=Bn(g=>{const{a:m,d:b}=i;if(g.is0())throw new Error("bad point: ZERO");const{X:p,Y:E,Z:v,T:N}=g,I=c(p*p),O=c(E*E),x=c(v*v),R=c(x*x),B=c(I*m),A=c(x*c(B+O)),w=c(R+c(b*c(I*O)));if(A!==w)throw new Error("bad point: equation left != right (1)");const T=c(p*E),C=c(v*N);if(T!==C)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(m,b,p,E){this.X=f("x",m),this.Y=f("y",b),this.Z=f("z",p,!0),this.T=f("t",E),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){if(m instanceof y)throw new Error("extended point not allowed");const{x:b,y:p}=m||{};return f("x",b),f("y",p),new y(b,p,ge,c(b*p))}static fromBytes(m,b=!1){const p=n.BYTES,{a:E,d:v}=i;m=Wo(zr(m,p,"point")),Sn(b,"zip215");const N=Wo(m),I=m[p-1];N[p-1]=I&-129;const O=An(N),x=b?o:n.ORDER;Xo("point.y",O,Dt,x);const R=c(O*O),B=c(R-ge),A=c(v*R-E);let{isValid:w,value:T}=l(B,A);if(!w)throw new Error("bad point: invalid y coordinate");const C=(T&ge)===ge,F=(I&128)!==0;if(!b&&T===Dt&&F)throw new Error("bad point: x=0 and x_0=1");return F!==C&&(T=c(-T)),y.fromAffine({x:T,y:O})}static fromHex(m,b=!1){return y.fromBytes(Ve("point",m),b)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,b=!0){return _.createCache(this,m),b||this.multiply(ta),this}assertValidity(){h(this)}equals(m){d(m);const{X:b,Y:p,Z:E}=this,{X:v,Y:N,Z:I}=m,O=c(b*I),x=c(v*E),R=c(p*I),B=c(N*E);return O===x&&R===B}is0(){return this.equals(y.ZERO)}negate(){return new y(c(-this.X),this.Y,this.Z,c(-this.T))}double(){const{a:m}=i,{X:b,Y:p,Z:E}=this,v=c(b*b),N=c(p*p),I=c(ta*c(E*E)),O=c(m*v),x=b+p,R=c(c(x*x)-v-N),B=O+N,A=B-I,w=O-N,T=c(R*A),C=c(B*w),F=c(R*w),L=c(A*B);return new y(T,C,L,F)}add(m){d(m);const{a:b,d:p}=i,{X:E,Y:v,Z:N,T:I}=this,{X:O,Y:x,Z:R,T:B}=m,A=c(E*O),w=c(v*x),T=c(I*p*B),C=c(N*R),F=c((E+v)*(O+x)-A-w),L=C-T,S=C+T,V=c(w-b*A),k=c(F*L),U=c(S*V),P=c(F*V),se=c(L*S);return new y(k,U,se,P)}subtract(m){return this.add(m.negate())}multiply(m){if(!s.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:b,f:p}=_.cached(this,m,E=>Tt(y,E));return Tt(y,[b,p])[0]}multiplyUnsafe(m,b=y.ZERO){if(!s.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===Dt?y.ZERO:this.is0()||m===ge?this:_.unsafe(this,m,p=>Tt(y,p),b)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return _.unsafe(this,i.n).is0()}toAffine(m){return u(this,m)}clearCofactor(){return a===ge?this:this.multiplyUnsafe(a)}toBytes(){const{x:m,y:b}=this.toAffine(),p=n.toBytes(b);return p[p.length-1]|=m&ge?128:0,p}toHex(){return re(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return Tt(y,m)}static msm(m,b){return gl(y,s,m,b)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}y.BASE=new y(i.Gx,i.Gy,ge,c(i.Gx*i.Gy)),y.ZERO=new y(Dt,ge,ge,Dt),y.Fp=n,y.Fn=s;const _=new _l(y,s.BITS);return y.BASE.precompute(8),y}function c0(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');rs(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:n}=r,{BASE:s,Fp:i,Fn:a}=e,o=r.randomBytes||ou,c=r.adjustScalarBytes||(x=>x),l=r.domain||((x,R,B)=>{if(Sn(B,"phflag"),R.length||B)throw new Error("Contexts/pre-hash are not supported");return x});function f(x){return a.create(An(x))}function d(x){const R=p.secretKey;x=Ve("private key",x,R);const B=Ve("hashed private key",t(x),2*R),A=c(B.slice(0,R)),w=B.slice(R,2*R),T=f(A);return{head:A,prefix:w,scalar:T}}function u(x){const{head:R,prefix:B,scalar:A}=d(x),w=s.multiply(A),T=w.toBytes();return{head:R,prefix:B,scalar:A,point:w,pointBytes:T}}function h(x){return u(x).pointBytes}function y(x=Uint8Array.of(),...R){const B=ee(...R);return f(t(l(B,Ve("context",x),!!n)))}function _(x,R,B={}){x=Ve("message",x),n&&(x=n(x));const{prefix:A,scalar:w,pointBytes:T}=u(R),C=y(B.context,A,x),F=s.multiply(C).toBytes(),L=y(B.context,F,T,x),S=a.create(C+L*w);if(!a.isValid(S))throw new Error("sign failed: invalid s");const V=ee(F,a.toBytes(S));return zr(V,p.signature,"result")}const g={zip215:!0};function m(x,R,B,A=g){const{context:w,zip215:T}=A,C=p.signature;x=Ve("signature",x,C),R=Ve("message",R),B=Ve("publicKey",B,p.publicKey),T!==void 0&&Sn(T,"zip215"),n&&(R=n(R));const F=C/2,L=x.subarray(0,F),S=An(x.subarray(F,C));let V,k,U;try{V=e.fromBytes(B,T),k=e.fromBytes(L,T),U=s.multiplyUnsafe(S)}catch{return!1}if(!T&&V.isSmallOrder())return!1;const P=y(w,k.toBytes(),V.toBytes(),R);return k.add(V.multiplyUnsafe(P)).subtract(U).clearCofactor().is0()}const b=i.BYTES,p={secretKey:b,publicKey:b,signature:2*b,seed:b};function E(x=o(p.seed)){return zr(x,p.seed,"seed")}function v(x){const R=O.randomSecretKey(x);return{secretKey:R,publicKey:h(R)}}function N(x){return Jn(x)&&x.length===a.BYTES}function I(x,R){try{return!!e.fromBytes(x,R)}catch{return!1}}const O={getExtendedPublicKey:u,randomSecretKey:E,isValidSecretKey:N,isValidPublicKey:I,toMontgomery(x){const{y:R}=e.fromBytes(x),B=p.publicKey,A=B===32;if(!A&&B!==57)throw new Error("only defined for 25519 and 448");const w=A?i.div(ge+R,ge-R):i.div(R-ge,R+ge);return i.toBytes(w)},toMontgomerySecret(x){const R=p.secretKey;zr(x,R);const B=t(x.subarray(0,R));return c(B).subarray(0,R)},randomPrivateKey:E,precompute(x=8,R=e.BASE){return R.precompute(x,!1)}};return Object.freeze({keygen:v,getPublicKey:h,sign:_,verify:m,utils:O,Point:e,lengths:p})}function u0(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Qt(t.n,e.nBitLength,!0),s={Fp:r,Fn:n,uvRatio:e.uvRatio},i={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:s,hash:e.hash,eddsaOpts:i}}function l0(e,t){const r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function d0(e){const{CURVE:t,curveOpts:r,hash:n,eddsaOpts:s}=u0(e),i=o0(t,r),a=c0(i,n,s);return l0(e,a)}const f0=BigInt(1),_c=BigInt(2);BigInt(3);const h0=BigInt(5),p0=BigInt(8),wo=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Rl={p:wo,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:p0,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function m0(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=wo,o=e*e%i*e%i,c=it(o,_c,i)*o%i,l=it(c,f0,i)*e%i,f=it(l,h0,i)*l%i,d=it(f,t,i)*f%i,u=it(d,r,i)*d%i,h=it(u,n,i)*u%i,y=it(h,s,i)*h%i,_=it(y,s,i)*h%i,g=it(_,t,i)*f%i;return{pow_p_5_8:it(g,_c,i)*e%i,b2:o}}function y0(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const gc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function _0(e,t){const r=wo,n=de(t*t*t,r),s=de(n*n*t,r),i=m0(e*s).pow_p_5_8;let a=de(e*n*i,r);const o=de(t*a*a,r),c=a,l=de(a*gc,r),f=o===e,d=o===de(-e,r),u=o===de(-e*gc,r);return f&&(a=c),(d||u)&&(a=l),Hf(a,r)&&(a=de(-a,r)),{isValid:f||d,value:a}}const g0=Qt(Rl.p,{isLE:!0}),b0={...Rl,Fp:g0,hash:qd,adjustScalarBytes:y0,uvRatio:_0},Mr=d0(b0);var bc,wc,Ee,Zr;class w0{constructor(t={}){Te(this,Ee);Te(this,Zr);this[bc]=this.entries.bind(this),this[wc]="ExpirableMap";const{source:r=[],expirationTime:n=600*1e3}=t,s=Date.now();xe(this,Ee,new Map([...r].map(([i,a])=>[i,{value:a,timestamp:s}]))),xe(this,Zr,n)}prune(){const t=Date.now();for(const[r,n]of G(this,Ee).entries())t-n.timestamp>G(this,Zr)&&G(this,Ee).delete(r);return this}set(t,r){this.prune();const n={value:r,timestamp:Date.now()};return G(this,Ee).set(t,n),this}get(t){const r=G(this,Ee).get(t);if(r!==void 0){if(Date.now()-r.timestamp>G(this,Zr)){G(this,Ee).delete(t);return}return r.value}}clear(){G(this,Ee).clear()}entries(){const t=G(this,Ee).entries();return function*(){for(const[n,s]of t)yield[n,s.value]}()}values(){const t=G(this,Ee).values();return function*(){for(const n of t)yield n.value}()}keys(){return G(this,Ee).keys()}forEach(t,r){for(const[n,s]of G(this,Ee).entries())t.call(r,s.value,n,this)}has(t){return G(this,Ee).has(t)}delete(t){return G(this,Ee).delete(t)}get size(){return G(this,Ee).size}}Ee=new WeakMap,Zr=new WeakMap,bc=Symbol.iterator,wc=Symbol.toStringTag;const xc=e=>{if(e<=127)return 1;if(e<=255)return 2;if(e<=65535)return 3;if(e<=16777215)return 4;throw ne.fromCode(new Ys("Length too long (> 4 bytes)"))},Ec=(e,t,r)=>{if(r<=127)return e[t]=r,1;if(r<=255)return e[t]=129,e[t+1]=r,2;if(r<=65535)return e[t]=130,e[t+1]=r>>8,e[t+2]=r,3;if(r<=16777215)return e[t]=131,e[t+1]=r>>16,e[t+2]=r>>8,e[t+3]=r,4;throw ne.fromCode(new Ys("Length too long (> 4 bytes)"))},Sa=(e,t)=>{if(e[t]<128)return 1;if(e[t]===128)throw ne.fromCode(new At("Invalid length 0"));if(e[t]===129)return 2;if(e[t]===130)return 3;if(e[t]===131)return 4;throw ne.fromCode(new At("Length too long (> 4 bytes)"))},x0=(e,t)=>{const r=Sa(e,t);if(r===1)return e[t];if(r===2)return e[t+1];if(r===3)return(e[t+1]<<8)+e[t+2];if(r===4)return(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];throw ne.fromCode(new At("Length too long (> 4 bytes)"))};Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]);const Ms=Uint8Array.from([48,5,6,3,43,101,112]);Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]);Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function Sl(e,t){const r=2+xc(e.byteLength+1),n=t.byteLength+r+e.byteLength;let s=0;const i=new Uint8Array(1+xc(n)+n);return i[s++]=48,s+=Ec(i,s,n),i.set(t,s),s+=t.byteLength,i[s++]=3,s+=Ec(i,s,e.byteLength+1),i[s++]=0,i.set(new Uint8Array(e),s),i}const Al=(e,t)=>{let r=0;const n=(o,c)=>{if(s[r++]!==o)throw ne.fromCode(new At(`Expected ${c} at offset ${r}`))},s=new Uint8Array(e);if(n(48,"sequence"),r+=Sa(s,r),!ti(s.slice(r,r+t.byteLength),t))throw ne.fromCode(new At("Not the expected OID."));r+=t.byteLength,n(3,"bit string");const i=x0(s,r)-1;r+=Sa(s,r),n(0,"0 padding");const a=s.slice(r);if(i!==a.length)throw ne.fromCode(new Ga(i,a.length));return a};var $n,qn,lt;let E0=(lt=class{constructor(t){Te(this,$n);Te(this,qn);if(t.byteLength!==lt.RAW_KEY_LENGTH)throw ne.fromCode(new At("An Ed25519 public key must be exactly 32 bytes long"));xe(this,$n,t),xe(this,qn,lt.derEncode(t))}static from(t){return this.fromDer(t.toDer())}static fromRaw(t){return new lt(t)}static fromDer(t){return new lt(this.derDecode(t))}static derEncode(t){return Sl(t,Ms)}static derDecode(t){const r=Al(t,Ms);if(r.length!==this.RAW_KEY_LENGTH)throw ne.fromCode(new At("An Ed25519 public key must be exactly 32 bytes long"));return r}get rawKey(){return G(this,$n)}get derKey(){return G(this,qn)}toDer(){return this.derKey}toRaw(){return this.rawKey}},$n=new WeakMap,qn=new WeakMap,lt.RAW_KEY_LENGTH=32,lt);class v0{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(r=>r!==t)}notify(t,...r){this.observers.forEach(n=>n(t,...r))}}class N0 extends v0{constructor(){super()}print(t,...r){this.notify({message:t,level:"info"},...r)}warn(t,...r){this.notify({message:t,level:"warn"},...r)}error(t,r,...n){this.notify({message:t,level:"error",error:r},...n)}}const vc=.5,Nc=1.5,Tc=500,Ic=6e4,Oc=9e5,Rc=10;var Qe,jn,Kn,Gn,Hn,zn,Zn,Yn,Yr;const zs=class zs{constructor(t=zs.default){Te(this,Qe);Te(this,jn);Te(this,Kn);Te(this,Gn);Te(this,Hn);Te(this,zn);Te(this,Zn);Te(this,Yn);Te(this,Yr,0);const{initialInterval:r=Tc,randomizationFactor:n=vc,multiplier:s=Nc,maxInterval:i=Ic,maxElapsedTime:a=Oc,maxIterations:o=Rc,date:c=Date}=t;xe(this,Qe,r),xe(this,jn,n),xe(this,Kn,s),xe(this,Gn,i),xe(this,Yn,c),xe(this,Hn,c.now()),xe(this,zn,a),xe(this,Zn,o)}get ellapsedTimeInMsec(){return G(this,Yn).now()-G(this,Hn)}get currentInterval(){return G(this,Qe)}get count(){return G(this,Yr)}get randomValueFromInterval(){const t=G(this,jn)*G(this,Qe),r=G(this,Qe)-t,n=G(this,Qe)+t;return Math.random()*(n-r)+r}incrementCurrentInterval(){return xe(this,Qe,Math.min(G(this,Qe)*G(this,Kn),G(this,Gn))),Do(this,Yr)._++,G(this,Qe)}next(){return this.ellapsedTimeInMsec>=G(this,zn)||G(this,Yr)>=G(this,Zn)?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};Qe=new WeakMap,jn=new WeakMap,Kn=new WeakMap,Gn=new WeakMap,Hn=new WeakMap,zn=new WeakMap,Zn=new WeakMap,Yn=new WeakMap,Yr=new WeakMap,zs.default={initialInterval:Tc,randomizationFactor:vc,multiplier:Nc,maxInterval:Ic,maxElapsedTime:Oc,maxIterations:Rc,date:Date};let Aa=zs;var vt;(function(e){e.Received="received",e.Processing="processing",e.Replied="replied",e.Rejected="rejected",e.Unknown="unknown",e.Done="done"})(vt||(vt={}));const Ca=60*1e3,T0=1e6,I0=0,O0="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae",R0="ic0.app",S0=".ic0.app",A0="icp0.io",C0=".icp0.io",B0="icp-api.io",V0=".icp-api.io",ra=200,k0=202,F0=404;function U0(){let e;if(typeof window<"u")if(window.fetch)e=window.fetch.bind(window);else throw Ce.fromCode(new gn("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof globalThis<"u")if(globalThis.fetch)e=globalThis.fetch.bind(globalThis);else throw Ce.fromCode(new gn("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(e=self.fetch.bind(self));if(e)return e;throw Ce.fromCode(new gn("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function P0(e){let t;if(e!==void 0)!e.match(/^[a-z]+:/)&&typeof window<"u"?t=new URL(window.location.protocol+"//"+e):t=new URL(e);else{const r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],s=typeof window<"u"?window.location:void 0,i=s?.hostname;let a;i&&typeof i=="string"&&(n.some(o=>i.endsWith(o))?a=i:a=r.find(o=>i.endsWith(o))),s&&a?t=new URL(`${s.protocol}//${a}${s.port?":"+s.port:""}`):t=new URL("https://icp-api.io")}return t.toString()}class ut{#e;#t;#s;#c;#l;#w;#r;#i;#g;#x;#n;#o;#d;#a;get#T(){return this.#a*Ca}#f;#h;#p;#m;constructor(t={}){this.#e=null,this.#t=!1,this.#s=I0,this.#c=!1,this.#l=null,this.#w=!1,this._isAgent=!0,this.config={},this.log=new N0,this.#f=[],this.#h=[],this.#p=new w0({expirationTime:5*Ca}),this.#m=!0,this.#E=(s,i)=>{if(this.#m===!1)return s;const{status:a,signatures:o=[],requestId:c}=s;for(const l of o){const{timestamp:f,identity:d}=l,u=D.fromUint8Array(d).toText();let h;if(a===Wr.Replied){const{reply:b}=s;h=Vs({status:a,reply:b,timestamp:BigInt(f),request_id:c})}else if(a===Wr.Rejected){const{reject_code:b,reject_message:p,error_code:E}=s;h=Vs({status:a,reject_code:b,reject_message:p,error_code:E,timestamp:BigInt(f),request_id:c})}else throw Oe.fromCode(new Me(`Unknown status: ${a}`));const y=ee(nf,h),_=i.get(u);if(!_)throw oe.fromCode(new ro);const g=E0.fromDer(_).rawKey;if(!Mr.verify(l.signature,y,g))throw De.fromCode(new no(u))}return s},this.config=t,this.#i=t.fetch||U0()||fetch.bind(globalThis),this.#g=t.fetchOptions,this.#x=t.callOptions,this.#t=t.shouldFetchRootKey??!1,this.#w=t.shouldSyncTime??!1,t.rootKey?this.rootKey=t.rootKey:this.#t?this.rootKey=null:this.rootKey=dt(O0);const r=P0(t.host);this.host=new URL(r),t.verifyQuerySignatures!==void 0&&(this.#m=t.verifyQuerySignatures),this.#o=t.retryTimes??3;const n=()=>new Aa({maxIterations:this.#o});if(this.#d=t.backoffStrategy||n,this.host.hostname.endsWith(S0)?this.host.hostname=R0:this.host.hostname.endsWith(C0)?this.host.hostname=A0:this.host.hostname.endsWith(V0)&&(this.host.hostname=B0),t.credentials){const{name:s,password:i}=t.credentials;this.#n=`${s}${i?":"+i:""}`}if(this.#r=Promise.resolve(t.identity||new Kr),t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes>5)throw ne.fromCode(new Et("The maximum ingress expiry time is 5 minutes.",t.ingressExpiryInMinutes));if(t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes<=0)throw ne.fromCode(new Et("Ingress expiry time must be greater than 0.",t.ingressExpiryInMinutes));this.#a=t.ingressExpiryInMinutes||5,this.addTransform("update",Zo(Na)),t.useQueryNonces&&this.addTransform("query",Zo(Na)),t.logToConsole&&this.log.subscribe(s=>{s.level==="error"?console.error(s.message):s.level==="warn"?console.warn(s.message):console.log(s.message)})}static createSync(t={}){return new this({...t})}static async create(t={}){const r=ut.createSync(t);return await r.#u(),r}static async from(t){try{return"config"in t?await ut.create(t.config):await ut.create({fetch:t._fetch,fetchOptions:t._fetchOptions,callOptions:t._callOptions,host:t._host.toString(),identity:t._identity??void 0})}catch{throw ne.fromCode(new Qa)}}isLocal(){const t=this.host.hostname;return t==="127.0.0.1"||t.endsWith("127.0.0.1")}addTransform(t,r,n=r.priority||0){if(t==="update"){const s=this.#h.findIndex(i=>(i.priority||0)<n);this.#h.splice(s>=0?s:this.#h.length,0,Object.assign(r,{priority:n}))}else if(t==="query"){const s=this.#f.findIndex(i=>(i.priority||0)<n);this.#f.splice(s>=0?s:this.#f.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw Ce.fromCode(new pr);return(await this.#r).getPrincipal()}async call(t,r,n){const s=r.callSync??!0,i=await(n??this.#r);if(!i)throw Ce.fromCode(new pr);const a=D.from(t),o=r.effectiveCanisterId?D.from(r.effectiveCanisterId):a;await this.#u(o);const c=i.getPrincipal(),l=na(this.#a,this.#s),f={request_type:va.Call,canister_id:a,method_name:r.methodName,arg:r.arg,sender:c,ingress_expiry:l};let d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.Call,body:f}),u;r?.nonce?u=h(r.nonce):d.body.nonce?u=h(d.body.nonce):u=void 0,f.nonce=u;function h(m){return Object.assign(m,{__nonce__:void 0})}d=await i.transformRequest(d);const y=Gi(d.body),_=this.#d(),g=jr(f);try{const p=s?()=>{const I=new URL(`/api/v4/canister/${o.toText()}/call`,this.host);return this.log.print(`fetching "${I.pathname}" with request:`,d),this.#i(I,{...this.#x,...d.request,body:y})}:()=>{const I=new URL(`/api/v2/canister/${o.toText()}/call`,this.host);return this.log.print(`fetching "${I.pathname}" with request:`,d),this.#i(I,{...this.#x,...d.request,body:y})},{responseBodyBytes:E,...v}=await this.#y({requestFn:p,backoff:_,tries:0}),N=E.byteLength>0?ct(E):null;return{requestId:g,response:{...v,body:N},requestDetails:f}}catch(m){let b;if(m instanceof ot){if(m.hasCode(Os))return this.log.warn("v4 api not supported. Fall back to v2"),this.call(t,{...r,callSync:!1},n);if(m.hasCode(Et)&&!this.#c)return await this.syncTime(a),this.call(a,r,n);m.code.requestContext={requestId:g,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},b=m}else b=Oe.fromCode(new Me(m));throw this.log.error(`Error while making call: ${b.message}`,b),b}}async#b(t){const{ecid:r,transformedRequest:n,body:s,requestId:i,backoff:a,tries:o}=t,c=o===0?0:a.next(),l=new URL(`/api/v3/canister/${r.toString()}/query`,this.host);if(this.log.print(`fetching "${l.pathname}" with tries:`,{tries:o,backoff:a,delay:c}),c===null)throw Oe.fromCode(new vn(`Backoff strategy exhausted after ${o} attempts.`,i));c>0&&await new Promise(m=>setTimeout(m,c));let f;try{this.log.print(`fetching "${l.pathname}" with request:`,n),f=await this.#i(l,{...this.#g,...n.request,body:s})}catch(m){if(o<this.#o)return this.log.warn(`Caught exception while attempting to make query:
  ${m}
  Retrying query.`),await this.#b({...t,tries:o+1});throw Ts.fromCode(new Rs(m))}const d=Yo(f.headers);if(f.status!==ra){const m=await f.text();if(Sc(m))throw ne.fromCode(new Et(m,this.#a));if(o<this.#o)return await this.#b({...t,tries:o+1});throw oe.fromCode(new Is(f.status,f.statusText,d,m))}const h={...ct(Bs(await f.arrayBuffer())),httpDetails:{ok:f.ok,status:f.status,statusText:f.statusText,headers:d},requestId:i};if(!this.#m)return h;const y=h.signatures?.[0]?.timestamp;if(!y)throw oe.fromCode(new eo("Timestamp not found in query response. This suggests a malformed or malicious response."));const _=Number(BigInt(y)/BigInt(T0));if(Date.now()+this.#s-_>this.#T){if(o<this.#o)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:i,signatureTimestampMs:_}),await this.syncTime(r),await this.#b({...t,tries:o+1});throw De.fromCode(new Za(this.#a,i,o))}return h}async#y(t){const{requestFn:r,backoff:n,tries:s}=t,i=s===0?0:n.next();if(i===null)throw oe.fromCode(new vn(`Retry strategy exhausted after ${s} attempts.`));i>0&&await new Promise(f=>setTimeout(f,i));let a,o=new Uint8Array;try{a=await r(),a.status===ra&&(o=Bs(await a.clone().arrayBuffer()))}catch(f){if(s<this.#o)return this.log.warn(`Caught exception while attempting to make request:
  ${f}
  Retrying request.`),await this.#y({requestFn:r,backoff:n,tries:s+1});throw Ts.fromCode(new Rs(f))}const c=Yo(a.headers);if(a.status===ra||a.status===k0)return{ok:a.ok,status:a.status,statusText:a.statusText,responseBodyBytes:o,headers:c};const l=await a.text();if(a.status===F0&&a.url.includes("api/v4"))throw oe.fromCode(new Os);if(Sc(l))throw ne.fromCode(new Et(l,this.#a));if(s<this.#o)return await this.#y({requestFn:r,backoff:n,tries:s+1});throw oe.fromCode(new Is(a.status,a.statusText,c,l))}async query(t,r,n){const s=this.#d(),i=r.effectiveCanisterId?D.from(r.effectiveCanisterId):D.from(t);await this.#u(i),this.log.print(`ecid ${i.toString()}`),this.log.print(`canisterId ${t.toString()}`);let a;const o=await(n??this.#r);if(!o)throw Ce.fromCode(new pr);const c=D.from(t),l=o.getPrincipal(),f=na(this.#a,this.#s),d={request_type:Rn.Query,canister_id:c,method_name:r.methodName,arg:r.arg,sender:l,ingress_expiry:f},u=jr(d);a=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.Query,body:d}),a=await o.transformRequest(a);const h=Gi(a.body),y={canister:c.toText(),ecid:i,transformedRequest:a,body:h,requestId:u,backoff:s,tries:0},_=async()=>{const m=await this.#b(y);return{requestDetails:d,...m}},g=async()=>{const m=this.#p.get(i.toString());if(m)return m;await this.fetchSubnetKeys(i.toString());const b=this.#p.get(i.toString());if(!b)throw De.fromCode(new to);return b};try{if(!this.#m)return await _();const[m,b]=await Promise.all([_(),g()]);try{return this.#E(m,b)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#p.delete(i.toString());const p=await g();return this.#E(m,p)}}catch(m){let b;if(m instanceof ot){if(m.hasCode(Et)&&!this.#c)return await this.syncTime(i),this.query(t,r,n);m.code.requestContext={requestId:u,senderPubKey:a.body.sender_pubkey,senderSignature:a.body.sender_sig,ingressExpiry:a.body.content.ingress_expiry},b=m}else b=Oe.fromCode(new Me(m));throw this.log.error(`Error while making query: ${b.message}`,b),b}}#E;async createReadStateRequest(t,r){await this.#u();const n=await(r??this.#r);if(!n)throw Ce.fromCode(new pr);const s=n.getPrincipal(),i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#n?{Authorization:"Basic "+btoa(this.#n)}:{}}},endpoint:yr.ReadState,body:{request_type:Rn.ReadState,paths:t.paths,sender:s,ingress_expiry:na(this.#a,this.#s)}});return n.transformRequest(i)}async readState(t,r,n,s){await this.#_();const i=D.from(t);function a(f){for(const d of f.paths){const[u,h]=d,y=new TextEncoder().encode("request_status");if(ti(u,y))return h}}let o,c;if(s)o=s;else{c=a(r);const f=await this.#r;if(!f)throw Ce.fromCode(new pr);o=await this.createReadStateRequest(r,f)}const l=new URL(`/api/v3/canister/${i.toString()}/read_state`,this.host);return await this.#v(l,{canisterId:i},o,c)}async readSubnetState(t,r){await this.#_();const n=D.from(t),s=new URL(`/api/v3/subnet/${n.toString()}/read_state`,this.host),i=await this.createReadStateRequest(r,this.#r??void 0);return await this.#v(s,{subnetId:n},i)}async#v(t,r,n,s){const i=this.#d();try{const{responseBodyBytes:a}=await this.#y({requestFn:()=>this.#i(t,{...this.#g,...n.request,body:Gi(n.body)}),backoff:i,tries:0});return ct(a)}catch(a){let o;if(a instanceof ot){if(a.hasCode(Et)&&!this.#c){if("canisterId"in r)await this.syncTime(r.canisterId);else if("subnetId"in r)await this.syncTimeWithSubnet(r.subnetId);else throw Rt;return await this.#v(t,r,n,s)}a.code.requestContext={requestId:s??jr(n),senderPubKey:n.body.sender_pubkey,senderSignature:n.body.sender_sig,ingressExpiry:n.body.content.ingress_expiry},o=a}else o=Oe.fromCode(new Me(a));throw this.log.error(`Error while making read state: ${o.message}`,o),o}}parseTimeFromResponse(t){let r;if(t.certificate){const n=ct(t.certificate);if(n&&"tree"in n)r=n.tree;else throw oe.fromCode(new es("Could not decode time from response"));const s=cn(["time"],r);if(s.status!==$e.Found)throw oe.fromCode(new vr("Time was not found in the response or was not in its expected format.",s.status));if(!(s.value instanceof Uint8Array)&&!ArrayBuffer.isView(s))throw oe.fromCode(new qa("Time was not in its expected format."));const i=oi(s.value);return this.log.print("Time from response:",i),this.log.print("Time from response in milliseconds:",i.getTime()),i.getTime()}else this.log.warn("No certificate found in response");return 0}async syncTime(t){this.#l=this.#l??(async()=>{await this.#_();const r=Date.now();try{t||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");const n=t??D.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),s=ut.createSync({identity:new Kr,host:this.host.toString(),fetch:this.#i,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),i=await Promise.all(Array(3).fill(null).map(async()=>{const o=(await e0({canisterId:n,agent:s,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(o instanceof Date)return o.getTime()},[]));this.#N(r,i)}catch(n){const s=n instanceof ot?n:Oe.fromCode(new Me(n));throw this.log.error("Caught exception while attempting to sync time",s),s}})(),await this.#l.finally(()=>{this.#l=null})}async syncTimeWithSubnet(t){await this.#_();const r=Date.now();try{const n=ut.createSync({identity:new Kr,host:this.host.toString(),fetch:this.#i,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),s=await Promise.all(Array(3).fill(null).map(async()=>{const a=(await n0({subnetId:t,agent:n,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(a instanceof Date)return a.getTime()},[]));this.#N(r,s)}catch(n){const s=n instanceof ot?n:Oe.fromCode(new Me(n));throw this.log.error("Caught exception while attempting to sync time with subnet",s),s}}#N(t,r){const n=r.reduce((s,i)=>typeof i=="number"&&i>s?i:s,0);n>0&&(this.#s=n-t,this.#c=!0,this.log.notify({message:`Syncing time: offset of ${this.#s}`,level:"info"}))}async status(){const t=this.#n?{Authorization:"Basic "+btoa(this.#n)}:{},r=new URL("/api/v2/status",this.host);this.log.print(`fetching "${r.pathname}"`);const n=this.#d(),{responseBodyBytes:s}=await this.#y({backoff:n,requestFn:()=>this.#i(r,{headers:t,...this.#g}),tries:0});return ct(s)}async fetchRootKey(){return this.#e=this.#e??(async()=>{const t=await this.status();return this.rootKey=t.root_key,this.rootKey})(),await this.#e.finally(()=>{this.#e=null})}async#u(t){await Promise.all([this.#_(),this.#I(t)])}async#_(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#t)await this.fetchRootKey();else throw Ce.fromCode(new Ar(this.#t))}async#I(t){this.#w&&!this.hasSyncedTime()&&await this.syncTime(t)}invalidateIdentity(){this.#r=null}replaceIdentity(t){this.#r=Promise.resolve(t)}async fetchSubnetKeys(t){const r=D.from(t);await this.#u(r);const n=this.rootKey,s=await this.readState(r,{paths:[[Q("subnet")]]}),i=await ht.create({certificate:s.certificate,rootKey:n,principal:{canisterId:r},agent:this});if(!i.cert.delegation){const c=D.selfAuthenticating(n);if(!Tl({canisterId:r,subnetId:c,tree:i.cert.tree}))throw De.fromCode(new Qn(r,c))}const a=yc(i.cert,n),o=bo(i.cert,a);return this.#p.set(r.toText(),o),o}async getSubnetIdFromCanister(t){const r=D.from(t);await this.#u(r);const n=await this.readState(r,{paths:[[Q("time")]]}),s=await ht.create({certificate:n.certificate,rootKey:this.rootKey,principal:{canisterId:r},agent:this});return yc(s.cert,this.rootKey)}_transform(t){let r=Promise.resolve(t);if(t.endpoint===yr.Call)for(const n of this.#h)r=r.then(s=>n(s).then(i=>i||s));else for(const n of this.#f)r=r.then(s=>n(s).then(i=>i||s));return r}getTimeDiffMsecs(){return this.#s}hasSyncedTime(){return this.#c}}function na(e,t){const r=e*Ca;return Hr.fromDeltaInMilliseconds(r,t)}function Sc(e){return e.includes("Invalid request expiry: ")}const D0=300*1e3;function M0(){return K0($0(L0(),1e3),j0(1e3,1.2),q0(D0))}function L0(){let e=!0;return async()=>e?(e=!1,!0):!1}function $0(e,t){return async(r,n,s)=>{if(await e(r,n,s))return new Promise(i=>setTimeout(i,t))}}function q0(e){const t=Date.now()+e;return async(r,n,s)=>{if(Date.now()>t)throw oe.fromCode(new vn(`Request timed out after ${e} msec`,n,s))}}function j0(e,t){let r=e;return()=>new Promise(n=>setTimeout(()=>{r*=t,n()},r))}function K0(...e){return async(t,r,n)=>{for(const s of e)await s(t,r,n)}}const G0={preSignReadStateRequest:!1};function Cl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function sa(e,t){return e!==null&&typeof e=="object"&&Cl(e,t)}function H0(e,t){return Cl(e,t)&&typeof e[t]=="function"}function Ac(e){return sa(e,"body")&&sa(e.body,"content")&&e.body.content.request_type===Rn.ReadState&&sa(e.body.content,"ingress_expiry")&&typeof e.body.content.ingress_expiry=="object"&&e.body.content.ingress_expiry!==null&&H0(e.body.content.ingress_expiry,"toHash")}async function Bl(e,t,r,n={}){const s=[Q("request_status"),r];let i,a;if(n.preSignReadStateRequest??!1?(a=await z0({paths:[s],agent:e,pollingOptions:n}),i=await e.readState(t,{paths:[s]},void 0,a)):i=await e.readState(t,{paths:[s]}),e.rootKey==null)throw Ce.fromCode(new Ar);const c=await ht.create({certificate:i.certificate,rootKey:e.rootKey,principal:{canisterId:t},blsVerify:n.blsVerify,agent:e}),l=Fe(c.lookup_path([...s,Q("status")]));let f;switch(typeof l>"u"?f=vt.Unknown:f=new TextDecoder().decode(l),f){case vt.Replied:return{reply:Fe(c.lookup_path([...s,"reply"])),certificate:c};case vt.Received:case vt.Unknown:case vt.Processing:{const d=n.strategy??M0();return await d(t,r,f),Bl(e,t,r,{...n,strategy:d,request:a})}case vt.Rejected:{const d=new Uint8Array(Fe(c.lookup_path([...s,"reject_code"])))[0],u=new TextDecoder().decode(Fe(c.lookup_path([...s,"reject_message"]))),h=Fe(c.lookup_path([...s,"error_code"])),y=h?new TextDecoder().decode(h):void 0;throw qr.fromCode(new Ws(r,d,u,y))}case vt.Done:throw Oe.fromCode(new Xa(r))}throw Rt}async function z0(e){const{paths:t,agent:r,pollingOptions:n}=e;if(n.request&&Ac(n.request))return n.request;const s=await r.createReadStateRequest?.({paths:t},void 0);if(!Ac(s))throw ne.fromCode(new so(s));return s}const Ke=Symbol.for("ic-agent-metadata");class Fn{static agentOf(t){return t[Ke].config.agent}static interfaceOf(t){return t[Ke].service}static canisterIdOf(t){return D.from(t[Ke].config.canisterId)}static createActorClass(t,r){const n=t({IDL:tf});class s extends Fn{constructor(a){if(!a.canisterId)throw ne.fromCode(new Ss(a.canisterId));const o=typeof a.canisterId=="string"?D.fromText(a.canisterId):a.canisterId;super({config:{...Vl,...a,canisterId:o},service:n});for(const[c,l]of n._fields)r?.httpDetails&&l.annotations.push(Ba),r?.certificate&&l.annotations.push(kl),this[c]=Z0(this,c,l,a.blsVerify)}}return s}static createActor(t,r){if(!r.canisterId)throw ne.fromCode(new Ss(r.canisterId));return new(this.createActorClass(t))(r)}static createActorWithHttpDetails(t,r){return new(this.createActorClass(t,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(t,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(t,n))(r)}constructor(t){this[Ke]=Object.freeze(t)}}function Pr(e,t){const r=bu(e,t);switch(r.length){case 0:return;case 1:return r[0];default:return r}}const Vl={pollingOptions:G0},Ba="http-details",kl="certificate";function Z0(e,t,r,n){let s;r.annotations.includes("query")||r.annotations.includes("composite_query")?s=async(a,...o)=>{a={...a,...e[Ke].config.queryTransform?.(t,o,{...e[Ke].config,...a})};const c=a.agent||e[Ke].config.agent||new ut,l=D.from(a.canisterId||e[Ke].config.canisterId),f=ba(r.argTypes,o),d=await c.query(l,{methodName:t,arg:f,effectiveCanisterId:a.effectiveCanisterId}),u={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case Wr.Rejected:{const h=new Ya(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw h.callContext={canisterId:l,methodName:t,httpDetails:u},qr.fromCode(h)}case Wr.Replied:return r.annotations.includes(Ba)?{httpDetails:u,result:Pr(r.retTypes,d.reply.arg)}:Pr(r.retTypes,d.reply.arg)}}:s=async(a,...o)=>{a={...a,...e[Ke].config.callTransform?.(t,o,{...e[Ke].config,...a})};const c=a.agent||e[Ke].config.agent||ut.createSync(),{canisterId:l,effectiveCanisterId:f,pollingOptions:d}={...Vl,...e[Ke].config,...a},u=D.from(l),h=f!==void 0?D.from(f):u,y=ba(r.argTypes,o),{requestId:_,response:g,requestDetails:m}=await c.call(u,{methodName:t,arg:y,effectiveCanisterId:h,nonce:a.nonce});let b,p;if(yd(g.body)){if(c.rootKey==null)throw Ce.fromCode(new Ar);const I=g.body.certificate;p=await ht.create({certificate:I,rootKey:c.rootKey,principal:{canisterId:h},blsVerify:n,agent:c});const O=[Q("request_status"),_];switch(new TextDecoder().decode(Fe(p.lookup_path([...O,"status"])))){case"replied":b=Fe(p.lookup_path([...O,"reply"]));break;case"rejected":{const R=new Uint8Array(Fe(p.lookup_path([...O,"reject_code"])))[0],B=new TextDecoder().decode(Fe(p.lookup_path([...O,"reject_message"]))),A=Fe(p.lookup_path([...O,"error_code"])),w=A?new TextDecoder().decode(A):void 0,T=new Ws(_,R,B,w);throw T.callContext={canisterId:u,methodName:t,httpDetails:g},qr.fromCode(T)}}}else if(md(g.body)){const{reject_code:I,reject_message:O,error_code:x}=g.body,R=new Wa(_,I,O,x);throw R.callContext={canisterId:u,methodName:t,httpDetails:g},qr.fromCode(R)}if(g.status===202){const I={...d,blsVerify:n},O=await Bl(c,h,_,I);p=O.certificate,b=O.reply}const E=r.annotations.includes(Ba),v=r.annotations.includes(kl),N={...g,requestDetails:m};if(b!==void 0)return E&&v?{httpDetails:N,certificate:p,result:Pr(r.retTypes,b)}:v?{certificate:p,result:Pr(r.retTypes,b)}:E?{httpDetails:N,result:Pr(r.retTypes,b)}:Pr(r.retTypes,b);{const I=new Me(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(O=>O.display()).join(",")}].`);throw I.callContext={canisterId:u,methodName:t,httpDetails:N},Oe.fromCode(I)}};const i=(...a)=>s({},...a);return i.withOptions=a=>(...o)=>s(a,...o),i}function Cc(e){return e!==null&&typeof e=="object"}var Wn,Xn;const mr=class mr{constructor(t){Te(this,Wn);Te(this,Xn);if(t.byteLength!==mr.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");xe(this,Wn,t),xe(this,Xn,mr.derEncode(t))}static from(t){if(typeof t=="string"){const r=dt(t);return this.fromRaw(r)}else if(Cc(t)){const r=t;if(Cc(r)&&Object.hasOwnProperty.call(r,"__derEncodedPublicKey__"))return this.fromDer(r);if(ArrayBuffer.isView(r)){const n=r;return this.fromRaw(Zt(n.buffer))}else{if(r instanceof ArrayBuffer)return this.fromRaw(Zt(r));if("rawKey"in r&&r.rawKey instanceof Uint8Array)return this.fromRaw(r.rawKey);if("derKey"in r)return this.fromDer(r.derKey);if("toDer"in r)return this.fromDer(r.toDer())}}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(t){return new mr(t)}static fromDer(t){return new mr(this.derDecode(t))}static derEncode(t){const r=Sl(t,Ms);return r.__derEncodedPublicKey__=void 0,r}static derDecode(t){const r=Al(t,Ms);if(r.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return r}get rawKey(){return G(this,Wn)}get derKey(){return G(this,Xn)}toDer(){return this.derKey}toRaw(){return this.rawKey}};Wn=new WeakMap,Xn=new WeakMap,mr.RAW_KEY_LENGTH=32;let wn=mr;class Ot extends fo{static generate(t){if(t&&t.length!==32)throw new Error("Ed25519 Seed needs to be 32 bytes long.");t||(t=Mr.utils.randomPrivateKey()),Gd(t,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");const r=new Uint8Array(32);for(let s=0;s<32;s++)r[s]=t[s];const n=Mr.getPublicKey(r);return Ot.fromKeyPair(n,r)}static fromParsedJson(t){const[r,n]=t;return new Ot(wn.fromDer(dt(r)),dt(n))}static fromJSON(t){const r=JSON.parse(t);if(Array.isArray(r)){if(typeof r[0]=="string"&&typeof r[1]=="string")return this.fromParsedJson([r[0],r[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(t)}`)}static fromKeyPair(t,r){return new Ot(wn.fromRaw(t),r)}static fromSecretKey(t){const r=Mr.getPublicKey(t);return Ot.fromKeyPair(r,t)}#e;#t;constructor(t,r){super(),this.#e=wn.from(t),this.#t=r}toJSON(){return[re(this.#e.toDer()),re(this.#t)]}getKeyPair(){return{secretKey:this.#t,publicKey:this.#e}}getPublicKey(){return this.#e}async sign(t){const r=Mr.sign(t,this.#t.slice(0,32));return Object.defineProperty(r,"__signature__",{enumerable:!1,value:void 0}),r}static verify(t,r,n){const[s,i,a]=[t,r,n].map(o=>(typeof o=="string"&&(o=dt(o)),Zt(o)));return Mr.verify(s,i,a)}}class xo extends Error{constructor(t){super(t),this.message=t,Object.setPrototypeOf(this,xo.prototype)}}function Bc(e){if(typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle)return globalThis.crypto.subtle;if(e)return e;if(typeof crypto<"u"&&crypto.subtle)return crypto.subtle;throw new xo("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}class Un extends fo{static async generate(t){const{extractable:r=!1,keyUsages:n=["sign","verify"],subtleCrypto:s}=t??{},i=Bc(s),a=await i.generateKey({name:"ECDSA",namedCurve:"P-256"},r,n),o=Zt(await i.exportKey("spki",a.publicKey));return Object.assign(o,{__derEncodedPublicKey__:void 0}),new this(a,o,i)}static async fromKeyPair(t,r){const n=Bc(r),s=Zt(await n.exportKey("spki",t.publicKey));return Object.assign(s,{__derEncodedPublicKey__:void 0}),new Un(t,s,n)}constructor(t,r,n){super(),this._keyPair=t,this._derKey=r,this._subtleCrypto=n}getKeyPair(){return this._keyPair}getPublicKey(){const t=this._derKey,r=Object.create(this._keyPair.publicKey);return r.toDer=function(){return t},r}async sign(t){const r={name:"ECDSA",hash:{name:"SHA-256"}},n=Zt(await this._subtleCrypto.sign(r,this._keyPair.privateKey,t));return Object.assign(n,{__signature__:void 0}),n}}class Y0{#e;get rawKey(){return this.#e.rawKey}get derKey(){return this.#e.derKey}toDer(){return this.#e.toDer()}getPublicKey(){return this.#e}getPrincipal(){if(!this.#e.rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return D.fromUint8Array(new Uint8Array(this.#e.rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}constructor(t){this.#e=t}}function xs(e){return e instanceof Uint8Array?re(e):re(new Uint8Array(e))}function ia(e){if(typeof e!="string"||e.length<64)throw new Error("Invalid public key.");return dt(e)}class Eo{constructor(t,r,n){this.pubkey=t,this.expiration=r,this.targets=n}toCborValue(){return{pubkey:this.pubkey,expiration:this.expiration,...this.targets&&{targets:this.targets}}}toJSON(){return{expiration:this.expiration.toString(16),pubkey:xs(this.pubkey),...this.targets&&{targets:this.targets.map(t=>t.toHex())}}}}async function W0(e,t,r,n){const s=new Eo(t.toDer(),BigInt(+r)*BigInt(1e6),n),i=new Uint8Array([...sf,...new Uint8Array(jr({...s}))]),a=await e.sign(i);return{delegation:s,signature:a}}class Ls{static async create(t,r,n=new Date(Date.now()+900*1e3),s={}){const i=await W0(t,r,n,s.targets);return new Ls([...s.previous?.delegations||[],i],s.previous?.publicKey||t.getPublicKey().toDer())}static fromJSON(t){const{publicKey:r,delegations:n}=typeof t=="string"?JSON.parse(t):t;if(!Array.isArray(n))throw new Error("Invalid delegations.");const s=n.map(i=>{const{delegation:a,signature:o}=i,{pubkey:c,expiration:l,targets:f}=a;if(f!==void 0&&!Array.isArray(f))throw new Error("Invalid targets.");return{delegation:new Eo(ia(c),BigInt("0x"+l),f&&f.map(d=>{if(typeof d!="string")throw new Error("Invalid target.");return D.fromHex(d)})),signature:ia(o)}});return new this(s,ia(r))}static fromDelegations(t,r){return new this(t,r)}constructor(t,r){this.delegations=t,this.publicKey=r}toJSON(){return{delegations:this.delegations.map(t=>{const{delegation:r,signature:n}=t,{targets:s}=r;return{delegation:{expiration:r.expiration.toString(16),pubkey:xs(r.pubkey),...s&&{targets:s.map(i=>i.toHex())}},signature:xs(n)}}),publicKey:xs(this.publicKey)}}}class Vc extends fo{static fromDelegation(t,r){return new this(t,r)}constructor(t,r){super(),this._inner=t,this._delegation=r}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(t){return this._inner.sign(t)}async transformRequest(t){const{body:r,...n}=t,s=await jr(r);return{...n,body:{content:r,sender_sig:await this.sign(new Uint8Array([...zu,...new Uint8Array(s)])),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}}}}class $s extends Y0{#e;get delegation(){return this.#e}constructor(t,r){super(t),this.#e=r}static fromDelegation(t,r){return new $s(t,r)}}function kc(e,t){for(const{delegation:n}of e.delegations)if(+new Date(Number(n.expiration/BigInt(1e6)))<=+Date.now())return!1;const r=[];for(const n of r){const s=n.toText();for(const{delegation:i}of e.delegations){if(i.targets===void 0)continue;let a=!0;for(const o of i.targets)if(o.toText()===s){a=!1;break}if(a)return!1}}return!0}const Fc=["mousedown","mousemove","keydown","touchstart","wheel"];class qs{callbacks=[];idleTimeout=600*1e3;timeoutID=void 0;static create(t={}){return new qs(t)}constructor(t={}){const{onIdle:r,idleTimeout:n=600*1e3}=t||{};this.callbacks=r?[r]:[],this.idleTimeout=n;const s=this._resetTimer.bind(this);window.addEventListener("load",s,!0),Fc.forEach(a=>{document.addEventListener(a,s,!0)});const i=(a,o)=>{let c;return(...l)=>{const f=this,d=()=>{c=void 0,a.apply(f,l)};clearTimeout(c),c=window.setTimeout(d,o)}};if(t?.captureScroll){const a=i(s,t?.scrollDebounce??100);window.addEventListener("scroll",a,!0)}s()}registerCallback(t){this.callbacks.push(t)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);const t=this._resetTimer.bind(this);Fc.forEach(r=>{document.removeEventListener(r,t,!0)}),this.callbacks.forEach(r=>{r()})}_resetTimer(){const t=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(t,this.idleTimeout)}}const X0=(e,t)=>t.some(r=>e instanceof r);let Uc,Pc;function J0(){return Uc||(Uc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Q0(){return Pc||(Pc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fl=new WeakMap,Va=new WeakMap,Ul=new WeakMap,aa=new WeakMap,vo=new WeakMap;function ep(e){const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{r(Wt(e.result)),s()},a=()=>{n(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(r=>{r instanceof IDBCursor&&Fl.set(r,e)}).catch(()=>{}),vo.set(t,e),t}function tp(e){if(Va.has(e))return;const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{r(),s()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});Va.set(e,t)}let ka={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Va.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ul.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Wt(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function rp(e){ka=e(ka)}function np(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(oa(this),t,...r);return Ul.set(n,t.sort?t.sort():[t]),Wt(n)}:Q0().includes(e)?function(...t){return e.apply(oa(this),t),Wt(Fl.get(this))}:function(...t){return Wt(e.apply(oa(this),t))}}function sp(e){return typeof e=="function"?np(e):(e instanceof IDBTransaction&&tp(e),X0(e,J0())?new Proxy(e,ka):e)}function Wt(e){if(e instanceof IDBRequest)return ep(e);if(aa.has(e))return aa.get(e);const t=sp(e);return t!==e&&(aa.set(e,t),vo.set(t,e)),t}const oa=e=>vo.get(e);function ip(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(e,t),o=Wt(a);return n&&a.addEventListener("upgradeneeded",c=>{n(Wt(a.result),c.oldVersion,c.newVersion,Wt(a.transaction),c)}),r&&a.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),o.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),o}const ap=["get","getKey","getAll","getAllKeys","count"],op=["put","add","delete","clear"],ca=new Map;function Dc(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(ca.get(t))return ca.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=op.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||ap.includes(r)))return;const i=async function(a,...o){const c=this.transaction(a,s?"readwrite":"readonly");let l=c.store;return n&&(l=l.index(o.shift())),(await Promise.all([l[r](...o),s&&c.done]))[0]};return ca.set(t,i),i}rp(e=>({...e,get:(t,r,n)=>Dc(t,r)||e.get(t,r,n),has:(t,r)=>!!Dc(t,r)||e.has(t,r)}));const Pl="auth-client-db",Dl="ic-keyval",cp=async(e=Pl,t=Dl,r)=>(globalThis.localStorage?.getItem(Gt)&&(globalThis.localStorage.removeItem(Gt),globalThis.localStorage.removeItem(wr)),await ip(e,r,{upgrade:n=>{n.objectStoreNames.contains(t)&&n.clear(t),n.createObjectStore(t)}}));async function up(e,t,r){return await e.get(t,r)}async function lp(e,t,r,n){return await e.put(t,n,r)}async function dp(e,t,r){return await e.delete(t,r)}class No{constructor(t,r){this._db=t,this._storeName=r}static async create(t){const{dbName:r=Pl,storeName:n=Dl,version:s=hp}=t??{},i=await cp(r,n,s);return new No(i,n)}async set(t,r){return await lp(this._db,this._storeName,t,r)}async get(t){return await up(this._db,this._storeName,t)??null}async remove(t){return await dp(this._db,this._storeName,t)}}const wr="identity",Gt="delegation",fp="iv",hp=1;class pp{constructor(t="ic-",r){this.prefix=t,this._localStorage=r}get(t){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+t))}set(t,r){return this._getLocalStorage().setItem(this.prefix+t,r),Promise.resolve()}remove(t){return this._getLocalStorage().removeItem(this.prefix+t),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;const t=globalThis.localStorage;if(!t)throw new Error("Could not find local storage.");return t}}class mp{#e;constructor(t){this.#e=t??{}}initializedDb;get _db(){return new Promise((t,r)=>{if(this.initializedDb){t(this.initializedDb);return}No.create(this.#e).then(n=>{this.initializedDb=n,t(n)}).catch(r)})}async get(t){return await(await this._db).get(t)}async set(t,r){await(await this._db).set(t,r)}async remove(t){await(await this._db).remove(t)}}const yp=BigInt(1e9),_p=BigInt(3600),gp=yp*_p,bp="https://identity.internetcomputer.org",wp="#authorize",xp=BigInt(8)*gp,ua="ECDSA",la="Ed25519",Ep=500,vp="UserInterrupt";class Pn{constructor(t,r,n,s,i,a,o,c){this._identity=t,this._key=r,this._chain=n,this._storage=s,this.idleManager=i,this._createOptions=a,this._idpWindow=o,this._eventHandler=c,this._registerDefaultIdleCallback()}static async create(t={}){const r=t.storage??new mp,n=t.keyType??ua;let s=null;if(t.identity)s=t.identity;else{let c=await r.get(wr);if(!c)try{const l=new pp,f=await l.get(Gt),d=await l.get(wr);f&&d&&n===ua&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await r.set(Gt,f),await r.set(wr,d),c=f,await l.remove(Gt),await l.remove(wr))}catch(l){console.error(`error while attempting to recover localstorage: ${l}`)}if(c)try{typeof c=="object"?n===la&&typeof c=="string"?s=Ot.fromJSON(c):s=await Un.fromKeyPair(c):typeof c=="string"&&(s=Ot.fromJSON(c))}catch{}}let i=new Kr,a=null;if(s)try{const c=await r.get(Gt);if(typeof c=="object"&&c!==null)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");t.identity?i=t.identity:c&&(a=Ls.fromJSON(c),kc(a)?"toDer"in s?i=$s.fromDelegation(s,a):i=Vc.fromDelegation(s,a):(await da(r),s=null))}catch(c){console.error(c),await da(r),s=null}let o;return t.idleOptions?.disableIdle?o=void 0:(a||t.identity)&&(o=qs.create(t.idleOptions)),s||(n===la?s=Ot.generate():(t.storage&&n===ua&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${la}' as the key type, as it can serialize to a string`),s=await Un.generate()),await Mc(r,s)),new Pn(i,s,a,r,o,t)}_registerDefaultIdleCallback(){const t=this._createOptions?.idleOptions;!t?.onIdle&&!t?.disableDefaultIdleCallback&&this.idleManager?.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(t,r){const n=t.delegations.map(o=>({delegation:new Eo(o.delegation.pubkey,o.delegation.expiration,o.delegation.targets),signature:o.signature})),s=Ls.fromDelegations(n,t.userPublicKey),i=this._key;if(!i)return;this._chain=s,"toDer"in i?this._identity=$s.fromDelegation(i,this._chain):this._identity=Vc.fromDelegation(i,this._chain),this._idpWindow?.close();const a=this._createOptions?.idleOptions;!this.idleManager&&!a?.disableIdle&&(this.idleManager=qs.create(a),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(Gt,JSON.stringify(this._chain.toJSON())),await Mc(this._storage,this._key),r?.(t)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&this._chain!==null&&kc(this._chain)}async login(t){const r=Np(this._createOptions?.loginOptions,t),n=r?.maxTimeToLive??xp,s=new URL(r?.identityProvider?.toString()||bp);s.hash=wp,this._idpWindow?.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(s,{maxTimeToLive:n,...r}),window.addEventListener("message",this._eventHandler),this._idpWindow=window.open(s.toString(),"idpWindow",r?.windowOpenerFeatures)??void 0;const i=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure(vp,r?.onError):setTimeout(i,Ep))};i()}_getEventHandler(t,r){return async n=>{if(n.origin!==t.origin)return;const s=n.data;switch(s.kind){case"authorize-ready":{const i={kind:"authorize-client",sessionPublicKey:new Uint8Array(this._key?.getPublicKey().toDer()),maxTimeToLive:r?.maxTimeToLive,allowPinAuthentication:r?.allowPinAuthentication,derivationOrigin:r?.derivationOrigin?.toString(),...r?.customValues};this._idpWindow?.postMessage(i,t.origin);break}case"authorize-client-success":try{await this._handleSuccess(s,r?.onSuccess)}catch(i){this._handleFailure(i.message,r?.onError)}break;case"authorize-client-failure":this._handleFailure(s.text,r?.onError);break}}}_handleFailure(t,r){this._idpWindow?.close(),r?.(t),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(t={}){if(await da(this._storage),this._identity=new Kr,this._chain=null,t.returnTo)try{window.history.pushState({},"",t.returnTo)}catch{window.location.href=t.returnTo}}}async function da(e){await e.remove(wr),await e.remove(Gt),await e.remove(fp)}function Np(e,t){if(!e&&!t)return;const r=e?.customValues||t?.customValues?{...e?.customValues,...t?.customValues}:void 0;return{...e,...t,customValues:r}}function Tp(e){if(e instanceof Un)return e.getKeyPair();if(e instanceof Ot)return JSON.stringify(e.toJSON());throw new Error("Unsupported key type")}async function Mc(e,t){const r=Tp(t);await e.set(wr,r)}(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Ip=({IDL:e})=>{let t=e.Variant({Set:e.Principal,Unset:e.Null}),r=e.Text;e.Record({exchange_rate_canister:e.Opt(t),cycles_ledger_canister_id:e.Opt(e.Principal),last_purged_notification:e.Opt(e.Nat64),governance_canister_id:e.Opt(e.Principal),minting_account_id:e.Opt(r),ledger_canister_id:e.Opt(e.Principal)});let n=e.Record({subnets:e.Vec(e.Principal),subnet_type:e.Text}),s=e.Variant({Add:n,Remove:n}),i=e.Record({subnet_type:e.Opt(e.Text)}),a=e.Variant({Filter:i,Subnet:e.Record({subnet:e.Principal})}),o=e.Record({value:e.Text,name:e.Text}),c=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),l=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(o)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(c),log_memory_limit:e.Opt(e.Nat),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),f=e.Record({subnet_selection:e.Opt(a),settings:e.Opt(l),subnet_type:e.Opt(e.Text)}),d=e.Variant({Refunded:e.Record({create_error:e.Text,refund_amount:e.Nat})}),u=e.Variant({Ok:e.Principal,Err:d}),h=e.Record({xdr_permyriad_per_icp:e.Nat64,timestamp_seconds:e.Nat64}),y=e.Record({certificate:e.Vec(e.Nat8),data:h,hash_tree:e.Vec(e.Nat8)}),_=e.Record({data:e.Vec(e.Tuple(e.Principal,e.Vec(e.Principal)))}),g=e.Record({data:e.Vec(e.Tuple(e.Text,e.Vec(e.Principal)))}),m=e.Nat64,b=e.Record({controller:e.Principal,block_index:m,subnet_selection:e.Opt(a),settings:e.Opt(l),subnet_type:e.Opt(e.Text)}),p=e.Variant({Refunded:e.Record({block_index:e.Opt(m),reason:e.Text}),InvalidTransaction:e.Text,Other:e.Record({error_message:e.Text,error_code:e.Nat64}),Processing:e.Null,TransactionTooOld:m}),E=e.Variant({Ok:e.Principal,Err:p}),v=e.Opt(e.Vec(e.Nat8)),N=e.Opt(e.Vec(e.Nat8)),I=e.Record({block_index:m,deposit_memo:v,to_subaccount:N}),O=e.Record({balance:e.Nat,block_index:e.Nat,minted:e.Nat}),x=e.Variant({Ok:O,Err:p}),R=e.Record({block_index:m,canister_id:e.Principal}),B=e.Nat,A=e.Variant({Ok:B,Err:p}),w=e.Record({who:e.Opt(e.Principal),subnets:e.Vec(e.Principal)}),T=e.Variant({Add:e.Text,Remove:e.Text});return e.Service({change_subnet_type_assignment:e.Func([s],[],[]),create_canister:e.Func([f],[u],[]),get_build_metadata:e.Func([],[e.Text],[]),get_default_subnets:e.Func([],[e.Vec(e.Principal)],[]),get_icp_xdr_conversion_rate:e.Func([],[y],[]),get_principals_authorized_to_create_canisters_to_subnets:e.Func([],[_],[]),get_subnet_types_to_subnets:e.Func([],[g],[]),notify_create_canister:e.Func([b],[E],[]),notify_mint_cycles:e.Func([I],[x],[]),notify_top_up:e.Func([R],[A],[]),set_authorized_subnetwork_list:e.Func([w],[],[]),update_subnet_type:e.Func([T],[],[])})},Op=({IDL:e})=>{let t=e.Variant({Set:e.Principal,Unset:e.Null}),r=e.Text;e.Record({exchange_rate_canister:e.Opt(t),cycles_ledger_canister_id:e.Opt(e.Principal),last_purged_notification:e.Opt(e.Nat64),governance_canister_id:e.Opt(e.Principal),minting_account_id:e.Opt(r),ledger_canister_id:e.Opt(e.Principal)});let n=e.Record({subnets:e.Vec(e.Principal),subnet_type:e.Text}),s=e.Variant({Add:n,Remove:n}),i=e.Record({subnet_type:e.Opt(e.Text)}),a=e.Variant({Filter:i,Subnet:e.Record({subnet:e.Principal})}),o=e.Record({value:e.Text,name:e.Text}),c=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),l=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(o)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(c),log_memory_limit:e.Opt(e.Nat),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),f=e.Record({subnet_selection:e.Opt(a),settings:e.Opt(l),subnet_type:e.Opt(e.Text)}),d=e.Variant({Refunded:e.Record({create_error:e.Text,refund_amount:e.Nat})}),u=e.Variant({Ok:e.Principal,Err:d}),h=e.Record({xdr_permyriad_per_icp:e.Nat64,timestamp_seconds:e.Nat64}),y=e.Record({certificate:e.Vec(e.Nat8),data:h,hash_tree:e.Vec(e.Nat8)}),_=e.Record({data:e.Vec(e.Tuple(e.Principal,e.Vec(e.Principal)))}),g=e.Record({data:e.Vec(e.Tuple(e.Text,e.Vec(e.Principal)))}),m=e.Nat64,b=e.Record({controller:e.Principal,block_index:m,subnet_selection:e.Opt(a),settings:e.Opt(l),subnet_type:e.Opt(e.Text)}),p=e.Variant({Refunded:e.Record({block_index:e.Opt(m),reason:e.Text}),InvalidTransaction:e.Text,Other:e.Record({error_message:e.Text,error_code:e.Nat64}),Processing:e.Null,TransactionTooOld:m}),E=e.Variant({Ok:e.Principal,Err:p}),v=e.Opt(e.Vec(e.Nat8)),N=e.Opt(e.Vec(e.Nat8)),I=e.Record({block_index:m,deposit_memo:v,to_subaccount:N}),O=e.Record({balance:e.Nat,block_index:e.Nat,minted:e.Nat}),x=e.Variant({Ok:O,Err:p}),R=e.Record({block_index:m,canister_id:e.Principal}),B=e.Nat,A=e.Variant({Ok:B,Err:p}),w=e.Record({who:e.Opt(e.Principal),subnets:e.Vec(e.Principal)}),T=e.Variant({Add:e.Text,Remove:e.Text});return e.Service({change_subnet_type_assignment:e.Func([s],[],[]),create_canister:e.Func([f],[u],[]),get_build_metadata:e.Func([],[e.Text],["query"]),get_default_subnets:e.Func([],[e.Vec(e.Principal)],["query"]),get_icp_xdr_conversion_rate:e.Func([],[y],["query"]),get_principals_authorized_to_create_canisters_to_subnets:e.Func([],[_],["query"]),get_subnet_types_to_subnets:e.Func([],[g],["query"]),notify_create_canister:e.Func([b],[E],[]),notify_mint_cycles:e.Func([I],[x],[]),notify_top_up:e.Func([R],[A],[]),set_authorized_subnetwork_list:e.Func([w],[],[]),update_subnet_type:e.Func([T],[],[])})},Rp=({IDL:e})=>{let t=e.Variant({mainnet:e.Null,testnet:e.Null}),r=e.Text,n=e.Record({network:t,address:r,min_confirmations:e.Opt(e.Nat32)}),s=e.Nat64,i=s,a=e.Nat32,o=e.Record({start_height:a,end_height:e.Opt(a),network:t}),c=e.Vec(e.Nat8),l=e.Record({tip_height:a,block_headers:e.Vec(c)}),f=e.Record({network:t}),d=e.Nat64,u=e.Vec(d),h=e.Record({network:t,filter:e.Opt(e.Variant({page:e.Vec(e.Nat8),min_confirmations:e.Nat32})),address:r}),y=e.Vec(e.Nat8),_=e.Record({txid:e.Vec(e.Nat8),vout:e.Nat32}),g=e.Record({height:e.Nat32,value:s,outpoint:_}),m=e.Record({next_page:e.Opt(e.Vec(e.Nat8)),tip_height:a,tip_block_hash:y,utxos:e.Vec(g)}),b=e.Record({transaction:e.Vec(e.Nat8),network:t}),p=e.Principal,E=e.Record({canister_id:p,num_requested_changes:e.Opt(e.Nat64)}),v=e.Variant({from_user:e.Record({user_id:e.Principal}),from_canister:e.Record({canister_version:e.Opt(e.Nat64),canister_id:e.Principal})}),N=e.Vec(e.Nat8),I=e.Variant({creation:e.Record({controllers:e.Vec(e.Principal),environment_variables_hash:e.Opt(e.Vec(e.Nat8))}),code_deployment:e.Record({mode:e.Variant({reinstall:e.Null,upgrade:e.Null,install:e.Null}),module_hash:e.Vec(e.Nat8)}),load_snapshot:e.Record({canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),from_canister_id:e.Opt(e.Principal),taken_at_timestamp:e.Nat64,snapshot_id:N}),controllers_change:e.Record({controllers:e.Vec(e.Principal)}),code_uninstall:e.Null}),O=e.Record({timestamp_nanos:e.Nat64,canister_version:e.Nat64,origin:v,details:I}),x=e.Record({controllers:e.Vec(e.Principal),module_hash:e.Opt(e.Vec(e.Nat8)),recent_changes:e.Vec(O),total_num_changes:e.Nat64}),R=e.Record({name:e.Text,canister_id:p}),B=e.Record({value:e.Vec(e.Nat8)}),A=e.Record({canister_id:p}),w=e.Record({value:e.Text,name:e.Text}),T=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),C=e.Record({freezing_threshold:e.Nat,wasm_memory_threshold:e.Nat,environment_variables:e.Vec(w),controllers:e.Vec(e.Principal),reserved_cycles_limit:e.Nat,log_visibility:T,wasm_memory_limit:e.Nat,memory_allocation:e.Nat,compute_allocation:e.Nat}),F=e.Record({memory_metrics:e.Record({wasm_binary_size:e.Nat,wasm_chunk_store_size:e.Nat,canister_history_size:e.Nat,stable_memory_size:e.Nat,snapshots_size:e.Nat,wasm_memory_size:e.Nat,global_memory_size:e.Nat,custom_sections_size:e.Nat}),status:e.Variant({stopped:e.Null,stopping:e.Null,running:e.Null}),memory_size:e.Nat,ready_for_migration:e.Bool,version:e.Nat64,cycles:e.Nat,settings:C,query_stats:e.Record({response_payload_bytes_total:e.Nat,num_instructions_total:e.Nat,num_calls_total:e.Nat,request_payload_bytes_total:e.Nat}),idle_cycles_burned_per_day:e.Nat,module_hash:e.Opt(e.Vec(e.Nat8)),reserved_cycles:e.Nat}),L=e.Record({canister_id:p}),S=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(w)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(T),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),V=e.Record({settings:e.Opt(S),sender_canister_version:e.Opt(e.Nat64)}),k=e.Record({canister_id:p}),U=e.Record({canister_id:p}),P=e.Record({canister_id:p,snapshot_id:N}),se=e.Record({canister_id:p}),te=e.Variant({secp256k1:e.Null}),Z=e.Record({key_id:e.Record({name:e.Text,curve:te}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),z=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),ie=e.Record({canister_id:p}),_e=e.Record({idx:e.Nat64,timestamp_nanos:e.Nat64,content:e.Vec(e.Nat8)}),J=e.Record({canister_log_records:e.Vec(_e)}),he=e.Record({value:e.Text,name:e.Text}),We=e.Record({status:e.Nat,body:e.Vec(e.Nat8),headers:e.Vec(he)}),mt=e.Record({url:e.Text,method:e.Variant({get:e.Null,head:e.Null,post:e.Null}),max_response_bytes:e.Opt(e.Nat64),body:e.Opt(e.Vec(e.Nat8)),transform:e.Opt(e.Record({function:e.Func([e.Record({context:e.Vec(e.Nat8),response:We})],[We],[]),context:e.Vec(e.Nat8)})),headers:e.Vec(he),is_replicated:e.Opt(e.Bool)}),yt=e.Variant({reinstall:e.Null,upgrade:e.Opt(e.Record({wasm_memory_persistence:e.Opt(e.Variant({keep:e.Null,replace:e.Null})),skip_pre_upgrade:e.Opt(e.Bool)})),install:e.Null}),Pe=e.Record({hash:e.Vec(e.Nat8)}),tr=e.Record({arg:e.Vec(e.Nat8),wasm_module_hash:e.Vec(e.Nat8),mode:yt,chunk_hashes_list:e.Vec(Pe),target_canister:p,store_canister:e.Opt(p),sender_canister_version:e.Opt(e.Nat64)}),rr=e.Vec(e.Nat8),nr=e.Record({arg:e.Vec(e.Nat8),wasm_module:rr,mode:yt,canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),sr=e.Record({canister_id:p}),_t=e.Record({id:N,total_size:e.Nat64,taken_at_timestamp:e.Nat64}),ir=e.Vec(_t),ar=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64),snapshot_id:N}),or=e.Record({start_at_timestamp_nanos:e.Nat64,subnet_id:e.Principal}),cr=e.Record({num_block_failures_total:e.Nat64,node_id:e.Principal,num_blocks_proposed_total:e.Nat64}),ur=e.Vec(e.Record({timestamp_nanos:e.Nat64,node_metrics:e.Vec(cr)})),lr=e.Record({settings:e.Opt(S),specified_id:e.Opt(p),amount:e.Opt(e.Nat),sender_canister_version:e.Opt(e.Nat64)}),dr=e.Record({canister_id:p}),fr=e.Record({canister_id:p,amount:e.Nat}),hr=e.Vec(e.Nat8),fi=e.Record({kind:e.Variant({wasm_module:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_memory:e.Record({size:e.Nat64,offset:e.Nat64}),stable_memory:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_chunk:e.Record({hash:e.Vec(e.Nat8)})}),canister_id:p,snapshot_id:N}),hi=e.Record({chunk:e.Vec(e.Nat8)}),pi=e.Record({canister_id:p,snapshot_id:N}),mi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,stable_memory_size:e.Nat64,wasm_chunk_store:e.Vec(e.Record({hash:e.Vec(e.Nat8)})),taken_at_timestamp:e.Nat64,wasm_memory_size:e.Nat64}),ln=e.Variant({ed25519:e.Null,bip340secp256k1:e.Null}),yi=e.Record({key_id:e.Record({algorithm:ln,name:e.Text}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),_i=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),gi=e.Record({key_id:e.Record({name:e.Text,curve:te}),derivation_path:e.Vec(e.Vec(e.Nat8)),message_hash:e.Vec(e.Nat8)}),bi=e.Record({signature:e.Vec(e.Nat8)}),wi=e.Variant({bip341:e.Record({merkle_root_hash:e.Vec(e.Nat8)})}),xi=e.Record({aux:e.Opt(wi),key_id:e.Record({algorithm:ln,name:e.Text}),derivation_path:e.Vec(e.Vec(e.Nat8)),message:e.Vec(e.Nat8)}),Ei=e.Record({signature:e.Vec(e.Nat8)}),vi=e.Record({canister_id:p}),Ni=e.Record({canister_id:p}),Ti=e.Record({canister_id:p}),Ii=e.Vec(Pe),Oi=e.Record({subnet_id:e.Principal}),Ri=e.Record({replica_version:e.Text,registry_version:e.Nat64}),Si=e.Record({replace_snapshot:e.Opt(N),canister_id:p,uninstall_code:e.Opt(e.Bool),sender_canister_version:e.Opt(e.Nat64)}),Ai=_t,Ci=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),Bi=e.Record({canister_id:e.Principal,settings:S,sender_canister_version:e.Opt(e.Nat64)}),Vi=e.Record({chunk:e.Vec(e.Nat8),kind:e.Variant({wasm_module:e.Record({offset:e.Nat64}),wasm_memory:e.Record({offset:e.Nat64}),stable_memory:e.Record({offset:e.Nat64}),wasm_chunk:e.Null}),canister_id:p,snapshot_id:N}),ki=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),replace_snapshot:e.Opt(N),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,canister_id:p,stable_memory_size:e.Nat64,wasm_memory_size:e.Nat64}),Fi=e.Record({snapshot_id:N}),Ui=e.Record({chunk:e.Vec(e.Nat8),canister_id:e.Principal}),Pi=Pe,dn=e.Variant({bls12_381_g2:e.Null}),Di=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),input:e.Vec(e.Nat8),transport_public_key:e.Vec(e.Nat8)}),Mi=e.Record({encrypted_key:e.Vec(e.Nat8)}),Li=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),canister_id:e.Opt(p)}),$i=e.Record({public_key:e.Vec(e.Nat8)});return e.Service({bitcoin_get_balance:e.Func([n],[i],[]),bitcoin_get_block_headers:e.Func([o],[l],[]),bitcoin_get_current_fee_percentiles:e.Func([f],[u],[]),bitcoin_get_utxos:e.Func([h],[m],[]),bitcoin_send_transaction:e.Func([b],[],[]),canister_info:e.Func([E],[x],[]),canister_metadata:e.Func([R],[B],[]),canister_status:e.Func([A],[F],[]),clear_chunk_store:e.Func([L],[],[]),create_canister:e.Func([V],[k],[]),delete_canister:e.Func([U],[],[]),delete_canister_snapshot:e.Func([P],[],[]),deposit_cycles:e.Func([se],[],[]),ecdsa_public_key:e.Func([Z],[z],[]),fetch_canister_logs:e.Func([ie],[J],[]),http_request:e.Func([mt],[We],[]),install_chunked_code:e.Func([tr],[],[]),install_code:e.Func([nr],[],[]),list_canister_snapshots:e.Func([sr],[ir],[]),load_canister_snapshot:e.Func([ar],[],[]),node_metrics_history:e.Func([or],[ur],[]),provisional_create_canister_with_cycles:e.Func([lr],[dr],[]),provisional_top_up_canister:e.Func([fr],[],[]),raw_rand:e.Func([],[hr],[]),read_canister_snapshot_data:e.Func([fi],[hi],[]),read_canister_snapshot_metadata:e.Func([pi],[mi],[]),schnorr_public_key:e.Func([yi],[_i],[]),sign_with_ecdsa:e.Func([gi],[bi],[]),sign_with_schnorr:e.Func([xi],[Ei],[]),start_canister:e.Func([vi],[],[]),stop_canister:e.Func([Ni],[],[]),stored_chunks:e.Func([Ti],[Ii],[]),subnet_info:e.Func([Oi],[Ri],[]),take_canister_snapshot:e.Func([Si],[Ai],[]),uninstall_code:e.Func([Ci],[],[]),update_settings:e.Func([Bi],[],[]),upload_canister_snapshot_data:e.Func([Vi],[],[]),upload_canister_snapshot_metadata:e.Func([ki],[Fi],[]),upload_chunk:e.Func([Ui],[Pi],[]),vetkd_derive_key:e.Func([Di],[Mi],[]),vetkd_public_key:e.Func([Li],[$i],[])})},Sp=({IDL:e})=>{let t=e.Variant({mainnet:e.Null,testnet:e.Null}),r=e.Text,n=e.Record({network:t,address:r,min_confirmations:e.Opt(e.Nat32)}),s=e.Nat64,i=s,a=e.Nat32,o=e.Record({start_height:a,end_height:e.Opt(a),network:t}),c=e.Vec(e.Nat8),l=e.Record({tip_height:a,block_headers:e.Vec(c)}),f=e.Record({network:t}),d=e.Nat64,u=e.Vec(d),h=e.Record({network:t,filter:e.Opt(e.Variant({page:e.Vec(e.Nat8),min_confirmations:e.Nat32})),address:r}),y=e.Vec(e.Nat8),_=e.Record({txid:e.Vec(e.Nat8),vout:e.Nat32}),g=e.Record({height:e.Nat32,value:s,outpoint:_}),m=e.Record({next_page:e.Opt(e.Vec(e.Nat8)),tip_height:a,tip_block_hash:y,utxos:e.Vec(g)}),b=e.Record({transaction:e.Vec(e.Nat8),network:t}),p=e.Principal,E=e.Record({canister_id:p,num_requested_changes:e.Opt(e.Nat64)}),v=e.Variant({from_user:e.Record({user_id:e.Principal}),from_canister:e.Record({canister_version:e.Opt(e.Nat64),canister_id:e.Principal})}),N=e.Vec(e.Nat8),I=e.Variant({creation:e.Record({controllers:e.Vec(e.Principal),environment_variables_hash:e.Opt(e.Vec(e.Nat8))}),code_deployment:e.Record({mode:e.Variant({reinstall:e.Null,upgrade:e.Null,install:e.Null}),module_hash:e.Vec(e.Nat8)}),load_snapshot:e.Record({canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),from_canister_id:e.Opt(e.Principal),taken_at_timestamp:e.Nat64,snapshot_id:N}),controllers_change:e.Record({controllers:e.Vec(e.Principal)}),code_uninstall:e.Null}),O=e.Record({timestamp_nanos:e.Nat64,canister_version:e.Nat64,origin:v,details:I}),x=e.Record({controllers:e.Vec(e.Principal),module_hash:e.Opt(e.Vec(e.Nat8)),recent_changes:e.Vec(O),total_num_changes:e.Nat64}),R=e.Record({name:e.Text,canister_id:p}),B=e.Record({value:e.Vec(e.Nat8)}),A=e.Record({canister_id:p}),w=e.Record({value:e.Text,name:e.Text}),T=e.Variant({controllers:e.Null,public:e.Null,allowed_viewers:e.Vec(e.Principal)}),C=e.Record({freezing_threshold:e.Nat,wasm_memory_threshold:e.Nat,environment_variables:e.Vec(w),controllers:e.Vec(e.Principal),reserved_cycles_limit:e.Nat,log_visibility:T,wasm_memory_limit:e.Nat,memory_allocation:e.Nat,compute_allocation:e.Nat}),F=e.Record({memory_metrics:e.Record({wasm_binary_size:e.Nat,wasm_chunk_store_size:e.Nat,canister_history_size:e.Nat,stable_memory_size:e.Nat,snapshots_size:e.Nat,wasm_memory_size:e.Nat,global_memory_size:e.Nat,custom_sections_size:e.Nat}),status:e.Variant({stopped:e.Null,stopping:e.Null,running:e.Null}),memory_size:e.Nat,ready_for_migration:e.Bool,version:e.Nat64,cycles:e.Nat,settings:C,query_stats:e.Record({response_payload_bytes_total:e.Nat,num_instructions_total:e.Nat,num_calls_total:e.Nat,request_payload_bytes_total:e.Nat}),idle_cycles_burned_per_day:e.Nat,module_hash:e.Opt(e.Vec(e.Nat8)),reserved_cycles:e.Nat}),L=e.Record({canister_id:p}),S=e.Record({freezing_threshold:e.Opt(e.Nat),wasm_memory_threshold:e.Opt(e.Nat),environment_variables:e.Opt(e.Vec(w)),controllers:e.Opt(e.Vec(e.Principal)),reserved_cycles_limit:e.Opt(e.Nat),log_visibility:e.Opt(T),wasm_memory_limit:e.Opt(e.Nat),memory_allocation:e.Opt(e.Nat),compute_allocation:e.Opt(e.Nat)}),V=e.Record({settings:e.Opt(S),sender_canister_version:e.Opt(e.Nat64)}),k=e.Record({canister_id:p}),U=e.Record({canister_id:p}),P=e.Record({canister_id:p,snapshot_id:N}),se=e.Record({canister_id:p}),te=e.Variant({secp256k1:e.Null}),Z=e.Record({key_id:e.Record({name:e.Text,curve:te}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),z=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),ie=e.Record({canister_id:p}),_e=e.Record({idx:e.Nat64,timestamp_nanos:e.Nat64,content:e.Vec(e.Nat8)}),J=e.Record({canister_log_records:e.Vec(_e)}),he=e.Record({value:e.Text,name:e.Text}),We=e.Record({status:e.Nat,body:e.Vec(e.Nat8),headers:e.Vec(he)}),mt=e.Record({url:e.Text,method:e.Variant({get:e.Null,head:e.Null,post:e.Null}),max_response_bytes:e.Opt(e.Nat64),body:e.Opt(e.Vec(e.Nat8)),transform:e.Opt(e.Record({function:e.Func([e.Record({context:e.Vec(e.Nat8),response:We})],[We],["query"]),context:e.Vec(e.Nat8)})),headers:e.Vec(he),is_replicated:e.Opt(e.Bool)}),yt=e.Variant({reinstall:e.Null,upgrade:e.Opt(e.Record({wasm_memory_persistence:e.Opt(e.Variant({keep:e.Null,replace:e.Null})),skip_pre_upgrade:e.Opt(e.Bool)})),install:e.Null}),Pe=e.Record({hash:e.Vec(e.Nat8)}),tr=e.Record({arg:e.Vec(e.Nat8),wasm_module_hash:e.Vec(e.Nat8),mode:yt,chunk_hashes_list:e.Vec(Pe),target_canister:p,store_canister:e.Opt(p),sender_canister_version:e.Opt(e.Nat64)}),rr=e.Vec(e.Nat8),nr=e.Record({arg:e.Vec(e.Nat8),wasm_module:rr,mode:yt,canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),sr=e.Record({canister_id:p}),_t=e.Record({id:N,total_size:e.Nat64,taken_at_timestamp:e.Nat64}),ir=e.Vec(_t),ar=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64),snapshot_id:N}),or=e.Record({start_at_timestamp_nanos:e.Nat64,subnet_id:e.Principal}),cr=e.Record({num_block_failures_total:e.Nat64,node_id:e.Principal,num_blocks_proposed_total:e.Nat64}),ur=e.Vec(e.Record({timestamp_nanos:e.Nat64,node_metrics:e.Vec(cr)})),lr=e.Record({settings:e.Opt(S),specified_id:e.Opt(p),amount:e.Opt(e.Nat),sender_canister_version:e.Opt(e.Nat64)}),dr=e.Record({canister_id:p}),fr=e.Record({canister_id:p,amount:e.Nat}),hr=e.Vec(e.Nat8),fi=e.Record({kind:e.Variant({wasm_module:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_memory:e.Record({size:e.Nat64,offset:e.Nat64}),stable_memory:e.Record({size:e.Nat64,offset:e.Nat64}),wasm_chunk:e.Record({hash:e.Vec(e.Nat8)})}),canister_id:p,snapshot_id:N}),hi=e.Record({chunk:e.Vec(e.Nat8)}),pi=e.Record({canister_id:p,snapshot_id:N}),mi=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),canister_version:e.Nat64,source:e.Variant({metadata_upload:e.Reserved,taken_from_canister:e.Reserved}),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,stable_memory_size:e.Nat64,wasm_chunk_store:e.Vec(e.Record({hash:e.Vec(e.Nat8)})),taken_at_timestamp:e.Nat64,wasm_memory_size:e.Nat64}),ln=e.Variant({ed25519:e.Null,bip340secp256k1:e.Null}),yi=e.Record({key_id:e.Record({algorithm:ln,name:e.Text}),canister_id:e.Opt(p),derivation_path:e.Vec(e.Vec(e.Nat8))}),_i=e.Record({public_key:e.Vec(e.Nat8),chain_code:e.Vec(e.Nat8)}),gi=e.Record({key_id:e.Record({name:e.Text,curve:te}),derivation_path:e.Vec(e.Vec(e.Nat8)),message_hash:e.Vec(e.Nat8)}),bi=e.Record({signature:e.Vec(e.Nat8)}),wi=e.Variant({bip341:e.Record({merkle_root_hash:e.Vec(e.Nat8)})}),xi=e.Record({aux:e.Opt(wi),key_id:e.Record({algorithm:ln,name:e.Text}),derivation_path:e.Vec(e.Vec(e.Nat8)),message:e.Vec(e.Nat8)}),Ei=e.Record({signature:e.Vec(e.Nat8)}),vi=e.Record({canister_id:p}),Ni=e.Record({canister_id:p}),Ti=e.Record({canister_id:p}),Ii=e.Vec(Pe),Oi=e.Record({subnet_id:e.Principal}),Ri=e.Record({replica_version:e.Text,registry_version:e.Nat64}),Si=e.Record({replace_snapshot:e.Opt(N),canister_id:p,uninstall_code:e.Opt(e.Bool),sender_canister_version:e.Opt(e.Nat64)}),Ai=_t,Ci=e.Record({canister_id:p,sender_canister_version:e.Opt(e.Nat64)}),Bi=e.Record({canister_id:e.Principal,settings:S,sender_canister_version:e.Opt(e.Nat64)}),Vi=e.Record({chunk:e.Vec(e.Nat8),kind:e.Variant({wasm_module:e.Record({offset:e.Nat64}),wasm_memory:e.Record({offset:e.Nat64}),stable_memory:e.Record({offset:e.Nat64}),wasm_chunk:e.Null}),canister_id:p,snapshot_id:N}),ki=e.Record({globals:e.Vec(e.Variant({f32:e.Float32,f64:e.Float64,i32:e.Int32,i64:e.Int64,v128:e.Nat})),replace_snapshot:e.Opt(N),certified_data:e.Vec(e.Nat8),global_timer:e.Opt(e.Variant({active:e.Nat64,inactive:e.Null})),on_low_wasm_memory_hook_status:e.Opt(e.Variant({condition_not_satisfied:e.Null,executed:e.Null,ready:e.Null})),wasm_module_size:e.Nat64,canister_id:p,stable_memory_size:e.Nat64,wasm_memory_size:e.Nat64}),Fi=e.Record({snapshot_id:N}),Ui=e.Record({chunk:e.Vec(e.Nat8),canister_id:e.Principal}),Pi=Pe,dn=e.Variant({bls12_381_g2:e.Null}),Di=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),input:e.Vec(e.Nat8),transport_public_key:e.Vec(e.Nat8)}),Mi=e.Record({encrypted_key:e.Vec(e.Nat8)}),Li=e.Record({context:e.Vec(e.Nat8),key_id:e.Record({name:e.Text,curve:dn}),canister_id:e.Opt(p)}),$i=e.Record({public_key:e.Vec(e.Nat8)});return e.Service({bitcoin_get_balance:e.Func([n],[i],[]),bitcoin_get_block_headers:e.Func([o],[l],[]),bitcoin_get_current_fee_percentiles:e.Func([f],[u],[]),bitcoin_get_utxos:e.Func([h],[m],[]),bitcoin_send_transaction:e.Func([b],[],[]),canister_info:e.Func([E],[x],[]),canister_metadata:e.Func([R],[B],[]),canister_status:e.Func([A],[F],["query"]),clear_chunk_store:e.Func([L],[],[]),create_canister:e.Func([V],[k],[]),delete_canister:e.Func([U],[],[]),delete_canister_snapshot:e.Func([P],[],[]),deposit_cycles:e.Func([se],[],[]),ecdsa_public_key:e.Func([Z],[z],[]),fetch_canister_logs:e.Func([ie],[J],["query"]),http_request:e.Func([mt],[We],[]),install_chunked_code:e.Func([tr],[],[]),install_code:e.Func([nr],[],[]),list_canister_snapshots:e.Func([sr],[ir],[]),load_canister_snapshot:e.Func([ar],[],[]),node_metrics_history:e.Func([or],[ur],[]),provisional_create_canister_with_cycles:e.Func([lr],[dr],[]),provisional_top_up_canister:e.Func([fr],[],[]),raw_rand:e.Func([],[hr],[]),read_canister_snapshot_data:e.Func([fi],[hi],[]),read_canister_snapshot_metadata:e.Func([pi],[mi],[]),schnorr_public_key:e.Func([yi],[_i],[]),sign_with_ecdsa:e.Func([gi],[bi],[]),sign_with_schnorr:e.Func([xi],[Ei],[]),start_canister:e.Func([vi],[],[]),stop_canister:e.Func([Ni],[],[]),stored_chunks:e.Func([Ti],[Ii],[]),subnet_info:e.Func([Oi],[Ri],[]),take_canister_snapshot:e.Func([Si],[Ai],[]),uninstall_code:e.Func([Ci],[],[]),update_settings:e.Func([Bi],[],[]),upload_canister_snapshot_data:e.Func([Vi],[],[]),upload_canister_snapshot_metadata:e.Func([ki],[Fi],[]),upload_chunk:e.Func([Ui],[Pi],[]),vetkd_derive_key:e.Func([Di],[Mi],[]),vetkd_public_key:e.Func([Li],[$i],[])})},Ap=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({owner:e.Principal,subaccount:e.Opt(t)}),n=e.Record({icrc2:e.Bool}),s=e.Record({icrc1_minting_account:e.Opt(r),feature_flags:e.Opt(n)}),i=e.Record({e8s:e.Nat64}),a=e.Text,o=e.Record({secs:e.Nat64,nanos:e.Nat32}),c=e.Record({num_blocks_to_archive:e.Nat64,max_transactions_per_response:e.Opt(e.Nat64),trigger_threshold:e.Nat64,more_controller_ids:e.Opt(e.Vec(e.Principal)),max_message_size_bytes:e.Opt(e.Nat64),cycles_for_archive_creation:e.Opt(e.Nat64),node_max_memory_size_bytes:e.Opt(e.Nat64),controller_id:e.Principal}),l=e.Record({send_whitelist:e.Vec(e.Principal),token_symbol:e.Opt(e.Text),transfer_fee:e.Opt(i),minting_account:a,transaction_window:e.Opt(o),max_message_size_bytes:e.Opt(e.Nat64),icrc1_minting_account:e.Opt(r),archive_options:e.Opt(c),initial_values:e.Vec(e.Tuple(a,i)),token_name:e.Opt(e.Text),feature_flags:e.Opt(n)});e.Variant({Upgrade:e.Opt(s),Init:l});let f=e.Vec(e.Nat8),d=e.Record({account:f}),u=e.Record({account:a}),h=e.Record({canister_id:e.Principal}),y=e.Record({archives:e.Vec(h)}),_=e.Record({prev_spender_id:e.Opt(a),from_account_id:a,take:e.Opt(e.Nat64)}),g=e.Vec(e.Record({from_account_id:a,to_spender_id:a,allowance:i,expires_at:e.Opt(e.Nat64)})),m=e.Nat,b=e.Variant({Int:e.Int,Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text}),p=e.Nat64,E=e.Record({to:r,fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m}),v=e.Nat,N=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),I=e.Variant({Ok:v,Err:N}),O=e.Record({utc_offset_minutes:e.Opt(e.Int16),language:e.Text}),x=e.Record({metadata:O,device_spec:e.Opt(e.Variant({GenericDisplay:e.Null,FieldsDisplay:e.Null}))}),R=e.Record({arg:e.Vec(e.Nat8),method:e.Text,user_preferences:x}),B=e.Variant({Text:e.Record({content:e.Text}),TokenAmount:e.Record({decimals:e.Nat8,amount:e.Nat64,symbol:e.Text}),TimestampSeconds:e.Record({amount:e.Nat64}),DurationSeconds:e.Record({amount:e.Nat64})}),A=e.Record({fields:e.Vec(e.Tuple(e.Text,B)),intent:e.Text}),w=e.Variant({FieldsDisplayMessage:A,GenericDisplayMessage:e.Text}),T=e.Record({metadata:O,consent_message:w}),C=e.Record({description:e.Text}),F=e.Variant({GenericError:e.Record({description:e.Text,error_code:e.Nat}),InsufficientPayment:C,UnsupportedCanisterCall:C,ConsentMessageUnavailable:C}),L=e.Variant({Ok:T,Err:F}),S=e.Record({account:r,spender:r}),V=e.Record({allowance:m,expires_at:e.Opt(p)}),k=e.Record({fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m,expected_allowance:e.Opt(m),expires_at:e.Opt(p),spender:r}),U=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),AllowanceChanged:e.Record({current_allowance:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,Expired:e.Record({ledger_time:e.Nat64}),InsufficientFunds:e.Record({balance:m})}),P=e.Variant({Ok:v,Err:U}),se=e.Record({to:r,fee:e.Opt(m),spender_subaccount:e.Opt(t),from:r,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(p),amount:m}),te=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,InsufficientAllowance:e.Record({allowance:m}),BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:p}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),Z=e.Variant({Ok:v,Err:te}),z=e.Nat64,ie=e.Record({start:z,length:e.Nat64}),_e=e.Nat64,J=e.Record({timestamp_nanos:e.Nat64}),he=e.Variant({Approve:e.Record({fee:i,from:f,allowance_e8s:e.Int,allowance:i,expected_allowance:e.Opt(i),expires_at:e.Opt(J),spender:f}),Burn:e.Record({from:f,amount:i,spender:e.Opt(f)}),Mint:e.Record({to:f,amount:i}),Transfer:e.Record({to:f,fee:i,from:f,amount:i,spender:e.Opt(e.Vec(e.Nat8))})}),We=e.Record({memo:_e,icrc1_memo:e.Opt(e.Vec(e.Nat8)),operation:e.Opt(he),created_at_time:J}),mt=e.Record({transaction:We,timestamp:J,parent_hash:e.Opt(e.Vec(e.Nat8))}),yt=e.Record({blocks:e.Vec(mt)}),Pe=e.Variant({BadFirstBlockIndex:e.Record({requested_index:z,first_valid_index:z}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),tr=e.Variant({Ok:yt,Err:Pe}),rr=e.Func([ie],[tr],[]),nr=e.Record({callback:rr,start:z,length:e.Nat64}),sr=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(mt),chain_length:e.Nat64,first_block_index:z,archived_blocks:e.Vec(nr)}),_t=e.Record({callback:e.Func([ie],[e.Variant({Ok:e.Vec(e.Vec(e.Nat8)),Err:Pe})],[]),start:e.Nat64,length:e.Nat64}),ir=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(e.Vec(e.Nat8)),chain_length:e.Nat64,first_block_index:e.Nat64,archived_blocks:e.Vec(_t)}),ar=e.Record({fee:e.Opt(m),from_subaccount:e.Opt(t),spender:f}),or=e.Record({to:a,fee:i,memo:_e,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),cr=e.Record({certification:e.Opt(e.Vec(e.Nat8)),tip_index:z}),ur=e.Record({to:f,fee:i,memo:_e,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),lr=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:i}),TxDuplicate:e.Record({duplicate_of:z}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:i})}),dr=e.Variant({Ok:z,Err:lr}),fr=e.Record({}),hr=e.Record({transfer_fee:i});return e.Service({account_balance:e.Func([d],[i],[]),account_balance_dfx:e.Func([u],[i],[]),account_identifier:e.Func([r],[f],[]),archives:e.Func([],[y],[]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],[]),get_allowances:e.Func([_],[g],[]),icrc10_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],[]),icrc1_balance_of:e.Func([r],[m],[]),icrc1_decimals:e.Func([],[e.Nat8],[]),icrc1_fee:e.Func([],[m],[]),icrc1_metadata:e.Func([],[e.Vec(e.Tuple(e.Text,b))],[]),icrc1_minting_account:e.Func([],[e.Opt(r)],[]),icrc1_name:e.Func([],[e.Text],[]),icrc1_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],[]),icrc1_symbol:e.Func([],[e.Text],[]),icrc1_total_supply:e.Func([],[m],[]),icrc1_transfer:e.Func([E],[I],[]),icrc21_canister_call_consent_message:e.Func([R],[L],[]),icrc2_allowance:e.Func([S],[V],[]),icrc2_approve:e.Func([k],[P],[]),icrc2_transfer_from:e.Func([se],[Z],[]),is_ledger_ready:e.Func([],[e.Bool],["query"]),name:e.Func([],[e.Record({name:e.Text})],[]),query_blocks:e.Func([ie],[sr],[]),query_encoded_blocks:e.Func([ie],[ir],[]),remove_approval:e.Func([ar],[P],[]),send_dfx:e.Func([or],[z],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],[]),tip_of_chain:e.Func([],[cr],[]),transfer:e.Func([ur],[dr],[]),transfer_fee:e.Func([fr],[hr],[])})},Cp=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({owner:e.Principal,subaccount:e.Opt(t)}),n=e.Record({icrc2:e.Bool}),s=e.Record({icrc1_minting_account:e.Opt(r),feature_flags:e.Opt(n)}),i=e.Record({e8s:e.Nat64}),a=e.Text,o=e.Record({secs:e.Nat64,nanos:e.Nat32}),c=e.Record({num_blocks_to_archive:e.Nat64,max_transactions_per_response:e.Opt(e.Nat64),trigger_threshold:e.Nat64,more_controller_ids:e.Opt(e.Vec(e.Principal)),max_message_size_bytes:e.Opt(e.Nat64),cycles_for_archive_creation:e.Opt(e.Nat64),node_max_memory_size_bytes:e.Opt(e.Nat64),controller_id:e.Principal}),l=e.Record({send_whitelist:e.Vec(e.Principal),token_symbol:e.Opt(e.Text),transfer_fee:e.Opt(i),minting_account:a,transaction_window:e.Opt(o),max_message_size_bytes:e.Opt(e.Nat64),icrc1_minting_account:e.Opt(r),archive_options:e.Opt(c),initial_values:e.Vec(e.Tuple(a,i)),token_name:e.Opt(e.Text),feature_flags:e.Opt(n)});e.Variant({Upgrade:e.Opt(s),Init:l});let f=e.Vec(e.Nat8),d=e.Record({account:f}),u=e.Record({account:a}),h=e.Record({canister_id:e.Principal}),y=e.Record({archives:e.Vec(h)}),_=e.Record({prev_spender_id:e.Opt(a),from_account_id:a,take:e.Opt(e.Nat64)}),g=e.Vec(e.Record({from_account_id:a,to_spender_id:a,allowance:i,expires_at:e.Opt(e.Nat64)})),m=e.Nat,b=e.Variant({Int:e.Int,Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text}),p=e.Nat64,E=e.Record({to:r,fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m}),v=e.Nat,N=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),I=e.Variant({Ok:v,Err:N}),O=e.Record({utc_offset_minutes:e.Opt(e.Int16),language:e.Text}),x=e.Record({metadata:O,device_spec:e.Opt(e.Variant({GenericDisplay:e.Null,FieldsDisplay:e.Null}))}),R=e.Record({arg:e.Vec(e.Nat8),method:e.Text,user_preferences:x}),B=e.Variant({Text:e.Record({content:e.Text}),TokenAmount:e.Record({decimals:e.Nat8,amount:e.Nat64,symbol:e.Text}),TimestampSeconds:e.Record({amount:e.Nat64}),DurationSeconds:e.Record({amount:e.Nat64})}),A=e.Record({fields:e.Vec(e.Tuple(e.Text,B)),intent:e.Text}),w=e.Variant({FieldsDisplayMessage:A,GenericDisplayMessage:e.Text}),T=e.Record({metadata:O,consent_message:w}),C=e.Record({description:e.Text}),F=e.Variant({GenericError:e.Record({description:e.Text,error_code:e.Nat}),InsufficientPayment:C,UnsupportedCanisterCall:C,ConsentMessageUnavailable:C}),L=e.Variant({Ok:T,Err:F}),S=e.Record({account:r,spender:r}),V=e.Record({allowance:m,expires_at:e.Opt(p)}),k=e.Record({fee:e.Opt(m),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(t),created_at_time:e.Opt(p),amount:m,expected_allowance:e.Opt(m),expires_at:e.Opt(p),spender:r}),U=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),AllowanceChanged:e.Record({current_allowance:m}),CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,Expired:e.Record({ledger_time:e.Nat64}),InsufficientFunds:e.Record({balance:m})}),P=e.Variant({Ok:v,Err:U}),se=e.Record({to:r,fee:e.Opt(m),spender_subaccount:e.Opt(t),from:r,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(p),amount:m}),te=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TemporarilyUnavailable:e.Null,InsufficientAllowance:e.Record({allowance:m}),BadBurn:e.Record({min_burn_amount:m}),Duplicate:e.Record({duplicate_of:v}),BadFee:e.Record({expected_fee:m}),CreatedInFuture:e.Record({ledger_time:p}),TooOld:e.Null,InsufficientFunds:e.Record({balance:m})}),Z=e.Variant({Ok:v,Err:te}),z=e.Nat64,ie=e.Record({start:z,length:e.Nat64}),_e=e.Nat64,J=e.Record({timestamp_nanos:e.Nat64}),he=e.Variant({Approve:e.Record({fee:i,from:f,allowance_e8s:e.Int,allowance:i,expected_allowance:e.Opt(i),expires_at:e.Opt(J),spender:f}),Burn:e.Record({from:f,amount:i,spender:e.Opt(f)}),Mint:e.Record({to:f,amount:i}),Transfer:e.Record({to:f,fee:i,from:f,amount:i,spender:e.Opt(e.Vec(e.Nat8))})}),We=e.Record({memo:_e,icrc1_memo:e.Opt(e.Vec(e.Nat8)),operation:e.Opt(he),created_at_time:J}),mt=e.Record({transaction:We,timestamp:J,parent_hash:e.Opt(e.Vec(e.Nat8))}),yt=e.Record({blocks:e.Vec(mt)}),Pe=e.Variant({BadFirstBlockIndex:e.Record({requested_index:z,first_valid_index:z}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),tr=e.Variant({Ok:yt,Err:Pe}),rr=e.Func([ie],[tr],["query"]),nr=e.Record({callback:rr,start:z,length:e.Nat64}),sr=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(mt),chain_length:e.Nat64,first_block_index:z,archived_blocks:e.Vec(nr)}),_t=e.Record({callback:e.Func([ie],[e.Variant({Ok:e.Vec(e.Vec(e.Nat8)),Err:Pe})],["query"]),start:e.Nat64,length:e.Nat64}),ir=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(e.Vec(e.Nat8)),chain_length:e.Nat64,first_block_index:e.Nat64,archived_blocks:e.Vec(_t)}),ar=e.Record({fee:e.Opt(m),from_subaccount:e.Opt(t),spender:f}),or=e.Record({to:a,fee:i,memo:_e,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),cr=e.Record({certification:e.Opt(e.Vec(e.Nat8)),tip_index:z}),ur=e.Record({to:f,fee:i,memo:_e,from_subaccount:e.Opt(t),created_at_time:e.Opt(J),amount:i}),lr=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:i}),TxDuplicate:e.Record({duplicate_of:z}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:i})}),dr=e.Variant({Ok:z,Err:lr}),fr=e.Record({}),hr=e.Record({transfer_fee:i});return e.Service({account_balance:e.Func([d],[i],["query"]),account_balance_dfx:e.Func([u],[i],["query"]),account_identifier:e.Func([r],[f],["query"]),archives:e.Func([],[y],["query"]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],["query"]),get_allowances:e.Func([_],[g],["query"]),icrc10_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],["query"]),icrc1_balance_of:e.Func([r],[m],["query"]),icrc1_decimals:e.Func([],[e.Nat8],["query"]),icrc1_fee:e.Func([],[m],["query"]),icrc1_metadata:e.Func([],[e.Vec(e.Tuple(e.Text,b))],["query"]),icrc1_minting_account:e.Func([],[e.Opt(r)],["query"]),icrc1_name:e.Func([],[e.Text],["query"]),icrc1_supported_standards:e.Func([],[e.Vec(e.Record({url:e.Text,name:e.Text}))],["query"]),icrc1_symbol:e.Func([],[e.Text],["query"]),icrc1_total_supply:e.Func([],[m],["query"]),icrc1_transfer:e.Func([E],[I],[]),icrc21_canister_call_consent_message:e.Func([R],[L],[]),icrc2_allowance:e.Func([S],[V],["query"]),icrc2_approve:e.Func([k],[P],[]),icrc2_transfer_from:e.Func([se],[Z],[]),is_ledger_ready:e.Func([],[e.Bool],["query"]),name:e.Func([],[e.Record({name:e.Text})],["query"]),query_blocks:e.Func([ie],[sr],["query"]),query_encoded_blocks:e.Func([ie],[ir],["query"]),remove_approval:e.Func([ar],[P],[]),send_dfx:e.Func([or],[z],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],["query"]),tip_of_chain:e.Func([],[cr],["query"]),transfer:e.Func([ur],[dr],[]),transfer_fee:e.Func([fr],[hr],["query"])})},Bp=(e=>(e[e.FractionalMoreThan8Decimals=0]="FractionalMoreThan8Decimals",e[e.InvalidFormat=1]="InvalidFormat",e[e.FractionalTooManyDecimals=2]="FractionalTooManyDecimals",e))(Bp||{});BigInt(1e8);var Ml=class{constructor(t,r,n){this.id=t,this.service=r,this.certifiedService=n}get canisterId(){return this.id}caller=({certified:t=!0})=>t?this.certifiedService:this.service},ss=e=>e==null,Nt=e=>!ss(e),Vp=()=>ut.createSync({host:"https://icp-api.io",identity:new Kr}),To=({options:{canisterId:e,serviceOverride:t,certifiedServiceOverride:r,agent:n,callTransform:s,queryTransform:i},idlFactory:a,certifiedIdlFactory:o})=>{let c=n??Vp(),l=t??Fn.createActor(a,{agent:c,canisterId:e,callTransform:s,queryTransform:i}),f=r??Fn.createActor(o,{agent:c,canisterId:e,callTransform:s,queryTransform:i});return{service:l,certifiedService:f,agent:c,canisterId:e}},kp=class extends Error{},Fp=(e,t)=>{if(e==null)throw new kp(t)},Dn=(e,t)=>{throw new Error(t)},Ll=e=>new Uint8Array(e),Up=e=>Array.from(e).map(t=>t.charCodeAt(0)),Io=e=>{let t=e.match(/.{1,2}/g);return Fp(t,"Invalid hex string."),Uint8Array.from(t.map(r=>parseInt(r,16)))},Es=e=>(e instanceof Uint8Array||(e=Uint8Array.from(e)),e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),"")),Lc="abcdefghijklmnopqrstuvwxyz234567",Mn=Object.create(null);for(let e=0;e<Lc.length;e++)Mn[Lc[e]]=e;Mn[0]=Mn.o;Mn[1]=Mn.i;var Pp=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),Dp=e=>{let t=-1;for(let r=0;r<e.length;r++){let n=(e[r]^t)&255;t=Pp[n]^t>>>8}return(t^-1)>>>0},$c=e=>{let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,Dp(e),!1),new Uint8Array(t)},Mp="__bigint__",Lp="__principal__",$p="__uint8array__",qp=(e,t)=>typeof t=="bigint"?{[Mp]:`${t}`}:Nt(t)&&D.isPrincipal(t)?{[Lp]:D.from(t).toText()}:Nt(t)&&t instanceof Uint8Array?{[$p]:Array.from(t)}:t,q=e=>Nt(e)?[e]:[],Fa=e=>e?.[0],jp=(e=>(e[e.Controllers=0]="Controllers",e[e.Public=1]="Public",e))(jp||{}),Kp=class extends Error{},fa=({controllers:e,freezingThreshold:t,memoryAllocation:r,computeAllocation:n,reservedCyclesLimit:s,logVisibility:i,wasmMemoryLimit:a,wasmMemoryThreshold:o,environmentVariables:c}={})=>{let l=()=>{switch(i){case 0:return{controllers:null};case 1:return{public:null};default:throw new Kp}};return{controllers:q(e?.map(f=>D.fromText(f))),freezing_threshold:q(t),memory_allocation:q(r),compute_allocation:q(n),reserved_cycles_limit:q(s),log_visibility:ss(i)?[]:[l()],wasm_memory_limit:q(a),wasm_memory_threshold:q(o),environment_variables:q(c)}},Gp=e=>Io(e),$l=e=>typeof e=="string"?Gp(e):e,mn=({canisterId:e,snapshotId:t})=>({canister_id:e,snapshot_id:$l(t)}),qc=({canisterId:e,snapshotId:t})=>({canister_id:e,replace_snapshot:q(Nt(t)?$l(t):void 0)}),Hp=e=>{if("wasmModule"in e)return{wasm_module:e.wasmModule};if("wasmMemory"in e)return{wasm_memory:e.wasmMemory};if("stableMemory"in e)return{stable_memory:e.stableMemory};if("wasmChunk"in e)return{wasm_chunk:e.wasmChunk};Dn(e,"Unsupported snapshot metadata kind")},zp=({globals:e,certifiedData:t,globalTimer:r,onLowWasmMemoryHookStatus:n,wasmModuleSize:s,stableMemorySize:i,wasmMemorySize:a})=>{let o=()=>ss(n)?q():"conditionNotSatisfied"in n?q({condition_not_satisfied:n.conditionNotSatisfied}):q(n);return{globals:e,certified_data:t,global_timer:q(r),on_low_wasm_memory_hook_status:o(),wasm_module_size:s,stable_memory_size:i,wasm_memory_size:a}},Zp=e=>{if("wasmModule"in e)return{wasm_module:e.wasmModule};if("wasmMemory"in e)return{wasm_memory:e.wasmMemory};if("stableMemory"in e)return{stable_memory:e.stableMemory};if("wasmChunk"in e)return{wasm_chunk:null};Dn(e,"Unsupported snapshot data kind")},Yp=({globals:e,canister_version:t,source:r,certified_data:n,global_timer:s,on_low_wasm_memory_hook_status:i,wasm_module_size:a,stable_memory_size:o,wasm_chunk_store:c,taken_at_timestamp:l,wasm_memory_size:f})=>{let d=()=>{if("metadata_upload"in r)return{metadataUpload:r.metadata_upload};if("taken_from_canister"in r)return{takenFromCanister:r.taken_from_canister};Dn(r,"Unsupported snapshot metadata source")},u=()=>{let h=Fa(i);if(!ss(h)){if("condition_not_satisfied"in h)return{conditionNotSatisfied:h.condition_not_satisfied};if("executed"in h)return{executed:h.executed};if("ready"in h)return{ready:h.ready};Dn(h,"Unsupported snapshot metadata on_low_wasm_memory_hook_status")}};return{globals:e,canisterVersion:t,source:d(),certifiedData:n,globalTimer:Fa(s),onLowWasmMemoryHookStatus:u(),wasmModuleSize:a,stableMemorySize:o,wasmChunkStore:c,takenAtTimestamp:l,wasmMemorySize:f}},jc=(e,t,r)=>{let[n]=t;if(Nt(n)&&typeof n=="object"){if(e==="install_chunked_code"&&Nt(n.target_canister))return{effectiveCanisterId:D.from(n.target_canister)};if(e==="provisional_create_canister_with_cycles"&&Nt(n.specified_id)){let s=Fa(n.specified_id);if(Nt(s))return{effectiveCanisterId:D.from(s)}}if(Nt(n.canister_id))return{effectiveCanisterId:D.from(n.canister_id)}}return{effectiveCanisterId:D.fromHex("")}},ql=class jl{constructor(t,r){this.service=t,this.certifiedService=r}caller=({certified:t=!0})=>t?this.certifiedService:this.service;static create(t){let{service:r,certifiedService:n}=To({options:{...t,canisterId:D.fromHex(""),callTransform:jc,queryTransform:jc},idlFactory:Sp,certifiedIdlFactory:Rp});return new jl(r,n)}createCanister=async({settings:t,senderCanisterVersion:r}={})=>{let{create_canister:n}=this.certifiedService,{canister_id:s}=await n({settings:q(fa(t)),sender_canister_version:q(r)});return s};updateSettings=({canisterId:t,senderCanisterVersion:r,settings:n})=>{let{update_settings:s}=this.certifiedService;return s({canister_id:t,sender_canister_version:q(r),settings:fa(n)})};installCode=({canisterId:t,wasmModule:r,senderCanisterVersion:n,...s})=>{let{install_code:i}=this.certifiedService;return i({...s,canister_id:t,wasm_module:r,sender_canister_version:q(n)})};uploadChunk=({canisterId:t,...r})=>{let{upload_chunk:n}=this.certifiedService;return n({canister_id:t,...r})};clearChunkStore=async({canisterId:t})=>{let{clear_chunk_store:r}=this.certifiedService;await r({canister_id:t})};storedChunks=({canisterId:t})=>{let{stored_chunks:r}=this.certifiedService;return r({canister_id:t})};installChunkedCode=async({senderCanisterVersion:t,chunkHashesList:r,targetCanisterId:n,storeCanisterId:s,wasmModuleHash:i,...a})=>{let{install_chunked_code:o}=this.certifiedService;await o({...a,target_canister:n,store_canister:q(s),sender_canister_version:q(t),chunk_hashes_list:r,wasm_module_hash:typeof i=="string"?Io(i):i})};uninstallCode=({canisterId:t,senderCanisterVersion:r})=>{let{uninstall_code:n}=this.certifiedService;return n({canister_id:t,sender_canister_version:q(r)})};startCanister=t=>{let{start_canister:r}=this.certifiedService;return r({canister_id:t})};stopCanister=t=>{let{stop_canister:r}=this.certifiedService;return r({canister_id:t})};canisterStatus=({canisterId:t,certified:r})=>{let{canister_status:n}=this.caller({certified:r});return n({canister_id:t})};deleteCanister=t=>{let{delete_canister:r}=this.certifiedService;return r({canister_id:t})};provisionalCreateCanisterWithCycles=async({settings:t,amount:r,canisterId:n}={})=>{let{provisional_create_canister_with_cycles:s}=this.certifiedService,{canister_id:i}=await s({settings:q(fa(t)),amount:q(r),specified_id:q(n),sender_canister_version:[]});return i};fetchCanisterLogs=t=>{let{fetch_canister_logs:r}=this.caller({certified:!1});return r({canister_id:t})};takeCanisterSnapshot=({senderCanisterVersion:t,uninstallCode:r,...n})=>{let{take_canister_snapshot:s}=this.certifiedService;return s({...qc(n),sender_canister_version:q(t),uninstall_code:q(r)})};listCanisterSnapshots=({canisterId:t})=>{let{list_canister_snapshots:r}=this.certifiedService;return r({canister_id:t})};loadCanisterSnapshot=async({senderCanisterVersion:t,...r})=>{let{load_canister_snapshot:n}=this.certifiedService;await n({...mn(r),sender_canister_version:q(t)})};deleteCanisterSnapshot=async t=>{let{delete_canister_snapshot:r}=this.certifiedService;await r(mn(t))};readCanisterSnapshotMetadata=async t=>{let{read_canister_snapshot_metadata:r}=this.certifiedService,n=await r(mn(t));return Yp(n)};readCanisterSnapshotData=({kind:t,...r})=>{let{read_canister_snapshot_data:n}=this.certifiedService;return n({...mn(r),kind:Hp(t)})};uploadCanisterSnapshotMetadata=({metadata:t,...r})=>{let{upload_canister_snapshot_metadata:n}=this.certifiedService;return n({...zp(t),...qc(r)})};uploadCanisterSnapshotData=async({kind:t,chunk:r,...n})=>{let{upload_canister_snapshot_data:s}=this.certifiedService;await s({...mn(n),chunk:r,kind:Zp(t)})}};const Wp=1000000000000n,Xp=({IDL:e})=>{const t=e.Record({url:e.Text,method:e.Text,body:e.Vec(e.Nat8),headers:e.Vec(e.Tuple(e.Text,e.Text))}),r=e.Record({body:e.Vec(e.Nat8),headers:e.Vec(e.Tuple(e.Text,e.Text)),status_code:e.Nat16}),n=e.Variant({Add:e.Text,Remove:e.Text}),s=e.Variant({Ok:e.Null,Err:e.Text}),i=e.Variant({Get:e.Null,Set:e.Principal}),a=e.Variant({Ok:e.Principal,Err:e.Text}),o=e.Variant({Hourly:e.Null,Weekly:e.Null,Daily:e.Null,Monthly:e.Null}),c=e.Variant({_1T:e.Null,_2T:e.Null,_5T:e.Null,_10T:e.Null,_50T:e.Null,_0_5T:e.Null,_100T:e.Null,_0_25T:e.Null}),l=e.Record({interval:o,cycles_amount:c,cycles_threshold:c}),f=e.Variant({Add:l,Get:e.Null,Clear:e.Null}),d=e.Variant({Ok:e.Opt(l),Err:e.Text}),u=e.Record({memo:e.Opt(e.Text),name:e.Text,version:e.Nat16});return e.Service({http_request:e.Func([t],[r],["query"]),manage_alternative_origins:e.Func([n],[s],[]),manage_ii_principal:e.Func([i],[a],[]),manage_top_up_rule:e.Func([f],[d],[]),wasm_status:e.Func([],[u],["query"])})};function Kl(e){if(e.canisterId==="")throw new Error("canisterId is required");return Fn.createActor(Xp,{agent:e.agent,canisterId:e.canisterId})}let Jp=class Gl{actor;constructor(t){this.actor=t}static create(t){const r=Kl(t);return new Gl(r)}async httpRequest(t){return await this.actor.http_request(t)}async manageAlternativeOrigins(t){return await this.actor.manage_alternative_origins(t)}async manageIIPrincipal(t){return await this.actor.manage_ii_principal(t)}async wasmStatus(){return await this.actor.wasm_status()}async manageTopUpRule(t){return await this.actor.manage_top_up_rule(t)}},Qp=class Hl{constructor(t,r){this.agent=t,this.canisterId=r,this.icManagement=ql.create({agent:this.agent})}icManagement;static create(t,r){return new Hl(t,r)}async checkCyclesBalance(t){try{const r=t?.threshold??Wp,n=(await this.icManagement.canisterStatus({canisterId:this.canisterId})).cycles;return n<r?{error:`Low cycles warning: ${n.toString()} cycles remaining (threshold: ${r.toString()})`}:{ok:n}}catch(r){return{error:String(r)}}}async isAuthenticated(){try{return"Ok"in await Jp.create({agent:this.agent,canisterId:this.canisterId}).manageIIPrincipal({Get:null})}catch{return!1}}};function em(){const e=window.location.hostname,t=window.location.protocol,r=/^([a-z0-9-]+)\.localhost$/.exec(e);if(r?.[1]!=null){if(t!=="http:")throw new Error(`Invalid protocol for localhost: ${t}. Only http: is allowed for localhost.`);return D.fromText(r[1])}const n=/^([a-z0-9-]+)\.icp0\.io$/.exec(e);if(n?.[1]!=null){if(t!=="https:")throw new Error(`Invalid protocol for production: ${t}. Only https: is allowed for icp0.io.`);return D.fromText(n[1])}throw new Error(`Could not infer canister ID from hostname: ${e}`)}const tm=BigInt(15)*BigInt(60)*BigInt(1e9),zl="rkp4c-7iaaa-aaaaa-aaaca-cai",ha=BigInt(1e4),rm=1e8,nm=new Uint8Array([84,80,85,80,0,0,0,0]),sm={host:"http://localhost:8080",identityProvider:"http://uxrrr-q7777-77774-qaaaq-cai.localhost:8080"},im={host:"https://icp-api.io",identityProvider:"https://identity.internetcomputer.org"};var Kc={host:"http://localhost:8080",identityProvider:"http://uxrrr-q7777-77774-qaaaq-cai.localhost:8080"},Gc={host:"https://icp-api.io",identityProvider:"https://identity.internetcomputer.org"};let pa=null,hs=null;function Zl(){if(typeof window>"u"||!window.location)return!1;const e=window.location.origin.toLowerCase();return e.startsWith("http://")||e.includes("localhost")||e.includes("127.0.0.1")}function am(){if(pa!==null)return pa;const t=Zl()?typeof Kc<"u"?Kc:sm:typeof Gc<"u"?Gc:im;return pa=t,t}function om(){return hs!==null||(hs=Zl()),hs}function cm(){try{return em()}catch{return D.fromText("22ajg-aqaaa-aaaap-adukq-cai")}}function Se(e){const t=document.getElementById(e);return t||(console.error(`Element with id '${e}' not found`),document.createElement("div"))}function Ht(e,t){const r=Se(e);r.textContent=t}function nt(e,t){const r=Se(e);t?r.classList.remove("hidden"):r.classList.add("hidden")}const ps=new WeakMap;function Bt(e,t,r){const n=Se(e),i=ps.get(n)?.get(t);i&&n.removeEventListener(t,i);const a=async()=>{try{await r()}catch(c){console.error(`Unhandled error in '${t}' handler for #${e}:`,c),we(mm)}};n.addEventListener(t,a);const o=ps.get(n)??new Map;o.set(t,a),ps.has(n)||ps.set(n,o)}function um(e,t){const r=Se("logout-btn");r.onclick=async()=>{try{await t()}catch{we(Wl)}},nt("auth-logged-out",!1),nt("auth-logged-in",!0),Ht("ii-principal",e),nt("authenticated-content",!0)}function lm(e){const t=Se("auth-btn");t.onclick=async()=>await e(),nt("auth-logged-out",!0),nt("auth-logged-in",!1),Ht("ii-principal",""),nt("authenticated-content",!1),nt("loading-overlay",!1)}function Hc(e,t,r,n){Ht("status-value",e),Ht("memory-size-value",t),Ht("cycles-value",r),Ht("module-hash-value",n)}function dm(e){Ht("balance-value",e)}function fm(e){Ht("icrc1-account",e)}function qe(){nt("loading-overlay",!0)}function je(){nt("loading-overlay",!1)}function we(e){const t=Se("error-section"),r=document.createElement("div");r.className="error-message",r.textContent=e,t.appendChild(r),nt("error-section",!0)}function zc(){const e=Se("error-section");e.innerHTML="",nt("error-section",!1)}function js(e){return Se(e).value.trim()}function Je(e){const t=Se(e);t.value=""}function hm(e,t){const r=Se("canister-id");r.textContent=e;const n=Se("canister-icp-balance");n.textContent=t}function pm(e){const t=Se("top-up-rule-display");if(t.textContent="",!e){t.textContent="No rule set";return}const r=document.createElement("pre");r.textContent=e,t.appendChild(r)}function ma(e){return Se(e).value}function Yl(e){const t=document.createElement("li");t.className="copyable";const r=document.createElement("div");r.className="data-display",r.textContent=e;const n=document.createElement("button");return n.type="button",n.className="copy-btn",n.setAttribute("aria-label","Copy to clipboard"),n.dataset.copyText=e,n.innerHTML=`
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
      <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"/>
    </svg>
  `,t.appendChild(r),t.appendChild(n),t}const ce="Network error occurred. Please try again.",mm="Something went wrong. Please try again.",ym="Failed to initialize dashboard.",Zc="Invalid principal format.",_m="URL must start with 'http://localhost:', 'http://*.localhost:', or 'https://'",gm="Please select threshold and amount.",Yc="Unable to determine canister ID.",bm="Failed to create HTTP agent.",wm="You are not authorized to access this application.",Wl="Logout failed. Please try again.",ms="Auth manager not initialized",xm="User is not authenticated",Em="Failed to add alternative origin",vm="Unknown error adding alternative origin",Nm="Failed to remove alternative origin",Tm="Unknown error removing alternative origin",Im="Insufficient balance for this operation.",Wc="TopUpRule Error:",Xc="TopUpError:",Om="Controller already exists.",Rm="Controller not found.",Jc="Cannot remove required controllers.";function H(e,t){t?console.error(e,t):console.error(e);try{we(e)}catch{}}function Xl(){return am()}function pt(){try{return cm()}catch(e){throw H(Yc,e),new Error(Yc)}}async function nn(){try{const e=await Pn.create({idleOptions:{disableIdle:!0}}),t=Xl(),r=e.getIdentity(),n=await ut.create({identity:r,host:t.host});return om()&&await n.fetchRootKey(),n}catch(e){throw H(bm,e),e}}function Qc(e){try{return D.fromText(e),!0}catch{return!1}}function Sm(e){try{const t=new URL(e),r=t.protocol==="https:",n=t.protocol==="http:"&&(t.hostname==="localhost"||t.hostname.endsWith(".localhost"))&&/:\d+$/.test(t.host);return r||n}catch{return!1}}class ui{authClient=null;constructor(){}static async create(){const t=new ui;return t.authClient=await Pn.create({idleOptions:{disableIdle:!0}}),t}async ensureAuthClient(){return this.authClient||(this.authClient=await Pn.create({idleOptions:{disableIdle:!0}})),this.authClient}async isIIPrincipal(){try{if(!this.authClient||!await this.authClient.isAuthenticated())return!1;const t=await nn(),r=pt();return await Qp.create(t,r).isAuthenticated()}catch(t){return console.warn("Failed to check II principal authorization:",t),!1}}async login(){const t=await this.ensureAuthClient();if(await t.isAuthenticated()){if(await this.isIIPrincipal())return;await t.logout(),this.authClient=null}const n=Xl(),s=await this.ensureAuthClient();if(await new Promise((a,o)=>{s.login({identityProvider:n.identityProvider,maxTimeToLive:tm,onSuccess:()=>{a()},onError:c=>{o(c)}})}),!await this.isIIPrincipal()){we(wm),await(await this.ensureAuthClient()).logout(),this.authClient=null;return}}async logout(){await(await this.ensureAuthClient()).logout(),this.authClient=null}async isAuthenticated(){return await(await this.ensureAuthClient()).isAuthenticated()?await this.isIIPrincipal():!1}async getPrincipal(){const t=await this.ensureAuthClient();return await t.isAuthenticated()||H(xm),t.getIdentity().getPrincipal()}}class Ks{async managmentApi(){const t=await nn();return ql.create({agent:t})}async getCanisterStatus(){try{const t=await this.managmentApi(),r=pt();return await t.canisterStatus({canisterId:r})}catch(t){throw H(ce,t),t}}async updateControllers(t){try{const r=await this.managmentApi(),n=pt();await r.updateSettings({canisterId:n,settings:{controllers:t.map(s=>s.toString())}})}catch(r){throw H(ce,r),r}}async getCanisterLogs(){try{const t=await this.managmentApi(),r=pt();return await t.fetchCanisterLogs(r)}catch(t){throw H(ce,t),t}}}function Am(){let e=null,t=null;const r=async()=>new Ks().getCanisterStatus(),n=async()=>(t||(t=r().then(i=>(e=i,i)).finally(()=>{t=null})),t);return{getStatus:async()=>e||t||n(),refresh:n}}const xn=Am();function Cm(e){const t=e.toUint8Array(),r=new Uint8Array(32);return r[0]=t.length,r.set(t,1),r}function Bm(e){return e<0?"0.00 MB":`${(Number(e)/(1024*1024)).toFixed(2)} MB`}function Vm(e){return e<0?"0.00 T":`${(Number(e)/1e12).toFixed(2)} T`}function Jl(e){return e<0?"0.00000000":(Number(e)/rm).toFixed(8)}class Ln{constructor(){}static async create(){const t=new Ln;try{const r=await xn.getStatus(),{statusText:n,memorySizeFormatted:s,cyclesFormatted:i,moduleHashHex:a}=t.formatStatusData(r);Hc(n,s,i,a)}catch(r){H(ce,r)}return t}static async refresh(){try{const t=await xn.refresh(),r=new Ln,{statusText:n,memorySizeFormatted:s,cyclesFormatted:i,moduleHashHex:a}=r.formatStatusData(t);Hc(n,s,i,a)}catch(t){H(ce,t)}}formatStatusData(t){const r="running"in t.status?"Running":"stopped"in t.status?"Stopped":"stopping"in t.status?"Stopping":"Unknown",n=Bm(t.memory_size),s=Vm(t.cycles),i=t.module_hash.length>0?Es(t.module_hash[0]):"N/A";return{statusText:r,memorySizeFormatted:n,cyclesFormatted:s,moduleHashHex:i}}}function km(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Oo(e,...t){if(!km(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function eu(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Fm(e,t){Oo(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ua(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ya(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function at(e,t){return e<<32-t|e>>>t}function Um(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Ql(e){return typeof e=="string"&&(e=Um(e)),Oo(e),e}var Pm=class{};function ed(e){let t=n=>e().update(Ql(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Dm(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),i=BigInt(4294967295),a=Number(r>>s&i),o=Number(r&i),c=n?4:0,l=n?0:4;e.setUint32(t+c,a,n),e.setUint32(t+l,o,n)}function Mm(e,t,r){return e&t^~e&r}function Lm(e,t,r){return e&t^e&r^t&r}var $m=class extends Pm{constructor(t,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(t),this.view=ya(this.buffer)}update(t){eu(this),t=Ql(t),Oo(t);let{view:r,buffer:n,blockLen:s}=this,i=t.length;for(let a=0;a<i;){let o=Math.min(s-this.pos,i-a);if(o===s){let c=ya(t);for(;s<=i-a;a+=s)this.process(c,a);continue}n.set(t.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){eu(this),Fm(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:i}=this,{pos:a}=this;r[a++]=128,Ua(this.buffer.subarray(a)),this.padOffset>s-a&&(this.process(n,0),a=0);for(let d=a;d<s;d++)r[d]=0;Dm(n,s-8,BigInt(this.length*8),i),this.process(n,0);let o=ya(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)o.setUint32(4*d,f[d],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:i,destroyed:a,pos:o}=this;return t.destroyed=a,t.finished=i,t.length=s,t.pos=o,s%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Mt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lt=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),qm=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$t=new Uint32Array(64),td=class extends $m{constructor(t=32){super(64,t,8,!1),this.A=Mt[0]|0,this.B=Mt[1]|0,this.C=Mt[2]|0,this.D=Mt[3]|0,this.E=Mt[4]|0,this.F=Mt[5]|0,this.G=Mt[6]|0,this.H=Mt[7]|0}get(){let{A:t,B:r,C:n,D:s,E:i,F:a,G:o,H:c}=this;return[t,r,n,s,i,a,o,c]}set(t,r,n,s,i,a,o,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=c|0}process(t,r){for(let d=0;d<16;d++,r+=4)$t[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){let u=$t[d-15],h=$t[d-2],y=at(u,7)^at(u,18)^u>>>3,_=at(h,17)^at(h,19)^h>>>10;$t[d]=_+$t[d-7]+y+$t[d-16]|0}let{A:n,B:s,C:i,D:a,E:o,F:c,G:l,H:f}=this;for(let d=0;d<64;d++){let u=at(o,6)^at(o,11)^at(o,25),h=f+u+Mm(o,c,l)+qm[d]+$t[d]|0,y=(at(n,2)^at(n,13)^at(n,22))+Lm(n,s,i)|0;f=l,l=c,c=o,o=a+h|0,a=i,i=s,s=n,n=h+y|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(n,s,i,a,o,c,l,f)}roundClean(){Ua($t)}destroy(){this.set(0,0,0,0,0,0,0,0),Ua(this.buffer)}},jm=class extends td{constructor(){super(28),this.A=Lt[0]|0,this.B=Lt[1]|0,this.C=Lt[2]|0,this.D=Lt[3]|0,this.E=Lt[4]|0,this.F=Lt[5]|0,this.G=Lt[6]|0,this.H=Lt[7]|0}};ed(()=>new td);var Km=ed(()=>new jm);var Gs=class Pa{constructor(t){this.bytes=t}static fromHex(t){let r=Io(t);if(r.length!==32)throw new Error(`Invalid AccountIdentifier: expected 32 bytes, got ${r.length}.`);let n=Es(r.slice(0,4)),s=r.slice(4),i=Es($c(s));if(n!==i)throw Error(`Checksum mismatch. Expected ${i}, but got ${n}.`);return new Pa(r)}static fromPrincipal({principal:t,subAccount:r=Gm.fromID(0)}){let n=Up(`
account-id`),s=Km.create();s.update(Ll([...n,...t.toUint8Array(),...r.toUint8Array()]));let i=s.digest(),a=$c(i),o=new Uint8Array([...a,...i]);return new Pa(o)}toHex(){return Es(this.bytes)}toUint8Array(){return this.bytes}toNumbers(){return Array.from(this.bytes)}toAccountIdentifierHash(){return{hash:this.toUint8Array()}}},Gm=class vs{constructor(t){this.bytes=t}static fromBytes(t){if(t.length!==32)throw new Error("Subaccount length must be 32-bytes");return new vs(t)}static fromPrincipal(t){let r=new Uint8Array(32).fill(0),n=t.toUint8Array();r[0]=n.length;for(let s=0;s<n.length;s++)r[1+s]=n[s];return new vs(r)}static fromID(t){if(t<0)throw new Error("Number cannot be negative");if(t>Number.MAX_SAFE_INTEGER)throw new Error("Number is too large to fit in 32 bytes.");let r=new DataView(new ArrayBuffer(32));if(typeof r.setBigUint64=="function")r.setBigUint64(24,BigInt(t));else{let s=BigInt(1)<<BigInt(32);r.setUint32(24,Number(BigInt(t)>>BigInt(32))),r.setUint32(28,Number(BigInt(t)%s))}let n=new Uint8Array(r.buffer);return new vs(n)}toUint8Array(){return this.bytes}};BigInt(1095062083);BigInt(1347768404);var Ro=BigInt(1e4);BigInt(1e8);var tu=e=>({e8s:e}),Hm=({to:e,amount:t,memo:r,fee:n,fromSubAccount:s,createdAt:i})=>({to:e.toUint8Array(),fee:tu(n??Ro),amount:tu(t),memo:r??BigInt(0),created_at_time:i!==void 0?[{timestamp_nanos:i}]:[],from_subaccount:s===void 0?[]:[Ll(s)]}),zm=({fromSubAccount:e,to:t,amount:r,fee:n,icrc1Memo:s,createdAt:i})=>({to:t,fee:q(n??Ro),amount:r,memo:q(s),created_at_time:q(i),from_subaccount:q(e)}),Zm=({fee:e,createdAt:t,icrc1Memo:r,fromSubAccount:n,expected_allowance:s,expires_at:i,amount:a,...o})=>({...o,fee:q(e??Ro),memo:q(r),from_subaccount:q(n),created_at_time:q(t),amount:a,expected_allowance:q(s),expires_at:q(i)}),Ym=({userPreferences:{metadata:{utcOffsetMinutes:e,language:t},deriveSpec:r},...n})=>({...n,user_preferences:{metadata:{language:t,utc_offset_minutes:q(e)},device_spec:ss(r)?q():q("GenericDisplay"in r?{GenericDisplay:null}:{FieldsDisplay:null})}}),li=class extends Error{},un=class extends li{},er=class extends li{},di=class extends li{},So=class extends un{constructor(e){super(),this.balance=e}},rd=class extends un{constructor(e){super(),this.allowed_window_secs=e}},nd=class extends un{},sd=class extends un{constructor(e){super(),this.duplicateOf=e}},Ao=class extends li{constructor(e){super(),this.expectedFee=e}},id=class extends er{constructor(e,t){super(),this.message=e,this.error_code=t}},Wm=class extends er{},Xm=class extends er{constructor(e){super(),this.duplicateOf=e}},Jm=class extends er{constructor(e){super(),this.currentAllowance=e}},Qm=class extends er{},ey=class extends er{},ty=class extends er{constructor(e){super(),this.ledgerTime=e}},ry=class extends di{},ny=class extends di{},sy=class extends di{},iy=e=>"TxDuplicate"in e?new sd(e.TxDuplicate.duplicate_of):"InsufficientFunds"in e?new So(e.InsufficientFunds.balance.e8s):"TxCreatedInFuture"in e?new nd:"TxTooOld"in e?new rd(Number(e.TxTooOld.allowed_window_nanos)):"BadFee"in e?new Ao(e.BadFee.expected_fee.e8s):new un(`Unknown error type ${JSON.stringify(e)}`),ay=e=>"Duplicate"in e?new sd(e.Duplicate.duplicate_of):"InsufficientFunds"in e?new So(e.InsufficientFunds.balance):"CreatedInFuture"in e?new nd:"TooOld"in e?new rd:"BadFee"in e?new Ao(e.BadFee.expected_fee):new un(`Unknown error type ${JSON.stringify(e)}`),oy=e=>"GenericError"in e?new id(e.GenericError.message,e.GenericError.error_code):"TemporarilyUnavailable"in e?new Wm:"Duplicate"in e?new Xm(e.Duplicate.duplicate_of):"BadFee"in e?new Ao(e.BadFee.expected_fee):"AllowanceChanged"in e?new Jm(e.AllowanceChanged.current_allowance):"CreatedInFuture"in e?new Qm:"TooOld"in e?new ey:"Expired"in e?new ty(e.Expired.ledger_time):"InsufficientFunds"in e?new So(e.InsufficientFunds.balance):new er(`Unknown error type ${JSON.stringify(e)}`),cy=e=>"GenericError"in e?new id(e.GenericError.description,e.GenericError.error_code):"InsufficientPayment"in e?new ry(e.InsufficientPayment.description):"UnsupportedCanisterCall"in e?new ny(e.UnsupportedCanisterCall.description):"ConsentMessageUnavailable"in e?new sy(e.ConsentMessageUnavailable.description):new di(`Unknown error type ${JSON.stringify(e)}`),uy=D.fromText("ryjl3-tyaaa-aaaaa-aaaba-cai");D.fromText("qhbym-qaaaa-aaaaa-aaafq-cai");var ly=e=>e instanceof Gs?e:Gs.fromHex(e),dy=class ad extends Ml{static create(t={}){let r=t.canisterId??uy,{service:n,certifiedService:s}=To({options:{...t,canisterId:r},idlFactory:Cp,certifiedIdlFactory:Ap});return new ad(r,n,s)}accountBalance=async({accountIdentifier:t,certified:r=!0})=>{let n=ly(t);return(await(r?this.certifiedService:this.service).account_balance({account:n.toUint8Array()})).e8s};metadata=t=>{let{icrc1_metadata:r}=this.caller(t);return r()};transactionFee=async(t={certified:!1})=>{let{transfer_fee:r}=this.caller(t),{transfer_fee:{e8s:n}}=await r({});return n};transfer=async t=>{let r=Hm(t),n=await this.certifiedService.transfer(r);if("Err"in n)throw iy(n.Err);return n.Ok};icrc1Transfer=async t=>{let r=zm(t),n=await this.certifiedService.icrc1_transfer(r);if("Err"in n)throw ay(n.Err);return n.Ok};icrc2Approve=async t=>{let{icrc2_approve:r}=this.caller({certified:!0}),n=await r(Zm(t));if("Err"in n)throw oy(n.Err);return n.Ok};icrc21ConsentMessage=async t=>{let{icrc21_canister_call_consent_message:r}=this.caller({certified:!0}),n=await r(Ym(t));if("Err"in n)throw cy(n.Err);return n.Ok}};class _n{async ledgerApi(){const t=await nn();return dy.create({agent:t})}async balance(){try{const r=await(await nn()).getPrincipal(),n=Gs.fromPrincipal({principal:r});return await(await this.ledgerApi()).accountBalance({accountIdentifier:n})}catch(t){throw H(ce,t),t}}async canisterBalance(){try{const t=pt(),r=Gs.fromPrincipal({principal:t});return await(await this.ledgerApi()).accountBalance({accountIdentifier:r})}catch(t){throw H(ce,t),t}}async transfer(t,r,n,s,i){try{return await(await this.ledgerApi()).icrc1Transfer({to:{owner:t,subaccount:[r]},amount:n,icrc1Memo:s,fee:i})}catch(a){throw H(ce,a),a}}}var fy=class extends Error{},hy=class extends Error{},py=class extends Error{},my=class extends Error{},yy=class extends Error{},_a=({Err:e})=>{if("Refunded"in e)throw new fy(e.Refunded.reason);if("InvalidTransaction"in e)throw new hy(e.InvalidTransaction);if("Processing"in e)throw new my;if("TransactionTooOld"in e)throw new yy;if("Other"in e)throw new py(`Error in CMC with code ${e.Other.error_code}: ${e.Other.error_message}`);Dn(e,`Unsupported error type ${JSON.stringify(e,qp)}`)},_y=class od extends Ml{static create(t){let{service:r,certifiedService:n,canisterId:s}=To({options:t,idlFactory:Op,certifiedIdlFactory:Ip});return new od(s,r,n)}getIcpToCyclesConversionRate=async({certified:t}={})=>{let{data:r}=await this.caller({certified:t}).get_icp_xdr_conversion_rate();return r.xdr_permyriad_per_icp};notifyCreateCanister=async t=>{let{notify_create_canister:r}=this.service,n=await r(t);if("Err"in n&&_a(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyCreateCanister ${JSON.stringify(n)}`)};notifyTopUp=async t=>{let{notify_top_up:r}=this.service,n=await r(t);if("Err"in n&&_a(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyTopUp ${JSON.stringify(n)}`)};notifyMintCycles=async t=>{let{notify_mint_cycles:r}=this.service,n=await r(t);if("Err"in n&&_a(n),"Ok"in n)return n.Ok;throw new Error(`Unsupported response type in notifyMintCycles ${JSON.stringify(n)}`)};getDefaultSubnets=({certified:t}={})=>{let{get_default_subnets:r}=this.caller({certified:t});return r()};getSubnetTypesToSubnets=({certified:t}={})=>{let{get_subnet_types_to_subnets:r}=this.caller({certified:t});return r()}};class gy{async cmcApi(){const t=await nn();return _y.create({agent:t,canisterId:D.fromText(zl)})}async notifyTopUp(t,r){try{return await(await this.cmcApi()).notifyTopUp({canister_id:D.fromText(t),block_index:r})}catch(n){throw H(ce,n),n}}}class Co{constructor(){}static async create(){const t=new Co;return await t.fetchAndRenderBalance(),t.attachEventListeners(),t}async fetchAndRenderBalance(){const r=await new _n().balance(),n=Jl(r);dm(n);const i=await(await ui.create()).getPrincipal();fm(i.toText())}attachEventListeners(){Bt("top-up-btn","click",()=>this.performTopUp()),Bt("refresh-balance-btn","click",()=>this.refreshBalance())}async refreshBalance(){qe();try{await this.fetchAndRenderBalance()}catch(t){H(ce,t)}finally{je()}}async performTopUp(){qe();try{if(!await this.checkBalanceForTopUp()){we(Im);return}const s=await new _n().balance()-ha,i=await this.transferToCMC(s),a=new gy,c=pt().toString();await a.notifyTopUp(c,i),await this.updateBalanceAndStatus()}catch(t){H(ce,t)}finally{je()}}async updateBalanceAndStatus(){await Ln.refresh(),await this.fetchAndRenderBalance()}async checkBalanceForTopUp(){const r=await new _n().balance(),n=ha*2n;return r>=n}async transferToCMC(t){const r=new _n,n=pt(),s=Cm(n),i=D.fromText(zl);return await r.transfer(i,s,t,nm,ha)}}function by(){document.querySelectorAll(".copy-btn").forEach(e=>{e.addEventListener("click",cd)})}async function cd(e){const t=e.currentTarget,r=t.dataset.copyTarget;let s=t.dataset.copyText??"";if(!s&&r){const i=document.getElementById(r);if(!i)return;s=i.textContent?.trim()??""}if(!(!s||s==="Loading..."))try{await navigator.clipboard.writeText(s),wy(t)}catch(i){console.error("Failed to copy to clipboard:",i)}}function wy(e){e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1500)}function ud(e){e.addEventListener("click",cd)}class Bo{canisterId;iiPrincipal;controllersList=[];constructor(t,r){this.canisterId=t,this.iiPrincipal=r}static async create(t,r){const n=new Bo(t,r),s=await xn.getStatus();return n.controllersList=s.settings.controllers,n.renderControllersContent(),n.attachEventListeners(),n}renderControllersContent(){const t=Se("controllers-list");t.textContent="";for(const r of this.controllersList){const n=Yl(r.toString()),s=n.querySelector(".copy-btn");s&&ud(s),t.appendChild(n)}}attachEventListeners(){Bt("controller-add","click",()=>this.handleAdd()),Bt("controller-remove","click",()=>this.handleRemove())}async handleAdd(){const t=js("controller-input");if(!t)return;if(!Qc(t)){we(Zc),Je("controller-input");return}const r=D.fromText(t),n=[...this.controllersList,r],s=n.map(a=>a.toString());if(s.length!==new Set(s).size){we(Om),Je("controller-input");return}if(!this.hasRequiredPrincipals(n)){we(Jc),Je("controller-input");return}qe();try{await new Ks().updateControllers(n),await xn.refresh(),this.controllersList=n,Je("controller-input"),this.renderControllersContent()}catch(a){H(ce,a)}finally{je()}}async handleRemove(){const t=js("controller-input");if(!t)return;if(!Qc(t)){we(Zc),Je("controller-input");return}const r=D.fromText(t);if(!this.controllersList.some(i=>i.toString()===r.toString())){we(Rm),Je("controller-input");return}const s=this.controllersList.filter(i=>i.toString()!==r.toString());if(!this.hasRequiredPrincipals(s)){we(Jc),Je("controller-input");return}qe();try{await new Ks().updateControllers(s),await xn.refresh(),this.controllersList=s,Je("controller-input"),this.renderControllersContent()}catch(i){H(ce,i)}finally{je()}}hasRequiredPrincipals(t){const r=t.some(s=>s.toString()===this.canisterId.toString()),n=t.some(s=>s.toString()===this.iiPrincipal.toString());return r&&n}}class ld{canisterApi;ready;constructor(){this.ready=this.create()}async create(){const t=await nn(),r=pt();this.canisterApi=Kl({agent:t,canisterId:r})}async manageAlternativeOrigins(t){try{return await this.ready,await this.canisterApi.manage_alternative_origins(t)}catch(r){throw H(ce,r),r}}async manageTopUpRule(t){try{return await this.ready,await this.canisterApi.manage_top_up_rule(t)}catch(r){throw H(ce,r),r}}}const ru=3e3;class Vo{canisterApi;constructor(){this.canisterApi=new ld}static async create(){const t=new Vo;return await t.initializeDisplay(),t.attachEventListeners(),t}async initializeDisplay(){const t=await this.fetchAlternativeOrigins();this.renderAlternativeOriginsContent(t)}renderAlternativeOriginsContent(t){const r=Se("alternative-origins-list");r.textContent="";for(const n of t){const s=Yl(n),i=s.querySelector(".copy-btn");i&&ud(i),r.appendChild(s)}}async fetchAlternativeOrigins(){try{const t=await fetch("/.well-known/ii-alternative-origins");return t.ok?(await t.json()).alternativeOrigins:(H(ce),[])}catch(t){return H(ce,t),[]}}attachEventListeners(){Bt("alternative-origin-add","click",()=>this.handleAdd()),Bt("alternative-origin-remove","click",()=>this.handleRemove())}async handleAdd(){const t=js("alternative-origin-input");if(t){if(!Sm(t)){we(_m),Je("alternative-origin-input");return}qe();try{const r=await this.canisterApi.manageAlternativeOrigins({Add:t});if("Ok"in r)await new Promise(n=>setTimeout(n,ru)),await this.initializeDisplay(),Je("alternative-origin-input");else if("Err"in r){const n=r.Err;H(ce+` (${n})`)}else H("Unknown error adding alternative origin"),H(vm)}catch(r){H(Em,r)}finally{je()}}}async handleRemove(){const t=js("alternative-origin-input");if(t){qe();try{const r=await this.canisterApi.manageAlternativeOrigins({Remove:t});if("Ok"in r)await new Promise(n=>setTimeout(n,ru)),await this.initializeDisplay(),Je("alternative-origin-input");else if("Err"in r){const n=r.Err;H(ce+` (${n})`)}else H("Unknown error removing alternative origin"),H(Tm)}catch(r){H(Nm,r)}finally{je()}}}}class ko{constructor(){}static async create(){const t=new ko;return await t.renderLogs(),t.attachEventListeners(),t}attachEventListeners(){Bt("refresh-logs-btn","click",()=>this.refreshLogs())}async refreshLogs(){qe(),await this.renderLogs(),je()}async renderLogs(){try{const t=new Ks,{canister_log_records:r}=await t.getCanisterLogs(),n=Se("logs-list");if(r.length===0){n.innerHTML='<li class="data-display">No logs found.</li>';return}const s=r.reverse().map(i=>{const a=i.content instanceof Uint8Array?i.content:Uint8Array.from(i.content),o=new TextDecoder().decode(a),c=Number(i.timestamp_nanos/1000000n),l=new Date(c),f=isNaN(l.getTime())?"Unknown time":xy(l),d=i.idx.toString(),u=Ey(o).replace(/\r\n|\n|\r/g,"<br>");return`<li class="data-display">[${f}] (#${d})<br>${u}</li>`}).join("");n.innerHTML=s}catch(t){H(ce,t)}}}function yn(e){return e.toString().padStart(2,"0")}function xy(e){const t=e.getFullYear(),r=yn(e.getMonth()+1),n=yn(e.getDate()),s=yn(e.getHours()),i=yn(e.getMinutes()),a=yn(e.getSeconds());return`${t}-${r}-${n} ${s}:${i}:${a}`}function Ey(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}class Fo{api=new ld;constructor(){}static async create(){const t=new Fo;return await Promise.all([t.fetchAndRender(),t.renderCanisterInfo()]),t.attachEventListeners(),t}async renderCanisterInfo(){const t=pt(),r=await new _n().canisterBalance(),n=t.toString(),s=Jl(r);hm(n,s)}attachEventListeners(){Bt("top-up-rule-set","click",()=>this.handleSet()),Bt("top-up-rule-clear","click",()=>this.handleClear())}async fetchAndRender(){try{this.render(await this.api.manageTopUpRule({Get:null}))}catch(t){H(ce,t)}}render(t){if("Err"in t)return we(Wc+" "+t.Err);if("Ok"in t){const r=t.Ok[0];pm(r?Ny(r):null)}}async handleSet(){const t=ma("top-up-rule-interval"),r=ma("top-up-rule-threshold"),n=ma("top-up-rule-amount");if(!r||!n)return we(gm);qe();try{const s=await this.api.manageTopUpRule({Add:{interval:Oy(t),cycles_threshold:su(r),cycles_amount:su(n)}});if("Err"in s)return we(s.Err);await this.fetchAndRender()}catch(s){H(Xc+" "+ce,s)}finally{je()}}async handleClear(){qe();try{const t=await this.api.manageTopUpRule({Clear:null});if("Err"in t)return we(Wc+" "+t.Err);await this.fetchAndRender()}catch(t){H(Xc+" "+ce,t)}finally{je()}}}function dd(e){if(e)return Object.keys(e)[0]}function nu(e){const t=dd(e);return t?t.replace(/^_/,"").replace("_","."):"Unknown"}function vy(e){return dd(e)||"Unknown"}function Ny(e){return[`Interval: ${vy(e.interval)}`,`Threshold: ${nu(e.cycles_threshold)} cycles`,`Amount: ${nu(e.cycles_amount)} cycles`].join(`
`)}const Ty={_0_25T:{_0_25T:null},_0_5T:{_0_5T:null},_1T:{_1T:null},_2T:{_2T:null},_5T:{_5T:null},_10T:{_10T:null},_50T:{_50T:null},_100T:{_100T:null}},Iy={Hourly:{Hourly:null},Daily:{Daily:null},Weekly:{Weekly:null},Monthly:{Monthly:null}};function su(e){const t=Ty[e];if(!t)throw new Error(`Invalid cycles amount: ${e}`);return t}function Oy(e){const t=Iy[e];return t||{Monthly:null}}const fd="canister-dashboard-theme";function Ry(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function hd(){const e=localStorage.getItem(fd);return e==="light"||e==="dark"?e:null}function pd(){return hd()??Ry()}function Da(e){document.documentElement.dataset.theme=e}function Sy(){const t=pd()==="dark"?"light":"dark";localStorage.setItem(fd,t),Da(t)}function Ay(){const e=pd();Da(e);const t=document.getElementById("theme-toggle");t&&t.addEventListener("click",Sy),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",r=>{hd()||Da(r.matches?"dark":"light")})}class Cy{authManager=null;currentState="initializing";managers={topup:null,topUpRule:null,status:null,controllers:null,alternativeOrigins:null,canisterLogs:null};constructor(){this.initialize()}async initialize(){try{this.setState("initializing"),qe(),this.authManager=await ui.create(),await this.checkAuthenticationState()}catch(t){console.error("Dashboard initialization error:",t),this.setState("error"),we(ym)}finally{je()}}async checkAuthenticationState(){if(!this.authManager)return H(ms);try{await this.authManager.isAuthenticated()?await this.transitionToLoggedIn():this.transitionToLoggedOut()}catch(t){console.error("Authentication check failed:",t),this.transitionToLoggedOut()}}async transitionToLoggedIn(){if(!this.authManager)return H(ms);try{this.setState("logged-in");const t=await this.authManager.getPrincipal(),r=t.toText();um(r,()=>this.handleLogout());const n=pt();await this.initializeManagers(n,t)}catch(t){console.error("Failed to transition to logged in state:",t),this.transitionToLoggedOut()}}transitionToLoggedOut(){this.setState("logged-out"),this.clearManagers(),lm(()=>this.handleLogin())}setState(t){this.currentState=t}async initializeManagers(t,r){try{qe();const[n,s,i,a,o,c]=await Promise.all([Co.create(),Fo.create(),Ln.create(),Bo.create(t,r),Vo.create(),ko.create()]);this.managers.topup=n,this.managers.topUpRule=s,this.managers.status=i,this.managers.controllers=a,this.managers.alternativeOrigins=o,this.managers.canisterLogs=c}finally{je()}}clearManagers(){this.managers.topup=null,this.managers.topUpRule=null,this.managers.status=null,this.managers.controllers=null,this.managers.alternativeOrigins=null,this.managers.canisterLogs=null}async handleLogin(){if(!this.authManager)return H(ms);if(this.currentState!=="logging-in")try{await this.authManager.logout().catch(()=>{}),this.setState("logging-in"),qe(),zc(),await this.authManager.login(),await this.authManager.isAuthenticated()?await this.transitionToLoggedIn():this.transitionToLoggedOut()}catch(t){console.error("Login failed:",t),this.setState("error"),this.transitionToLoggedOut()}finally{je()}}async handleLogout(){if(!this.authManager)return H(ms);try{qe(),zc(),await this.authManager.logout(),this.transitionToLoggedOut()}catch(t){console.error("Logout failed:",t),we(Wl)}finally{je()}}}document.addEventListener("DOMContentLoaded",()=>{Ay(),by(),new Cy});
